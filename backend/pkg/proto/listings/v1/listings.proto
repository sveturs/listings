syntax = "proto3";

package listings.v1;

import "google/protobuf/empty.proto";
import "google/protobuf/field_mask.proto";
import "google/protobuf/struct.proto";
import "google/protobuf/timestamp.proto";

option go_package = "github.com/sveturs/listings/api/proto/listings/v1;listingsv1";

// ListingsService provides RPC methods for managing marketplace listings
service ListingsService {
  // === Core Listing Operations ===

  // GetListing retrieves a single listing by ID
  rpc GetListing(GetListingRequest) returns (GetListingResponse);

  // CreateListing creates a new listing
  rpc CreateListing(CreateListingRequest) returns (CreateListingResponse);

  // UpdateListing updates an existing listing
  rpc UpdateListing(UpdateListingRequest) returns (UpdateListingResponse);

  // DeleteListing soft-deletes a listing
  rpc DeleteListing(DeleteListingRequest) returns (DeleteListingResponse);

  // SearchListings performs full-text search on listings
  rpc SearchListings(SearchListingsRequest) returns (SearchListingsResponse);

  // ListListings returns a paginated list of listings
  rpc ListListings(ListListingsRequest) returns (ListListingsResponse);

  // === Image Management (HIGH PRIORITY) ===

  // GetListingImage retrieves a single image by ID
  rpc GetListingImage(ImageIDRequest) returns (ImageResponse);

  // DeleteListingImage removes an image from a listing
  rpc DeleteListingImage(ImageIDRequest) returns (google.protobuf.Empty);

  // AddListingImage adds a new image to a listing
  rpc AddListingImage(AddImageRequest) returns (ImageResponse);

  // GetListingImages retrieves all images for a listing
  rpc GetListingImages(ListingIDRequest) returns (ImagesResponse);

  // === Category Management (HIGH PRIORITY) ===

  // GetRootCategories retrieves all top-level categories (no parent)
  rpc GetRootCategories(google.protobuf.Empty) returns (CategoriesResponse);

  // GetAllCategories retrieves all categories in the system
  rpc GetAllCategories(google.protobuf.Empty) returns (CategoriesResponse);

  // GetPopularCategories retrieves most popular categories by listing count
  rpc GetPopularCategories(PopularCategoriesRequest) returns (CategoriesResponse);

  // GetCategory retrieves a single category by ID
  rpc GetCategory(CategoryIDRequest) returns (CategoryResponse);

  // GetCategoryTree retrieves category hierarchy starting from a node
  rpc GetCategoryTree(CategoryIDRequest) returns (CategoryTreeResponse);

  // === Favorites Management (MEDIUM PRIORITY) ===

  // GetFavoritedUsers retrieves list of user IDs who favorited a listing
  rpc GetFavoritedUsers(ListingIDRequest) returns (UserIDsResponse);

  // AddToFavorites adds a listing to user's favorites
  rpc AddToFavorites(AddToFavoritesRequest) returns (google.protobuf.Empty);

  // RemoveFromFavorites removes a listing from user's favorites
  rpc RemoveFromFavorites(RemoveFromFavoritesRequest) returns (google.protobuf.Empty);

  // GetUserFavorites retrieves list of listing IDs favorited by a user
  rpc GetUserFavorites(GetUserFavoritesRequest) returns (GetUserFavoritesResponse);

  // IsFavorite checks if a listing is in user's favorites
  rpc IsFavorite(IsFavoriteRequest) returns (IsFavoriteResponse);

  // === Storefronts Management (HIGH PRIORITY) ===

  // GetStorefront retrieves a single storefront by ID
  rpc GetStorefront(GetStorefrontRequest) returns (StorefrontResponse);

  // GetStorefrontBySlug retrieves a storefront by slug
  rpc GetStorefrontBySlug(GetStorefrontBySlugRequest) returns (StorefrontResponse);

  // ListStorefronts returns a paginated list of storefronts
  rpc ListStorefronts(ListStorefrontsRequest) returns (ListStorefrontsResponse);

  // === Variants Management (MEDIUM PRIORITY) ===

  // CreateVariants creates multiple variants for a listing
  rpc CreateVariants(CreateVariantsRequest) returns (google.protobuf.Empty);

  // GetVariants retrieves all variants for a listing
  rpc GetVariants(ListingIDRequest) returns (VariantsResponse);

  // UpdateVariant updates a specific variant
  rpc UpdateVariant(UpdateVariantRequest) returns (google.protobuf.Empty);

  // DeleteVariant removes a variant from a listing
  rpc DeleteVariant(VariantIDRequest) returns (google.protobuf.Empty);

  // === Reindexing Support (MEDIUM PRIORITY) ===

  // GetListingsForReindex retrieves listings that need reindexing
  rpc GetListingsForReindex(ReindexRequest) returns (ListingsResponse);

  // ResetReindexFlags resets reindex flags for specified listings
  rpc ResetReindexFlags(ResetFlagsRequest) returns (google.protobuf.Empty);

  // SyncDiscounts synchronizes discount information across listings
  rpc SyncDiscounts(google.protobuf.Empty) returns (google.protobuf.Empty);

  // === Products Management (HIGH PRIORITY) ===

  // GetProduct retrieves a single product by ID
  rpc GetProduct(GetProductRequest) returns (ProductResponse);

  // GetProductsBySKUs retrieves multiple products by their SKUs
  rpc GetProductsBySKUs(GetProductsBySKUsRequest) returns (ProductsResponse);

  // GetProductsByIDs retrieves multiple products by their IDs
  rpc GetProductsByIDs(GetProductsByIDsRequest) returns (ProductsResponse);

  // ListProducts returns a paginated list of products for a storefront
  rpc ListProducts(ListProductsRequest) returns (ProductsResponse);

  // === Product Variants Management (HIGH PRIORITY) ===

  // GetVariant retrieves a single product variant by ID
  rpc GetVariant(GetVariantRequest) returns (VariantResponse);

  // GetVariantsByProductID retrieves all variants for a product
  rpc GetVariantsByProductID(GetVariantsByProductIDRequest) returns (ProductVariantsResponse);

  // === Stock Management (CRITICAL for Order Processing) ===

  // DecrementStock atomically decrements stock for multiple products/variants
  // Used during order creation to reserve inventory
  rpc DecrementStock(DecrementStockRequest) returns (DecrementStockResponse);

  // RollbackStock restores stock if order creation fails
  // Compensating transaction for failed orders
  rpc RollbackStock(RollbackStockRequest) returns (RollbackStockResponse);

  // CheckStockAvailability verifies if requested quantities are available
  // Used for validation before order creation
  rpc CheckStockAvailability(CheckStockAvailabilityRequest) returns (CheckStockAvailabilityResponse);

  // === Product CRUD Operations (Phase 9.5.2) ===

  // CreateProduct creates a new B2C product
  // Transaction: Creates product + initializes stock record
  rpc CreateProduct(CreateProductRequest) returns (ProductResponse);

  // UpdateProduct updates an existing B2C product (partial update)
  // Supports field masking for efficient updates
  rpc UpdateProduct(UpdateProductRequest) returns (ProductResponse);

  // DeleteProduct removes a product (soft delete by default)
  // Cascade behavior: Soft-deletes all variants, images, reservations
  rpc DeleteProduct(DeleteProductRequest) returns (DeleteProductResponse);

  // BulkCreateProducts creates multiple products in a single transaction
  // Recommended batch size: 1-1000 items
  rpc BulkCreateProducts(BulkCreateProductsRequest) returns (BulkCreateProductsResponse);

  // BulkUpdateProducts updates multiple products in a single transaction
  // Supports partial updates via field mask per product
  rpc BulkUpdateProducts(BulkUpdateProductsRequest) returns (BulkUpdateProductsResponse);

  // BulkDeleteProducts deletes multiple products in a single transaction
  // Cascade behavior: Deletes all associated variants, images, reservations
  rpc BulkDeleteProducts(BulkDeleteProductsRequest) returns (BulkDeleteProductsResponse);

  // === Product Variant CRUD Operations (Phase 9.5.2) ===

  // CreateProductVariant creates a new variant for a product
  // Transaction: Creates variant + initializes stock record
  rpc CreateProductVariant(CreateProductVariantRequest) returns (VariantResponse);

  // UpdateProductVariant updates an existing product variant
  // Supports partial updates via field mask
  rpc UpdateProductVariant(UpdateProductVariantRequest) returns (VariantResponse);

  // DeleteProductVariant removes a variant from a product
  rpc DeleteProductVariant(DeleteProductVariantRequest) returns (DeleteProductVariantResponse);

  // BulkCreateProductVariants creates multiple variants for a product
  // Recommended for product imports with size/color matrices
  rpc BulkCreateProductVariants(BulkCreateProductVariantsRequest) returns (BulkCreateProductVariantsResponse);

  // === Inventory Management (Phase 9.5.2) ===

  // RecordInventoryMovement tracks stock changes (in, out, adjustment)
  // Creates audit trail in b2c_inventory_movements table
  rpc RecordInventoryMovement(RecordInventoryMovementRequest) returns (RecordInventoryMovementResponse);

  // BatchUpdateStock updates stock for multiple products/variants atomically
  // Useful for bulk inventory adjustments
  rpc BatchUpdateStock(BatchUpdateStockRequest) returns (BatchUpdateStockResponse);

  // GetProductStats retrieves statistics for storefront products
  // Returns counts, values, and stock status breakdown
  rpc GetProductStats(GetProductStatsRequest) returns (GetProductStatsResponse);

  // IncrementProductViews increments view counter for analytics
  // Used when customer views product detail page
  rpc IncrementProductViews(IncrementProductViewsRequest) returns (google.protobuf.Empty);
}

// ============================================================================
// Core Entity Messages
// ============================================================================

// Listing represents a marketplace listing
message Listing {
  int64 id = 1;
  string uuid = 2;
  int64 user_id = 3;
  optional int64 storefront_id = 4;
  string title = 5;
  optional string description = 6;
  double price = 7;
  string currency = 8;
  int64 category_id = 9;
  string status = 10;
  string visibility = 11;
  int32 quantity = 12;
  optional string sku = 13;
  int32 views_count = 14;
  int32 favorites_count = 15;
  string created_at = 16;
  string updated_at = 17;
  optional string published_at = 18;
  optional string deleted_at = 19;
  bool is_deleted = 20;

  // Relations
  repeated ListingImage images = 21;
  repeated ListingAttribute attributes = 22;
  repeated string tags = 23;
  optional ListingLocation location = 24;
  repeated ListingVariant variants = 25;
}

// ListingImage represents an image associated with a listing
message ListingImage {
  int64 id = 1;
  int64 listing_id = 2;
  string url = 3;
  optional string storage_path = 4;
  optional string thumbnail_url = 5;
  int32 display_order = 6;
  bool is_primary = 7;
  optional int32 width = 8;
  optional int32 height = 9;
  optional int64 file_size = 10;
  optional string mime_type = 11;
  string created_at = 12;
  string updated_at = 13;
}

// ListingAttribute represents flexible key-value attributes
message ListingAttribute {
  int64 id = 1;
  int64 listing_id = 2;
  string attribute_key = 3;
  string attribute_value = 4;
  string created_at = 5;
}

// ListingLocation represents geographic location
message ListingLocation {
  int64 id = 1;
  int64 listing_id = 2;
  optional string country = 3;
  optional string city = 4;
  optional string postal_code = 5;
  optional string address_line1 = 6;
  optional string address_line2 = 7;
  optional double latitude = 8;
  optional double longitude = 9;
  string created_at = 10;
  string updated_at = 11;
}

// ListingVariant represents a product variant
message ListingVariant {
  int64 id = 1;
  int64 listing_id = 2;
  string sku = 3;
  optional double price = 4;
  optional int32 stock = 5;
  map<string, string> attributes = 6;
  optional string image_url = 7;
  bool is_active = 8;
  optional string created_at = 9;
  optional string updated_at = 10;
}

// Category represents a marketplace category
message Category {
  int64 id = 1;
  string name = 2;
  string slug = 3;
  optional int64 parent_id = 4;
  optional string icon = 5;
  optional string description = 6;
  bool is_active = 7;
  int32 listing_count = 8;
  int32 sort_order = 9;
  int32 level = 10;
  map<string, string> translations = 11;
  bool has_custom_ui = 12;
  optional string custom_ui_component = 13;
  string created_at = 14;
}

// CategoryTreeNode represents a category with its children
message CategoryTreeNode {
  int64 id = 1;
  string name = 2;
  string slug = 3;
  optional string icon = 4;
  optional int64 parent_id = 5;
  int32 level = 6;
  string path = 7;
  int32 listing_count = 8;
  int32 children_count = 9;
  repeated CategoryTreeNode children = 10;
  map<string, string> translations = 11;
  bool has_custom_ui = 12;
  optional string custom_ui_component = 13;
  string created_at = 14;
}

// Product represents a B2C product
message Product {
  int64 id = 1;
  int64 storefront_id = 2;
  string name = 3;
  string description = 4;
  double price = 5;
  string currency = 6;
  int64 category_id = 7;
  optional string sku = 8;
  optional string barcode = 9;
  int32 stock_quantity = 10;
  string stock_status = 11;
  bool is_active = 12;
  google.protobuf.Struct attributes = 13;
  int32 view_count = 14;
  int32 sold_count = 15;
  google.protobuf.Timestamp created_at = 16;
  google.protobuf.Timestamp updated_at = 17;
  bool has_individual_location = 18;
  optional string individual_address = 19;
  optional double individual_latitude = 20;
  optional double individual_longitude = 21;
  optional string location_privacy = 22;
  bool show_on_map = 23;
  bool has_variants = 24;
  repeated ProductVariant variants = 25;
}

// ProductVariant represents a product variant with specific attributes
message ProductVariant {
  int64 id = 1;
  int64 product_id = 2;
  optional string sku = 3;
  optional string barcode = 4;
  optional double price = 5;
  optional double compare_at_price = 6;
  optional double cost_price = 7;
  int32 stock_quantity = 8;
  string stock_status = 9;
  optional int32 low_stock_threshold = 10;
  google.protobuf.Struct variant_attributes = 11;
  optional double weight = 12;
  google.protobuf.Struct dimensions = 13;
  bool is_active = 14;
  bool is_default = 15;
  int32 view_count = 16;
  int32 sold_count = 17;
  google.protobuf.Timestamp created_at = 18;
  google.protobuf.Timestamp updated_at = 19;
}

// ============================================================================
// Request/Response Messages - Core Listing Operations
// ============================================================================

// GetListing messages
message GetListingRequest {
  int64 id = 1;
}

message GetListingResponse {
  Listing listing = 1;
}

// CreateListing messages
message CreateListingRequest {
  int64 user_id = 1;
  optional int64 storefront_id = 2;
  string title = 3;
  optional string description = 4;
  double price = 5;
  string currency = 6;
  int64 category_id = 7;
  int32 quantity = 8;
  optional string sku = 9;
}

message CreateListingResponse {
  Listing listing = 1;
}

// UpdateListing messages
message UpdateListingRequest {
  int64 id = 1;
  int64 user_id = 2; // Required for ownership check
  optional string title = 3;
  optional string description = 4;
  optional double price = 5;
  optional int32 quantity = 6;
  optional string status = 7;
}

message UpdateListingResponse {
  Listing listing = 1;
}

// DeleteListing messages
message DeleteListingRequest {
  int64 id = 1;
  int64 user_id = 2; // Required for ownership check
}

message DeleteListingResponse {
  bool success = 1;
}

// SearchListings messages
message SearchListingsRequest {
  string query = 1;
  optional int64 category_id = 2;
  optional double min_price = 3;
  optional double max_price = 4;
  int32 limit = 5;
  int32 offset = 6;
}

message SearchListingsResponse {
  repeated Listing listings = 1;
  int32 total = 2;
}

// ListListings messages
message ListListingsRequest {
  optional int64 user_id = 1;
  optional int64 storefront_id = 2;
  optional int64 category_id = 3;
  optional string status = 4;
  optional double min_price = 5;
  optional double max_price = 6;
  int32 limit = 7;
  int32 offset = 8;
}

message ListListingsResponse {
  repeated Listing listings = 1;
  int32 total = 2;
}

// ============================================================================
// Request/Response Messages - Image Management
// ============================================================================

// ImageIDRequest requests an image by ID
message ImageIDRequest {
  int64 image_id = 1;
}

// ImageResponse returns a single image
message ImageResponse {
  ListingImage image = 1;
}

// AddImageRequest adds a new image to a listing
message AddImageRequest {
  int64 listing_id = 1;
  string url = 2;
  optional string storage_path = 3;
  optional string thumbnail_url = 4;
  int32 display_order = 5;
  bool is_primary = 6;
  optional int32 width = 7;
  optional int32 height = 8;
  optional int64 file_size = 9;
  optional string mime_type = 10;
}

// ListingIDRequest requests data by listing ID
message ListingIDRequest {
  int64 listing_id = 1;
}

// ImagesResponse returns multiple images
message ImagesResponse {
  repeated ListingImage images = 1;
}

// ============================================================================
// Request/Response Messages - Category Management
// ============================================================================

// PopularCategoriesRequest requests popular categories
message PopularCategoriesRequest {
  int32 limit = 1; // Maximum number of categories to return
}

// CategoriesResponse returns multiple categories
message CategoriesResponse {
  repeated Category categories = 1;
}

// CategoryIDRequest requests a category by ID
message CategoryIDRequest {
  int64 category_id = 1;
}

// CategoryResponse returns a single category
message CategoryResponse {
  Category category = 1;
}

// CategoryTreeResponse returns category tree
message CategoryTreeResponse {
  CategoryTreeNode tree = 1;
}

// ============================================================================
// Request/Response Messages - Favorites Management
// ============================================================================

// UserIDsResponse returns list of user IDs
message UserIDsResponse {
  repeated int64 user_ids = 1;
}

// AddToFavoritesRequest adds a listing to favorites
message AddToFavoritesRequest {
  int64 user_id = 1;
  int64 listing_id = 2;
}

// RemoveFromFavoritesRequest removes a listing from favorites
message RemoveFromFavoritesRequest {
  int64 user_id = 1;
  int64 listing_id = 2;
}

// GetUserFavoritesRequest retrieves user's favorites
message GetUserFavoritesRequest {
  int64 user_id = 1;
  int32 limit = 2;
  int32 offset = 3;
}

// GetUserFavoritesResponse returns list of favorited listing IDs
message GetUserFavoritesResponse {
  repeated int64 listing_ids = 1;
  int32 total = 2;
}

// IsFavoriteRequest checks if listing is favorited
message IsFavoriteRequest {
  int64 user_id = 1;
  int64 listing_id = 2;
}

// IsFavoriteResponse returns favorite status
message IsFavoriteResponse {
  bool is_favorite = 1;
}

// ============================================================================
// Request/Response Messages - Storefronts Management
// ============================================================================

// Storefront represents a B2C store
message Storefront {
  int64 id = 1;
  int64 user_id = 2;
  string slug = 3;
  string name = 4;
  optional string description = 5;
  optional string logo_url = 6;
  optional string banner_url = 7;
  optional string phone = 8;
  optional string email = 9;
  optional string website = 10;
  optional string address = 11;
  optional string city = 12;
  optional string postal_code = 13;
  string country = 14;
  optional double latitude = 15;
  optional double longitude = 16;
  bool is_active = 17;
  bool is_verified = 18;
  double rating = 19;
  int32 reviews_count = 20;
  int32 products_count = 21;
  int32 sales_count = 22;
  int32 views_count = 23;
  int32 followers_count = 24;
  string created_at = 25;
  string updated_at = 26;
}

// GetStorefrontRequest requests a storefront by ID
message GetStorefrontRequest {
  int64 id = 1;
}

// GetStorefrontBySlugRequest requests a storefront by slug
message GetStorefrontBySlugRequest {
  string slug = 1;
}

// StorefrontResponse returns a single storefront
message StorefrontResponse {
  Storefront storefront = 1;
}

// ListStorefrontsRequest requests a list of storefronts
message ListStorefrontsRequest {
  optional int64 user_id = 1;
  optional bool is_active = 2;
  optional bool is_verified = 3;
  optional string city = 4;
  int32 limit = 5;
  int32 offset = 6;
  optional string sort_by = 7;
  optional string sort_order = 8;
}

// ListStorefrontsResponse returns multiple storefronts
message ListStorefrontsResponse {
  repeated Storefront storefronts = 1;
  int32 total = 2;
}

// ============================================================================
// Request/Response Messages - Variants Management
// ============================================================================

// CreateVariantsRequest creates multiple variants
message CreateVariantsRequest {
  int64 listing_id = 1;
  repeated VariantInput variants = 2;
}

// VariantInput represents input data for creating a variant
message VariantInput {
  string sku = 1;
  optional double price = 2;
  optional int32 stock = 3;
  map<string, string> attributes = 4;
  optional string image_url = 5;
  bool is_active = 6;
}

// VariantsResponse returns multiple variants
message VariantsResponse {
  repeated ListingVariant variants = 1;
}

// UpdateVariantRequest updates a variant
message UpdateVariantRequest {
  int64 variant_id = 1;
  optional string sku = 2;
  optional double price = 3;
  optional int32 stock = 4;
  optional string image_url = 5;
  optional bool is_active = 6;
  map<string, string> attributes = 7;
}

// VariantIDRequest requests a variant by ID
message VariantIDRequest {
  int64 variant_id = 1;
}

// ============================================================================
// Request/Response Messages - Reindexing Support
// ============================================================================

// ReindexRequest requests listings for reindexing
message ReindexRequest {
  int32 batch_size = 1;
  optional int64 last_id = 2; // For cursor-based pagination
}

// ListingsResponse returns multiple listings
message ListingsResponse {
  repeated Listing listings = 1;
  int32 total = 2;
  optional int64 next_cursor = 3; // Next cursor for pagination
}

// ResetFlagsRequest resets reindex flags
message ResetFlagsRequest {
  repeated int64 listing_ids = 1;
}

// ============================================================================
// Request/Response Messages - Products Management
// ============================================================================

// GetProductRequest retrieves a single product by ID
message GetProductRequest {
  int64 product_id = 1;
  optional int64 storefront_id = 2;
}

// ProductResponse returns a single product
message ProductResponse {
  Product product = 1;
}

// GetProductsBySKUsRequest retrieves products by SKUs
message GetProductsBySKUsRequest {
  repeated string skus = 1;
  optional int64 storefront_id = 2;
}

// ProductsResponse returns multiple products
message ProductsResponse {
  repeated Product products = 1;
  int32 total_count = 2;
}

// GetProductsByIDsRequest retrieves products by IDs
message GetProductsByIDsRequest {
  repeated int64 product_ids = 1;
  optional int64 storefront_id = 2;
}

// ListProductsRequest requests a paginated list of products
message ListProductsRequest {
  int64 storefront_id = 1;
  int32 page = 2;
  int32 page_size = 3;
  optional bool is_active_only = 4;
}

// GetVariantRequest retrieves a single variant by ID
message GetVariantRequest {
  int64 variant_id = 1;
  optional int64 product_id = 2;
}

// VariantResponse returns a single product variant
message VariantResponse {
  ProductVariant variant = 1;
}

// GetVariantsByProductIDRequest retrieves variants by product ID
message GetVariantsByProductIDRequest {
  int64 product_id = 1;
  optional bool is_active_only = 2;
}

// ProductVariantsResponse returns multiple product variants
message ProductVariantsResponse {
  repeated ProductVariant variants = 1;
}

// ============================================================================
// Request/Response Messages - Stock Management
// ============================================================================

// StockItem represents a product or variant quantity to decrement
message StockItem {
  int64 product_id = 1;
  optional int64 variant_id = 2; // If null, decrement product stock
  int32 quantity = 3;
}

// StockResult represents the result of stock operation for a single item
message StockResult {
  int64 product_id = 1;
  optional int64 variant_id = 2;
  int32 stock_before = 3;
  int32 stock_after = 4;
  bool success = 5;
  optional string error = 6; // Error message if failed
}

// DecrementStockRequest decrements stock for multiple items atomically
message DecrementStockRequest {
  repeated StockItem items = 1;
  optional string order_id = 2; // For logging/tracking
}

// DecrementStockResponse returns results of stock decrement operation
message DecrementStockResponse {
  bool success = 1;
  optional string error = 2; // General error message
  repeated StockResult results = 3; // Individual item results
}

// RollbackStockRequest restores stock (compensating transaction)
message RollbackStockRequest {
  repeated StockItem items = 1;
  optional string order_id = 2; // For logging/tracking
}

// RollbackStockResponse confirms stock restoration
message RollbackStockResponse {
  bool success = 1;
  optional string error = 2;
  repeated StockResult results = 3;
}

// CheckStockAvailabilityRequest checks if quantities are available
message CheckStockAvailabilityRequest {
  repeated StockItem items = 1;
}

// StockAvailability represents availability status for a single item
message StockAvailability {
  int64 product_id = 1;
  optional int64 variant_id = 2;
  int32 requested_quantity = 3;
  int32 available_quantity = 4;
  bool is_available = 5;
}

// CheckStockAvailabilityResponse returns availability for all items
message CheckStockAvailabilityResponse {
  bool all_available = 1; // True if ALL items available
  repeated StockAvailability items = 2;
}

// ============================================================================
// Request/Response Messages - Product CRUD Operations (Phase 9.5.2)
// ============================================================================

// CreateProductRequest creates a new product
message CreateProductRequest {
  int64 storefront_id = 1; // Required for ownership
  string name = 2; // Required, 1-500 characters
  string description = 3; // Optional, up to 5000 characters
  double price = 4; // Required, must be > 0
  string currency = 5; // Required, ISO 4217 code (USD, EUR, etc.)
  int64 category_id = 6; // Required, must exist
  optional string sku = 7; // Optional, must be unique in storefront
  optional string barcode = 8; // Optional (EAN, UPC, etc.)
  int32 stock_quantity = 9; // Initial stock, default 0
  bool is_active = 10; // Default true
  google.protobuf.Struct attributes = 11; // Custom attributes (brand, model, etc.)

  // Location fields (optional)
  bool has_individual_location = 12;
  optional string individual_address = 13;
  optional double individual_latitude = 14;
  optional double individual_longitude = 15;
  optional string location_privacy = 16; // "public", "approximate", "hidden"
  bool show_on_map = 17;

  bool has_variants = 18; // If true, create as variant parent
}

// UpdateProductRequest updates product fields (partial update)
message UpdateProductRequest {
  int64 product_id = 1; // Required
  int64 storefront_id = 2; // Required for ownership validation

  // Fields to update (optional)
  optional string name = 3;
  optional string description = 4;
  optional double price = 5;
  optional string currency = 6;
  optional int64 category_id = 7;
  optional string sku = 8;
  optional string barcode = 9;
  optional bool is_active = 10;
  optional google.protobuf.Struct attributes = 11;

  // Location updates
  optional bool has_individual_location = 12;
  optional string individual_address = 13;
  optional double individual_latitude = 14;
  optional double individual_longitude = 15;
  optional string location_privacy = 16;
  optional bool show_on_map = 17;

  // Field mask for partial updates (recommended)
  optional google.protobuf.FieldMask update_mask = 18;
}

// DeleteProductRequest removes a product
message DeleteProductRequest {
  int64 product_id = 1; // Required
  int64 storefront_id = 2; // Required for ownership validation
  bool hard_delete = 3; // Default false (soft delete)
}

// DeleteProductResponse confirms deletion
message DeleteProductResponse {
  bool success = 1;
  optional string message = 2; // Error or warning message
  int32 variants_deleted = 3; // Number of cascaded variant deletions
}

// ============================================================================
// Bulk Operations - Products
// ============================================================================

// ProductInput represents input data for creating a product
message ProductInput {
  string name = 1;
  string description = 2;
  double price = 3;
  string currency = 4;
  int64 category_id = 5;
  optional string sku = 6;
  optional string barcode = 7;
  int32 stock_quantity = 8;
  bool is_active = 9;
  google.protobuf.Struct attributes = 10;

  // Location
  bool has_individual_location = 11;
  optional string individual_address = 12;
  optional double individual_latitude = 13;
  optional double individual_longitude = 14;
  optional string location_privacy = 15;
  bool show_on_map = 16;

  bool has_variants = 17;
}

// BulkCreateProductsRequest creates multiple products
message BulkCreateProductsRequest {
  int64 storefront_id = 1;
  repeated ProductInput products = 2; // Max 1000 items
}

// BulkCreateProductsResponse returns created products
message BulkCreateProductsResponse {
  repeated Product products = 1; // Successfully created products
  int32 successful_count = 2;
  int32 failed_count = 3;
  repeated BulkOperationError errors = 4; // Failed items with reasons
}

// ProductUpdateInput represents input for bulk update
message ProductUpdateInput {
  int64 product_id = 1;
  optional string name = 2;
  optional string description = 3;
  optional double price = 4;
  optional string currency = 5;
  optional int64 category_id = 6;
  optional string sku = 7;
  optional string barcode = 8;
  optional bool is_active = 9;
  optional google.protobuf.Struct attributes = 10;
  optional google.protobuf.FieldMask update_mask = 11;
}

// BulkUpdateProductsRequest updates multiple products
message BulkUpdateProductsRequest {
  int64 storefront_id = 1;
  repeated ProductUpdateInput updates = 2; // Max 1000 items
}

// BulkUpdateProductsResponse returns update results
message BulkUpdateProductsResponse {
  repeated Product products = 1; // Successfully updated products
  int32 successful_count = 2;
  int32 failed_count = 3;
  repeated BulkOperationError errors = 4;
}

// BulkDeleteProductsRequest deletes multiple products
message BulkDeleteProductsRequest {
  int64 storefront_id = 1;
  repeated int64 product_ids = 2; // Max 1000 items
  bool hard_delete = 3; // Default false
}

// BulkDeleteProductsResponse returns deletion results
message BulkDeleteProductsResponse {
  int32 successful_count = 1;
  int32 failed_count = 2;
  int32 variants_deleted = 3; // Total cascaded deletions
  repeated BulkOperationError errors = 4;
}

// BulkOperationError represents a failed item in bulk operation
message BulkOperationError {
  int32 index = 1; // Index in input array
  optional int64 product_id = 2; // If applicable
  string error_code = 3; // "sku_duplicate", "not_found", "validation_failed", etc.
  string error_message = 4; // Human-readable error
}

// ============================================================================
// Product Variant CRUD Operations (Phase 9.5.2)
// ============================================================================

// CreateProductVariantRequest creates a new variant
message CreateProductVariantRequest {
  int64 product_id = 1; // Parent product
  optional string sku = 2; // Optional, unique within product
  optional string barcode = 3;
  optional double price = 4; // If null, inherits from product
  optional double compare_at_price = 5; // "Was" price for discounts
  optional double cost_price = 6; // For profit calculations
  int32 stock_quantity = 7;
  optional int32 low_stock_threshold = 8;
  google.protobuf.Struct variant_attributes = 9; // {"color": "red", "size": "XL"}
  optional double weight = 10; // In grams
  google.protobuf.Struct dimensions = 11; // {"length": 10, "width": 5, "height": 3}
  bool is_active = 12; // Default true
  bool is_default = 13; // Default false
}

// UpdateProductVariantRequest updates variant fields
message UpdateProductVariantRequest {
  int64 variant_id = 1;
  int64 product_id = 2; // For validation

  optional string sku = 3;
  optional string barcode = 4;
  optional double price = 5;
  optional double compare_at_price = 6;
  optional double cost_price = 7;
  optional int32 stock_quantity = 8;
  optional int32 low_stock_threshold = 9;
  optional google.protobuf.Struct variant_attributes = 10;
  optional double weight = 11;
  optional google.protobuf.Struct dimensions = 12;
  optional bool is_active = 13;
  optional bool is_default = 14;

  optional google.protobuf.FieldMask update_mask = 15;
}

// DeleteProductVariantRequest removes a variant
message DeleteProductVariantRequest {
  int64 variant_id = 1;
  int64 product_id = 2; // For validation
}

// DeleteProductVariantResponse confirms deletion
message DeleteProductVariantResponse {
  bool success = 1;
  optional string message = 2;
}

// ProductVariantInput for bulk creation
message ProductVariantInput {
  optional string sku = 1;
  optional string barcode = 2;
  optional double price = 3;
  optional double compare_at_price = 4;
  optional double cost_price = 5;
  int32 stock_quantity = 6;
  optional int32 low_stock_threshold = 7;
  google.protobuf.Struct variant_attributes = 8;
  optional double weight = 9;
  google.protobuf.Struct dimensions = 10;
  bool is_active = 11;
  bool is_default = 12;
}

// BulkCreateProductVariantsRequest creates multiple variants
message BulkCreateProductVariantsRequest {
  int64 product_id = 1;
  repeated ProductVariantInput variants = 2; // Max 1000 items
}

// BulkCreateProductVariantsResponse returns created variants
message BulkCreateProductVariantsResponse {
  repeated ProductVariant variants = 1;
  int32 successful_count = 2;
  int32 failed_count = 3;
  repeated BulkOperationError errors = 4;
}

// ============================================================================
// Inventory Management Operations (Phase 9.5.2)
// ============================================================================

// RecordInventoryMovementRequest records a stock change
message RecordInventoryMovementRequest {
  int64 storefront_id = 1; // Required for ownership validation
  int64 product_id = 2; // Required
  optional int64 variant_id = 3; // Optional, if null - update product stock
  string movement_type = 4; // "in", "out", "adjustment"
  int32 quantity = 5; // Quantity to add/subtract/set
  optional string reason = 6; // "sale", "return", "damaged", "restock", "manual_adjustment"
  optional string notes = 7; // Additional notes for audit trail
  int64 user_id = 8; // User who performed the operation
}

// RecordInventoryMovementResponse confirms the movement was recorded
message RecordInventoryMovementResponse {
  bool success = 1;
  int32 stock_before = 2; // Stock quantity before update
  int32 stock_after = 3; // Stock quantity after update
  optional string error = 4;
}

// StockUpdateItem represents a single stock update in batch operation
message StockUpdateItem {
  int64 product_id = 1;
  optional int64 variant_id = 2; // If null, update product stock
  int32 quantity = 3; // New stock quantity (absolute value)
  optional string reason = 4; // Reason for the update
}

// BatchUpdateStockRequest updates stock for multiple items atomically
message BatchUpdateStockRequest {
  int64 storefront_id = 1; // Required for ownership validation
  repeated StockUpdateItem items = 2; // Max 1000 items
  optional string reason = 3; // Common reason for all updates
  int64 user_id = 4; // User who performed the operation
}

// StockUpdateResult represents result of a single stock update
message StockUpdateResult {
  int64 product_id = 1;
  optional int64 variant_id = 2;
  int32 stock_before = 3;
  int32 stock_after = 4;
  bool success = 5;
  optional string error = 6;
}

// BatchUpdateStockResponse returns results of batch stock update
message BatchUpdateStockResponse {
  int32 successful_count = 1;
  int32 failed_count = 2;
  repeated StockUpdateResult results = 3;
}

// GetProductStatsRequest requests product statistics
message GetProductStatsRequest {
  int64 storefront_id = 1; // Required
}

// ProductStats represents statistics for storefront products
message ProductStats {
  int32 total_products = 1;
  int32 active_products = 2;
  int32 out_of_stock = 3;
  int32 low_stock = 4;
  double total_value = 5; // Sum of (price * stock_quantity) for all products
  int32 total_sold = 6; // Sum of sold_count for all products
}

// GetProductStatsResponse returns product statistics
message GetProductStatsResponse {
  ProductStats stats = 1;
}

// IncrementProductViewsRequest increments view counter
message IncrementProductViewsRequest {
  int64 product_id = 1; // Required
}
