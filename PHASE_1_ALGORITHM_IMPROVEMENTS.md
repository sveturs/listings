# Улучшения алгоритма поиска похожих объявлений - Фаза 1

## Проблема
Объявление 31 (890,000$, Београд) не находило объявление 17 (120,000$, Нови Сад) как похожее из-за слишком строгих критериев поиска.

## Решение

### 1. Расширение диапазонов цен
- **Попытка 0**: ±50% (как было ранее)
- **Попытка 1**: ±100% (от 30% до 200% от исходной цены)
- **Попытка 2**: ±200% (от 10% до 300% от исходной цены)  
- **Попытка 3**: Без ограничений по цене

### 2. Гибкие географические ограничения
- **Попытка 0-1**: Поиск в том же городе
- **Попытка 2**: Поиск в той же стране
- **Попытка 3**: Поиск без географических ограничений

### 3. Адаптивные фильтры по атрибутам
- **Попытка 0**: До 3 ключевых атрибутов
- **Попытка 1**: До 2 атрибутов
- **Попытка 2**: Только 1 самый важный атрибут
- **Попытка 3**: Без фильтров по атрибутам

### 4. Fallback логика
- Система последовательных попыток с ослаблением критериев
- Остановка при достижении нужного количества результатов
- Предотвращение дубликатов между попытками
- Сортировка по скору похожести

## Результат
Теперь объявление 31 (890,000$, Београд) находит объявление 17 (120,000$, Нови Сад) как похожее благодаря:
- Расширенному диапазону цен (попытка 2: 89,000$ - 2,670,000$)
- Поиску по всей стране (попытка 2) 
- Общей категории недвижимости

## Файлы изменены
- `backend/internal/proj/marketplace/service/marketplace.go`
  - Метод `GetSimilarListings()` - добавлена логика множественных попыток
  - Метод `buildAdvancedSearchParams()` - параметр `tryNumber` для управления строгостью

## Логирование
Добавлено подробное логирование для отслеживания:
- Параметров каждой попытки поиска
- Количества найденных результатов  
- Скоров похожести
- Использованных критериев

## Совместимость
Изменения полностью обратно совместимы - API не изменился, только улучшилась логика поиска.