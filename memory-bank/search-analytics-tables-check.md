# Проверка таблиц аналитики поиска

## Дата проверки: 2025-01-08

### Результаты проверки

#### ✅ Успешно созданы все необходимые таблицы:

1. **Основные таблицы логирования и аналитики:**
   - `search_logs` - логирование всех поисковых запросов
   - `search_queries` - уникальные поисковые запросы с нормализацией
   - `search_result_clicks` - клики по результатам поиска
   - `search_statistics` - агрегированная статистика
   - `search_trending_queries` - трендовые запросы

2. **Таблицы поведенческой аналитики:**
   - `search_behavior_metrics` - метрики поведения пользователей (CTR, конверсии)
   - `user_behavior_events` - события пользователей (просмотры, клики, покупки)
   - `item_performance_metrics` - производительность товаров в поиске

3. **Таблицы конфигурации:**
   - `search_config` - общая конфигурация поиска
   - `search_weights` - веса для полей поиска
   - `search_weights_history` - история изменений весов
   - `search_synonyms_config` - конфигурация синонимов
   - `search_optimization_sessions` - сессии оптимизации поиска

### Применённые миграции:
- 083 - `add_search_queries_table`
- 089 - `create_item_performance_metrics`
- 090 - `create_search_weights`
- 091 - `create_search_optimization_sessions`

### Структура ключевых таблиц:

#### search_logs
- Содержит все поисковые запросы с полной информацией
- Индексы для быстрого поиска по user_id, session_id, query_text
- Поддержка полнотекстового поиска через GIN индекс

#### search_behavior_metrics
- Агрегированные метрики по периодам
- CTR, средняя позиция кликов, конверсии
- Уникальный индекс по query + period_start

#### search_weights
- Настраиваемые веса для разных полей поиска
- Поддержка разных типов поиска (fulltext, fuzzy, exact)
- История изменений через триггеры
- Начальные данные уже загружены (16 записей)

### Проверка данных:
- В таблице `search_weights` загружены начальные веса
- Самый высокий вес у поля `title` для marketplace (0.95)
- Настроены веса для всех основных полей поиска

### Статус: ✅ Все таблицы созданы и готовы к использованию