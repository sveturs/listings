# Система вариативных атрибутов товаров - Итоговая документация

## Обзор

Система вариативных атрибутов позволяет создавать варианты товаров с разными характеристиками (цвет, размер, память и т.д.), где каждый вариант может иметь свою цену и количество на складе.

## Выполненные задачи

### 1. Анализ проблемы
**Проблема**: При создании товара в категории "Телефоны" предлагался только атрибут "Величина экрана", отсутствовали важные атрибуты: цвет, память (RAM), накопитель (ROM).

**Причина**: Frontend использовал жестко закодированную фильтрацию атрибутов по ключевым словам, что не позволяло правильно определять атрибуты для разных категорий.

### 2. Расширение системы атрибутов

#### Добавлены новые вариативные атрибуты:
- **memory** - Оперативная память (RAM)
- **storage** - Встроенная память (ROM)
- **material** - Материал
- **capacity** - Объем/Вместимость
- **power** - Мощность
- **connectivity** - Тип подключения
- **style** - Стиль
- **pattern** - Узор
- **weight** - Вес
- **bundle** - Комплектация

#### Миграция базы данных:
```sql
-- backend/migrations/000182_add_variant_attributes_for_categories.up.sql
-- Добавление новых атрибутов и их переводов на 3 языка (en, ru, sr)
```

### 3. Создание системы связи категорий с атрибутами

#### Backend:

1. **Сервис вариативных атрибутов** (`backend/internal/proj/marketplace/service/variant_attributes.go`):
   - Маппинг категорий на доступные атрибуты
   - Методы получения атрибутов для категории

2. **API endpoints**:
   - `GET /api/v1/product-variant-attributes` - все доступные атрибуты
   - `GET /api/v1/categories/{slug}/variant-attributes` - атрибуты для конкретной категории

3. **Handler** (`backend/internal/proj/marketplace/handler/variant_attributes.go`):
   - Обработка HTTP запросов
   - Swagger документация

#### Frontend:

1. **Конфигурация** (`frontend/svetu/src/lib/variant-attributes-config.ts`):
   - Локальный маппинг категорий (резервный вариант)
   
2. **Компонент SimplifiedVariantGenerator**:
   - Динамическая загрузка атрибутов через API
   - Автоматическое определение доступных атрибутов по категории

### 4. Маппинг категорий

```typescript
// Примеры настроенных категорий:
{
  // Электроника
  'smartphones': ['color', 'memory', 'storage'],
  'computers': ['color', 'memory', 'storage', 'connectivity'],
  'gaming-consoles': ['color', 'storage', 'bundle'],
  
  // Одежда
  'womens-clothing': ['color', 'size', 'material', 'pattern', 'style'],
  'mens-clothing': ['color', 'size', 'material', 'pattern', 'style'],
  
  // Бытовая техника
  'home-appliances': ['color', 'capacity', 'power'],
  
  // И другие...
}
```

## Архитектура решения

### Поток данных:
1. **При создании товара**: Frontend запрашивает slug категории
2. **Загрузка атрибутов**: По slug запрашиваются доступные вариативные атрибуты
3. **Генерация вариантов**: На основе выбранных атрибутов создаются комбинации
4. **Сохранение**: Варианты сохраняются в таблице `storefront_product_variants`

### Структура данных:
```json
{
  "variant_attributes": {
    "color": "Черный",
    "memory": "8GB",
    "storage": "256GB"
  },
  "price": 45000,
  "quantity": 10,
  "sku": "PHONE-BLACK-8GB-256GB"
}
```

## Преимущества системы

1. **Гибкость**: Легко добавлять новые атрибуты и категории
2. **Масштабируемость**: Централизованное управление через API
3. **Мультиязычность**: Все атрибуты имеют переводы
4. **Типизация**: TypeScript типы генерируются автоматически

## Оставшиеся задачи

1. **Множественный выбор значений**: Сейчас при заполнении атрибутов товара нельзя выбрать несколько значений (например, несколько размеров экрана). Это ограничение на уровне UI компонентов выбора атрибутов.

## Использование

### Для добавления новой категории:
1. Добавить маппинг в `categoryVariantAttributesMap` в backend
2. Опционально: добавить в frontend конфигурацию
3. Протестировать создание товара в новой категории

### Для добавления нового атрибута:
1. Создать миграцию для добавления в `product_variant_attributes`
2. Добавить переводы в таблицу `translations`
3. Обновить маппинги категорий

## Заключение

Система вариативных атрибутов успешно расширена и теперь поддерживает широкий спектр категорий товаров. Проблема с телефонами решена - теперь доступны атрибуты цвет, память и накопитель. Архитектура позволяет легко добавлять новые категории и атрибуты без изменения кода.