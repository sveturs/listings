# Система вариативных атрибутов для категорий товаров

## Обзор

Система вариативных атрибутов позволяет создавать варианты товаров в витринах с различными характеристиками (например, цвет, размер, память и т.д.), где каждая комбинация может иметь свою цену и остаток на складе.

## Последние обновления (2025-07-31)

1. **Добавлены новые API endpoints**:
   - `GET /api/v1/product-variant-attributes` - получение всех доступных атрибутов
   - `GET /api/v1/categories/{slug}/variant-attributes` - получение атрибутов для конкретной категории

2. **Создана система связи категорий с атрибутами**:
   - Backend сервис с маппингом категорий на атрибуты
   - Frontend компонент динамически загружает атрибуты через API

3. **Исправлена проблема с телефонами**:
   - Теперь для категории smartphones доступны атрибуты: color, memory, storage
   - Удалена жесткая привязка к ключевым словам в названиях атрибутов

## Архитектура системы

### Таблицы базы данных

1. **product_variant_attributes** - Хранит доступные типы атрибутов
   - `id` - уникальный идентификатор
   - `name` - системное имя атрибута (например, 'color', 'size')
   - `display_name` - отображаемое имя
   - `type` - тип атрибута для правильного отображения UI
   - `is_required` - обязательность атрибута
   - `sort_order` - порядок отображения
   - `affects_stock` - влияет ли на раздельный учет остатков
   
2. **storefront_product_variants** - Хранит варианты товаров
   - `variant_attributes` (JSONB) - значения атрибутов варианта
   - `price` - цена варианта
   - `stock_quantity` - остаток на складе
   - `sku` - артикул варианта

### Ключевые особенности

- Вариативные атрибуты не связаны напрямую с категориями через таблицу связей
- Атрибуты используются динамически при создании товаров в витринах
- Поле `affects_stock` определяет, будет ли для данного атрибута вестись раздельный учет остатков

## Доступные вариативные атрибуты

### Базовые атрибуты (уже существовали)

1. **color** (Цвет)
   - Тип: color
   - Влияет на остатки: Да
   - Применим для: одежда, обувь, аксессуары, электроника, мебель

2. **size** (Размер) 
   - Тип: size
   - Влияет на остатки: Да
   - Применим для: одежда, обувь, аксессуары

### Новые атрибуты (добавлены в миграции 182)

3. **memory** (Память)
   - Тип: memory
   - Влияет на остатки: Да
   - Применим для: смартфоны, планшеты, компьютеры

4. **storage** (Хранилище)
   - Тип: storage
   - Влияет на остатки: Да
   - Применим для: смартфоны, компьютеры, игровые консоли

5. **material** (Материал)
   - Тип: material
   - Влияет на остатки: Нет
   - Применим для: одежда, обувь, аксессуары, мебель

6. **capacity** (Емкость/Объем)
   - Тип: capacity
   - Влияет на остатки: Да
   - Применим для: кухонная утварь, бытовая техника

7. **power** (Мощность)
   - Тип: power
   - Влияет на остатки: Нет
   - Применим для: бытовая техника

8. **connectivity** (Тип подключения)
   - Тип: connectivity
   - Влияет на остатки: Да
   - Применим для: электроника, аксессуары

9. **style** (Стиль/Дизайн)
   - Тип: style
   - Влияет на остатки: Нет
   - Применим для: мебель, одежда

10. **pattern** (Узор/Паттерн)
    - Тип: pattern
    - Влияет на остатки: Нет
    - Применим для: одежда, аксессуары

11. **weight** (Вес)
    - Тип: weight
    - Влияет на остатки: Да
    - Применим для: спортивное оборудование, продукты

12. **bundle** (Комплектация)
    - Тип: bundle
    - Влияет на остатки: Да
    - Применим для: электроника, мебель

## Рекомендации по использованию атрибутов для категорий

### Одежда (womens-clothing, mens-clothing, kids-clothing, sports-clothing)
- **Основные**: color, size
- **Дополнительные**: material, pattern, style

### Обувь (shoes)
- **Основные**: color, size
- **Дополнительные**: material, style

### Сумки и аксессуары (bags, accessories)
- **Основные**: color
- **Дополнительные**: size, material, style, pattern

### Электроника (smartphones, computers, gaming-consoles)
- **Основные**: color, memory, storage
- **Дополнительные**: connectivity, bundle

### Электронные аксессуары (electronics-accessories)
- **Основные**: color
- **Дополнительные**: connectivity, bundle

### Бытовая техника (home-appliances)
- **Основные**: color
- **Дополнительные**: capacity, power

### Мебель (furniture)
- **Основные**: color
- **Дополнительные**: material, style

### Кухонная утварь (kitchenware)
- **Основные**: color
- **Дополнительные**: capacity, material

## Интеграция с фронтендом

### Компоненты для работы с вариантами

1. **VariantManager** (`frontend/svetu/src/components/Storefront/ProductVariants/VariantManager.tsx`)
   - Основной компонент для управления вариантами товара

2. **VariantSelector** (`frontend/svetu/src/components/Storefront/ProductVariants/VariantSelector.tsx`)
   - Компонент для выбора варианта при покупке

3. **CategoryVariantGenerator** (`frontend/svetu/src/components/products/CategoryVariantGenerator.tsx`)
   - Генератор вариантов на основе категории

### Пример использования

При создании товара в витрине:

1. Пользователь выбирает категорию товара
2. Система определяет подходящие вариативные атрибуты
3. Пользователь выбирает нужные атрибуты и их значения
4. Система генерирует все возможные комбинации
5. Для каждой комбинации можно установить:
   - Индивидуальную цену
   - Остаток на складе (если атрибут влияет на остатки)
   - SKU/артикул

### Пример данных варианта

```json
{
  "variant_attributes": {
    "color": "red",
    "size": "L"
  },
  "price": 2500.00,
  "stock_quantity": 15,
  "sku": "TSHIRT-RED-L"
}
```

## Переводы

Все вариативные атрибуты имеют переводы на три языка:
- Английский (en)
- Русский (ru) 
- Сербский (sr)

Переводы хранятся в таблице `translations` с типом сущности `product_variant_attribute`.

## Будущие улучшения

1. **Динамическое связывание с категориями** - создать таблицу связей между категориями и доступными для них вариативными атрибутами

2. **Валидация значений** - добавить правила валидации для значений атрибутов (например, размеры одежды из предопределенного списка)

3. **Группировка атрибутов** - возможность группировать связанные атрибуты (например, размеры EU/US/UK)

4. **Зависимые атрибуты** - поддержка зависимостей между атрибутами (например, доступные размеры зависят от выбранного цвета)

## Техническая информация

- Миграция: `000182_add_variant_attributes_for_categories`
- Индексы: 
  - Уникальный индекс на `name`
  - Индекс на `affects_stock` для быстрого поиска атрибутов с учетом остатков
- Триггеры: автоматическое обновление `updated_at`