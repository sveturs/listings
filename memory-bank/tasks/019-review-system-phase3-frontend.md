# Фаза 3: Frontend интеграция системы отзывов

## Дата: 2025-06-17
## Ветка: rev_17_06

## Цель
Создать frontend компоненты для системы отзывов и интегрировать их в страницу товара

## Выполненные задачи

### 1. Создание типов TypeScript
- Файл: `/frontend/svetu/src/types/review.ts`
- Определены интерфейсы:
  - Review - основная модель отзыва
  - CreateReviewRequest - запрос создания отзыва
  - ReviewsFilter - фильтры для списка
  - ReviewStats - статистика отзывов
  - AggregatedRating - агрегированный рейтинг
  - CanReviewResponse - проверка возможности оставить отзыв

### 2. Redux интеграция
- Файл: `/frontend/svetu/src/store/slices/reviewsSlice.ts`
- Реализованы actions:
  - fetchReviews - получение списка отзывов
  - createReview - создание нового отзыва
  - voteReview - голосование за отзыв
  - confirmReview - подтверждение продавцом
  - disputeReview - оспаривание отзыва

### 3. API сервис
- Файл: `/frontend/svetu/src/services/reviewApi.ts`
- Методы для работы с API:
  - Получение отзывов с фильтрами
  - Создание и обновление отзывов
  - Загрузка фото для отзывов
  - Голосование и модерация

### 4. React Query хуки
- Файл: `/frontend/svetu/src/hooks/useReviews.ts`
- Хуки для удобной работы с данными:
  - useReviews - список отзывов
  - useReviewStats - статистика
  - useCanReview - проверка возможности
  - useCreateReview - создание отзыва
  - useUploadReviewPhotos - загрузка фото

### 5. Компоненты UI

#### RatingDisplay
- Отображение рейтинга звездами
- Поддержка разных размеров (sm, md, lg)
- Показ количества отзывов

#### RatingInput
- Интерактивный выбор рейтинга
- Визуальная обратная связь при наведении
- Текстовое описание выбранной оценки

#### RatingStats
- Визуализация статистики отзывов
- График распределения оценок
- Процент подтвержденных покупок

#### ReviewForm
- Форма добавления отзыва
- Поля: рейтинг, комментарий, плюсы/минусы
- Загрузка до 5 фото (JPG/PNG/WebP, до 5MB)
- Валидация на клиенте

#### ReviewList
- Список отзывов с пагинацией
- Фильтры по рейтингу, фото, подтвержденным
- Сортировка по дате/рейтингу/полезности
- Действия: голосование, подтверждение, оспаривание

#### ReviewsSection
- Главный компонент секции отзывов
- Координация всех подкомпонентов
- Управление состоянием

### 6. Интеграция в страницу товара
- Файл: `/frontend/svetu/src/app/[locale]/marketplace/[id]/page.tsx`
- Добавлена секция отзывов после описания товара
- Передача необходимых параметров (entityType, entityId, sellerId)

## Особенности реализации

### Проверка возможности оставить отзыв
- Автоматическая проверка через API endpoint `/reviews/can-review/{type}/{id}`
- Учитывается активность в чате (минимум 5 сообщений от каждой стороны)
- Запрет на повторные отзывы от одного пользователя

### Загрузка фото
- Клиентская валидация типов файлов и размера
- Ограничение на 5 фото в одном отзыве
- Предпросмотр загруженных изображений

### Модерация
- Продавец может подтвердить отзыв
- Возможность оспорить отзыв с указанием причины
- Визуальные индикаторы статуса (подтвержден, оспаривается)

### Интернационализация
- Поддержка русского и английского языков
- Использование next-intl для переводов
- Форматирование дат с учетом локали

## Результат
Полностью функциональная система отзывов на frontend, интегрированная со страницей товара. Пользователи могут оставлять отзывы с фото, голосовать за полезность, а продавцы - модерировать отзывы на свои товары.