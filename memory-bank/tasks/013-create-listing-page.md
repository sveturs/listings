# Техническое задание: Страница создания объявлений

## Обзор
Необходимо создать региональную платформу для создания объявлений, адаптированную под специфику **сербского рынка и бывшей Югославии**. Платформа должна стать цифровым воплощением традиционной балканской торговли с современными удобствами, учитывая низкую покупательную способность, культуру личных встреч и наложенных платежей.

## Региональная специфика
- **Низкая покупательная способность**: GDP per capita $11,206, средний доход ~$1300
- **Консервативность в платежах**: 80-85% покупок с наложенным платежом, 49.6% не используют онлайн-платежи
- **Культура личных встреч**: "Лична предаја" как основной способ передачи товара
- **Многоязычность**: Поддержка кирилицы/латиницы, региональных диалектов
- **Межстрановая торговля**: Общее наследие Югославии как объединяющий фактор

## Функциональные требования

### 1. Пошаговая форма (Step-by-Step Wizard)

**УПРОЩЕННЫЙ ПОРЯДОК ШАГОВ ДЛЯ MVP:**
- **Шаг 1: Быстрый выбор категории** (визуальный интерфейс)
- **Шаг 2: Базовая информация** (заголовок + цена + тип объявления)
- **Шаг 3: Фото** с опциональным AI-анализом
- **Шаг 4: Детали** (атрибуты категории)
- **Шаг 5: Местоположение**
- **Шаг 6: Контакты и публикация**

**РАСШИРЕННЫЙ ФЛОУ (после MVP):**
- **Шаг 1: Выбор категории или анализ фото**
  - **Быстрый старт** - выбор категории визуально
  - **Smart-режим** - загрузка фото для автоопределения:
    - Drag & drop или выбор файла
    - Камера для мобильных устройств
    - Анализ изображения для определения:
      - Категории (через ML модель или сравнение с базой изображений)
      - Бренда/модели (OCR для текста на товаре)
      - Состояния товара (анализ качества)
      - Цветовой гаммы
    - Автозаполнение найденных характеристик
  
  - **Базовая модерация контента (MVP)**:
    - Проверка на запрещенный контент (NSFW, оружие, наркотики)
    - Проверка на watermarks других площадок
    - Соответствие изображения выбранной категории
    - Блокировка или предупреждение при нарушениях
  
  - **Расширенная модерация (V1)**:
    - Детекция поддельных товаров (анализ логотипов, брендов)
    - Проверка на стоковые фото (сравнение с базой)
    - Геоверификация (EXIF данные соответствуют локации)
    - Анализ аномальных цен (слишком низкие для категории)
    - Оценка качества товара по фото
  
  - **Улучшение фото** (платные опции):
    - Базовое (доступно): автокоррекция яркости/контраста, обрезка
    - Стандарт: удаление фона, цветокоррекция, резкость
    - Премиум: AI-улучшение качества, профессиональная карточка товара
  
  - **Ручной выбор категории**:
    - Древовидная структура категорий
    - Визуальные иконки для быстрого выбора
    - Поиск по названию категории
    - Популярные категории вверху

- **Шаг 2: Тип объявления и основная информация**
  - **Тип объявления** (влияет на последующие поля):
    - Продажа (разовая сделка)
    - Аренда/Прокат (временное пользование)
    - Обмен/Бартер (обмен на другие товары)
    - Услуги (выполнение работ)
    - Ищу (поиск товаров/услуг)
    - Дарю (безвозмездная передача)
  
  - **Вариации товара** (для физических товаров):
    - Переключатель "У товара есть вариации"
    - Добавление вариаций: цвет, размер, материал и т.д.
    - Управление остатками для каждой вариации
    - Разные фото для вариаций
    - Опция разной цены для вариаций
  
  - Заголовок (с счетчиком символов и подсказками)
    - Табы для разных языков (RU/EN/SR)
    - Кнопка автоперевода для каждого языка
    - Индикатор: машинный/ручной перевод
  
  - Описание (rich text editor с базовым форматированием)
    - Аналогичные табы для языков
    - Сохранение форматирования при переводе
    - Предупреждение при изменении после автоперевода
  
  - **Поля в зависимости от типа**:
    - Для продажи: состояние (new/used/refurbished), цена, торг
    - Для аренды: цена за период, минимальный срок, залог
    - Для обмена: на что готов обменять, доплата
    - Для услуг: тип услуги, выезд на дом, график работы
    - Для поиска: готов заплатить до, срочность
    - Для дарения: причина, самовывоз/доставка

- **Шаг 3: Детали (динамические атрибуты)**
  - Загрузка атрибутов на основе выбранной категории
  - Различные типы полей:
    - Text input с валидацией
    - Number input с min/max
    - Select/Multiselect с поиском
    - Boolean (checkbox/toggle)
    - Custom components (если есть)
  - Условная логика показа полей
  - Подсказки и примеры для каждого поля

- **Шаг 4: Фотографии**
  - Drag & drop загрузка
  - Множественная загрузка
  - Предпросмотр с возможностью удаления
  - Выбор главной фотографии
  - Кадрирование и поворот
  - Сжатие на клиенте перед загрузкой
  - Прогресс загрузки для каждого файла
  - Рекомендации по качеству фото

- **Шаг 5: Местоположение**
  - Интерактивная карта (Leaflet)
  - Автоопределение локации
  - Поиск адреса
  - Точная установка маркера
  - Радиус показа (для приватности)

- **Шаг 6: SEO оптимизация**
  - **Бесплатные инструменты**:
    - Анализ плотности ключевых слов
    - Рекомендации по длине заголовка/описания
    - Проверка уникальности текста
    - Подсказки по популярным поисковым запросам в категории
    - Предпросмотр в поисковой выдаче
  - **Платные AI функции** (через баланс пользователя):
    - AI-оптимизация заголовка для поиска
    - Генерация SEO-описания с ключевыми словами
    - Анализ конкурентов и рекомендации
    - Подбор релевантных тегов и ключевых слов

- **Шаг 7: Контакты и публикация**
  - Способы связи (телефон, чат, email)
  - Время для связи
  - Предпросмотр объявления
  - Опции продвижения (если есть)
  - Автоматическая индексация в OpenSearch после публикации

### 2. Система предотвращения дубликатов

#### **MVP версия:**
- Простая проверка по заголовку при создании
- Предупреждение о похожих объявлениях

#### **V1 версия:**
- **Автоматическая проверка при создании:**
  - Анализ загруженных фото (perceptual hash)
  - Сравнение текста (fuzzy matching)
  - Поиск по комбинации: категория + цена + локация
- **Интерфейс обнаружения дубликатов:**
  - Показ найденных похожих объявлений
  - Опции: продолжить создание / обновить существующее / объединить
  - История изменений объявления

### 3. Accessibility & Инклюзивность (WCAG 2.1 AA)

#### **Обязательно в MVP:**
- **Навигация с клавиатуры:**
  - Tab-order для всех элементов
  - Escape для закрытия модалок
  - Enter для подтверждения действий
- **Screen reader поддержка:**
  - ARIA-labels для всех интерактивных элементов
  - Объявления об изменениях состояния
  - Описания для изображений
- **Визуальная доступность:**
  - Контраст минимум 4.5:1 для текста
  - Не полагаться только на цвет для передачи информации
  - Возможность увеличения шрифта до 200%
- **Поддержка дальтоников:**
  - Дополнительные индикаторы кроме цвета
  - Паттерны и иконки для статусов

### 4. Региональная система доверия (КРИТИЧНО ДЛЯ MVP!)

#### **MVP - Балканская модель доверия:**
- **Лична предаја (личная передача):**
  - Планировщик личных встреч с календарем
  - Карта безопасных общественных мест для встреч
  - Интеграция с кафе, торговые центры, паркинги
  - Система рейтинга мест встреч сообществом
- **Обязательная телефонная верификация:**
  - Звонок на мобильный (не SMS) для верификации
  - Блокировка виртуальных и иностранных номеров  
  - База проверенных местных операторов (MTS, VIP, Telenor)
- **Локальные индикаторы доверия:**
  - Значки "Местный продавец" по району/городу
  - "Семейный бизнес" бейджи
  - Репутация в районе/сообществе
  - Рекомендации от соседей и друзей

#### **MVP - Традиционная торговая культура:**
- **Наложенный платеж приоритет:**
  - "Плаћање при преузимању" как основной способ
  - Интеграция с почтой Србије и курьерскими службами
  - Калькулятор стоимости наложенного платежа
- **Интерфейс для торга:**
  - "Договорна цена" опция
  - Система предложения цены с историей
  - Культурно-адаптированные фразы торга
- **Сезонные и традиционные товары:**
  - Специальные категории (ракија, зимница, домаћи производи)
  - Сезонные секции (лето: воће/поврће, зима: огрев)
  - Поддержка традиционных единиц измерения

#### **V1 - Расширенное региональное доверие:**
- **Межстрановая система доверия:**
  - Единый рейтинг через границы (Srbija-Hrvatska-Slovenija)
  - Валидация документов по стандартам ЕУ для соседних стран
  - Система гарантий для приграничной торговли
- **Общинная модерация:**
  - Местные модераторы от сообщества
  - Быстрое решение споров через местных арбитров
  - Культурно-чувствительная модерация контента

### 5. Региональная локализация и культурная адаптация (КРИТИЧНО ДЛЯ MVP!)

#### **MVP - Мультиязычность и письменность:**
- **Кирилица/Латиница динамическое переключение:**
  - Автоматическое определение предпочтений пользователя
  - Одновременное отображение для пограничных регионов
  - Поддержка смешанного ввода (кир+лат в одном тексте)
- **Региональные языки и диалекты:**
  - Српски (кирилица/латиница), Hrvatski, Slovenščina, Македонски
  - Местные выражения: "лична предаја", "договорна цена", "домаћи производи"
  - Региональные варианты: "kupujem/prodajem" vs "prodavam/kupujem"
- **Культурно-адаптированные тексты:**
  - Традиционные формы обращения и вежливости
  - Местные единицы измерения (кг/ока, лitar, архивированные меры)
  - Региональные валюты: РСД, EUR, HRK, MKD с актуальными курсами

#### **MVP - Традиционная торговая культура:**
- **"Пијаца" стиль интерфейса:**
  - Визуальная стилизация под традиционные рынки
  - Персонализированные "тезге" (лавки) продавцов
  - Система "познатих лица" (знакомых продавцов)
- **Сезонная адаптация:**
  - Динамические категории по сезонам (пролеће: саднице, јесен: огрев)
  - Традиционные праздничные товары (Слава, Божић, Васкрс)
  - Сельскохозяйственный календарь и ярмарки

#### **MVP - Экономическая доступность:**
- **Мобильный-first с экономией трафика:**
  - Сжатие изображений для медленного интернета
  - Оффлайн-режим для просмотра сохраненных объявлений
  - Прогрессивная загрузка с индикатором потребления данных
- **Поддержка старых устройств:**
  - Совместимость с Android 6+ и iOS 10+
  - Простой интерфейс для слабых процессоров
  - Минимальное использование JavaScript

### 6. Compliance и правовые особенности региона

#### **MVP - Региональные требования:**
- **Сербия (кандидат в ЕС):**
  - Переходная совместимость с ЕС регуляциями
  - Местное законодательство о защите данных
  - НБС требования для валютных операций
- **ЕС страны региона (Хорватия, Словения):**
  - Полное GDPR compliance
  - ЕЦБ регуляции для евро операций
  - Единый цифровой рынок ЕС
- **Локальные особенности:**
  - Запрещенные товары по религиозным/культурным причинам
  - Региональные лицензии (медицина, алкоголь, оружие)
  - Налоговые различия между странами

### 7. "Pijaca 2.0" - Уникальное конкурентное преимущество (MVP)

#### **MVP - Цифровой традиционный рынок:**
- **Персонализированные "тезге" (лавки):**
  - Личные страницы продавцов с фото и историей
  - Виртуальные витрины в стиле традиционных рынков
  - Система "стални купци" (постоянные покупатели)
- **Социальная торговля:**
  - Районные группы покупателей и продавцов
  - Система рекомендаций от соседей
  - Местные лидеры мнений и их рекомендации
- **Традиционные торговые события:**
  - Календарь местных ярмарок и базаров
  - Сезонные события (крстац, вашар, сајам)
  - Интеграция с местными праздниками

#### **V1 - Региональная экспансия с общим наследием:**
- **"Югославский мост":**
  - Общие категории товаров с исторической ценностью
  - Ностальгический раздел (стари предмети, СФРЈ меморабилија)
  - Межрегиональный обмен специфическими товарами
- **Объединяющие функции:**
  - Кросс-бордер дружбы и рекомендации
  - Общие культурные события и фестивали
  - Музыкальные и спортивные меморабилии

### 8. Офлайн-режим и PWA (адаптированный под регион)

#### **MVP - базовый офлайн:**
- Service Worker для кэширования страницы создания
- localStorage для автосохранения черновиков
- Индикатор статуса подключения
- Уведомление о потере связи

#### **V1 - полный офлайн:**
- IndexedDB для хранения фото и данных
- Очередь синхронизации при восстановлении связи
- Background sync для автоматической отправки
- Push-уведомления о статусе публикации
- Установка как PWA приложение

### 7. Экосистемная интеграция (V1)

#### **Интеграция с платформой:**
- **Единый профиль:**
  - Синхронизация с основным профилем платформы
  - Общая система рейтингов и отзывов
  - Единая история транзакций
- **Кошелек платформы:**
  - Использование внутреннего баланса
  - Начисление кэшбека за сделки
  - Оплата премиум-функций
- **Программа лояльности:**
  - Баллы за качественные объявления
  - Уровни продавцов с привилегиями
  - Реферальные бонусы

#### **Бизнес-инструменты:**
- **Массовая загрузка:**
  - Импорт каталогов (CSV, XML)
  - Синхронизация с 1C, CRM
  - API для автоматизации
- **Управление инвентарем:**
  - Отслеживание остатков
  - Автоматическое снятие при продаже
  - Уведомления о низких остатках
- **Аналитика продаж:**
  - Детальная статистика
  - Конверсионные воронки
  - Рекомендации по улучшению

### 8. UX/UI требования

#### Общие принципы
- **Прогресс-бар** с названиями шагов
- **Сохранение черновика** автоматически каждые 30 секунд
- **Валидация в реальном времени** с понятными сообщениями
- **Возможность вернуться** к предыдущим шагам
- **Мобильная адаптация** с упрощенным интерфейсом

#### Визуальные элементы
- Анимированные переходы между шагами
- Микроанимации при взаимодействии
- Skeleton screens при загрузке
- Тултипы с подсказками
- Визуальная обратная связь при действиях

### 9. Голосовой ввод и AI-ассистент

#### **V1 - Голосовой ввод:**
- **Диктовка текста:**
  - Поддержка Web Speech API
  - Распознавание на русском, английском, сербском
  - Автоматическая пунктуация
  - Команды редактирования (удалить слово, новый абзац)
- **Голосовые команды:**
  - Навигация по шагам ("следующий шаг", "назад")
  - Выбор опций ("выбрать первый вариант")
  - Управление ("сохранить черновик", "опубликовать")

#### **V2 - AI-ассистент:**
- **Чат-бот помощник:**
  - Контекстные подсказки на каждом шаге
  - Ответы на вопросы о заполнении
  - Рекомендации по улучшению объявления
- **Умное автозаполнение:**
  - Предсказание на основе поведения пользователя
  - Заполнение по аналогии с похожими объявлениями
  - Адаптация интерфейса под паттерны использования

### 10. Социальные функции

#### **V1 - Базовая интеграция:**
- **Импорт из соцсетей:**
  - Загрузка фото из Instagram/Facebook
  - Импорт описания из постов
  - Сохранение хештегов как тегов
- **Шаринг после публикации:**
  - Кнопки "Поделиться" для основных соцсетей
  - Автогенерация превью для соцсетей
  - Короткие ссылки для мессенджеров

#### **V2 - Продвинутая интеграция:**
- **Автопостинг:**
  - Публикация в группы Facebook/VK
  - Интеграция с Telegram-ботом
  - Планировщик постов
- **Реферальная система:**
  - Уникальные ссылки для отслеживания
  - Вознаграждения за привлеченных пользователей
  - Интеграция с программой лояльности

### 11. Технические особенности

#### State Management
- Redux Toolkit для управления состоянием формы
- Сохранение в localStorage для восстановления
- Оптимистичные обновления

#### Валидация
- Клиентская валидация на каждом шаге
- Серверная валидация перед публикацией
- Кастомные сообщения об ошибках

#### Оптимизация изображений
- Ресайз на клиенте до 1920px по большей стороне
- Конвертация в WebP (с fallback на JPEG)
- Lazy loading для предпросмотра

#### Интеграции
- OpenStreetMaps / Leaflet для карт и геокодинга
- Интеграция с MinIO для загрузки файлов
- WebSocket для real-time статуса загрузки
- Существующая система переводов (Google Translate / OpenAI)

### 12. Продвинутая ML персонализация (V1)

#### **Recommendation Engine:**
- **Умные предсказания:**
  - Предсказание категории по первому фото
  - Оптимальная цена на основе рынка
  - Лучшее время для публикации
  - Какие фото привлекут больше просмотров
- **Генерация контента:**
  - AI-генерация заголовков
  - Оптимизация описания для SEO
  - Подбор релевантных тегов
  - Предложения по улучшению текста

#### **User Journey оптимизация:**
- **Предсказание намерений:**
  - Определение цели (быстрая продажа vs максимальная цена)
  - Адаптация интерфейса под паттерны пользователя
  - Предотвращение отказов через умные подсказки
- **Персональные рекомендации:**
  - Какие атрибуты заполнить для успеха
  - Оптимальное количество фото
  - Рекомендации по улучшению конверсии

### 13. Дополнительные фичи

#### Smart Features
- **Анализ изображений** (варианты реализации):
  - Сравнение с базой эталонных изображений категорий (быстро, дешево)
  - OCR для извлечения текста с товара (бренд, модель)
  - Хеширование изображений для поиска дубликатов
  - ML модель для классификации (опционально)
  - Цветовой анализ для определения основных цветов
- **Модерация контента**:
  - Проверка по хешам запрещенных изображений
  - Анализ метаданных EXIF
  - Детекция watermarks конкурентов
- **Улучшение фото**:
  - Базовое: Sharp.js для обработки (обрезка, поворот, яркость)
  - Стандарт: Background removal API, цветокоррекция
  - Премиум: AI upscaling, профессиональные фильтры
- **Мультиязычность** с ручным и автоматическим переводом
  - Переключатель языка в форме
  - Автоперевод через Google Translate или OpenAI
  - Возможность редактирования переводов
  - Индикация машинного/ручного перевода
- **SEO оптимизация**:
  - Бесплатный анализ: длина текста, ключевые слова, уникальность
  - Платная AI-оптимизация через баланс пользователя
  - Интеграция с системой платежей для списания средств
  - История SEO-оптимизаций в профиле
- **Автозаполнение** на основе похожих объявлений
- **Рекомендации цены** на основе аналогов
- **Проверка качества** фотографий
- **Автоматическая индексация** в OpenSearch с учетом SEO-score

#### Gamification
- Прогресс заполнения с поощрениями
- Бейджи за качественные объявления
- Подсказки для повышения просмотров

### 5. Компонентная структура

```
CreateListingPage/
├── StepWizard/
│   ├── StepIndicator
│   ├── StepContent
│   └── StepNavigation
├── Steps/
│   ├── PhotoAnalysisStep/
│   │   ├── PhotoUploader
│   │   ├── ImageAnalyzer
│   │   ├── ContentModerator
│   │   ├── PhotoEnhancer
│   │   ├── AutofillResults
│   │   └── CategoryTreeFallback
│   ├── ListingTypeStep/
│   │   ├── TypeSelector
│   │   ├── VariationsManager
│   │   └── TypeSpecificFields
│   ├── BasicInfoStep/
│   │   ├── TitleInput
│   │   ├── DescriptionEditor
│   │   ├── ConditionSelect
│   │   ├── PriceInput
│   │   ├── RentalFields
│   │   ├── ExchangeFields
│   │   ├── ServiceFields
│   │   └── VariationsList
│   ├── AttributesStep/
│   │   ├── DynamicAttributeForm
│   │   ├── AttributeField
│   │   └── CustomComponents/
│   ├── PhotosStep/
│   │   ├── PhotoUploader
│   │   ├── PhotoPreview
│   │   ├── PhotoEditor
│   │   └── UploadProgress
│   ├── LocationStep/
│   │   ├── LocationMap
│   │   ├── AddressSearch
│   │   └── LocationPrivacy
│   ├── SEOStep/
│   │   ├── SEOAnalyzer
│   │   ├── KeywordDensity
│   │   ├── SEOPreview
│   │   ├── AIOptimizer
│   │   └── CompetitorAnalysis
│   └── PublishStep/
│       ├── ContactSettings
│       ├── ListingPreview
│       └── PublishButton
└── Common/
    ├── SaveDraftButton
    ├── ValidationSummary
    ├── HelpTooltip
    ├── A11y/
    │   ├── A11yWrapper
    │   ├── ScreenReaderHelper
    │   ├── KeyboardNavigation
    │   └── ColorBlindSupport
    ├── OfflineSupport/
    │   ├── ServiceWorkerManager
    │   ├── OfflineIndicator
    │   └── SyncQueue
    ├── VoiceInput/
    │   ├── SpeechRecognition
    │   └── VoiceCommands
    ├── DuplicateDetection/
    │   ├── DuplicateChecker
    │   ├── SimilarListingsModal
    │   └── MergeListingsFlow
    ├── SocialIntegration/
    │   ├── InstagramImporter
    │   ├── FacebookShare
    │   ├── TelegramBot
    │   └── ReferralTracker
    ├── PersonalizationEngine/
    │   ├── UserBehaviorTracker
    │   ├── SmartDefaults
    │   └── FormAdaptation
    ├── Analytics/
    │   ├── ConversionFunnel
    │   ├── ABTestWrapper
    │   └── HeatmapTracker
    ├── ARPreview/
    │   ├── RoomVisualizer
    │   ├── ClothingTryOn
    │   └── ScaleComparison
    ├── RegionalTrust/
    │   ├── PhoneCallVerification
    │   ├── LocalReputationBadge
    │   ├── PersonalMeetingScheduler
    │   ├── SafePlacesMap
    │   ├── NeighborhoodGroups
    │   └── CODCalculator
    ├── Compliance/
    │   ├── ConsentManager
    │   ├── AgeVerification
    │   ├── ProhibitedItemsChecker
    │   └── DataPrivacyNotice
    ├── EcosystemIntegration/
    │   ├── ProfileSync
    │   ├── WalletConnect
    │   ├── LoyaltyPoints
    │   └── BusinessAPIClient
    ├── MLPersonalization/
    │   ├── CategoryPredictor
    │   ├── PriceOptimizer
    │   ├── ContentGenerator
    │   └── UserIntentAnalyzer
    ├── RegionalLocalization/
    │   ├── CyrillicLatinSwitcher
    │   ├── RegionalDialectProcessor
    │   ├── CurrencyConverter
    │   ├── TraditionalUnitsHandler
    │   ├── SeasonalCategoryManager
    │   └── CulturalContextAdapter
    ├── PijacaDigital/
    │   ├── VendorStallInterface
    │   ├── TraditionalMarketStyle
    │   ├── NeighborhoodCommunity
    │   ├── LocalEventsCalendar
    │   ├── RegularCustomersSystem
    │   └── BargainingInterface
    ├── YugoslavianHeritage/
    │   ├── NostalgiaCategories
    │   ├── CrossBorderConnections
    │   ├── RegionalSpecialties
    │   ├── CulturalEventIntegration
    │   └── SharedMemoriesMarket
    └── LowResourceOptimization/
        ├── DataCompressionManager
        ├── OfflineFirstDesign
        ├── OldDeviceSupport
        ├── ProgressiveImageLoader
        └── TrafficSavingMode
```

### 14. API endpoints для реализации

```typescript
// Существующие endpoints
GET    /api/v1/marketplace/category-tree           // Дерево категорий ✅
GET    /api/v1/marketplace/categories/:id/attributes // Атрибуты категории ✅
POST   /api/v1/marketplace/listings               // Создание объявления ✅
POST   /api/v1/marketplace/listings/:id/images    // Загрузка изображений ✅

// MVP - Критические endpoints
POST   /api/v1/marketplace/listings/draft         // Сохранение черновика
DELETE /api/v1/marketplace/listings/:id/draft     // Удаление черновика
GET    /api/v1/marketplace/listings/drafts        // Список черновиков пользователя
POST   /api/v1/marketplace/listings/validate      // Валидация данных
DELETE /api/v1/marketplace/images/:id             // Удаление изображения до публикации

// Региональная система доверия (MVP)
POST   /api/v1/trust/phone-call-verify            // Верификация звонком (не SMS)
POST   /api/v1/trust/local-verification           // Локальная верификация в районе
GET    /api/v1/trust/local-reputation             // Местная репутация продавца
POST   /api/v1/meetings/schedule-personal         // Планирование личной встречи
GET    /api/v1/meetings/safe-places               // Безопасные места для встреч
POST   /api/v1/meetings/rate-location             // Оценка места встречи
GET    /api/v1/payments/cod-calculator            // Калькулятор наложенного платежа
POST   /api/v1/negotiations/price-offer           // Предложение цены (торг)

// Региональная локализация (MVP)
GET    /api/v1/localization/script-preference     // Предпочтение кирилица/латиница
POST   /api/v1/localization/currency-convert      // Конвертация валют (РСД/EUR/HRK/MKD)
GET    /api/v1/localization/regional-phrases      // Региональные фразы и выражения
GET    /api/v1/localization/seasonal-categories   // Сезонные категории товаров
GET    /api/v1/localization/traditional-units     // Традиционные единицы измерения

// "Pijaca 2.0" функции (MVP)
GET    /api/v1/pijaca/vendor-stalls               // Персональные "тезге" продавцов
POST   /api/v1/pijaca/neighborhood-groups         // Районные группы
GET    /api/v1/pijaca/local-events                // Местные ярмарки и события
POST   /api/v1/pijaca/regular-customers           // Система постоянных покупателей
GET    /api/v1/pijaca/traditional-calendar        // Традиционный торговый календарь

// Compliance региональный (MVP)
POST   /api/v1/compliance/consent                 // Управление согласиями
GET    /api/v1/compliance/prohibited-items        // Список запрещенных товаров по стране
POST   /api/v1/compliance/cross-border-check      // Проверка межстранового товара
GET    /api/v1/compliance/regional-licenses       // Региональные лицензии

// Офлайн и синхронизация (MVP)
POST   /api/v1/marketplace/listings/sync          // Синхронизация офлайн-данных
GET    /api/v1/marketplace/listings/offline       // Получение кэшированных данных  
PUT    /api/v1/marketplace/listings/queue         // Управление очередью синхронизации

// Система дубликатов (V1)
POST   /api/v1/marketplace/listings/check-duplicates  // Проверка дубликатов
GET    /api/v1/marketplace/listings/similar           // Похожие объявления
POST   /api/v1/marketplace/listings/merge             // Объединение объявлений

// Существующие endpoints для переводов
POST   /api/v1/marketplace/translations/translate     // Перевести текст ✅
POST   /api/v1/marketplace/translations/batch         // Пакетный перевод ✅
PUT    /api/v1/marketplace/translations/:id          // Обновить переводы ✅
GET    /api/v1/marketplace/translations/:id          // Получить переводы ✅

// Endpoints для анализа изображений и модерации
POST   /api/v1/marketplace/images/analyze            // Анализ изображения (категория, бренд)
POST   /api/v1/marketplace/images/moderate           // Модерация контента
POST   /api/v1/marketplace/images/enhance            // Улучшение фото (платно)
GET    /api/v1/marketplace/images/similar            // Поиск похожих товаров по фото

// Экосистемная интеграция (V1)
GET    /api/v1/ecosystem/profile/sync                // Синхронизация профиля
POST   /api/v1/ecosystem/wallet/balance              // Проверка баланса кошелька
POST   /api/v1/ecosystem/loyalty/earn-points         // Начисление баллов лояльности
GET    /api/v1/ecosystem/business/inventory          // Управление инвентарем
POST   /api/v1/ecosystem/business/bulk-upload        // Массовая загрузка

// ML персонализация (V1)
POST   /api/v1/ml/predict/category                   // Предсказание категории по фото
POST   /api/v1/ml/optimize/price                     // Оптимизация цены
POST   /api/v1/ml/generate/title                     // Генерация заголовка
POST   /api/v1/ml/analyze/user-intent                // Анализ намерений пользователя
GET    /api/v1/ml/recommendations/listing-quality    // Рекомендации по качеству

// Интеграции с внешними сервисами (V2)
POST   /api/v1/marketplace/integrations/barcode      // Сканирование штрих-кодов
GET    /api/v1/marketplace/integrations/catalogs     // Импорт из каталогов производителей
POST   /api/v1/marketplace/integrations/shipping     // Расчет доставки
POST   /api/v1/marketplace/integrations/social       // Импорт из соцсетей

// Endpoints для SEO и индексации
GET    /api/v1/marketplace/seo/keywords/:categoryId   // Популярные ключевые слова категории
POST   /api/v1/marketplace/seo/analyze               // Анализ SEO текста
POST   /api/v1/marketplace/seo/optimize              // AI оптимизация (платно)
GET    /api/v1/marketplace/seo/competitors/:categoryId // Анализ конкурентов

// Расширенная аналитика (V2)
POST   /api/v1/marketplace/analytics/track           // Отслеживание действий пользователя
GET    /api/v1/marketplace/analytics/funnel          // Анализ воронки конверсии
POST   /api/v1/marketplace/analytics/ab-test         // A/B тестирование

// Опциональные endpoints для V2-V3
GET    /api/v1/marketplace/listings/price-suggestion // Рекомендация цены
POST   /api/v1/marketplace/ar/preview               // AR preview товара
POST   /api/v1/marketplace/blockchain/verify        // Blockchain верификация
```

### Адаптация под существующую архитектуру:
1. Использовать существующий процесс создания объявления
2. Реализовать черновики на frontend через localStorage + опциональный backend
3. Загрузка изображений происходит после создания объявления
4. Интеграция с OpenSearch:
   - Автоматическая индексация после создания/обновления
   - Включение SEO-оптимизированных полей в индекс
   - Использование анализаторов для разных языков
   - Boost для объявлений с лучшим SEO
5. Расширение модели данных для поддержки:
   - Типов объявлений (listing_type: sale/rent/exchange/service/wanted/free)
   - Вариаций товаров (новая таблица listing_variations)
   - Специфичных полей для разных типов (rental_period, deposit, etc.)
   - Управления остатками для вариаций

### 7. Мобильная версия

- Упрощенный пошаговый интерфейс
- Полноэкранные шаги
- Нативная камера для фото
- Свайпы для навигации
- Адаптированные контролы

### 15. Метрики успеха

#### **Основные метрики (MVP):**
- **Скорость:**
  - Среднее время создания < 3 минуты (было 5)
  - Время до загрузки первого фото < 30 секунд
  - Процент завершения создания > 85%
  
- **Качество:**
  - Оценка качества фото > 8/10
  - Полнота заполнения полей > 95%
  - Процент прохождения модерации с первого раза > 90%

- **Accessibility:**
  - WCAG 2.1 AA compliance = 100%
  - Keyboard navigation success rate > 95%
  - Screen reader compatibility = 100%

- **Региональное доверие (КРИТИЧНО):**
  - Personal meeting rate > 60% (уникальная метрика для региона)
  - COD payment rate > 70% (наложенный платеж)
  - Local seller preference > 80% (предпочтение местных)
  - Phone call verification rate > 95% (звонок, не SMS)
  - Neighborhood reputation accuracy > 90% (точность местной репутации)

#### **Расширенные метрики (V1+):**
- **Региональная локализация:**
  - Multi-language usage > 40% (использование нескольких языков)
  - Cyrillic-Latin switching > 30% (переключение письменности)
  - Regional dialect accuracy > 90% (точность диалектов)
  - Traditional units usage > 25% (использование традиционных единиц)

- **"Pijaca 2.0" эффективность:**
  - Vendor stall engagement > 70% (вовлеченность "тезги")
  - Neighborhood group participation > 40% (участие в районных группах)
  - Traditional events integration > 60% (интеграция с традиционными событиями)
  - Regular customer retention > 80% (удержание постоянных покупателей)

- **Межрегиональная торговля:**
  - Cross-border trade > 25% (торговля через границы)
  - Multi-country user base > 30% (пользователи из разных стран)
  - Regional partnership success > 60% (успешность региональных партнерств)
  - Yugoslav heritage engagement > 35% (вовлеченность в наследие)

- **ML эффективность:**
  - AI recommendation accuracy > 85%
  - Autofill correctness > 90%
  - Price optimization lift > 15%
  - Category prediction accuracy > 90%

- **Бизнес-метрики:**
  - Конверсия объявления в продажу > 25%
  - Revenue per listing +25% vs baseline
  - Customer lifetime value +40% vs baseline
  - Platform take rate optimized to 3-5%

- **Социальные и качество:**
  - Процент шаринга в соцсети > 30%
  - Community moderation accuracy > 95%
  - Expert verification adoption > 15%
  - Sustainability feature usage > 25%

### 9. Примеры лучших практик

Вдохновение от:
- **Avito** - простота и скорость
- **Facebook Marketplace** - визуальность
- **Airbnb** - пошаговость и подсказки
- **Etsy** - детальность атрибутов
- **OLX** - мобильный опыт

### 10. Преимущества системы вариаций

Для примера с чехлами на телефон (40 цветов):

**Одно объявление с вариациями:**
- ✅ Удобное управление остатками
- ✅ Единая статистика просмотров
- ✅ Накопление отзывов в одном месте
- ✅ Легче попасть в топ выдачи
- ✅ Покупатель видит все варианты сразу
- ✅ Меньше работы по обновлению

**40 отдельных объявлений:**
- ❌ Сложно управлять
- ❌ Размытие статистики
- ❌ Спам в выдаче
- ❌ Покупателю сложнее найти нужный цвет

### 16. Community-Driven Quality и Sustainability (V2)

#### **Community-Driven Quality:**
- **Совет качества:**
  - Выборные представители активного сообщества
  - Голосование по спорным модерациям
  - Разработка стандартов качества
- **Краудсорсинг модерации:**
  - Система репутации модераторов
  - Коллективная проверка спорных объявлений
  - Вознаграждения за качественную модерацию
- **Экспертная верификация:**
  - Проверка экспертами в нишевых категориях
  - Значки экспертного одобрения
  - Система наставничества для новых продавцов

#### **Sustainability Features:**
- **Экологический подход:**
  - Расчет углеродного следа покупки
  - Приоритет для местных бизнесов
  - Поощрение покупки б/у товаров
- **Ремонт вместо покупки:**
  - Сообщество ремонта и восстановления
  - Гайды по ремонту от экспертов
  - Каталог мастерских и услуг ремонта
- **Экологичная логистика:**
  - Варианты экологичной упаковки
  - Группировка заказов для оптимизации
  - Компенсация углеродного следа

### 17. Революционные фичи (V2-V3)

#### **Упрощенные визуальные помощники (V2):**
- **Сравнение размеров:**
  - Сравнение с обычными объектами (монета, линейка)
  - Наложение размерной сетки на фото
  - Визуальные индикаторы масштаба
- **Улучшенная визуализация:**
  - 360-градусный поворот товара
  - Детальное приближение с высоким разрешением
  - Точная передача цветов с калибровкой
- **Базовое AR (V3):**
  - Простое размещение товара в пространстве
  - Примерка без сложных алгоритмов
  - Интеграция с камерой мобильных устройств

#### **Predictive Commerce (V3):**
- **Предсказание спроса:**
  - Анализ трендов и сезонности
  - Прогноз популярности товаров
  - Рекомендации по времени публикации
- **Управление жизненным циклом:**
  - Оптимизация цен на основе спроса
  - Автоматическое перемещение в архив
  - Предложения по обновлению объявлений
- **Анализ настроений рынка:**
  - Мониторинг социальных сетей
  - Влияние событий на спрос
  - Адаптация стратегии продаж

#### **Умная логистика:**
- **Мгновенная доставка:**
  - Интеграция с курьерскими сервисами
  - Расчет стоимости в реальном времени
  - Отслеживание в приложении
- **Экологичные варианты:**
  - Углеродный след доставки
  - Группировка заказов для оптимизации
  - Поощрение экологичных способов

### 13. Архитектурные улучшения

#### **Микросервисная архитектура:**
```typescript
Services/
├── ListingService/           // Основная логика объявлений
├── ImageProcessingService/   // Обработка изображений (Sharp, AI)
├── AIAnalysisService/        // ML модели, анализ контента
├── ModerationService/        // Проверка контента, антифрод
├── NotificationService/      // Push, email, SMS уведомления
├── AnalyticsService/         // Сбор метрик, A/B тесты
├── IntegrationService/       // Внешние API (соцсети, доставка)
└── BlockchainService/        // Верификация, NFT
```

#### **Event-Driven архитектура:**
```typescript
Events/
├── ListingEvents/
│   ├── ListingCreated
│   ├── ListingUpdated
│   ├── ListingPublished
│   └── ListingDeleted
├── UserEvents/
│   ├── UserActionTracked
│   ├── FormStepCompleted
│   └── VoiceCommandUsed
├── ModerationEvents/
│   ├── ContentFlagged
│   ├── DuplicateDetected
│   └── QualityScoreCalculated
└── SyncEvents/
    ├── OfflineDataQueued
    ├── SyncStarted
    └── SyncCompleted
```

#### **Оптимизация производительности:**
- Code splitting по шагам формы
- Lazy loading тяжелых компонентов (AR, карты)
- WebAssembly для обработки изображений
- Edge computing для геолокации
- CDN для статических ресурсов

### 14. Приоритеты реализации

#### **MVP** (критически важно для региона):
1. **Региональная система доверия (ПРИОРИТЕТ #1)**
   - Лична предаја (личная передача) с планировщиком встреч
   - Верификация звонком на местные номера (MTS, VIP, Telenor)
   - Наложенный платеж как основной способ
   - Локальные индикаторы доверия и репутации

2. **Мультиязычность и культурная адаптация**
   - Кирилица/Латиница динамическое переключение
   - Поддержка всех региональных языков и диалектов
   - Традиционные единицы измерения
   - Культурно-адаптированные фразы и выражения

3. **"Pijaca 2.0" - цифровой традиционный рынок**
   - Персонализированные "тезге" (лавки) продавцов
   - Районные группы и местные сообщества
   - Интеграция с традиционными событиями и ярмарками
   - Система постоянных покупателей

4. **Экономическая доступность (low-income адаптация)**
   - Мобильный-first с экономией трафика
   - Поддержка старых устройств (Android 6+)
   - Оффлайн-режим для просмотра объявлений
   - Прогрессивная загрузка с индикатором потребления

5. **Региональное compliance**
   - Переходные ЕС регуляции для Сербии
   - Полное GDPR для ЕС стран региона
   - Локальные запреты и лицензионные требования
   - Межстрановые торговые правила

#### **V1** (региональная экспансия, 3-6 месяцев):
1. **Межстрановая экспансия с общим наследием**
   - Развертывание в Хорватии и Словении
   - "Югославский мост" - объединяющие функции
   - Единая система репутации через границы
   - Ностальгические товары и меморабилия

2. **Региональная AI специализация**
   - Предсказание цен по региональным рынкам
   - Анализ сезонного спроса (с/х специфика)
   - NLP для югославских языков и диалектов
   - Культурно-контекстное понимание

3. **Партнерства с местными конкурентами**
   - Мосты интеграции с KupujemProdajem
   - Сотрудничество с Njuskalo (Хорватия)
   - Партнерство с Bolha (Словения)
   - Интеграция с Pazar3 (Македония)

4. **Сельскохозяйственная платформа**
   - Специальные инструменты для фермеров
   - Сезонные категории и календари
   - Прямые продажи от производителей
   - Поддержка традиционных продуктов

5. **Расширенная общинная система**
   - Местные модераторы от сообщества
   - Быстрое решение споров через арбитров
   - Система наставничества для новых продавцов
   - Культурно-чувствительная модерация

#### **V2** (инновации, 3-6 месяцев):
1. **Community-Driven Quality**
   - Совет качества из сообщества
   - Краудсорсинг модерации
   - Экспертная верификация в нишах
   - Программа наставничества

2. **Sustainability функции**
   - Расчет углеродного следа
   - Приоритет экологичных товаров
   - Сообщество ремонта
   - Экологичная логистика

3. **Упрощенные AR фичи**
   - Сравнение размеров с объектами
   - 360-градусный просмотр
   - Точная передача цветов
   - Детальное приближение

4. **Голосовой ввод и социальная интеграция**
   - Диктовка описаний
   - Импорт из Instagram/Facebook
   - Автопостинг в соцсети
   - Реферальная система

#### **V3** (предиктивная аналитика, 6+ месяцев):
1. **Predictive Commerce**
   - Предсказание спроса и трендов
   - Управление жизненным циклом товаров
   - Анализ настроений рынка
   - Оптимизация стратегии продаж

2. **Расширенная аналитика**
   - A/B тестирование форм
   - Тепловые карты взаимодействий
   - Предиктивная аналитика поведения
   - Автооптимизация конверсии

3. **Базовое AR**
   - Простое размещение в пространстве
   - Примерка без сложных алгоритмов
   - Интеграция с мобильными камерами

#### **V4+** (далекое будущее):
1. **Blockchain верификация**
   - Доказательство подлинности
   - История владения
   - NFT для коллекционных товаров

2. **Полноценный AR/VR**
   - Сложная примерка одежды
   - Визуализация в интерьере
   - AR-линейка и измерения

3. **Микросервисная архитектура**
   - Полное разделение на сервисы
   - Event-driven подход
   - Бесконечная масштабируемость

## Заключение

Данное техническое задание описывает создание **региональной платформы для Балкан**, которая станет цифровым воплощением традиционной югославской торговли:

1. **Понимает региональную душу** - лична предаја, наложенный платеж, районные сообщества
2. **Уважает культурные традиции** - кирилица/латиница, традиционные рынки, семейный бизнес
3. **Адаптирована под экономику** - низкая покупательная способность, экономия трафика, старые устройства
4. **Объединяет через наследие** - общая югославская история как конкурентное преимущество
5. **Локализована до мелочей** - диалекты, валюты, традиционные единицы, сезонность

### Ключевые региональные инновации:
- 🤝 **Trust-through-personal-connections** - доверие через личные связи, не технологии
- 🏛️ **Digital-traditional-market** - "Pijaca 2.0" как уникальное позиционирование
- 🌍 **Yugoslav-heritage-bridge** - общее наследие как объединяющий фактор
- 📱 **Low-resource-optimization** - работа на слабых устройствах и медленном интернете
- 🗣️ **Multi-script-fluency** - свободное переключение кирилица/латиница
- 🚚 **COD-as-primary** - наложенный платеж как основа доверия
- 🏘️ **Neighborhood-commerce** - районная торговля и местная репутация

### Региональные риски и митигация:
- **Культурная чувствительность** → Наем местных экспертов, культурные консультанты
- **Межстрановые регуляции** → Юридическая экспертиза по каждой стране региона
- **Низкая покупательная способность** → Freemium модель, локальное ценообразование
- **Консервативность к новым технологиям** → Постепенное внедрение, обучающий контент
- **Конкуренция с укоренившимися игроками** → Уникальное позиционирование через традиции
- **Языковая сложность** → NLP экспертиза по югославским языкам
- **Качество интернета в регионе** → Оффлайн-first подход, оптимизация для 3G

### Следующие шаги для региона:
1. **Региональная экспертиза и команда**
   - Найм местных экспертов по культуре и языкам
   - Юридическая экспертиза по Сербии, Хорватии, Словении
   - Партнерства с местными телеком операторами

2. **MVP с региональным фокусом**
   - Система "лична предаја" как ключевая функция
   - Интеграция с местными курьерскими службами
   - Кирилица/латиница переключение в UI

3. **Пилотное тестирование в Белграде**
   - Запуск в одном районе с местными продавцами
   - Тестирование с фокус-группами традиционных рынков
   - Валидация концепции "Pijaca 2.0"

4. **Постепенная экспансия по региону**
   - Хорватия и Словения как следующие рынки
   - Адаптация под ЕС регуляции
   - Валидация "югославского моста" концепции

Это ТЗ - живой документ, который будет обновляться на основе обратной связи пользователей и результатов A/B тестов.