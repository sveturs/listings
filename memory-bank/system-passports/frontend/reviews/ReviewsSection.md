# ะะฐัะฟะพัั ะบะพะผะฟะพะฝะตะฝัะฐ: ReviewsSection

## ๐ ะะตัะฐะดะฐะฝะฝัะต
- **ะััั**: `/frontend/svetu/src/components/reviews/ReviewsSection.tsx`
- **ะะพะปั**: Container Component - Review Management Orchestrator
- **ะขะธะฟ**: React Client Component
- **ะะฐะทะผะตั**: 259 ัััะพะบ

## ๐ฏ ะะฐะทะฝะฐัะตะฝะธะต
ะะปะฐะฒะฝัะน ะบะพะฝัะตะนะฝะตัะฝัะน ะบะพะผะฟะพะฝะตะฝั ะดะปั ัะฟัะฐะฒะปะตะฝะธั ะฒัะตะน ัะธััะตะผะพะน ะพัะทัะฒะพะฒ. ะะพะพัะดะธะฝะธััะตั ะพัะพะฑัะฐะถะตะฝะธะต ััะฐัะธััะธะบะธ, ัะฟะธัะบะฐ ะพัะทัะฒะพะฒ, ัะพัะผั ัะพะทะดะฐะฝะธั ะพัะทัะฒะฐ ะธ ะฟัะพะฒะตัะบั ะฟัะฐะฒ ะฟะพะปัะทะพะฒะฐัะตะปั. ะกะปัะถะธั ะตะดะธะฝะพะน ัะพัะบะพะน ะฒัะพะดะฐ ะดะปั ะธะฝัะตะณัะฐัะธะธ ัะธััะตะผั ะพัะทัะฒะพะฒ.

## ๐ง Props ััััะบัััะฐ

```typescript
interface ReviewsSectionProps {
  entityType: 'listing' | 'user' | 'storefront'; // ะขะธะฟ ัััะฝะพััะธ ะดะปั ะพัะทัะฒะพะฒ
  entityId: number;                               // ID ัััะฝะพััะธ
  sellerId?: number;                             // ID ะฟัะพะดะฐะฒัะฐ (ะดะปั ะฟัะพะฒะตัะบะธ ะฟัะฐะฒ)
  storefrontId?: number;                         // ID ะฒะธััะธะฝั (ะพะฟัะธะพะฝะฐะปัะฝะพ)
}
```

## ๐ ะะฐะฒะธัะธะผะพััะธ

### ะะฝะตัะฝะธะต ะฑะธะฑะปะธะพัะตะบะธ
- React (useState)
- next-intl (useTranslations)

### ะะฝัััะตะฝะฝะธะต ะทะฐะฒะธัะธะผะพััะธ
- `@/contexts/AuthContext` - ะบะพะฝัะตะบัั ะฐััะตะฝัะธัะธะบะฐัะธะธ
- `@/hooks/useReviews` - ััะบะธ ะดะปั ัะฐะฑะพัั ั ะพัะทัะฒะฐะผะธ
- `./RatingStats` - ะบะพะผะฟะพะฝะตะฝั ััะฐัะธััะธะบะธ ัะตะนัะธะฝะณะฐ
- `./ReviewList` - ะบะพะผะฟะพะฝะตะฝั ัะฟะธัะบะฐ ะพัะทัะฒะพะฒ
- `./ReviewForm` - ัะพัะผะฐ ัะพะทะดะฐะฝะธั ะพัะทัะฒะฐ
- `@/types/review` - ัะธะฟั ะพัะทัะฒะพะฒ

## ๐ ะฃะฟัะฐะฒะปะตะฝะธะต ัะพััะพัะฝะธะตะผ

### ะะพะบะฐะปัะฝะพะต ัะพััะพัะฝะธะต
```typescript
const [showReviewForm, setShowReviewForm] = useState(false); // ะะพะบะฐะท ัะพัะผั ะพัะทัะฒะฐ
const [filters, setFilters] = useState<ReviewsFilter>({     // ะคะธะปัััั ะพัะทัะฒะพะฒ
  entity_type: entityType,
  entity_id: entityId,
  page: 1,
  limit: 10,
  sort_by: 'date',
  sort_order: 'desc',
});
```

### ะะปะพะฑะฐะปัะฝะพะต ัะพััะพัะฝะธะต
```typescript
const { user } = useAuth(); // ะะฐะฝะฝัะต ัะตะบััะตะณะพ ะฟะพะปัะทะพะฒะฐัะตะปั
```

### ะกะตัะฒะตัะฝะพะต ัะพััะพัะฝะธะต (React Query)
```typescript
// ะะฐะณััะทะบะฐ ะพัะทัะฒะพะฒ ั ัะธะปัััะฐะผะธ
const {
  data: reviewsData,
  isLoading: reviewsLoading,
  refetch: refetchReviews,
} = useReviews(filters);

// ะะฐะณััะทะบะฐ ััะฐัะธััะธะบะธ ะพัะทัะฒะพะฒ
const {
  data: statsData,
  isLoading: statsLoading,
  refetch: refetchStats,
} = useReviewStats(entityType, entityId);

// ะัะพะฒะตัะบะฐ ะฒะพะทะผะพะถะฝะพััะธ ะฝะฐะฟะธัะฐัั ะพัะทัะฒ
const { data: canReviewData } = useCanReview(entityType, entityId, user?.id);
```

## ๐งฉ ะะธะทะฝะตั-ะปะพะณะธะบะฐ

### ะัะพะฒะตัะบะฐ ะฟัะฐะฒ ะฝะฐ ัะพะทะดะฐะฝะธะต ะพัะทัะฒะฐ
```typescript
const canWriteReview = user && canReviewData?.can_review && user.id !== sellerId;
```

### ะะฑัะฐะฑะพััะธะบะธ ัะพะฑััะธะน
```typescript
// ะฃัะฟะตัะฝะพะต ัะพะทะดะฐะฝะธะต ะพัะทัะฒะฐ
const handleReviewSuccess = () => {
  setShowReviewForm(false);
  refetchReviews();  // ะัะธะฝัะดะธัะตะปัะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ัะฟะธัะบะฐ
  refetchStats();    // ะัะธะฝัะดะธัะตะปัะฝะพะต ะพะฑะฝะพะฒะปะตะฝะธะต ััะฐัะธััะธะบะธ
};

// ะกะผะตะฝะฐ ัััะฐะฝะธัั
const handlePageChange = (page: number) => {
  setFilters((prev) => ({ ...prev, page }));
};

// ะกะผะตะฝะฐ ัะพััะธัะพะฒะบะธ
const handleSortChange = (sortBy: string) => {
  setFilters((prev) => ({
    ...prev,
    sort_by: sortBy as 'date' | 'rating' | 'likes',
    page: 1, // ะกะฑัะพั ะฝะฐ ะฟะตัะฒัั ัััะฐะฝะธัั
  }));
};

// ะะทะผะตะฝะตะฝะธะต ัะธะปัััะพะฒ
const handleFilterChange = (newFilters: Partial<ReviewsFilter>) => {
  setFilters((prev) => ({ ...prev, ...newFilters, page: 1 }));
};
```

## ๐จ UI ััััะบัััะฐ

### ะัะฝะพะฒะฝะฐั ะฐััะธัะตะบัััะฐ
```
โโ ะะฐะณะพะปะพะฒะพะบ ัะตะบัะธะธ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ [๐ฌ ะัะทัะฒั (123)]              [+ ะะฐะฟะธัะฐัั]  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโ ะฃะฒะตะดะพะผะปะตะฝะธะต (ะตัะปะธ ะฝะตะปัะทั ะฟะธัะฐัั ะพัะทัะฒ) โโโโโโโ
โ โ๏ธ ะั ัะถะต ะพััะฐะฒะธะปะธ ะพัะทัะฒ / ะะปะฐะดะตะปะตั ัะพะฒะฐัะฐ   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโ ะคะพัะผะฐ ะพัะทัะฒะฐ (ะตัะปะธ ะฟะพะบะฐะทะฐะฝะฐ) โโโโโโโโโโโโโโโโ
โ [ะะฐั ะพัะทัะฒ]                            [ร]   โ
โ < ReviewForm ะบะพะผะฟะพะฝะตะฝั >                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโ ะกัะฐัะธััะธะบะฐ ัะตะนัะธะฝะณะฐ โโโโโโโโโโโโโโโโโโโโโโโโโ
โ < RatingStats ะบะพะผะฟะพะฝะตะฝั >                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโ ะกะฟะธัะพะบ ะพัะทัะฒะพะฒ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ < ReviewList ะบะพะผะฟะพะฝะตะฝั >                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โโ ะะฐะณะปััะบะฐ (ะตัะปะธ ะพัะทัะฒะพะฒ ะฝะตั) โโโโโโโโโโโโโโโโโ
โ        ๐ฌ                                    โ
โ   ะัะทัะฒะพะฒ ะฟะพะบะฐ ะฝะตั                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะกะพััะพัะฝะธั ะทะฐะณััะทะบะธ
```typescript
if (reviewsLoading || statsLoading) {
  return (
    <div className="space-y-6">
      <div className="skeleton h-48"></div>  {/* ะกะบะตะปะตัะพะฝ ััะฐัะธััะธะบะธ */}
      <div className="skeleton h-96"></div>  {/* ะกะบะตะปะตัะพะฝ ัะฟะธัะบะฐ */}
    </div>
  );
}
```

## ๐ง ะคัะฝะบัะธะพะฝะฐะปัะฝัะต ะฒะพะทะผะพะถะฝะพััะธ

### ะฃัะปะพะฒะฝัะน ัะตะฝะดะตัะธะฝะณ

#### ะะฝะพะฟะบะฐ "ะะฐะฟะธัะฐัั ะพัะทัะฒ"
- ะะพะบะฐะทัะฒะฐะตััั ัะพะปัะบะพ ะตัะปะธ ะฟะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะพััะฐะฒะธัั ะพัะทัะฒ
- ะกะบััะฒะฐะตััั ะบะพะณะดะฐ ัะพัะผะฐ ัะถะต ะพัะบัััะฐ
- ะฃัะธััะฒะฐะตั ะฟัะฐะฒะฐ ะฟะพะปัะทะพะฒะฐัะตะปั (ะฝะต ะฟัะพะดะฐะฒะตั, ะฝะต ะฟะธัะฐะป ัะฐะฝะตะต)

#### ะฃะฒะตะดะพะผะปะตะฝะธั ะพ ะทะฐะฟัะตัะต
```typescript
// ะัะธัะธะฝั ะทะฐะฟัะตัะฐ ะฝะฐ ะฝะฐะฟะธัะฐะฝะธะต ะพัะทัะฒะฐ
canReviewData.reason === 'already_reviewed'  // ะฃะถะต ะพััะฐะฒะธะป ะพัะทัะฒ
canReviewData.reason === 'is_owner'          // ะะปะฐะดะตะปะตั ัะพะฒะฐัะฐ
default: t('cantReview')                     // ะะฑัะธะน ะทะฐะฟัะตั
```

#### ะคะพัะผะฐ ะพัะทัะฒะฐ
- ะะพะบะฐะทัะฒะฐะตััั ัะพะปัะบะพ ะฟะพ ะฝะฐะถะฐัะธั ะบะฝะพะฟะบะธ
- ะะฝัะตะณัะธัะพะฒะฐะฝะฐ ะฒ ะพะฑัะธะน ะฟะพัะพะบ ั ะทะฐะณะพะปะพะฒะบะพะผ ะธ ะบะฝะพะฟะบะพะน ะทะฐะบัััะธั
- ะะตัะตะดะฐัั ะฒัะต ะฝะตะพะฑัะพะดะธะผัะต ะฟะฐัะฐะผะตััั

### ะะฑัะฐะฑะพัะบะฐ ะดะฐะฝะฝัั

#### ะะฝะฐัะตะฝะธั ะฟะพ ัะผะพะปัะฐะฝะธั
```typescript
const reviews = reviewsData?.reviews || [];
const totalPages = reviewsData?.totalPages || 0;
const stats = statsData || {
  total_reviews: 0,
  average_rating: 0,
  verified_reviews: 0,
  rating_distribution: {},
  photo_reviews: 0,
};
```

#### Debug ะธะฝัะพัะผะฐัะธั
```typescript
console.log('ReviewsSection debug:', {
  user: user?.id,
  canReviewData,
  sellerId,
  canWriteReview,
  reviewsData,
  statsData,
  reviewsLoading,
  statsLoading,
});
```

## ๐ฏ ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะพัะบะธ

### ะก ัะพะดะธัะตะปััะบะธะผะธ ะบะพะผะฟะพะฝะตะฝัะฐะผะธ
```typescript
// ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะฒ ัััะฐะฝะธัะต ัะพะฒะฐัะฐ
<ReviewsSection
  entityType="listing"
  entityId={listing.id}
  sellerId={listing.seller_id}
/>

// ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะดะปั ะฟัะพัะธะปั ะฟะพะปัะทะพะฒะฐัะตะปั
<ReviewsSection
  entityType="user"
  entityId={profile.id}
/>

// ะัะธะผะตั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะดะปั ะฒะธััะธะฝั
<ReviewsSection
  entityType="storefront"
  entityId={storefront.id}
  storefrontId={storefront.id}
/>
```

### ะก ะดะพัะตัะฝะธะผะธ ะบะพะผะฟะพะฝะตะฝัะฐะผะธ

#### RatingStats
```typescript
{stats.total_reviews > 0 && <RatingStats stats={stats} />}
```

#### ReviewList
```typescript
<ReviewList
  reviews={reviews}
  totalPages={totalPages}
  currentPage={filters.page || 1}
  onPageChange={handlePageChange}
  onSortChange={handleSortChange}
  onFilterChange={handleFilterChange}
  currentUserId={user?.id}
  sellerId={sellerId}
/>
```

#### ReviewForm
```typescript
<ReviewForm
  entityType={entityType}
  entityId={entityId}
  storefrontId={storefrontId}
  onSuccess={handleReviewSuccess}
  onCancel={() => setShowReviewForm(false)}
/>
```

## ๐ก ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

```typescript
// ะะฐะทะพะฒะพะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต ะดะปั ัะพะฒะฐัะฐ
<ReviewsSection
  entityType="listing"
  entityId={123}
  sellerId={456}
/>

// ะะปั ะฟะพะปัะทะพะฒะฐัะตะปั (ะพัะทัะฒั ะบะฐะบ ะฟัะพะดะฐะฒัะฐ)
<ReviewsSection
  entityType="user"
  entityId={789}
/>

// ะะปั ะฒะธััะธะฝั ะผะฐะณะฐะทะธะฝะฐ
<ReviewsSection
  entityType="storefront"
  entityId={101}
  storefrontId={101}
/>
```

## โ๏ธ ะะทะฒะตััะฝัะต ะพัะพะฑะตะฝะฝะพััะธ

### ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั
- Debug ะปะพะณะธัะพะฒะฐะฝะธะต ะพััะฐัััั ะฒ ะฟัะพะดะฐะบัะตะฝะต
- ะะตั ะพะฟัะธะผะธะทะฐัะธะธ ัะตัะตะฝะดะตัะพะฒ ัะตัะตะท ะผะตะผะพะธะทะฐัะธั
- ะัะตะณะดะฐ ะฟะตัะตะทะฐะณััะถะฐะตั ะดะฐะฝะฝัะต ะฟะพัะปะต ัะพะทะดะฐะฝะธั ะพัะทัะฒะฐ

### ะฃะฟัะฐะฒะปะตะฝะธะต ัะพััะพัะฝะธะตะผ
- ะัะฑะปะธัะพะฒะฐะฝะธะต ะดะฐะฝะฝัั ะผะตะถะดั hooks (reviews, stats)
- ะคะธะปัััั ัะฑัะฐััะฒะฐัััั ะฟัะธ ะธะทะผะตะฝะตะฝะธะธ ัะพััะธัะพะฒะบะธ/ัะธะปัััะฐัะธะธ
- ะะตั ัะพััะฐะฝะตะฝะธั ัะพััะพัะฝะธั ัะธะปัััะพะฒ ะฟัะธ ะฝะฐะฒะธะณะฐัะธะธ

### UX/UI ะพัะพะฑะตะฝะฝะพััะธ
- ะะพะบะฐะทัะฒะฐะตั ัะบะตะปะตัะพะฝั ะฟัะธ ะปัะฑะพะน ะทะฐะณััะทะบะต (ะดะฐะถะต ัะฐััะธัะฝะพะน)
- ะคะพัะผะฐ ะพัะทัะฒะฐ ะธะฝัะตะณัะธัะพะฒะฐะฝะฐ ะฒ ะฟะพัะพะบ (ะฝะต ะผะพะดะฐะปัะฝะพะต ะพะบะฝะพ)
- ะกัะฐัะธััะธะบะฐ ัะบััะฒะฐะตััั ะตัะปะธ ะฝะตั ะพัะทัะฒะพะฒ

### ะะตะทะพะฟะฐัะฝะพััั
- ะัะพะฒะตัะบะฐ ะฟัะฐะฒ ะฟัะพะธััะพะดะธั ะฝะฐ ััะพะฝัะตะฝะดะต (ะผะพะถะตั ะฑััั ะพะฑะพะนะดะตะฝะฐ)
- ะะพะปะฐะณะฐะตััั ะฝะฐ API ะดะปั ัะธะฝะฐะปัะฝะพะน ะฒะฐะปะธะดะฐัะธะธ ะฟัะฐะฒ
- Debug ะธะฝัะพัะผะฐัะธั ะผะพะถะตั ัะฐัะบััะฒะฐัั ะฒะฝัััะตะฝะฝะธะต ะดะฐะฝะฝัะต

### ะะพะบะฐะปะธะทะฐัะธั
- ะะพะดะดะตัะถะบะฐ ะฟะตัะตะฒะพะดะพะฒ ัะตัะตะท next-intl
- ะะตั ะพะฑัะฐะฑะพัะบะธ ะพัะธะฑะพะบ ะทะฐะณััะทะบะธ ะฟะตัะตะฒะพะดะพะฒ
- ะฅะฐัะดะบะพะดะธัะพะฒะฐะฝะฝัะต ะบะปััะธ ะฟะตัะตะฒะพะดะพะฒ

### ะะฝัะตะณัะฐัะธั
- ะขะตัะฝะพ ัะฒัะทะฐะฝ ั ะบะพะฝะบัะตัะฝัะผะธ ััะบะฐะผะธ (ะฝะธะทะบะฐั ะฟะตัะตะธัะฟะพะปัะทัะตะผะพััั)
- ะะฐะฒะธัะธั ะพั ััััะบัััั ะบะพะฝัะตะบััะฐ ะฐััะตะฝัะธัะธะบะฐัะธะธ
- ะะตั ะฒะพะทะผะพะถะฝะพััะธ ะบะฐััะพะผะธะทะฐัะธะธ UI ะบะพะผะฟะพะฝะตะฝัะพะฒ