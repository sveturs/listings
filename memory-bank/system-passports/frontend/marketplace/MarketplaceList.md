# –ü–∞—Å–ø–æ—Ä—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: MarketplaceList

## üìã –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- **–ü—É—Ç—å**: `/frontend/svetu/src/components/marketplace/MarketplaceList.tsx`
- **–†–æ–ª—å**: –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ —Å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π
- **–¢–∏–ø**: Client Component
- **–†–∞–∑–º–µ—Ä**: 132 —Å—Ç—Ä–æ–∫–∏

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- –ë–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ (infinite scroll)
- –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Å–µ—Ç–∫–æ–π –∏ —Å–ø–∏—Å–∫–æ–º
- –û–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∑–∞–≥—Ä—É–∑–∫–∏
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Props
```typescript
interface MarketplaceListProps {
  initialData: {
    data: MarketplaceItem[];    // –ù–∞—á–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
    meta: {
      total: number;            // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
      page: number;             // –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
      size: number;             // –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      has_more: boolean;        // –ï—Å—Ç—å –ª–∏ –µ—â–µ
    };
  };
  locale: string;               // –õ–æ–∫–∞–ª—å –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
}
```

## üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

### –°–µ—Ä–≤–∏—Å—ã:
- `MarketplaceService` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
- `MarketplaceItem` - —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `MarketplaceCard` - –∫–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞
- `ViewToggle` - –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–∞
- `InfiniteScrollTrigger` - —Ç—Ä–∏–≥–≥–µ—Ä –ø—Ä–æ–∫—Ä—É—Ç–∫–∏

### –•—É–∫–∏:
- `useViewPreference` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –≤–∏–¥–∞
- `useInfiniteScroll` - –ª–æ–≥–∏–∫–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
- `useTranslations` - –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

## üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
```typescript
items: MarketplaceItem[]     // –ú–∞—Å—Å–∏–≤ —Ç–æ–≤–∞—Ä–æ–≤
page: number                 // –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (0-based)
loading: boolean             // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
hasMore: boolean             // –ï—Å—Ç—å –ª–∏ –µ—â–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
error: string | null         // –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
viewMode: 'grid' | 'list'    // –†–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
```

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:
- –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `initialData`
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 0
- `hasMore` –∏–∑ meta –¥–∞–Ω–Ω—ã—Ö

## üîÑ –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞

### LoadMore —Ñ—É–Ω–∫—Ü–∏—è:
```typescript
1. –ü—Ä–æ–≤–µ—Ä–∫–∞: –Ω–µ –∏–¥–µ—Ç –ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∏ –µ—Å—Ç—å –ª–∏ –µ—â–µ –¥–∞–Ω–Ω—ã–µ
2. –ó–∞–ø—Ä–æ—Å —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (page + 1)
3. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ Set
4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è page –∏ hasMore
6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
```

### –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è:
```typescript
const existingIds = new Set(prev.map(item => item.id));
const newItems = response.data.filter(
  item => !existingIds.has(item.id)
);
```

## üé® UI —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### 1. –ö–æ–Ω—Ç—Ä–æ–ª—ã:
```tsx
<ViewToggle currentView={viewMode} onViewChange={setViewMode} />
```

### 2. –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤:
- Grid —Ä–µ–∂–∏–º: `grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4`
- List —Ä–µ–∂–∏–º: `space-y-4`

### 3. –ö–∞—Ä—Ç–æ—á–∫–∏:
```tsx
<MarketplaceCard
  key={item.id}
  item={item}
  locale={locale}
  viewMode={viewMode}
/>
```

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
- Alert –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –∏–∫–æ–Ω–∫–æ–π –æ—à–∏–±–∫–∏
- –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

### 5. –¢—Ä–∏–≥–≥–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏:
- InfiniteScrollTrigger —Å ref –∏–∑ —Ö—É–∫–∞
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. useCallback –¥–ª—è loadMore:
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
- –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `[loading, hasMore, page, t]`

### 2. –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Set:
- O(1) –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è ID
- –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö

### 3. –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥:
- –û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏
- –¢—Ä–∏–≥–≥–µ—Ä –∞–∫—Ç–∏–≤–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `hasMore`

## üåç –ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–ª—é—á–∏:
- `home.errorLoadingData` - –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
- `home.loadMore` - —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```tsx
// –ù–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
<MarketplaceList
  initialData={{
    data: listings,
    meta: {
      total: 100,
      page: 0,
      size: 20,
      has_more: true
    }
  }}
  locale="ru"
/>
```

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **0-based –ø–∞–≥–∏–Ω–∞—Ü–∏—è**:
   - –°—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å 0
   - –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è page + 1

2. **–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã**:
   - Hardcoded size: 20
   - sort_by: 'date_desc'

3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ viewMode**:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç localStorage —á–µ—Ä–µ–∑ —Ö—É–∫
   - –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏

4. **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**:
   - –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π –ø—Ä–∏ race conditions
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ ID —Ç–æ–≤–∞—Ä–∞

## üîÑ –°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `MarketplaceCard` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
- `ViewToggle` - –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–∏–¥–∞
- `InfiniteScrollTrigger` - UI —Ç—Ä–∏–≥–≥–µ—Ä–∞
- `MarketplaceFilters` - —Ñ–∏–ª—å—Ç—Ä—ã (–æ—Ç–¥–µ–ª—å–Ω–æ)