# Паспорт компонента: StorefrontMapContainer

## Метаданные
- **Путь**: `/frontend/svetu/src/components/storefronts/Map/StorefrontMapContainer.tsx`
- **Роль**: Контейнер управления картой витрин
- **Тип**: Контейнерный компонент с бизнес-логикой
- **Размер**: 267 строк

## Назначение
Оркестрирует работу карты витрин, объединяя компоненты карты, фильтров и поиска адресов. Управляет загрузкой данных, состоянием фильтров и взаимодействием между компонентами.

## Props
```typescript
interface StorefrontMapContainerProps {
  initialCenter?: { lat: number; lng: number }; // Начальный центр (по умолчанию Белград)
  initialZoom?: number;                         // Начальный зум (по умолчанию 12)
  height?: string;                              // Высота карты (по умолчанию 500px)
  showFilters?: boolean;                        // Показывать панель фильтров (по умолчанию true)
  showSearch?: boolean;                         // Показывать поиск адресов (по умолчанию true)
  clustering?: boolean;                         // Кластеризация маркеров
  mapConfig?: Partial<StorefrontMapConfig>;     // Дополнительная конфигурация (не используется)
  className?: string;                           // CSS классы
}
```

## Зависимости
### Внешние
- `next/navigation` - роутинг
- `next-intl` - локализация
- `next/dynamic` - динамическая загрузка
- `leaflet` - типы для bounds

### Внутренние
- `@/hooks/useStorefronts` - хук управления витринами
- `@/services/storefrontApi` - API сервис
- `./StorefrontMap` - компонент карты
- `./MapFilters` - компонент фильтров
- `./AddressSearch` - компонент поиска адресов

## Управление состоянием
### Локальное состояние
- `mapStorefronts` - массив витрин для отображения
- `mapCenter` - центр карты
- `mapZoom` - уровень масштабирования
- `isLoadingMap` - загрузка данных карты
- `filtersVisible` - видимость панели фильтров

### Внешние данные
- `filters`, `updateFilters`, `resetFilters` - из useStorefronts хука
- API запросы к storefrontApi

## Бизнес-логика
1. **Загрузка витрин**:
   - По границам карты (если переданы bounds)
   - По фильтрам с лимитом 1000
   - Преобразование данных в формат StorefrontMapData
   - Заглушки для некоторых полей (TODO)

2. **Управление фильтрами**:
   - Счетчик активных фильтров
   - Сворачиваемая боковая панель
   - Интеграция с хуком useStorefronts

3. **Поиск по адресу**:
   - Обновление центра карты
   - Установка зума 14 при выборе адреса
   - Автоматическое обновление фильтров (координаты, радиус, город)

4. **Взаимодействие с картой**:
   - Клик по витрине → переход на страницу
   - Изменение границ → опциональная перезагрузка (закомментировано)

5. **Преобразование данных**:
   - Из API формата в StorefrontMapData
   - Временные заглушки для полей (accepts_cards, working_now, etc.)

## UI структура
```
<div> // Контейнер
  ├── <div> // Заголовок
  │   ├── <div> // Информация
  │   │   ├── <h2> // "Карта витрин"
  │   │   └── <p> // Счетчик найденных
  │   └── {showSearch && <AddressSearch>} // Поиск адресов
  │
  ├── <div> // Кнопки управления
  │   ├── Фильтры (с счетчиком активных)
  │   └── Обновить
  │
  └── <div className="grid"> // Основной контент
      ├── {filtersVisible && <MapFilters>} // Боковая панель (3/12)
      └── <div> // Контейнер карты (9/12 или 12/12)
          ├── {isLoadingMap && <LoadingOverlay>}
          └── <StorefrontMap> // Динамически загружаемая карта
```

## Примеры использования
```typescript
// Базовое использование
<StorefrontMapContainer />

// С кастомными настройками
<StorefrontMapContainer
  initialCenter={{ lat: 45.2671, lng: 19.8335 }} // Нови Сад
  initialZoom={13}
  height="600px"
  showFilters={true}
  clustering={true}
/>

// Только карта без фильтров
<StorefrontMapContainer
  showFilters={false}
  showSearch={false}
  height="400px"
/>
```

## Известные особенности
### Позитивные
- Адаптивная сетка для фильтров и карты
- Динамическая загрузка карты (SSR совместимость)
- Интеграция всех компонентов карты
- Счетчики найденных витрин и активных фильтров

### Технический долг
- Заглушки для полей витрин (accepts_cards, working_now)
- Жестко закодированные тексты без локализации
- Неиспользуемый параметр mapConfig
- console.error без уведомления пользователя
- Закомментирована динамическая загрузка по границам

### Возможные улучшения
- Реализовать реальные данные вместо заглушек
- Добавить локализацию всех текстов
- Реализовать динамическую загрузку при перемещении карты
- Добавить экспорт/сохранение текущего вида
- Показывать статистику по районам
- Добавить режим полноэкранной карты