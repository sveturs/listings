# Паспорт компонента: StorefrontProducts

## Метаданные
- **Путь**: `/frontend/svetu/src/components/storefronts/public/StorefrontProducts.tsx`
- **Роль**: Витрина товаров магазина с infinite scroll
- **Тип**: Контейнерный компонент с асинхронной загрузкой
- **Размер**: 256 строк

## Назначение
Отображает список товаров конкретного магазина с поддержкой переключения видов (сетка/список), бесконечной прокруткой и адаптивным дизайном. Компонент является ключевой частью публичной страницы витрины.

## Props
```typescript
interface StorefrontProductsProps {
  storefrontId: number; // ID магазина для загрузки товаров
}
```

## Зависимости
### Внешние
- `react` - хуки состояния и эффектов
- `next-intl` - локализация
- `next/link` - навигация

### Внутренние
- `@/components/SafeImage` - безопасная загрузка изображений
- `@/services/marketplaceApi` - API маркетплейса
- `@/components/common/ViewToggle` - переключатель видов
- `@/hooks/useViewPreference` - сохранение предпочтений вида
- `@/hooks/useInfiniteScroll` - infinite scroll
- `@/components/common/InfiniteScrollTrigger` - триггер загрузки

## Управление состоянием
### Локальное состояние
- `products` - массив товаров
- `isLoading` - статус загрузки
- `currentPage` - текущая страница пагинации
- `totalPages` - общее количество страниц
- `viewMode` - режим отображения (grid/list)
- `hasMore` - есть ли еще товары для загрузки

### Внешние данные
- API запросы к `marketplaceApi.getListings()`
- Сохранение предпочтений вида в localStorage

## Бизнес-логика
1. **Загрузка товаров**:
   - Пагинация по 12 товаров
   - Фильтрация по storefront_id
   - Добавление к существующим при прокрутке

2. **Обработка ответа API**:
   - Безопасное извлечение вложенных данных
   - Поддержка разных форматов ответа
   - Расчет общего количества страниц

3. **Infinite Scroll**:
   - Автоматическая загрузка при прокрутке
   - Кнопка "Загрузить еще" как fallback
   - Предотвращение дублирующих запросов

4. **Режимы отображения**:
   - Grid: карточки 3 в ряд на десктопе
   - List: вертикальный список с миниатюрами

5. **Отображение цен**:
   - Основная цена в долларах
   - Старая цена зачеркнута
   - Процент скидки в badge

## UI структура
```
<div className="card"> // Контейнер
  └── <div className="card-body">
      ├── <div> // Заголовок с контролами
      │   ├── <h2> // "Товары"
      │   └── <div> // Контролы
      │       ├── <ViewToggle> // Сетка/Список
      │       └── <Link> // "Смотреть все"
      │
      ├── <div> // Сетка или список товаров
      │   └── {products.map()} // Карточки товаров
      │       ├── Grid режим:
      │       │   ├── Изображение 4:3
      │       │   ├── Badge скидки
      │       │   ├── Название
      │       │   ├── Цена
      │       │   └── Локация
      │       └── List режим:
      │           ├── Миниатюра 96x96
      │           ├── Badge скидки
      │           ├── Название
      │           ├── Цена
      │           └── Локация
      │
      └── <InfiniteScrollTrigger> // Загрузка еще
```

## Примеры использования
```typescript
// На странице витрины
<StorefrontProducts storefrontId={storefront.id} />

// В секции товаров
<section>
  <StorefrontProducts storefrontId={123} />
</section>
```

## Известные особенности
### Позитивные
- Адаптивный дизайн для всех размеров экранов
- Сохранение предпочтений вида пользователя
- Плавная загрузка с skeleton loader
- Обработка различных форматов API ответов
- Fallback изображения при ошибке загрузки

### Технический долг
- Жестко закодированная валюта ($)
- Сложная логика извлечения данных из API ответа
- Префикс `_` для неиспользуемой переменной totalPages
- console.error без уведомления пользователя

### Возможные улучшения
- Добавить фильтрацию и сортировку
- Показывать индикатор новых товаров
- Добавить быстрый просмотр товара
- Реализовать виртуальный скроллинг для больших списков
- Добавить кеширование загруженных товаров
- Показывать количество товаров в заголовке