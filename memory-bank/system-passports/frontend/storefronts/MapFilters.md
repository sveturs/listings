# Паспорт компонента: MapFilters

## Метаданные
- **Путь**: `/frontend/svetu/src/components/storefronts/Map/MapFilters.tsx`
- **Роль**: Панель фильтров для карты витрин
- **Тип**: Контролируемый компонент формы
- **Размер**: 350 строк

## Назначение
Предоставляет расширенную систему фильтрации витрин на карте. Включает текстовый поиск, фильтры по статусу, способам оплаты, доставке, рейтингу и другим параметрам. Поддерживает сворачивание/разворачивание панели.

## Props
```typescript
interface MapFiltersProps {
  filters: StorefrontFilters;                          // Текущие значения фильтров
  onFiltersChange: (filters: Partial<StorefrontFilters>) => void; // Обработчик изменения
  onResetFilters: () => void;                         // Сброс всех фильтров
  isLoading?: boolean;                                // Состояние загрузки
  className?: string;                                 // CSS классы
}
```

## Зависимости
### Внешние
- `react` - хуки состояния и callback
- `next-intl` - локализация (закомментирована)

### Внутренние
- `@/types/storefront` - типы фильтров и способов оплаты

## Управление состоянием
### Локальное состояние
- `isExpanded` - состояние развернутости панели

### Внешние данные
- `filters` - все значения контролируются родителем
- Изменения передаются через `onFiltersChange`

## Бизнес-логика
1. **Подсчет активных фильтров**:
   - Игнорирует пустые значения (null, undefined, '')
   - Для массивов проверяет длину
   - Отображает счетчик в заголовке

2. **Типы фильтров**:
   - **Текстовые**: поиск по названию, город
   - **Выбор из списка**: минимальный рейтинг, сортировка
   - **Чекбоксы**: статусы, способы оплаты, доставка
   - **Слайдер**: радиус поиска (если есть координаты)

3. **Способы оплаты**:
   - cash - Наличные
   - card - Карта
   - bank_transfer - Перевод
   - cod - При доставке
   - postanska - Pošta (местная служба)

4. **Сортировка**:
   - По рейтингу, расстоянию, дате, количеству товаров
   - Направление: по возрастанию/убыванию

## UI структура
```
<div className="bg-white rounded-lg shadow-lg"> // Контейнер
  ├── <div> // Заголовок
  │   ├── <div> // "Фильтры" + счетчик активных
  │   └── <div> // Кнопки
  │       ├── "Сбросить" (если есть активные)
  │       └── Стрелка развертывания
  │
  └── {isExpanded && <div>} // Содержимое фильтров
      ├── Поиск по названию
      ├── Город
      ├── Минимальный рейтинг (select)
      ├── Статусы (чекбоксы)
      │   ├── Активные
      │   ├── Проверенные
      │   └── Открыто сейчас
      ├── Способы оплаты (чекбоксы)
      │   ├── Наличные
      │   ├── Карта
      │   ├── Перевод
      │   ├── При доставке
      │   └── Pošta
      ├── Доставка (чекбоксы)
      │   ├── Есть доставка
      │   └── Самовывоз
      ├── Радиус поиска (слайдер, если есть координаты)
      └── Сортировка (2 select)
          ├── Поле сортировки
          └── Направление
```

## Примеры использования
```typescript
// В компоненте карты
const [filters, setFilters] = useState<StorefrontFilters>({});

<MapFilters
  filters={filters}
  onFiltersChange={(changes) => setFilters({...filters, ...changes})}
  onResetFilters={() => setFilters({})}
  isLoading={isLoadingStorefronts}
/>
```

## Известные особенности
### Позитивные
- Сворачиваемая панель экономит место
- Счетчик активных фильтров
- Блокировка при загрузке
- Динамическое отображение радиуса (только с координатами)
- Мультивыбор способов оплаты

### Технический долг
- Жестко закодированные тексты без локализации
- Закомментирован useTranslations
- Нет валидации диапазонов (например, радиус)
- Нет дебаунса для текстовых полей

### Возможные улучшения
- Реализовать полную локализацию
- Добавить дебаунс для поиска
- Сохранять состояние фильтров в URL
- Добавить пресеты фильтров (например, "Рестораны рядом")
- Визуально группировать связанные фильтры
- Добавить индикацию количества результатов