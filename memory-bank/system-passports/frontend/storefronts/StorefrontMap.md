# Паспорт компонента: StorefrontMap

## Метаданные
- **Путь**: `/frontend/svetu/src/components/storefronts/Map/StorefrontMap.tsx`
- **Роль**: Интерактивная карта с витринами магазинов
- **Тип**: Динамически загружаемый компонент с Leaflet
- **Размер**: 285 строк

## Назначение
Отображает интерактивную карту с маркерами витрин магазинов. Поддерживает автоматическое позиционирование, кастомные маркеры, всплывающие окна с информацией и отслеживание изменений области просмотра.

## Props
```typescript
interface StorefrontMapProps {
  storefronts: StorefrontMapData[];                    // Массив витрин для отображения
  center?: { lat: number; lng: number };              // Центр карты (по умолчанию Белград)
  zoom?: number;                                       // Уровень масштабирования (по умолчанию 12)
  height?: string;                                     // Высота карты (по умолчанию 400px)
  onStorefrontClick?: (storefront: StorefrontMapData) => void; // Обработчик клика по витрине
  onBoundsChange?: (bounds: L.LatLngBounds) => void; // Обработчик изменения границ
  className?: string;                                  // CSS классы
  showSearch?: boolean;                                // Показывать поиск (TODO)
  clustering?: boolean;                                // Кластеризация маркеров (не используется)
}
```

## Зависимости
### Внешние
- `react-leaflet` - React обертка для Leaflet
- `leaflet` - библиотека карт
- `next/image` - оптимизированные изображения
- `next/dynamic` - динамическая загрузка для SSR

### Внутренние
- `@/types/storefront` - типы данных витрин

## Управление состоянием
### Локальное состояние
- `isClient` - флаг клиентского рендеринга

### Внешние данные
- `storefronts` - данные витрин из props
- События карты передаются через callbacks

## Бизнес-логика
1. **Инициализация карты**:
   - Кастомные иконки маркеров витрин
   - Центр по умолчанию - Белград (44.7866, 20.4489)
   - OpenStreetMap тайлы

2. **Автопозиционирование**:
   - Если нет center, карта автоматически подстраивается под все маркеры
   - Использует FeatureGroup для расчета границ
   - Добавляет padding для лучшего отображения

3. **Маркеры витрин**:
   - Фильтрация витрин с валидными координатами
   - Кастомная иконка storefront-marker.png
   - Всплывающее окно с информацией

4. **Информация в popup**:
   - Название и логотип
   - Адрес и телефон
   - Рейтинг
   - Индикаторы: карты, открыто, доставка
   - Кнопка открытия витрины

5. **События карты**:
   - moveend, zoomend - отслеживание изменения области
   - click на маркере - открытие витрины

## UI структура
```
<div> // Контейнер с высотой
  ├── <MapContainer> // Leaflet карта
  │   ├── <TileLayer> // OSM тайлы
  │   ├── <MapEventHandler> // Обработчик событий
  │   ├── <MapController> // Автопозиционирование
  │   └── {storefronts.map()} // Маркеры
  │       └── <Marker>
  │           └── <Popup> // Информация о витрине
  │               ├── Название
  │               ├── Логотип
  │               ├── Адрес
  │               ├── Телефон
  │               ├── Badges (рейтинг, карты, открыто, доставка)
  │               └── Кнопка открытия
  │
  ├── {showSearch && <SearchBox>} // Поиск (TODO)
  └── <Counter> // Счетчик найденных витрин
```

## Примеры использования
```typescript
// Базовое использование
<StorefrontMap storefronts={storefrontsList} />

// С обработчиками событий
<StorefrontMap 
  storefronts={storefronts}
  center={{ lat: 44.8, lng: 20.5 }}
  zoom={14}
  height="600px"
  onStorefrontClick={handleStorefrontSelect}
  onBoundsChange={handleMapBoundsChange}
  showSearch={true}
/>
```

## Известные особенности
### Позитивные
- Динамическая загрузка для совместимости с SSR
- Автоматическое позиционирование по маркерам
- Кастомные иконки маркеров
- Информативные popup окна
- Счетчик найденных витрин

### Технический долг
- Функция поиска не реализована (только UI)
- Параметр clustering не используется
- Жестко закодированные тексты без локализации
- Нет обработки ошибок загрузки карты

### Возможные улучшения
- Реализовать поиск витрин на карте
- Добавить кластеризацию для большого количества маркеров
- Локализовать все тексты
- Добавить фильтры (открыто сейчас, с доставкой)
- Показывать текущее местоположение пользователя
- Добавить маршруты до витрин