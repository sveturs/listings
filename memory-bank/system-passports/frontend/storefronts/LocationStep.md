# Паспорт компонента: LocationStep

## Метаданные
- **Путь**: `/frontend/svetu/src/components/storefronts/create/steps/LocationStep.tsx`
- **Роль**: Ввод адреса и выбор локации на карте
- **Тип**: Компонент формы с интерактивной картой
- **Размер**: 241 строка

## Назначение
Третий шаг мастера создания витрины. Собирает адресную информацию и позволяет точно указать местоположение магазина на карте с автоматическим геокодированием.

## Props
```typescript
interface LocationStepProps {
  onNext: () => void;  // Переход к следующему шагу
  onBack: () => void;  // Возврат к предыдущему шагу
}
```

## Зависимости
### Внешние
- `react` - хуки состояния и эффектов
- `next-intl` - локализация
- `next/dynamic` - динамическая загрузка карты
- `leaflet` - типы координат
- OpenStreetMap Nominatim API - геокодирование

### Внутренние
- `@/contexts/CreateStorefrontContext` - контекст формы
- `@/components/storefronts/create/LocationMap` - компонент карты

## Управление состоянием
### Локальное состояние
- `errors` - ошибки валидации полей
- `searchingLocation` - статус поиска координат

### Контекст
- `formData` - адрес, город, индекс, страна, координаты
- `updateFormData` - обновление данных

## Бизнес-логика
1. **Обязательные поля**:
   - `address` - минимум 5 символов
   - `city` - минимум 2 символа
   - `postalCode` - минимум 4 символа
   - `country` - выбор из списка балканских стран

2. **Геокодирование**:
   - Автоматический поиск при вводе адреса и города
   - Ручной поиск кнопкой "Найти на карте"
   - Использование Nominatim API
   - Координаты по умолчанию: Белград (44.8125, 20.4612)

3. **Поддерживаемые страны**:
   - RS - Сербия
   - BA - Босния и Герцеговина
   - HR - Хорватия
   - ME - Черногория
   - MK - Северная Македония

4. **Взаимодействие с картой**:
   - Отображение найденной позиции
   - Возможность ручной корректировки маркера

## UI структура
```
<div className="card"> // Карточка формы
  └── <div className="card-body">
      ├── <h2> // "Местоположение"
      ├── <p> // Подзаголовок
      ├── <div className="grid"> // 2 колонки
      │   ├── <div> // Левая колонка - форма
      │   │   ├── Адрес* (с ошибкой)
      │   │   ├── Город* (с ошибкой)
      │   │   ├── Почтовый индекс* (с ошибкой)
      │   │   ├── Страна (select)
      │   │   └── Кнопка "Найти на карте"
      │   │
      │   └── <div> // Правая колонка
      │       └── <LocationMap> // Интерактивная карта
      │
      └── <div className="card-actions"> // Кнопки
          ├── Назад (ghost)
          └── Далее (primary)
```

## Примеры использования
```typescript
// В мастере создания витрины
<LocationStep
  onNext={() => setCurrentStep(4)}
  onBack={() => setCurrentStep(2)}
/>

// Данные в контексте после заполнения
{
  address: "Кнез Михаилова 15",
  city: "Београд",
  postalCode: "11000",
  country: "RS",
  latitude: 44.8176,
  longitude: 20.4565
}
```

## Известные особенности
### Позитивные
- Автоматическое геокодирование при вводе
- Визуальное подтверждение локации на карте
- Поддержка балканского региона
- Динамическая загрузка карты (SSR совместимость)

### Технический долг
- console.error без уведомления пользователя
- Нет обработки случая когда адрес не найден
- eslint-disable для useEffect зависимостей

### Возможные улучшения
- Показывать сообщение если адрес не найден
- Автодополнение адресов при вводе
- Возможность поиска по названию места
- Сохранение истории адресов
- Валидация почтового индекса по формату страны
- Определение текущего местоположения пользователя