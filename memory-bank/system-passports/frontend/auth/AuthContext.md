# –ü–∞—Å–ø–æ—Ä—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: AuthContext

## üìã –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- **–ü—É—Ç—å**: `/frontend/svetu/src/contexts/AuthContext.tsx`
- **–†–æ–ª—å**: –ì–ª–æ–±–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–¢–∏–ø**: Client Component (Context Provider)
- **–†–∞–∑–º–µ—Ä**: 497 —Å—Ç—Ä–æ–∫

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —É–ø—Ä–∞–≤–ª—è—é—â–∏–π:
- –°–æ—Å—Ç–æ—è–Ω–∏–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –≤ sessionStorage
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Å–µ—Å—Å–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–æ–≤ –∏ –ø—Ä–æ—Ñ–∏–ª—è
- –ü—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### AuthContextType:
```typescript
interface AuthContextType {
  user: User | null;                    // –î–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  isAuthenticated: boolean;             // –§–ª–∞–≥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  isLoading: boolean;                   // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ—Å—Å–∏–∏
  isLoggingOut: boolean;                // –ü—Ä–æ—Ü–µ—Å—Å –≤—ã—Ö–æ–¥–∞
  isUpdatingProfile: boolean;           // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
  isRefreshingSession: boolean;         // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏
  error: string | null;                 // –¢–µ–∫—Å—Ç –æ—à–∏–±–∫–∏
  login: (returnTo?: string) => void;   // –í—Ö–æ–¥ —á–µ—Ä–µ–∑ Google
  logout: () => Promise<void>;          // –í—ã—Ö–æ–¥
  refreshSession: () => Promise<void>;  // –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é
  updateProfile: (data: UpdateProfileRequest) => Promise<boolean>;
  updateUser: (userData: User | null) => void;
  clearError: () => void;
}
```

## üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–≤—è–∑–∏

### –°–µ—Ä–≤–∏—Å—ã:
- `@/services/auth` - AuthService –¥–ª—è API –≤—ã–∑–æ–≤–æ–≤
- `@/utils/tokenManager` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ JWT —Ç–æ–∫–µ–Ω–∞–º–∏
- `@/i18n/routing` - –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Å –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–µ–π

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- `AuthErrorBoundary` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç —á–µ—Ä–µ–∑ `useAuth()` hook

## üíæ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### SessionStorage –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ:
1. **–ö–µ—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: `svetu_user` - JSON —Å –¥–∞–Ω–Ω—ã–º–∏ User
2. **–§–ª–∞–≥ –≤—ã—Ö–æ–¥–∞**: `svetu_logout_flag` - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∞–≤—Ç–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞**: fallback –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ storage

### StorageUtils:
```typescript
{
  isAvailable: boolean;
  getItem: (key: string) => string | null;
  setItem: (key: string, value: string) => boolean;
  removeItem: (key: string) => boolean;
}
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ logout —Ñ–ª–∞–≥–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏

### 2. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏:
```typescript
refreshSession(retries = 3, skipLoadingState = false)
```
- JWT –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `restoreSession()`
- Fallback –Ω–∞ –æ–±—ã—á–Ω—É—é —Å–µ—Å—Å–∏—é
- Exponential backoff –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- Cooldown 5 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏

### 3. –ü—Ä–æ—Ü–µ—Å—Å –≤—Ö–æ–¥–∞:
- –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ Google OAuth
- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π `returnTo` –ø–∞—Ä–∞–º–µ—Ç—Ä

### 4. –ü—Ä–æ—Ü–µ—Å—Å –≤—ã—Ö–æ–¥–∞:
- –í—ã–∑–æ–≤ API logout
- –û—á–∏—Å—Ç–∫–∞ storage (—Å–æ—Ö—Ä–∞–Ω—è—è locale)
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ logout —Ñ–ª–∞–≥–∞
- –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –≥–ª–∞–≤–Ω—É—é

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:
```typescript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
if (parsedUser && 
    typeof parsedUser === 'object' && 
    parsedUser.id && 
    parsedUser.email)
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
- Try-catch –¥–ª—è –≤—Å–µ—Ö storage –æ–ø–µ—Ä–∞—Ü–∏–π
- –û—á–∏—Å—Ç–∫–∞ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–Ω–æ–≥–æ –∫–µ—à–∞
- Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

### Token management:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–µ—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ
- –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ sessionStorage:
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ refresh
- –ò–∑–±–µ–≥–∞–Ω–∏–µ –ª–∏—à–Ω–∏—Ö API –≤—ã–∑–æ–≤–æ–≤

### 2. Cooldown –º–µ—Ö–∞–Ω–∏–∑–º:
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ spam –≤—ã–∑–æ–≤–æ–≤
- 5-—Å–µ–∫—É–Ω–¥–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª

### 3. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏:
- –§–æ–Ω–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- skipLoadingState –¥–ª—è background –æ–ø–µ—Ä–∞—Ü–∏–π

### 4. Memoization:
- useMemo –¥–ª—è value –æ–±—ä–µ–∫—Ç–∞
- useCallback –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ:
```tsx
function MyComponent() {
  const { user, isAuthenticated, login, logout } = useAuth();
  
  if (!isAuthenticated) {
    return <button onClick={() => login()}>Login</button>;
  }
  
  return <div>Welcome, {user.name}</div>;
}
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è:
```tsx
const { updateProfile, isUpdatingProfile } = useAuth();

const handleUpdate = async (data) => {
  const success = await updateProfile(data);
  if (success) {
    toast.success('Profile updated');
  }
};
```

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **QuotaExceededError handling**: –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ storage –ø—Ä–∏ –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–∏
2. **Development logs**: –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ dev —Ä–µ–∂–∏–º–µ
3. **Logout flag**: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∞–≤—Ç–æ–≤—Ö–æ–¥ –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞
4. **Token expiry check**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

## üîÑ –°–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- `AuthButton` - –æ—Å–Ω–æ–≤–Ω–æ–π UI –¥–ª—è auth
- `LoginModal` - –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—Ö–æ–¥–∞
- `AdminGuard` - –∑–∞—â–∏—Ç–∞ –∞–¥–º–∏–Ω-—Ä–æ—É—Ç–æ–≤
- `AuthStateManager` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º auth