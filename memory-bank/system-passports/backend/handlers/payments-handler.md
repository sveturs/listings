# –ü–∞—Å–ø–æ—Ä—Ç: Payments Handler Module

**–§–∞–π–ª**: `/backend/internal/proj/payments/handler/`  
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: HTTP handlers –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞**: 2025-06-29

## üìã –û–±–∑–æ—Ä –º–æ–¥—É–ª—è

Payments Handler Module –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤—Å–µ—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏ –≤ —Å–∏—Å—Ç–µ–º–µ. –ú–æ–¥—É–ª—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏: AllSecure –∏ Stripe, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhooks –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å—Ç–∞—Ç—É—Å–µ –ø–ª–∞—Ç–µ–∂–µ–π.

## üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
backend/internal/proj/payments/handler/
‚îú‚îÄ‚îÄ handler.go           # –û—Å–Ω–æ–≤–Ω–æ–π handler —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–µ–π
‚îú‚îÄ‚îÄ payment_handler.go   # PaymentHandler - AllSecure –ø–ª–∞—Ç–µ–∂–∏
‚îú‚îÄ‚îÄ webhook_handler.go   # WebhookHandler - AllSecure webhooks
‚îú‚îÄ‚îÄ routes.go           # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îî‚îÄ‚îÄ responses.go        # –°—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤ API
```

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. Handler (handler.go)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É—é—â–∞—è –≤—Å–µ payment handlers

```go
type Handler struct {
    payment   paymentService.PaymentServiceInterface  // –û–±—â–∏–π –ø–ª–∞—Ç–µ–∂–Ω—ã–π —Å–µ—Ä–≤–∏—Å
    allsecure *PaymentHandler                        // AllSecure handler
    webhook   *WebhookHandler                        // Webhook handler
}
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –õ–µ–Ω–∏–≤–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AllSecure handlers —á–µ—Ä–µ–∑ `InitAllSecure()`
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhooks

### 2. PaymentHandler (payment_handler.go)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —á–µ—Ä–µ–∑ AllSecure

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã**:
- `CreatePayment()` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- `CapturePayment()` - –∑–∞—Ö–≤–∞—Ç –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
- `RefundPayment()` - –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤
- `GetPaymentStatus()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–ª–∞—Ç–µ–∂–∞

**–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏**:
- –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π —Å —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–º –Ω–∞ –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
- –î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏ (–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è + –∑–∞—Ö–≤–∞—Ç)
- –ß–∞—Å—Ç–∏—á–Ω—ã–µ –∏ –ø–æ–ª–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—Ç—ã
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### 3. WebhookHandler (webhook_handler.go)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ—Ç AllSecure

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã**:
- `HandleAllSecureWebhook()` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ webhook –æ—Ç AllSecure
- `verifySignature()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook
- `calculateSignature()` - –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ–∂–∏–¥–∞–µ–º–æ–π –ø–æ–¥–ø–∏—Å–∏

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
- HMAC-SHA256 –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö webhook —Å–æ–±—ã—Ç–∏–π
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π

## üåê API Endpoints

### Stripe –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
```
POST   /api/v1/payments/stripe/webhook      # Stripe webhook handler
```

### AllSecure –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π)
```
POST   /api/v1/payments/create              # –°–æ–∑–¥–∞—Ç—å –ø–ª–∞—Ç–µ–∂
POST   /api/v1/payments/:id/capture         # –ó–∞—Ö–≤–∞—Ç–∏—Ç—å –ø–ª–∞—Ç–µ–∂
POST   /api/v1/payments/:id/refund          # –í–µ—Ä–Ω—É—Ç—å —Å—Ä–µ–¥—Å—Ç–≤–∞
GET    /api/v1/payments/:id/status          # –°—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
```

### Webhooks (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)
```
POST   /api/v1/webhooks/allsecure           # AllSecure webhook
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### Middleware:
- **AuthRequiredJWT**: –ø—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞ –¥–ª—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **Webhook Signature Verification**: –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ HMAC-SHA256

### –í–∞–ª–∏–¥–∞—Ü–∏—è:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º –∏ –≤–∞–ª—é—Ç
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ URL –≤–æ–∑–≤—Ä–∞—Ç–∞
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –í—Å–µ –ø–ª–∞—Ç–µ–∂–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- Webhook —Å–æ–±—ã—Ç–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Å–µ–Ω—Å–∏—Ç–∏–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## üìä –°–≤—è–∑–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- `payment_transactions` - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π
- `payment_methods` - –º–µ—Ç–æ–¥—ã –æ–ø–ª–∞—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `payment_gateways` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —à–ª—é–∑–æ–≤
- `escrow_payments` - —ç—Å–∫—Ä–æ—É –ø–ª–∞—Ç–µ–∂–∏
- `merchant_payouts` - –≤—ã–ø–ª–∞—Ç—ã –ø—Ä–æ–¥–∞–≤—Ü–∞–º
- `balance_transactions` - –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–ª–∞–Ω—Å–æ–º

## üîÑ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–∞:
1. –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ç–æ–≤–∞—Ä–∞/—É—Å–ª—É–≥–∏
3. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ë–î
4. –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–∞ –≤ AllSecure
5. –í–æ–∑–≤—Ä–∞—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞

### –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∑–∞–ø—Ä–æ—Å–∞
2. –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –æ —Å—Ç–∞—Ç—É—Å–µ
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –ë–î
4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
5. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤:
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç
2. –í–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã –≤–æ–∑–≤—Ä–∞—Ç–∞
3. –ò–Ω–∏—Ü–∏–∞—Ü–∏—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
5. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üí≥ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

### AllSecure
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Å–Ω–æ–≤–Ω–∞—è –ø–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- **–§—É–Ω–∫—Ü–∏–∏**: —Å–æ–∑–¥–∞–Ω–∏–µ, –∑–∞—Ö–≤–∞—Ç, –≤–æ–∑–≤—Ä–∞—Ç –ø–ª–∞—Ç–µ–∂–µ–π
- **Webhook**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ
- **–í–∞–ª—é—Ç—ã**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–∞–ª—é—Ç

### Stripe
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–ª–∞—Ç–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- **–§—É–Ω–∫—Ü–∏–∏**: webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞ (legacy)
- **–°—Ç–∞—Ç—É—Å**: –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

## üìù Request/Response —Ç–∏–ø—ã

### CreatePaymentRequest
```go
type CreatePaymentRequest struct {
    ListingID   int    `json:"listing_id" validate:"required"`
    Amount      string `json:"amount" validate:"required"`
    Currency    string `json:"currency" validate:"required,len=3"`
    Description string `json:"description"`
    ReturnURL   string `json:"return_url" validate:"required,url"`
}
```

### CreatePaymentResponse
```go
type CreatePaymentResponse struct {
    TransactionID  int64  `json:"transaction_id"`
    GatewayUUID    string `json:"gateway_uuid"`
    Status         string `json:"status"`
    RedirectURL    string `json:"redirect_url,omitempty"`
    RequiresAction bool   `json:"requires_action"`
}
```

### RefundPaymentRequest
```go
type RefundPaymentRequest struct {
    Amount string `json:"amount" validate:"required"`
    Reason string `json:"reason"`
}
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**:
- AllSecure API credentials
- Webhook secret –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏
- Stripe API keys (legacy)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞–ª—é—Ç –∏ –ª–∏–º–∏—Ç–æ–≤

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**:
- HMAC secret –¥–ª—è webhook –ø–æ–¥–ø–∏—Å–µ–π
- SSL/TLS –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- Rate limiting –¥–ª—è API endpoints

## üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ:
- `internal/proj/global/service` - –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- `internal/proj/payments/service` - –±–∏–∑–Ω–µ—Å –ª–æ–≥–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- `internal/middleware` - middleware –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `pkg/logger` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- `pkg/utils` - –æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã

### –í–Ω–µ—à–Ω–∏–µ:
- `github.com/gofiber/fiber/v2` - HTTP framework
- `github.com/shopspring/decimal` - —Ç–æ—á–Ω–∞—è –∞—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ —Å –¥–µ–Ω—å–≥–∞–º–∏
- `crypto/hmac` - HMAC –ø–æ–¥–ø–∏—Å–∏
- `crypto/sha256` - —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

## üö® –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –î–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–µ –ø–ª–∞—Ç–µ–∂–∏:
- Authorize ‚Üí Capture –ø–∞—Ç—Ç–µ—Ä–Ω
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–º–µ–Ω—ã –¥–æ –∑–∞—Ö–≤–∞—Ç–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞—Ö–≤–∞—Ç –ø–æ —Ç–∞–π–º–∞—É—Ç—É

### –≠—Å–∫—Ä–æ—É —Å–∏—Å—Ç–µ–º–∞:
- –£–¥–µ—Ä–∂–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è
- –ó–∞—â–∏—Ç–∞ –∫–∞–∫ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è, —Ç–∞–∫ –∏ –ø—Ä–æ–¥–∞–≤—Ü–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤

### –ú—É–ª—å—Ç–∏-–≤–∞–ª—é—Ç–Ω–æ—Å—Ç—å:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤–∞–ª—é—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:
- Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
- Retry –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è webhook –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏**:
- –°–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–µ–π
- –í–æ–∑–≤—Ä–∞—Ç—ã –∏ —á–∞—Å—Ç–∏—á–Ω—ã–µ –≤–æ–∑–≤—Ä–∞—Ç—ã
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
- Security testing –¥–ª—è webhook endpoints

## üìã TODO –∏ —É–ª—É—á—à–µ–Ω–∏—è

1. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å GetPaymentStatus** - –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç mock –¥–∞–Ω–Ω—ã–µ
2. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ä–µ–∫—É—Ä—Ä–µ–Ω—Ç–Ω—ã—Ö –ø–ª–∞—Ç–µ–∂–µ–π**
3. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** –æ —Å—Ç–∞—Ç—É—Å–µ –ø–ª–∞—Ç–µ–∂–µ–π
4. **–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
5. **–£–ª—É—á—à–∏—Ç—å retry –ª–æ–≥–∏–∫—É** –¥–ª—è webhook –æ–±—Ä–∞–±–æ—Ç–∫–∏
6. **–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É Apple Pay/Google Pay**
7. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å fraud detection**
8. **–î–æ–±–∞–≤–∏—Ç—å KYC/AML –ø—Ä–æ–≤–µ—Ä–∫–∏** –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π