# üìã –ü–∞—Å–ø–æ—Ä—Ç Nginx Configuration

## üè∑Ô∏è –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—Ä–∞—Ç–Ω—ã–π –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –∏ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è Sve Tu Platform
- **–¢–∏–ø –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:** –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ / Web Server & Reverse Proxy
- **–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω—ã–π, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ production
- **–í–µ—Ä—Å–∏—è:** Nginx 1.21+
- **–§–∞–π–ª—ã:** `nginx.conf`, `nginx/Dockerfile`

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
Nginx –≤—ã—Å—Ç—É–ø–∞–µ—Ç –≤ —Ä–æ–ª–∏ –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –¥–ª—è –≤—Å–µ—Ö –≤–µ–±-—Å–µ—Ä–≤–∏—Å–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è SSL —Ç–µ—Ä–º–∏–Ω–∞—Ü–∏—é, –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏ –∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏.

## üåê –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–æ–º–µ–Ω–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤

### –û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–º–µ–Ω—ã
1. **svetu.rs / www.svetu.rs** - –≥–ª–∞–≤–Ω—ã–π –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å
2. **mail.svetu.rs** - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ—á—Ç—ã
3. **autodiscover.svetu.rs** - –∞–≤—Ç–æ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Exchange
4. **autoconfig.svetu.rs** - –∞–≤—Ç–æ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Thunderbird
5. **gis.svetu.rs** - GIS –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞
6. **klimagrad.svetu.rs** - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∞–π—Ç

### Upstream —Å–µ—Ä–≤–µ—Ä—ã
```nginx
upstream api_backend {\n    server backend:3000;\n    keepalive 32;\n}\n\nupstream minio_backend {\n    server minio:9000;\n}\n```\n\n## üîê SSL/TLS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è\n\n### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏\n```nginx\nssl_session_cache shared:SSL:10m;\nssl_session_timeout 10m;\nssl_protocols TLSv1.2 TLSv1.3;\nssl_prefer_server_ciphers off;\nssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384;\n```\n\n### –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã Let's Encrypt\n```nginx\n# –î–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞\nssl_certificate /etc/letsencrypt/live/svetu.rs/fullchain.pem;\nssl_certificate_key /etc/letsencrypt/live/svetu.rs/privkey.pem;\n\n# –î–ª—è –ø–æ—á—Ç–æ–≤–æ–≥–æ –¥–æ–º–µ–Ω–∞\nssl_certificate /etc/letsencrypt/live/mail.svetu.rs/fullchain.pem;\nssl_certificate_key /etc/letsencrypt/live/mail.svetu.rs/privkey.pem;\n```\n\n### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤\n```bash\n# init-letsencrypt.sh - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è\n# renew-certs.sh - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ\n# Cron –∑–∞–¥–∞—á–∞ –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n```\n\n## üéØ –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞ (svetu.rs)\n\n### 1. HTTP ‚Üí HTTPS —Ä–µ–¥–∏—Ä–µ–∫—Ç\n```nginx\nserver {\n    listen 80;\n    server_name svetu.rs www.svetu.rs;\n    \n    location /.well-known/acme-challenge/ {\n        root /var/www/certbot;  # –î–ª—è Let's Encrypt\n    }\n    \n    location / {\n        return 301 https://$host$request_uri;\n    }\n}\n```\n\n### 2. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã\n```nginx\n# Favicon —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º\nlocation = /favicon.ico {\n    access_log off;\n    log_not_found off;\n    expires max;\n}\n\n# –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã\nlocation /uploads/ {\n    alias /usr/share/nginx/uploads/;\n    expires 30d;\n}\n```\n\n### 3. MinIO –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ\n```nginx\n# –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π\nlocation ~ ^/listings/(.+)$ {\n    proxy_pass http://minio:9000/listings/$1;\n    proxy_http_version 1.1;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_buffering off;\n    expires 7d;\n}\n\n# –§–∞–π–ª—ã —á–∞—Ç–æ–≤\nlocation ~ ^/chat-files/(.+)$ {\n    proxy_pass http://minio:9000/chat-files/$1;\n    proxy_http_version 1.1;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_buffering off;\n    expires 7d;\n}\n\n# –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ MinIO\nlocation /minio/ {\n    proxy_pass http://minio:9000/;\n    proxy_http_version 1.1;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_buffering off;\n}\n```\n\n### 4. Backend API –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ\n```nginx\n# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–≤–æ–π–Ω–æ–≥–æ API –ø—Ä–µ—Ñ–∏–∫—Å–∞\nlocation ~ ^/api/api/(.*)$ {\n    proxy_pass http://api_backend/api/$1;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection 'upgrade';\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n}\n\n# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Å —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–º–∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏\nlocation /api/auth/ {\n    proxy_pass http://api_backend/api/auth/;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection 'upgrade';\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_read_timeout 90;\n}\n\n# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è\nlocation /api/health {\n    proxy_pass http://api_backend/api/health;\n    proxy_http_version 1.1;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n}\n\n# –û–±—â–∏–π API –º–∞—Ä—à—Ä—É—Ç —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º–∏ —Ç–∞–π–º–∞—É—Ç–∞–º–∏\nlocation /api/ {\n    proxy_pass http://api_backend/api/;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection 'upgrade';\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    \n    # –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã –¥–ª—è —Ç—è–∂–µ–ª—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π\n    proxy_connect_timeout 120s;\n    proxy_send_timeout 120s;\n    proxy_read_timeout 120s;\n}\n\n# –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—É—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏\nlocation /auth/ {\n    proxy_pass http://api_backend/auth/;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection 'upgrade';\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_read_timeout 90;\n}\n```\n\n### 5. WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–∞\n```nginx\nlocation /ws/ {\n    proxy_pass http://api_backend/ws/;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"upgrade\";\n    proxy_read_timeout 600s;  # 10 –º–∏–Ω—É—Ç –¥–ª—è –¥–æ–ª–≥–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π\n    proxy_send_timeout 60s;\n    proxy_connect_timeout 10s;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n    proxy_buffering off;\n    tcp_nodelay on;\n}\n```\n\n### 6. Frontend SPA\n```nginx\n# –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–µ–∑ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è\nlocation = /env.js {\n    add_header Cache-Control \"no-store, no-cache, must-revalidate\";\n    expires -1;\n    alias /usr/share/nginx/html/env.js;\n}\n\nlocation = /process-env.js {\n    add_header Cache-Control \"no-store, no-cache, must-revalidate\";\n    expires -1;\n    alias /usr/share/nginx/html/process-env.js;\n}\n\n# SPA –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å fallback\nlocation / {\n    root /usr/share/nginx/html;\n    index index.html;\n    try_files $uri $uri/ /index.html;\n}\n```\n\n## üìß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—á—Ç–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (mail.svetu.rs)\n\n### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n```nginx\nserver {\n    listen 443 ssl;\n    server_name mail.svetu.rs;\n    client_max_body_size 50M;  # –î–ª—è –±–æ–ª—å—à–∏—Ö –≤–ª–æ–∂–µ–Ω–∏–π\n    \n    ssl_certificate /etc/letsencrypt/live/mail.svetu.rs/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/mail.svetu.rs/privkey.pem;\n}\n```\n\n### Exchange Web Services (EWS) –∑–∞–≥–ª—É—à–∫–∞\n```nginx\n# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è Exchange Web Services\nlocation = /EWS/Exchange.asmx {\n    default_type text/xml;\n    return 200 '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">\n        <soap:Body>\n            <soap:Fault>\n                <faultcode>soap:Client</faultcode>\n                <faultstring>Microsoft Exchange Web Services not supported. Please use IMAP/SMTP.</faultstring>\n            </soap:Fault>\n        </soap:Body>\n    </soap:Envelope>';\n}\n\n# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ EWS\nlocation ~* ^/ews/exchange\\.asmx$ {\n    default_type text/xml;\n    return 200 '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n    <soap:Envelope xmlns:soap=\"http://schemas.xmlsoap.org/soap/envelope/\">\n        <soap:Body>\n            <soap:Fault>\n                <faultcode>soap:Client</faultcode>\n                <faultstring>Microsoft Exchange Web Services not supported. Please use IMAP/SMTP.</faultstring>\n            </soap:Fault>\n        </soap:Body>\n    </soap:Envelope>';\n}\n```\n\n### Roundcube –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ\n```nginx\n# –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫\nlocation = / {\n    proxy_pass http://mail-webui:80/;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto https;\n    proxy_set_header X-Forwarded-Host $host;\n    proxy_set_header X-Forwarded-Port 443;\n    proxy_set_header X-Forwarded-Ssl on;\n    \n    proxy_buffer_size 128k;\n    proxy_buffers 4 256k;\n    proxy_busy_buffers_size 256k;\n    \n    proxy_connect_timeout 300s;\n    proxy_send_timeout 300s;\n    proxy_read_timeout 300s;\n}\n\n# URL —Å GET-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏\nlocation ~ ^/\\?(.*)$ {\n    proxy_pass http://mail-webui:80/?$1;\n    # ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏\n}\n\n# URL —Å —Ç–æ–∫–µ–Ω–æ–º —Å–µ—Å—Å–∏–∏\nlocation ~ ^/[a-zA-Z0-9_-]+/?.* {\n    proxy_pass http://mail-webui:80$uri$is_args$args;\n    # ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏\n}\n```\n\n## üîß –ê–≤—Ç–æ–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—á—Ç–æ–≤—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤\n\n### Microsoft Outlook (autodiscover.svetu.rs)\n```nginx\nserver {\n    listen 443 ssl;\n    server_name autodiscover.svetu.rs;\n    \n    ssl_certificate /etc/letsencrypt/live/autodiscover.svetu.rs/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/autodiscover.svetu.rs/privkey.pem;\n    \n    location /autodiscover/autodiscover.xml {\n        default_type application/xml;\n        return 200 '<?xml version=\"1.0\" encoding=\"utf-8\"?>\n        <Autodiscover xmlns=\"http://schemas.microsoft.com/exchange/autodiscover/responseschema/2006\">\n            <Response xmlns=\"http://schemas.microsoft.com/exchange/autodiscover/outlook/responseschema/2006a\">\n                <Account>\n                    <AccountType>email</AccountType>\n                    <Action>settings</Action>\n                    <Protocol>\n                        <Type>IMAP</Type>\n                        <Server>mail.svetu.rs</Server>\n                        <Port>993</Port>\n                        <SSL>on</SSL>\n                        <AuthRequired>on</AuthRequired>\n                    </Protocol>\n                    <Protocol>\n                        <Type>SMTP</Type>\n                        <Server>mail.svetu.rs</Server>\n                        <Port>587</Port>\n                        <SSL>on</SSL>\n                        <AuthRequired>on</AuthRequired>\n                    </Protocol>\n                </Account>\n            </Response>\n        </Autodiscover>';\n    }\n}\n```\n\n### Mozilla Thunderbird (autoconfig.svetu.rs)\n```nginx\nserver {\n    listen 443 ssl;\n    server_name autoconfig.svetu.rs;\n    \n    ssl_certificate /etc/letsencrypt/live/autoconfig.svetu.rs/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/autoconfig.svetu.rs/privkey.pem;\n    \n    location /mail/config-v1.1.xml {\n        default_type application/xml;\n        return 200 '<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n        <clientConfig version=\"1.1\">\n            <emailProvider id=\"svetu.rs\">\n                <domain>svetu.rs</domain>\n                <displayName>Sve Tu Mail</displayName>\n                <displayShortName>Sve Tu</displayShortName>\n                <incomingServer type=\"imap\">\n                    <hostname>mail.svetu.rs</hostname>\n                    <port>993</port>\n                    <socketType>SSL</socketType>\n                    <authentication>password-cleartext</authentication>\n                    <username>%EMAILADDRESS%</username>\n                </incomingServer>\n                <outgoingServer type=\"smtp\">\n                    <hostname>mail.svetu.rs</hostname>\n                    <port>587</port>\n                    <socketType>STARTTLS</socketType>\n                    <authentication>password-cleartext</authentication>\n                    <username>%EMAILADDRESS%</username>\n                </outgoingServer>\n            </emailProvider>\n        </clientConfig>';\n    }\n}\n```\n\n## üó∫Ô∏è GIS —Å–µ—Ä–≤–∏—Å (gis.svetu.rs)\n```nginx\nserver {\n    listen 443 ssl;\n    server_name gis.svetu.rs;\n    \n    ssl_certificate /etc/letsencrypt/live/gis.svetu.rs/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/gis.svetu.rs/privkey.pem;\n    \n    location / {\n        proxy_pass http://gis-backend:3002/;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        \n        # CORS –¥–ª—è GIS –¥–∞–Ω–Ω—ã—Ö\n        add_header Access-Control-Allow-Origin *;\n        add_header Access-Control-Allow-Methods \"GET, POST, OPTIONS\";\n        add_header Access-Control-Allow-Headers \"Origin, Content-Type, Accept, Authorization\";\n    }\n}\n```\n\n## üé® –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∞–π—Ç (klimagrad.svetu.rs)\n```nginx\nserver {\n    listen 443 ssl;\n    server_name klimagrad.svetu.rs;\n    \n    ssl_certificate /etc/letsencrypt/live/klimagrad.svetu.rs/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/klimagrad.svetu.rs/privkey.pem;\n    \n    location / {\n        root /usr/share/nginx/klimagrad;\n        index index.html;\n        try_files $uri $uri/ =404;\n        \n        # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤\n        expires 30d;\n        add_header Cache-Control \"public, immutable\";\n    }\n}\n```\n\n## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏\n\n### –û–±—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏\n```nginx\n# DNS —Ä–µ–∑–æ–ª–≤–∏–Ω–≥ –¥–ª—è Docker\nresolver 127.0.0.11 valid=30s ipv6=off;\nresolver_timeout 5s;\n\n# –†–∞–∑–º–µ—Ä—ã –±—É—Ñ–µ—Ä–æ–≤\nclient_max_body_size 20M;  # –û—Å–Ω–æ–≤–Ω–æ–π –¥–æ–º–µ–Ω\nclient_max_body_size 50M;  # –ü–æ—á—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä\n\n# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è production\naccess_log /dev/null;\n```\n\n### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ\n```nginx\n# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ—Å—É—Ä—Å—ã\nexpires 30d;                    # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã\nexpires 7d;                     # MinIO –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è\nexpires max;                    # Favicon\nexpires -1;                     # –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Ñ–∏–≥–∏\n\n# Cache-Control –∑–∞–≥–æ–ª–æ–≤–∫–∏\nadd_header Cache-Control \"public, immutable\";      # –°—Ç–∞—Ç–∏–∫–∞\nadd_header Cache-Control \"no-store, no-cache, must-revalidate\";  # –î–∏–Ω–∞–º–∏–∫–∞\n```\n\n### –¢–∞–π–º–∞—É—Ç—ã\n```nginx\n# API –∑–∞–ø—Ä–æ—Å—ã\nproxy_connect_timeout 120s;\nproxy_send_timeout 120s;\nproxy_read_timeout 120s;\n\n# WebSocket\nproxy_read_timeout 600s;\nproxy_send_timeout 60s;\nproxy_connect_timeout 10s;\n\n# –ü–æ—á—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä\nproxy_connect_timeout 300s;\nproxy_send_timeout 300s;\nproxy_read_timeout 300s;\n\n# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è\nproxy_read_timeout 90;\n```\n\n### –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è\n```nginx\n# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö\nproxy_buffering off;            # MinIO, WebSocket\n\n# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –ø–æ—á—Ç—ã\nproxy_buffer_size 128k;\nproxy_buffers 4 256k;\nproxy_busy_buffers_size 256k;\n\n# WebSocket –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏\ntcp_nodelay on;\n```\n\n## üê≥ Docker –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è\n\n### Dockerfile –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è\n```dockerfile\n# nginx/Dockerfile\nFROM nginx:alpine\n\n# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏\nCOPY nginx.conf /etc/nginx/nginx.conf\n\n# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π\nRUN mkdir -p /var/www/certbot\nRUN mkdir -p /usr/share/nginx/uploads\n\n# –≠–∫—Å–ø–æ–∑–∏—Ü–∏—è –ø–æ—Ä—Ç–æ–≤\nEXPOSE 80 443\n\n# Healthcheck\nHEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \\\n    CMD curl -f http://localhost/api/health || exit 1\n```\n\n### Docker Compose volumes\n```yaml\nvolumes:\n  - ./nginx.conf:/etc/nginx/nginx.conf:ro\n  - ./certbot/conf:/etc/letsencrypt:ro\n  - ./certbot/www:/var/www/certbot:ro\n  - uploads_volume:/usr/share/nginx/uploads:ro\n  - frontend_build:/usr/share/nginx/html:ro\n  - klimagrad_static:/usr/share/nginx/klimagrad:ro\n```\n\n## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —É–ª—É—á—à–µ–Ω–∏—è\n\n### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏\n```nginx\n# –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏\nadd_header X-Frame-Options \"SAMEORIGIN\" always;\nadd_header X-Content-Type-Options \"nosniff\" always;\nadd_header X-XSS-Protection \"1; mode=block\" always;\nadd_header Referrer-Policy \"strict-origin-when-cross-origin\" always;\n\n# Content Security Policy\nadd_header Content-Security-Policy \"default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' wss: https:;\" always;\n\n# HSTS –¥–ª—è production\nadd_header Strict-Transport-Security \"max-age=63072000; includeSubDomains; preload\" always;\n\n# –°–∫—Ä—ã—Ç–∏–µ –≤–µ—Ä—Å–∏–∏ Nginx\nserver_tokens off;\n```\n\n### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è\n```nginx\n# Gzip –∫–æ–º–ø—Ä–µ—Å—Å–∏—è\ngzip on;\ngzip_vary on;\ngzip_min_length 1024;\ngzip_types text/plain text/css text/xml text/javascript application/javascript application/xml+rss application/json;\n\n# Brotli –∫–æ–º–ø—Ä–µ—Å—Å–∏—è (–µ—Å–ª–∏ –º–æ–¥—É–ª—å –¥–æ—Å—Ç—É–ø–µ–Ω)\nbrotli on;\nbrotli_comp_level 6;\nbrotli_types text/plain text/css application/json application/javascript text/xml application/xml;\n\n# HTTP/2 –ø–æ–¥–¥–µ—Ä–∂–∫–∞\nlisten 443 ssl http2;\n\n# Rate limiting\nlimit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;\nlimit_req zone=api burst=20 nodelay;\n```\n\n## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ\n\n### –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏\n```nginx\n# –§–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞\nlog_format json_combined escape=json\n  '{'\n    '\"time_local\":\"$time_local\",'  \n    '\"remote_addr\":\"$remote_addr\",'  \n    '\"remote_user\":\"$remote_user\",'  \n    '\"request\":\"$request\",'  \n    '\"status\": \"$status\",'  \n    '\"body_bytes_sent\":\"$body_bytes_sent\",'  \n    '\"http_referer\":\"$http_referer\",'  \n    '\"http_user_agent\":\"$http_user_agent\",'  \n    '\"request_time\":\"$request_time\",'  \n    '\"upstream_response_time\":\"$upstream_response_time\"'\n  '}';\n\n# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞\naccess_log /var/log/nginx/access.log json_combined;\nerror_log /var/log/nginx/error.log warn;\n```\n\n### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞\n```nginx\n# –ú–æ–¥—É–ª—å nginx-module-vts –¥–ª—è –º–µ—Ç—Ä–∏–∫\nvhost_traffic_status_zone;\n\nlocation /nginx_status {\n    vhost_traffic_status_display;\n    vhost_traffic_status_display_format html;\n    allow 127.0.0.1;\n    deny all;\n}\n```\n\n---\n**–ü–∞—Å–ø–æ—Ä—Ç —Å–æ–∑–¥–∞–Ω:** 2025-06-29  \n**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç:** Nginx Configuration  \n**–°—Ç–∞—Ç—É—Å:** –ê–∫—Ç–∏–≤–Ω—ã–π –≤ production