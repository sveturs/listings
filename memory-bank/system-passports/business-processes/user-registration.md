# –ü–∞—Å–ø–æ—Ä—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–∞: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ Google OAuth, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∞–∫–∫–∞—É–Ω—Ç–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

## üîÑ –°—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

### 1. **–¢—Ä–∏–≥–≥–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**
```mermaid
graph LR
    A[Google OAuth callback] --> B[–ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ Google ID]
    B --> C{–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω?}
    C -->|–ù–µ—Ç| D[–ù–ê–ß–ê–õ–û –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò]
    C -->|–î–∞| E[–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö]
    D --> F[–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è]
```

### 2. **–ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è**
```mermaid
graph TD
    A[–î–∞–Ω–Ω—ã–µ –∏–∑ Google] --> B[–í–∞–ª–∏–¥–∞—Ü–∏—è email/–∏–º–µ–Ω–∏]
    B --> C[–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ users]
    C --> D[–ì–µ–Ω–µ—Ä–∞—Ü–∏—è display_name]
    D --> E[–°–æ–∑–¥–∞–Ω–∏–µ privacy_settings]
    E --> F[–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è user_balances]
    F --> G[–û—Ç–ø—Ä–∞–≤–∫–∞ welcome email]
    G --> H[–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π]
    H --> I[–í–æ–∑–≤—Ä–∞—Ç user –æ–±—ä–µ–∫—Ç–∞]
```

### 3. **–ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**
```mermaid
graph LR
    A[–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] --> B[–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å modal]
    B --> C[–í—ã–±–æ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏]
    C --> D[–ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ]
    D --> E[–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π]
    E --> F[–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ onboarding]
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### **Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
- **RegisterForm** - —Ñ–æ—Ä–º–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- **WelcomeModal** - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **PrivacySettingsStep** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- **AuthStateManager** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### **Backend handlers**
- `/auth/google/callback` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ OAuth
- `/users/profile` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `/users/privacy` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
- `/notifications/welcome` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
- `users` - –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è
- `user_privacy_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
- `user_balances` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
- `notification_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### **–°–µ—Ä–≤–∏—Å—ã**
- Email service - –æ—Ç–ø—Ä–∞–≤–∫–∞ welcome –ø–∏—Å–µ–º
- Avatar service - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- Analytics service - —Ç—Ä–µ–∫–∏–Ω–≥ –Ω–æ–≤—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π

## üìã –î–µ—Ç–∞–ª—å–Ω—ã–π flow –ø—Ä–æ—Ü–µ—Å—Å–∞

### **–≠—Ç–∞–ø 1: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
1. –í –ø—Ä–æ—Ü–µ—Å—Å–µ OAuth callback –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
   ```go
   user, err := userRepo.GetByGoogleID(googleProfile.ID)
   if err == pgx.ErrNoRows {
       // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
       isNewUser = true
   }
   ```

2. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ –∏–∑ Google –ø—Ä–æ—Ñ–∏–ª—è:
   ```json
   {
     "id": "google_user_id",
     "email": "user@gmail.com", 
     "name": "John Doe",
     "picture": "https://lh3.googleusercontent.com/...",
     "verified_email": true
   }
   ```

### **–≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
1. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**:
   - Email —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å
   - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∏–º–µ–Ω–∏ (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤)
   - –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Google –∞–≤–∞—Ç–∞—Ä–∞

2. **–°–æ–∑–¥–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø–∏—Å–∏**:
   ```go
   user := &models.User{
       GoogleID:     googleProfile.ID,
       Email:        googleProfile.Email,
       Name:         googleProfile.Name,
       AvatarURL:    googleProfile.Picture,
       DisplayName:  generateDisplayName(googleProfile.Name),
       IsVerified:   true, // Email —É–∂–µ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω Google
       CreatedAt:    time.Now(),
       UpdatedAt:    time.Now(),
   }
   ```

3. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ display_name**:
   ```go
   // "John Doe" -> "john.doe.123" –µ—Å–ª–∏ john.doe –∑–∞–Ω—è—Ç
   displayName := strings.ToLower(
       strings.ReplaceAll(googleProfile.Name, " ", "."),
   )
   if exists := checkDisplayNameExists(displayName); exists {
       displayName += "." + generateRandomSuffix()
   }
   ```

### **–≠—Ç–∞–ø 3: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
1. **Privacy Settings** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ):
   ```go
   privacySettings := &models.UserPrivacySettings{
       UserID:           user.ID,
       ShowEmail:        false,
       ShowPhone:        false,
       ShowLastSeen:     false,
       AllowDirectMessages: true,
       ShowOnlineStatus: false,
   }
   ```

2. **User Balances** (—Å—Ç–∞—Ä—Ç–æ–≤—ã–µ –±–∞–ª–∞–Ω—Å—ã):
   ```go
   balance := &models.UserBalance{
       UserID:       user.ID,
       AvailableRSD: decimal.Zero,
       EscrowRSD:    decimal.Zero,
       TotalEarnedRSD: decimal.Zero,
   }
   ```

3. **Notification Settings** (–≤—Å–µ –≤–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
   ```go
   notificationSettings := &models.NotificationSettings{
       UserID:      user.ID,
       EmailEnabled: true,
       TelegramEnabled: false, // –¥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è Telegram
       InAppEnabled: true,
   }
   ```

### **–≠—Ç–∞–ø 4: Welcome –ø—Ä–æ—Ü–µ–¥—É—Ä—ã**
1. **–û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ email**:
   ```html
   Subject: –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Sve Tu! üéâ
   
   –ü—Ä–∏–≤–µ—Ç {{.Name}}!
   
   –°–ø–∞—Å–∏–±–æ –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –≤ Sve Tu Platform.
   –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ:
   - –†–∞–∑–º–µ—â–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è
   - –ü–æ–∫—É–ø–∞—Ç—å —Ç–æ–≤–∞—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ
   - –°–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ—é –≤–∏—Ç—Ä–∏–Ω—É
   ```

2. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ**:
   ```go
   analytics.TrackEvent("user_registered", map[string]interface{}{
       "user_id": user.ID,
       "source": "google_oauth",
       "timestamp": time.Now(),
   })
   ```

## üé® Frontend onboarding

### **Welcome Modal –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ:

```typescript
interface WelcomeModalProps {
  isNewUser: boolean;
  user: User;
  onComplete: () => void;
}

// –°–æ–¥–µ—Ä–∂–∏—Ç:
// 1. –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ –∏–º–µ–Ω–∏
// 2. –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã  
// 3. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
// 4. –°—Å—ã–ª–∫—É –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
```

### **–ü–µ—Ä–≤—ã–µ —à–∞–≥–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
   - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è
   - –£–∫–∞–∑–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞/—Ä–µ–≥–∏–æ–Ω–∞

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏**:
   - –ö—Ç–æ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å email
   - –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø—Ä—è–º—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
   - –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å–∞ "–æ–Ω–ª–∞–π–Ω"

3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**:
   - Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram –±–æ—Ç–∞
   - Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–±—É–¥—É—â–µ–µ)

## üìä –¢–∏–ø—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### **–û–±—ã—á–Ω—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å**
- –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
- –§–æ–∫—É—Å –Ω–∞ –ø–æ–∏—Å–∫–µ —Ç–æ–≤–∞—Ä–æ–≤
- –ü—Ä–æ—Å—Ç–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–æ–¥–∞–≤–µ—Ü**
- –ë–æ–ª–µ–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–µ—Ä–≤–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- Welcome email —Å –≥–∏–¥–æ–º –ø–æ –ø—Ä–æ–¥–∞–∂–∞–º

### **–ë—É–¥—É—â–∏–π –≤–ª–∞–¥–µ–ª–µ—Ü –≤–∏—Ç—Ä–∏–Ω—ã**
- –°–±–æ—Ä –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ (—Ç–∏–ø –±–∏–∑–Ω–µ—Å–∞)
- –ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ business –ø—Ä–æ–≥—Ä–∞–º–º—É
- –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ welcome –º–∞—Ç–µ—Ä–∏–∞–ª—ã

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### **–ó–∞—â–∏—Ç–∞ –æ—Ç spam-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π**
```go
// Rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ IP
const maxRegistrationsPerIP = 5
const timeWindow = time.Hour

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–µ–Ω–∞ email
allowedDomains := []string{"gmail.com", "yahoo.com", "outlook.com"}
if !isAllowedEmailDomain(user.Email) {
    return errors.New("email domain not allowed")
}
```

### **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö Google**
```go
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
if googleProfile.Email == "" || googleProfile.ID == "" {
    return errors.New("incomplete google profile")
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ email –≤ Google
if !googleProfile.EmailVerified {
    return errors.New("google email not verified")
}
```

### **–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**
```go
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ Google ID
existingUser := userRepo.GetByGoogleID(googleProfile.ID)

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ email (–Ω–∞ —Å–ª—É—á–∞–π —Å–º–µ–Ω—ã Google ID)
existingByEmail := userRepo.GetByEmail(googleProfile.Email)

if existingByEmail != nil && existingByEmail.GoogleID != googleProfile.ID {
    // –û–±–Ω–æ–≤–ª—è–µ–º GoogleID —É —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    userRepo.UpdateGoogleID(existingByEmail.ID, googleProfile.ID)
}
```

## üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏

### **–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**
1. **Conversion rate**: –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ / –Ω–∞—á–∞—Ç—ã–µ OAuth flows
2. **Time to first action**: –≤—Ä–µ–º—è –æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–æ –ø–µ—Ä–≤–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
3. **Onboarding completion**: –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–æ—à–µ–¥—à–∏—Ö welcome steps
4. **Profile completion**: –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª–µ–π –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### **–ö–æ–≥–æ—Ä—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
```sql
-- –î–Ω–µ–≤–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
SELECT DATE(created_at) as date, COUNT(*) as new_users
FROM users 
WHERE created_at >= CURRENT_DATE - INTERVAL '30 days'
GROUP BY DATE(created_at);

-- –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
SELECT 
  CASE 
    WHEN referrer LIKE '%google%' THEN 'google'
    WHEN referrer IS NULL THEN 'direct'
    ELSE 'other'
  END as source,
  COUNT(*) as registrations
FROM users
GROUP BY source;
```

### **Retention tracking**
```go
// –¢—Ä–µ–∫–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
type UserActivity struct {
    UserID      int
    Day1Active  bool // –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤ –ø–µ—Ä–≤—ã–π –¥–µ–Ω—å
    Day7Active  bool // –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é
    Day30Active bool // –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü
}
```

## üåê –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### **Email Service**
```go
// Welcome email template
emailTemplate := &EmailTemplate{
    Subject: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Sve Tu! üéâ",
    Template: "welcome_user.html",
    Data: map[string]interface{}{
        "UserName": user.Name,
        "PlatformFeatures": []string{
            "–ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏",
            "–°–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π", 
            "–ü—Ä—è–º–æ–µ –æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–æ–¥–∞–≤—Ü–∞–º–∏",
        },
    },
}
```

### **Avatar Processing**
```go
// –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è Google –∞–≤–∞—Ç–∞—Ä–∞
avatarURL := processGoogleAvatar(googleProfile.Picture)

// –°–æ–∑–¥–∞–Ω–∏–µ thumbnails —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤
thumbnails := []string{
    createThumbnail(avatarURL, "32x32"),
    createThumbnail(avatarURL, "64x64"), 
    createThumbnail(avatarURL, "128x128"),
}
```

### **Analytics Integration**
```typescript
// Frontend tracking
analytics.track('User Registered', {
  userId: user.id,
  email: user.email,
  source: 'google_oauth',
  timestamp: new Date(),
  properties: {
    hasAvatar: !!user.avatarUrl,
    completedWelcome: false,
  }
});
```

## ‚ùå –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### **–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**
1. **Email —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç**:
   ```json
   {
     "success": false,
     "error": "registration.emailExists",
     "message": "User with this email already exists"
   }
   ```

2. **–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω Google –ø—Ä–æ—Ñ–∏–ª—å**:
   ```json
   {
     "success": false, 
     "error": "registration.invalidGoogleProfile",
     "message": "Unable to fetch Google profile data"
   }
   ```

3. **Database –æ—à–∏–±–∫–∏**:
   ```json
   {
     "success": false,
     "error": "registration.databaseError", 
     "message": "Failed to create user profile"
   }
   ```

### **Rollback —Å—Ç—Ä–∞—Ç–µ–≥–∏—è**
```go
func registerUser(googleProfile *GoogleProfile) error {
    tx, err := db.Begin()
    if err != nil {
        return err
    }
    defer tx.Rollback()

    // 1. –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user, err := createUserInTx(tx, googleProfile)
    if err != nil {
        return err
    }

    // 2. –°–æ–∑–¥–∞–Ω–∏–µ privacy settings
    err = createPrivacySettingsInTx(tx, user.ID)
    if err != nil {
        return err
    }

    // 3. –°–æ–∑–¥–∞–Ω–∏–µ balance
    err = createUserBalanceInTx(tx, user.ID)
    if err != nil {
        return err
    }

    return tx.Commit()
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **Unit —Ç–µ—Å—Ç—ã**
```go
func TestUserRegistration(t *testing.T) {
    googleProfile := &GoogleProfile{
        ID:            "google123",
        Email:         "test@gmail.com",
        Name:          "Test User",
        Picture:       "https://avatar.url",
        EmailVerified: true,
    }
    
    user, err := registerUser(googleProfile)
    assert.NoError(t, err)
    assert.Equal(t, googleProfile.Email, user.Email)
    assert.True(t, user.IsVerified)
}
```

### **Integration —Ç–µ—Å—Ç—ã**
- –ü–æ–ª–Ω—ã–π OAuth + registration flow
- Welcome email –æ—Ç–ø—Ä–∞–≤–∫–∞
- Privacy settings —Å–æ–∑–¥–∞–Ω–∏–µ
- Analytics events —Ç—Ä–µ–∫–∏–Ω–≥

### **E2E —Ç–µ—Å—Ç—ã**
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google OAuth
- Welcome modal –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- Profile completion flow
- First listing creation

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**
- **Batch inserts**: —Å–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
- **Avatar caching**: –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ Google –∞–≤–∞—Ç–∞—Ä–æ–≤ –≤ MinIO
- **Welcome email queue**: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ email'–æ–≤

### **Database –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**
```sql
-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_users_google_id ON users(google_id);
CREATE INDEX idx_users_email ON users(email);
CREATE INDEX idx_users_created_at ON users(created_at);

-- –ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è analytics
CREATE TABLE user_registrations_2024 PARTITION OF user_registrations
FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');
```

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –ø—Ä–∏ –Ω–æ–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è** - —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ –ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏** - —á–∞—Å—Ç—å onboarding –ø—Ä–æ—Ü–µ—Å—Å–∞
4. **–°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è** - typical next action
5. **Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** - welcome series –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
6. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–∞–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üéõÔ∏è A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–í–∞—Ä–∏–∞–Ω—Ç—ã onboarding'–∞**
- **Minimal**: —Ç–æ–ª—å–∫–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —à–∞–≥–æ–≤
- **Standard**: welcome modal + privacy settings
- **Complete**: –ø–æ–ª–Ω—ã–π guided tour –ø–æ —Ñ—É–Ω–∫—Ü–∏—è–º –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

### **Welcome email variations**
- **Short**: –∫—Ä–∞—Ç–∫–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏
- **Detailed**: –ø–æ–¥—Ä–æ–±–Ω—ã–π –≥–∏–¥ –ø–æ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ
- **Video**: email —Å welcome –≤–∏–¥–µ–æ

## üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### **API Reference**
- `POST /auth/google/callback` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ OAuth flow
- `GET /users/profile` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ—Ñ–∏–ª—è
- `PUT /users/privacy` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

### **Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
- `RegisterForm.md` - —Ñ–æ—Ä–º–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `WelcomeModal.md` - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –æ–∫–Ω–æ
- `AuthStateManager.md` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

### **Database —Å—Ö–µ–º—ã**
- `users.md` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `user_privacy_settings.md` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
- `user_balances.md` - —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ