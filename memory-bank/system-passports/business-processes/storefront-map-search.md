# –ü–∞—Å–ø–æ—Ä—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–∞: –ü–æ–∏—Å–∫ –≤–∏—Ç—Ä–∏–Ω –Ω–∞ –∫–∞—Ä—Ç–µ

## üìã –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- **–ù–∞–∑–≤–∞–Ω–∏–µ**: –ü–æ–∏—Å–∫ –≤–∏—Ç—Ä–∏–Ω –Ω–∞ –∫–∞—Ä—Ç–µ
- **–†–æ–ª—å**: –ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤–∏—Ç—Ä–∏–Ω–∞–º
- **–¢–∏–ø**: –ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å
- **–°—Ç–∞—Ç—É—Å**: –ê–∫—Ç–∏–≤–Ω—ã–π
- **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞**: 2025-06-29

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ü—Ä–æ—Ü–µ—Å—Å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–∏—Å–∫ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏—Ç—Ä–∏–Ω –Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç–µ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—é, —Ä–µ–π—Ç–∏–Ω–≥—É –∏ –¥—Ä—É–≥–∏–º –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–∫—É–ø–∞—Ç–µ–ª—è–º –Ω–∞—Ö–æ–¥–∏—Ç—å –±–ª–∏–∂–∞–π—à–∏–µ –º–∞–≥–∞–∑–∏–Ω—ã –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ñ–ª–∞–π–Ω-–ø–æ–∫—É–ø–∫–∏.

## üîÑ –û–±—â–∞—è —Å—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∫–∞—Ä—Ç—ã] --> B{–ï—Å—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é?}
    B -->|–î–∞| C[–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏]
    B -->|–ù–µ—Ç| D[–ó–∞–ø—Ä–æ—Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏–ª–∏ —Ä—É—á–Ω–æ–π –≤–≤–æ–¥]
    
    C --> E[–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã —Å —Ü–µ–Ω—Ç—Ä–æ–º –≤ —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏]
    D --> E
    
    E --> F[–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏—Ç—Ä–∏–Ω –≤ —Ä–∞–¥–∏—É—Å–µ]
    F --> G[–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ]
    
    G --> H{–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç}
    H -->|–ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã| I[–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏—Ç—Ä–∏–Ω]
    H -->|–ö–ª–∏–∫–∞–µ—Ç –Ω–∞ –º–∞—Ä–∫–µ—Ä| J[–ü–æ–∫–∞–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∏—Ç—Ä–∏–Ω–µ]
    H -->|–ò–∑–º–µ–Ω—è–µ—Ç –∑—É–º/–ø–æ–∑–∏—Ü–∏—é| K[–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏]
    H -->|–ü–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É| L[–ì–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–µ—Ä–µ—Ö–æ–¥]
    
    I --> M[–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ]
    J --> N[Popup —Å –¥–µ—Ç–∞–ª—è–º–∏ –≤–∏—Ç—Ä–∏–Ω—ã]
    K --> O[–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤—ã—Ö –≤–∏—Ç—Ä–∏–Ω]
    L --> P[–¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã]
    
    N --> Q{–î–µ–π—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è}
    Q -->|–ü–µ—Ä–µ—Ö–æ–¥ –≤ –≤–∏—Ç—Ä–∏–Ω—É| R[–û—Ç–∫—Ä—ã—Ç–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–∏—Ç—Ä–∏–Ω—ã]
    Q -->|–ü–æ—Å—Ç—Ä–æ–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç| S[–ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ –≤–∏—Ç—Ä–∏–Ω–µ]
    Q -->|–ü–æ–∑–≤–æ–Ω–∏—Ç—å| T[–ò–Ω–∏—Ü–∏–∞—Ü–∏—è –∑–≤–æ–Ω–∫–∞]
```

## üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
1. **StorefrontMap** (`/frontend/svetu/src/components/storefronts/StorefrontMap.tsx`)
   - –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–∞—Ä—Ç—ã –Ω–∞ –±–∞–∑–µ Leaflet
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –∫–∞—Ä—Ç—ã –∏ –º–∞—Ä–∫–µ—Ä–æ–≤
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Redux –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

2. **MapFilters** (`/frontend/svetu/src/components/storefronts/MapFilters.tsx`)
   - –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤: –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ, —Ä–µ–π—Ç–∏–Ω–≥
   - –ß–µ–∫–±–æ–∫—Å—ã –¥–ª—è —Ç–∏–ø–æ–≤ –≤–∏—Ç—Ä–∏–Ω
   - –°–ª–∞–π–¥–µ—Ä —Ä–∞–¥–∏—É—Å–∞ –ø–æ–∏—Å–∫–∞

3. **AddressSearch** (`/frontend/svetu/src/components/storefronts/AddressSearch.tsx`)
   - –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤ —á–µ—Ä–µ–∑ Nominatim API
   - –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞ –≤ localStorage
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

4. **StorefrontMapContainer** (`/frontend/svetu/src/components/storefronts/StorefrontMapContainer.tsx`)
   - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
   - –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

### Backend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
1. **Storefronts Handler** (`/backend/internal/proj/storefronts/handler/`)
   - `GET /api/v1/storefronts/map` - –≤–∏—Ç—Ä–∏–Ω—ã –≤ –≥—Ä–∞–Ω–∏—Ü–∞—Ö –∫–∞—Ä—Ç—ã
   - `GET /api/v1/storefronts/nearby` - –≤–∏—Ç—Ä–∏–Ω—ã —Ä—è–¥–æ–º —Å —Ç–æ—á–∫–æ–π
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º

2. **Geocoding Service** (`/backend/internal/proj/geocode/`)
   - –ü—Ä—è–º–æ–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (–∞–¥—Ä–µ—Å ‚Üí –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)
   - –û–±—Ä–∞—Ç–Ω–æ–µ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã ‚Üí –∞–¥—Ä–µ—Å)
   - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

3. **PostgreSQL + PostGIS**
   - –¢–∞–±–ª–∏—Ü–∞ `storefronts` —Å –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–º–∏ –ø–æ–ª—è–º–∏
   - –ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
   - –§—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π

## üîß –î–µ—Ç–∞–ª—å–Ω—ã–π flow –ø—Ä–æ—Ü–µ—Å—Å–∞

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
```typescript
// StorefrontMap.tsx
useEffect(() => {
  // –ó–∞–ø—Ä–æ—Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(
      (position) => {
        setCenter([position.coords.latitude, position.coords.longitude]);
        setUserLocation([position.coords.latitude, position.coords.longitude]);
      },
      (error) => {
        console.error('Geolocation error:', error);
        // Fallback –Ω–∞ —Ü–µ–Ω—Ç—Ä –ë–µ–ª–≥—Ä–∞–¥–∞
        setCenter([44.8176, 20.4633]);
      }
    );
  }
}, []);
```

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏—Ç—Ä–∏–Ω –≤ –≤–∏–¥–∏–º–æ–π –æ–±–ª–∞—Å—Ç–∏
```go
// storefronts handler
func (h *Handler) GetMapStorefronts(c *fiber.Ctx) error {
    // –ü–æ–ª—É—á–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü –∫–∞—Ä—Ç—ã
    bounds := struct {
        North float64 `query:"north"`
        South float64 `query:"south"`
        East  float64 `query:"east"`
        West  float64 `query:"west"`
    }{}
    
    if err := c.QueryParser(&bounds); err != nil {
        return c.Status(400).JSON(fiber.Map{
            "error": "Invalid bounds",
        })
    }
    
    // –§–∏–ª—å—Ç—Ä—ã
    filters := parseMapFilters(c)
    
    // –ó–∞–ø—Ä–æ—Å –∫ –ë–î —Å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω–¥–µ–∫—Å–æ–º
    storefronts, err := h.service.GetStorefrontsInBounds(
        bounds.North, bounds.South, bounds.East, bounds.West,
        filters,
    )
    
    return c.JSON(fiber.Map{
        "success": true,
        "data": storefronts,
        "count": len(storefronts),
    })
}
```

### 3. SQL –∑–∞–ø—Ä–æ—Å —Å PostGIS
```sql
-- –ü–æ–∏—Å–∫ –≤–∏—Ç—Ä–∏–Ω –≤ –≥—Ä–∞–Ω–∏—Ü–∞—Ö —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
SELECT 
    s.id,
    s.name,
    s.description,
    s.category_id,
    s.rating,
    s.reviews_count,
    ST_Y(s.location::geometry) as latitude,
    ST_X(s.location::geometry) as longitude,
    s.address,
    s.phone,
    s.working_hours,
    array_agg(si.image_url) as images
FROM storefronts s
LEFT JOIN storefront_images si ON s.id = si.storefront_id
WHERE 
    s.is_active = true
    AND s.is_published = true
    AND ST_Within(
        s.location::geometry,
        ST_MakeEnvelope($1, $2, $3, $4, 4326)
    )
    AND ($5::int[] IS NULL OR s.category_id = ANY($5))
    AND ($6::numeric IS NULL OR s.rating >= $6)
GROUP BY s.id
ORDER BY s.rating DESC, s.reviews_count DESC
LIMIT $7;
```

### 4. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ
```typescript
// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –º–∞—Ä–∫–µ—Ä–æ–≤ –≤ StorefrontMap
{storefronts.map((storefront) => (
  <Marker
    key={storefront.id}
    position={[storefront.latitude, storefront.longitude]}
    icon={createCustomIcon(storefront.category)}
  >
    <Popup>
      <StorefrontPopup 
        storefront={storefront}
        onNavigate={() => handleNavigate(storefront)}
        onCall={() => handleCall(storefront.phone)}
      />
    </Popup>
  </Marker>
))}
```

### 5. –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤–∏—Ç—Ä–∏–Ω
```typescript
// MapFilters.tsx
const handleFilterChange = (filters: MapFilters) => {
  dispatch(updateMapFilters(filters));
  
  // –î–µ–±–∞—É–Ω—Å –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
  debounce(() => {
    fetchFilteredStorefronts(filters);
  }, 300)();
};

// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤
interface MapFilters {
  categories: number[];
  radius: number; // –∫–º
  rating: number; // –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥
  isOpen: boolean; // —Ç–æ–ª—å–∫–æ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Å–µ–π—á–∞—Å
  hasDelivery: boolean;
  hasPickup: boolean;
}
```

### 6. –ü–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É
```typescript
// AddressSearch.tsx
const searchAddress = async (query: string) => {
  try {
    const response = await fetch(
      `https://nominatim.openstreetmap.org/search?` +
      `q=${encodeURIComponent(query)}&` +
      `format=json&limit=5&countrycodes=rs`
    );
    
    const results = await response.json();
    setSuggestions(results);
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
    if (results.length > 0) {
      saveToHistory(query);
    }
  } catch (error) {
    console.error('Address search error:', error);
  }
};
```

### 7. –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤
```typescript
// –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –≤–∏—Ç—Ä–∏–Ω
import MarkerClusterGroup from 'react-leaflet-markercluster';

<MarkerClusterGroup
  chunkedLoading
  maxClusterRadius={50}
  spiderfyOnMaxZoom={true}
  showCoverageOnHover={false}
>
  {storefronts.map(storefront => (
    <Marker key={storefront.id} {...markerProps} />
  ))}
</MarkerClusterGroup>
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫
1. **Rate limiting** –Ω–∞ API endpoints (10 req/sec)
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≥—Ä–∞–Ω–∏—Ü –∫–∞—Ä—Ç—ã** - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—É–º–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
3. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞** –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã—Ö –≤–∏—Ç—Ä–∏–Ω (max 500)
4. **–°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –≤ –ø–æ–∏—Å–∫–µ

### –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å
1. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è** - —Ä–∞–±–æ—Ç–∞ –±–µ–∑ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
2. **–ê–Ω–æ–Ω–∏–º–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞** - –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
3. **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ** –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏

### –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–µ —Å–æ–±—ã—Ç–∏—è
```typescript
// –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç—ã
analytics.track('map_viewed', {
  user_location: userLocation ? 'enabled' : 'disabled',
  initial_center: center,
  viewport_bounds: map.getBounds(),
});

analytics.track('map_filter_applied', {
  filters: appliedFilters,
  results_count: storefronts.length,
});

analytics.track('storefront_clicked_on_map', {
  storefront_id: storefront.id,
  source: 'map_marker',
  user_distance: calculateDistance(userLocation, storefront.location),
});
```

### KPI –º–µ—Ç—Ä–∏–∫–∏
- **–ö–æ–Ω–≤–µ—Ä—Å–∏—è**: –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ä—Ç—ã ‚Üí –∫–ª–∏–∫ –Ω–∞ –≤–∏—Ç—Ä–∏–Ω—É (—Ü–µ–ª—å > 30%)
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤**: % —Å–µ—Å—Å–∏–π —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π (—Ü–µ–ª—å > 40%)
- **–ì–µ–æ–ª–æ–∫–∞—Ü–∏—è**: % –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º (—Ü–µ–ª—å > 60%)
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏—Ç—Ä–∏–Ω < 1—Å

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏
1. **Viewport-based loading** - —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ –≤–∏—Ç—Ä–∏–Ω—ã
2. **–î–µ–±–∞—É–Ω—Å** –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–π –∫–∞—Ä—Ç—ã (500ms)
3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ç–∞–π–ª–æ–≤ –∫–∞—Ä—Ç—ã –≤ localStorage
4. **Lazy loading** –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –ø–æ–ø–∞–ø–∞—Ö

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
1. **–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å** –Ω–∞ location –ø–æ–ª–µ
```sql
CREATE INDEX idx_storefronts_location 
ON storefronts USING GIST (location);
```

2. **–°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å** –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
```sql
CREATE INDEX idx_storefronts_active_category_rating 
ON storefronts (is_active, is_published, category_id, rating);
```

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```go
// Redis –∫–µ—à –¥–ª—è –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –æ–±–ª–∞—Å—Ç–µ–π
cacheKey := fmt.Sprintf("storefronts:bounds:%s", boundsHash)
if cached, err := redis.Get(cacheKey); err == nil {
    return cached
}
// ... –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î
redis.Set(cacheKey, result, 5*time.Minute)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã
```typescript
// StorefrontMap.test.tsx
describe('StorefrontMap', () => {
  it('should request geolocation on mount', () => {
    const mockGeolocation = {
      getCurrentPosition: jest.fn(),
    };
    global.navigator.geolocation = mockGeolocation;
    
    render(<StorefrontMap />);
    
    expect(mockGeolocation.getCurrentPosition).toHaveBeenCalled();
  });
  
  it('should handle geolocation error gracefully', () => {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ fallback –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
  });
});
```

### Integration —Ç–µ—Å—Ç—ã
```go
func TestGetMapStorefronts(t *testing.T) {
    // –¢–µ—Å—Ç —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ –≥—Ä–∞–Ω–∏—Ü–∞–º–∏
    req := httptest.NewRequest(
        "GET", 
        "/api/v1/storefronts/map?north=45&south=44&east=21&west=20",
        nil,
    )
    // ... –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞
}
```

### E2E —Ç–µ—Å—Ç—ã
```typescript
// cypress/e2e/storefront-map.cy.ts
describe('Storefront Map Search', () => {
  it('should show nearby storefronts when location allowed', () => {
    cy.visit('/storefronts/map');
    cy.mockGeolocation(44.8176, 20.4633);
    
    cy.get('[data-testid="map-container"]').should('be.visible');
    cy.get('.leaflet-marker-icon').should('have.length.greaterThan', 0);
  });
});
```

## üåç –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

### –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å
- –ê–¥—Ä–µ—Å–∞ –Ω–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü–µ –∏ –ª–∞—Ç–∏–Ω–∏—Ü–µ
- –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π (–∫–º/–º)

### –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ë–µ–ª–≥—Ä–∞–¥–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–µ—Å—Ç–Ω—ã–º–∏ –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- –£—á–µ—Ç –º–µ—Å—Ç–Ω—ã—Ö –ø—Ä–∞–∑–¥–Ω–∏–∫–æ–≤ –≤ —Ä–∞–±–æ—Ç–µ –≤–∏—Ç—Ä–∏–Ω

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Nominatim API** - –ª–∏–º–∏—Ç 1 –∑–∞–ø—Ä–æ—Å/—Å–µ–∫
2. **–ú–∞–∫—Å–∏–º—É–º 500 –≤–∏—Ç—Ä–∏–Ω** –Ω–∞ –∫–∞—Ä—Ç–µ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
3. **–¢—Ä–µ–±—É–µ—Ç—Å—è HTTPS** –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
4. **Offline —Ä–µ–∂–∏–º** –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

## üîÑ –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

1. **[–°–æ–∑–¥–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏—Ç—Ä–∏–Ω—ã](storefront-creation-setup.md)** - –æ—Ç–∫—É–¥–∞ –±–µ—Ä—É—Ç—Å—è –≤–∏—Ç—Ä–∏–Ω—ã
2. **[–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏ –≤ –≤–∏—Ç—Ä–∏–Ω–µ](product-management-storefront.md)** - —á—Ç–æ –≤–Ω—É—Ç—Ä–∏ –≤–∏—Ç—Ä–∏–Ω
3. **[–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è](search-filtering.md)** - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–∏—Å–∫–∞
4. **[–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂](sales-analytics.md)** - —Ç—Ä–µ–∫–∏–Ω–≥ –∫–æ–Ω–≤–µ—Ä—Å–∏–π —Å –∫–∞—Ä—Ç—ã

## üìà –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **AR –Ω–∞–≤–∏–≥–∞—Ü–∏—è** - –¥–æ–ø–æ–ª–Ω–µ–Ω–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤–∏—Ç—Ä–∏–Ω
2. **–ü—Ä–æ–≥–Ω–æ–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ—Å—Ç–∏** - –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
3. **–ì—Ä—É–ø–ø–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã** - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –ø—É—Ç—å –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –≤–∏—Ç—Ä–∏–Ω–∞–º
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–∞–º–∏** - Google Maps, Yandex
5. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –±–ª–∏–∑–æ—Å—Ç–∏** - push –ø—Ä–∏ –ø—Ä–∏–±–ª–∏–∂–µ–Ω–∏–∏ –∫ –≤–∏—Ç—Ä–∏–Ω–µ