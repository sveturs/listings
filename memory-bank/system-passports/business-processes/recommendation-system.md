# –ü–∞—Å–ø–æ—Ä—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–∞: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

## üìã –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- **–ù–∞–∑–≤–∞–Ω–∏–µ**: –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- **–†–æ–ª—å**: –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏ —É–ª—É—á—à–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞
- **–¢–∏–ø**: –ë–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å
- **–°—Ç–∞—Ç—É—Å**: –ê–∫—Ç–∏–≤–Ω—ã–π
- **–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞—Å–ø–æ—Ä—Ç–∞**: 2025-06-29

## üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ü—Ä–æ—Ü–µ—Å—Å –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤, –≤–∏—Ç—Ä–∏–Ω –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∏—Å—Ç–æ—Ä–∏–∏ –ø–æ–∫—É–ø–æ–∫, –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –∏ –∫–æ–ª–ª–∞–±–æ—Ä–∞—Ç–∏–≤–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏. –°–∏—Å—Ç–µ–º–∞ –ø–æ–≤—ã—à–∞–µ—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏—é, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫ –∏ —É–ª—É—á—à–∞–µ—Ç —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

## üîÑ –û–±—â–∞—è —Å—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

```mermaid
graph TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π] --> B{–¢–∏–ø –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏}
    
    B -->|–ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ–≤–∞—Ä–∞| C[–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ]
    B -->|–ü–æ–∏—Å–∫| D[–ê–Ω–∞–ª–∏–∑ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤]
    B -->|–ü–æ–∫—É–ø–∫–∞| E[–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–∫—É–ø–æ–∫]
    B -->|–õ–∞–π–∫/–ò–∑–±—Ä–∞–Ω–Ω–æ–µ| F[–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π]
    
    C --> G[Real-time –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π]
    D --> G
    E --> G
    F --> G
    
    G --> H[–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è]
    H --> I[–í–µ–∫—Ç–æ—Ä–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]
    
    I --> J{–¢–∏–ø —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π}
    
    J -->|–ü–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã| K[Content-based —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è]
    J -->|–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–∞—è –ª–µ–Ω—Ç–∞| L[Hybrid –ø–æ–¥—Ö–æ–¥]
    J -->|–ö—Ä–æ—Å—Å-–∫–∞—Ç–µ–≥–æ—Ä–∏–∏| M[Collaborative —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è]
    J -->|–¢—Ä–µ–Ω–¥–æ–≤—ã–µ| N[Popularity-based]
    
    K --> O[–ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤]
    L --> P[–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤]
    M --> Q[–ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π]
    N --> R[–ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–Ω–¥–æ–≤ –∏ —Å–µ–∑–æ–Ω–Ω–æ—Å—Ç–∏]
    
    O --> S[–†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤]
    P --> S
    Q --> S
    R --> S
    
    S --> T[–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è]
    T --> U[A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ]
    U --> V[–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π]
    
    V --> W{–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ä–µ–∞–≥–∏—Ä—É–µ—Ç}
    W -->|–ö–ª–∏–∫| X[Positive feedback]
    W -->|–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ| Y[Negative feedback]
    W -->|–ü–æ–∫—É–ø–∫–∞| Z[Strong positive signal]
    
    X --> AA[–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ML –º–æ–¥–µ–ª–∏]
    Y --> AA
    Z --> AA
```

## üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
1. **RecommendationWidget** (`/frontend/svetu/src/components/recommendations/RecommendationWidget.tsx`)
   - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≤–∏–¥–∂–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö layouts (–∫–∞—Ä—É—Å–µ–ª—å, —Å–µ—Ç–∫–∞, —Å–ø–∏—Å–æ–∫)
   - Lazy loading –∏ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è

2. **PersonalizedFeed** (`/frontend/svetu/src/components/recommendations/PersonalizedFeed.tsx`)
   - –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–µ–Ω—Ç–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π
   - Infinite scroll —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø–æ–¥–≥—Ä—É–∑–∫–æ–π
   - Mix–ø–∞–Ω–µ–ª—å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

3. **SimilarItems** (`/frontend/svetu/src/components/recommendations/SimilarItems.tsx`)
   - –ë–ª–æ–∫ "–ü–æ—Ö–æ–∂–∏–µ —Ç–æ–≤–∞—Ä—ã" –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞
   - –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—Ö–æ–∂–µ—Å—Ç–∏
   - Quick view –±–µ–∑ –ø–µ—Ä–µ—Ö–æ–¥–∞

4. **RecommendationExplainer** (`/frontend/svetu/src/components/recommendations/RecommendationExplainer.tsx`)
   - –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ø–æ—á–µ–º—É —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω —Ç–æ–≤–∞—Ä
   - "–ü–æ—Ç–æ–º—É —á—Ç–æ –≤—ã —Å–º–æ—Ç—Ä–µ–ª–∏ X"
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–∫—Ä—ã—Ç—å —Ç–∏–ø —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

### Backend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
1. **Recommendation Engine** (`/backend/internal/proj/recommendations/engine/`)
   - –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤
   - –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **User Profile Service** (`/backend/internal/proj/recommendations/profile/`)
   - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
   - –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

3. **ML Pipeline** (`/backend/internal/proj/recommendations/ml/`)
   - –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
   - Feature engineering
   - Model serving —á–µ—Ä–µ–∑ API

4. **Analytics Collector** (`/backend/internal/proj/recommendations/analytics/`)
   - –°–±–æ—Ä implicit feedback
   - Click-through rate tracking
   - Conversion attribution

### ML/Data –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
1. **Feature Store**
   - –•—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ç–æ–≤–∞—Ä–æ–≤
   - Real-time –∏ batch features
   - –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ features

2. **Model Registry**
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ –º–æ–¥–µ–ª–µ–π
   - A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
   - Rollback –º–µ—Ö–∞–Ω–∏–∑–º—ã

3. **Vector Database (Milvus/Qdrant)**
   - –•—Ä–∞–Ω–µ–Ω–∏–µ embeddings —Ç–æ–≤–∞—Ä–æ–≤
   - –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤
   - –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ –º–∏–ª–ª–∏–æ–Ω–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤

## üîß –î–µ—Ç–∞–ª—å–Ω—ã–π flow –ø—Ä–æ—Ü–µ—Å—Å–∞

### 1. –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –æ –ø–æ–≤–µ–¥–µ–Ω–∏–∏
```typescript
// Analytics tracking –Ω–∞ frontend
const trackUserBehavior = (event: UserEvent) => {
  // Immediate –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–ª—è real-time —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
  sendBeacon('/api/v1/analytics/track', {
    event_type: event.type,
    item_id: event.itemId,
    category_id: event.categoryId,
    timestamp: Date.now(),
    context: {
      source: event.source, // search, recommendation, direct
      position: event.position, // –ø–æ–∑–∏—Ü–∏—è –≤ —Å–ø–∏—Å–∫–µ
      viewport: event.viewport, // –≤–∏–¥–∏–º–∞—è –æ–±–ª–∞—Å—Ç—å
      session_id: getSessionId(),
    },
    user_features: {
      device_type: getDeviceType(),
      location: getUserLocation(),
      time_of_day: new Date().getHours(),
      day_of_week: new Date().getDay(),
    }
  });
  
  // Batch –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
  batchAnalytics.add(event);
};

// –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
export const trackItemView = (item: Item, duration: number) => {
  trackUserBehavior({
    type: 'item_view',
    itemId: item.id,
    categoryId: item.category_id,
    source: item.view_source,
    position: item.list_position,
    viewport: getViewportInfo(),
    metadata: {
      view_duration: duration,
      scroll_depth: getScrollDepth(),
      interactions: getInteractionCount(),
    }
  });
};

export const trackAddToFavorites = (item: Item) => {
  trackUserBehavior({
    type: 'add_to_favorites',
    itemId: item.id,
    categoryId: item.category_id,
    source: 'explicit_preference',
    metadata: {
      price: item.price,
      has_discount: item.discount > 0,
    }
  });
};
```

### 2. –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è
```go
// user_profile_service.go
type UserProfile struct {
    UserID           int
    Demographics     Demographics
    Preferences      map[string]float64
    CategoryAffinity map[int]float64
    PriceRange       PricePreference
    BrandAffinity    map[string]float64
    StyleVector      []float32 // 128-dimensional embedding
    LastUpdated      time.Time
}

func (s *ProfileService) UpdateUserProfile(userID int, event UserEvent) error {
    profile, err := s.getOrCreateProfile(userID)
    if err != nil {
        return err
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∏–ø–∞ —Å–æ–±—ã—Ç–∏—è
    switch event.Type {
    case "item_view":
        s.updateViewPreferences(profile, event)
    case "purchase":
        s.updatePurchasePreferences(profile, event)
    case "search":
        s.updateSearchPreferences(profile, event)
    case "add_to_favorites":
        s.updateExplicitPreferences(profile, event)
    }
    
    // –ü–µ—Ä–µ—Å—á–µ—Ç –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
    profile.StyleVector = s.calculateStyleEmbedding(profile)
    
    // Decay —Å—Ç–∞—Ä—ã—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
    s.applyTimeDecay(profile)
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Redis –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
    return s.saveProfile(profile)
}

func (s *ProfileService) calculateStyleEmbedding(profile *UserProfile) []float32 {
    // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ features
    features := s.extractFeatures(profile)
    
    // –ü—Ä–æ–≥–æ–Ω —á–µ—Ä–µ–∑ –Ω–µ–π—Ä–æ–Ω–Ω—É—é —Å–µ—Ç—å
    embedding, err := s.mlService.GetUserEmbedding(features)
    if err != nil {
        // Fallback –Ω–∞ rule-based embedding
        return s.calculateRuleBasedEmbedding(profile)
    }
    
    return embedding
}
```

### 3. Content-based —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```go
// content_based_recommender.go
func (r *ContentBasedRecommender) GetSimilarItems(itemID int, limit int) ([]ScoredItem, error) {
    // –ü–æ–ª—É—á–µ–Ω–∏–µ embedding –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
    sourceItem, err := r.itemService.GetItemWithEmbedding(itemID)
    if err != nil {
        return nil, err
    }
    
    // –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –ë–î
    similarItems, err := r.vectorDB.SearchSimilar(
        sourceItem.Embedding,
        limit * 2, // –ë–µ—Ä–µ–º –±–æ–ª—å—à–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        map[string]interface{}{
            "category_id": sourceItem.CategoryID, // –¢–æ–ª—å–∫–æ –∏–∑ —Ç–æ–π –∂–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            "price_range": getPriceRange(sourceItem.Price, 0.3), // ¬±30% –ø–æ —Ü–µ–Ω–µ
            "is_active": true,
        },
    )
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ scoring
    scoredItems := []ScoredItem{}
    for _, item := range similarItems {
        if item.ID == itemID {
            continue // –ò—Å–∫–ª—é—á–∞–µ–º —Å–∞–º —Ç–æ–≤–∞—Ä
        }
        
        score := r.calculateSimilarityScore(sourceItem, item)
        
        // Boost –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ —Ç–æ–≥–æ –∂–µ –ø—Ä–æ–¥–∞–≤—Ü–∞
        if item.SellerID == sourceItem.SellerID {
            score *= 1.2
        }
        
        // Penalty –¥–ª—è —Ç–æ–≤–∞—Ä–æ–≤ –±–µ–∑ —Ñ–æ—Ç–æ
        if len(item.Images) == 0 {
            score *= 0.7
        }
        
        scoredItems = append(scoredItems, ScoredItem{
            Item:  item,
            Score: score,
            Reason: r.explainSimilarity(sourceItem, item),
        })
    }
    
    // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ score –∏ –≤–æ–∑–≤—Ä–∞—Ç top N
    sort.Slice(scoredItems, func(i, j int) bool {
        return scoredItems[i].Score > scoredItems[j].Score
    })
    
    return scoredItems[:min(len(scoredItems), limit)], nil
}
```

### 4. Collaborative —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
```go
// collaborative_recommender.go
func (r *CollaborativeRecommender) GetRecommendations(userID int, limit int) ([]ScoredItem, error) {
    // Matrix Factorization –ø–æ–¥—Ö–æ–¥
    userProfile, err := r.profileService.GetUserProfile(userID)
    if err != nil {
        return nil, err
    }
    
    // –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    similarUsers, err := r.findSimilarUsers(userProfile, 100)
    if err != nil {
        return nil, err
    }
    
    // –°–±–æ—Ä —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–∏—Å—å –ø–æ—Ö–æ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
    itemScores := make(map[int]float64)
    userItems := r.getUserItems(userID) // –¢–æ–≤–∞—Ä—ã —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    
    for _, simUser := range similarUsers {
        simUserItems := r.getUserItems(simUser.UserID)
        
        for _, item := range simUserItems {
            // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ç–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –≤–∏–¥–µ–ª
            if _, seen := userItems[item.ItemID]; seen {
                continue
            }
            
            // Score = similarity * interaction_strength
            score := simUser.Similarity * item.InteractionScore
            itemScores[item.ItemID] += score
        }
    }
    
    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ —Å–ø–∏—Å–æ–∫ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
    recommendations := []ScoredItem{}
    for itemID, score := range itemScores {
        item, err := r.itemService.GetItem(itemID)
        if err != nil || !item.IsActive {
            continue
        }
        
        recommendations = append(recommendations, ScoredItem{
            Item:  item,
            Score: score,
            Reason: "Users with similar taste also liked this",
        })
    }
    
    sort.Slice(recommendations, func(i, j int) bool {
        return recommendations[i].Score > recommendations[j].Score
    })
    
    return recommendations[:min(len(recommendations), limit)], nil
}

// Alternating Least Squares –¥–ª—è matrix factorization
func (r *CollaborativeRecommender) trainALSModel() error {
    // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω–æ–π –º–∞—Ç—Ä–∏—Ü—ã user-item interactions
    interactions := r.buildInteractionMatrix()
    
    // ALS –∏—Ç–µ—Ä–∞—Ü–∏–∏
    for iter := 0; iter < r.config.MaxIterations; iter++ {
        // Fix user factors, solve for item factors
        r.solveItemFactors(interactions)
        
        // Fix item factors, solve for user factors
        r.solveUserFactors(interactions)
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏
        if r.hasConverged(iter) {
            break
        }
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
    return r.saveModel()
}
```

### 5. Hybrid —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```go
// hybrid_recommender.go
func (r *HybridRecommender) GetPersonalizedFeed(userID int, page int) (*PersonalizedFeed, error) {
    // –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    var wg sync.WaitGroup
    resultsChan := make(chan RecommendationSource, 5)
    
    // Content-based –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–µ–¥–∞–≤–Ω–∏—Ö –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
    wg.Add(1)
    go func() {
        defer wg.Done()
        items, _ := r.contentBased.GetBasedOnRecentViews(userID, 20)
        resultsChan <- RecommendationSource{
            Type:   "recent_views",
            Items:  items,
            Weight: 0.3,
        }
    }()
    
    // Collaborative —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
    wg.Add(1)
    go func() {
        defer wg.Done()
        items, _ := r.collaborative.GetRecommendations(userID, 20)
        resultsChan <- RecommendationSource{
            Type:   "collaborative",
            Items:  items,
            Weight: 0.25,
        }
    }()
    
    // Trending –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    wg.Add(1)
    go func() {
        defer wg.Done()
        items, _ := r.trending.GetTrendingInUserCategories(userID, 20)
        resultsChan <- RecommendationSource{
            Type:   "trending",
            Items:  items,
            Weight: 0.2,
        }
    }()
    
    // –ù–æ–≤–∏–Ω–∫–∏ –æ—Ç –ª—é–±–∏–º—ã—Ö –ø—Ä–æ–¥–∞–≤—Ü–æ–≤
    wg.Add(1)
    go func() {
        defer wg.Done()
        items, _ := r.social.GetFromFavoriteSellers(userID, 15)
        resultsChan <- RecommendationSource{
            Type:   "favorite_sellers",
            Items:  items,
            Weight: 0.15,
        }
    }()
    
    // –°–µ–∑–æ–Ω–Ω—ã–µ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ
    wg.Add(1)
    go func() {
        defer wg.Done()
        items, _ := r.contextual.GetSeasonalRecommendations(userID, 10)
        resultsChan <- RecommendationSource{
            Type:   "seasonal",
            Items:  items,
            Weight: 0.1,
        }
    }()
    
    // –°–±–æ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
    go func() {
        wg.Wait()
        close(resultsChan)
    }()
    
    sources := []RecommendationSource{}
    for source := range resultsChan {
        sources = append(sources, source)
    }
    
    // Mixing —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
    feed := r.mixSources(sources, page)
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è
    r.applyUserPreferences(feed, userID)
    
    // –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
    r.deduplicateItems(feed)
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
    r.ensureDiversity(feed)
    
    return feed, nil
}

// –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–º–µ—à–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
func (r *HybridRecommender) mixSources(sources []RecommendationSource, page int) *PersonalizedFeed {
    feed := &PersonalizedFeed{
        Items: []FeedItem{},
        Page:  page,
    }
    
    // Round-robin —Å —É—á–µ—Ç–æ–º –≤–µ—Å–æ–≤
    maxItems := 20
    addedCount := make(map[string]int)
    
    for len(feed.Items) < maxItems {
        added := false
        
        for _, source := range sources {
            // –ü—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ—Å–∞
            targetCount := int(float64(maxItems) * source.Weight)
            if addedCount[source.Type] >= targetCount {
                continue
            }
            
            // –ë–µ—Ä–µ–º —Å–ª–µ–¥—É—é—â–∏–π —ç–ª–µ–º–µ–Ω—Ç –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
            idx := addedCount[source.Type]
            if idx < len(source.Items) {
                item := source.Items[idx]
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã
                if !r.feedContainsItem(feed, item.Item.ID) {
                    feed.Items = append(feed.Items, FeedItem{
                        Item:             item.Item,
                        Score:           item.Score,
                        RecommendationType: source.Type,
                        Position:        len(feed.Items) + 1,
                    })
                    added = true
                }
                
                addedCount[source.Type]++
            }
        }
        
        // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏, –≤—ã—Ö–æ–¥–∏–º
        if !added {
            break
        }
    }
    
    return feed
}
```

### 6. Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
```go
// realtime_updater.go
func (u *RealtimeUpdater) ProcessUserEvent(event UserEvent) {
    // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
    shortTermProfile := u.getShortTermProfile(event.UserID)
    
    switch event.Type {
    case "search":
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤
        u.updateSearchContext(shortTermProfile, event.Query)
        
    case "item_view":
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –Ω–µ–¥–∞–≤–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–µ
        u.addToRecentlyViewed(shortTermProfile, event.ItemID)
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
        item, _ := u.itemService.GetItem(event.ItemID)
        u.updateCategoryPreference(shortTermProfile, item.CategoryID, 1.0)
        
    case "add_to_cart":
        // –°–∏–ª—å–Ω—ã–π —Å–∏–≥–Ω–∞–ª –∏–Ω—Ç–µ—Ä–µ—Å–∞
        u.updateStrongInterest(shortTermProfile, event.ItemID)
    }
    
    // –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
    u.invalidateUserCache(event.UserID)
    
    // Trigger –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
    if u.isUserActive(event.UserID) {
        go u.triggerRecommendationRefresh(event.UserID)
    }
}

// WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è SPA
func (u *RealtimeUpdater) StreamRecommendationUpdates(userID int, conn *websocket.Conn) {
    ticker := time.NewTicker(30 * time.Second)
    defer ticker.Stop()
    
    lastVersion := ""
    
    for {
        select {
        case <-ticker.C:
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö
            currentVersion := u.getRecommendationVersion(userID)
            if currentVersion != lastVersion {
                // –û—Ç–ø—Ä–∞–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
                updates := u.getIncrementalUpdates(userID, lastVersion)
                
                if err := conn.WriteJSON(updates); err != nil {
                    return
                }
                
                lastVersion = currentVersion
            }
            
        case event := <-u.userEventChan:
            if event.UserID == userID {
                // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                u.ProcessUserEvent(event)
            }
        }
    }
}
```

### 7. A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
```go
// ab_testing.go
type ExperimentConfig struct {
    Name            string
    StartDate       time.Time
    EndDate         time.Time
    TrafficPercent  float64
    Variants        []Variant
    SuccessMetrics  []string
}

func (a *ABTestingService) GetRecommendationVariant(userID int) Variant {
    // –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ user_id
    experiments := a.getActiveExperiments()
    
    for _, exp := range experiments {
        if a.isUserInExperiment(userID, exp) {
            // Consistent hashing –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
            hash := xxhash.Sum64([]byte(fmt.Sprintf("%d-%s", userID, exp.Name)))
            variantIndex := int(hash % uint64(len(exp.Variants)))
            
            variant := exp.Variants[variantIndex]
            
            // Tracking assignment
            a.trackAssignment(userID, exp.Name, variant.Name)
            
            return variant
        }
    }
    
    return a.defaultVariant
}

// –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞
func (r *RecommendationEngine) ApplyExperimentVariant(variant Variant, params *RecommendationParams) {
    config := variant.Config
    
    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
    if weight, ok := config["collaborative_weight"]; ok {
        params.CollaborativeWeight = weight.(float64)
    }
    
    if diversityFactor, ok := config["diversity_factor"]; ok {
        params.DiversityFactor = diversityFactor.(float64)
    }
    
    if algorithm, ok := config["algorithm"]; ok {
        params.Algorithm = algorithm.(string)
    }
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã
    switch variant.Name {
    case "neural_collaborative_filtering":
        params.UseNeuralCF = true
        
    case "context_aware_recommendations":
        params.IncludeContext = true
        params.ContextFeatures = []string{"time_of_day", "day_of_week", "weather"}
        
    case "exploration_boost":
        params.ExplorationRate = 0.3 // –ë–æ–ª—å—à–µ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
    }
}
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
1. **–ê–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö ID
2. **Differential privacy** - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —à—É–º–∞ –≤ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
3. **–ü—Ä–∞–≤–æ –Ω–∞ –∑–∞–±–≤–µ–Ω–∏–µ** - —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∑–∞–ø—Ä–æ—Å—É
4. **–§–µ–¥–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ** - –º–æ–¥–µ–ª–∏ –±–µ–∑ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### –ó–∞—â–∏—Ç–∞ –æ—Ç –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π
```go
// –î–µ—Ç–µ–∫—Ü–∏—è –Ω–∞–∫—Ä—É—Ç–æ–∫ –∏ –∞–Ω–æ–º–∞–ª–∏–π
func (s *AnomalyDetector) DetectManipulation(userID int, events []UserEvent) bool {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∞—Å—Ç–æ—Ç—ã —Å–æ–±—ã—Ç–∏–π
    eventRate := float64(len(events)) / time.Since(events[0].Timestamp).Minutes()
    if eventRate > s.config.MaxEventRate {
        return true
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
    patterns := s.analyzePatterns(events)
    
    // –°–ª–∏—à–∫–æ–º —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –∫–ª–∏–∫–∏
    if patterns.RegularityScore > 0.9 {
        return true
    }
    
    // –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (—Ç–æ–ª—å–∫–æ –¥–æ—Ä–æ–≥–∏–µ —Ç–æ–≤–∞—Ä—ã)
    if patterns.AveragePriceViewed > patterns.MarketAverage * 5 {
        return true
    }
    
    // ML-based anomaly detection
    features := s.extractFeatures(events)
    anomalyScore := s.model.Predict(features)
    
    return anomalyScore > s.config.AnomalyThreshold
}
```

## üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –º–µ—Ç—Ä–∏–∫–∏

### KPI —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
```sql
-- –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
WITH recommendation_stats AS (
    SELECT 
        DATE(timestamp) as date,
        recommendation_type,
        COUNT(DISTINCT session_id) as unique_sessions,
        COUNT(*) as total_impressions,
        COUNT(CASE WHEN clicked = true THEN 1 END) as clicks,
        COUNT(CASE WHEN purchased = true THEN 1 END) as purchases,
        SUM(CASE WHEN purchased = true THEN purchase_amount ELSE 0 END) as revenue,
        AVG(position) as avg_position,
        AVG(CASE WHEN clicked = true THEN dwell_time ELSE NULL END) as avg_dwell_time
    FROM recommendation_events
    WHERE timestamp >= CURRENT_DATE - INTERVAL '30 days'
    GROUP BY DATE(timestamp), recommendation_type
)
SELECT 
    date,
    recommendation_type,
    clicks::float / NULLIF(total_impressions, 0) * 100 as ctr,
    purchases::float / NULLIF(clicks, 0) * 100 as conversion_rate,
    revenue / NULLIF(purchases, 0) as avg_order_value,
    purchases::float / NULLIF(unique_sessions, 0) as purchases_per_session,
    avg_position,
    avg_dwell_time
FROM recommendation_stats
ORDER BY date DESC, ctr DESC;
```

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞
- **CTR (Click-through rate)**: > 5% –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
- **Conversion rate**: > 2% –æ—Ç –∫–ª–∏–∫–æ–≤
- **Coverage**: > 80% –∫–∞—Ç–∞–ª–æ–≥–∞ –≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è—Ö
- **Diversity**: > 0.7 –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- **Novelty**: 30% –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **Serendipity**: 10% –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –Ω–∞—Ö–æ–¥–æ–∫

### User satisfaction –º–µ—Ç—Ä–∏–∫–∏
```go
// Implicit satisfaction signals
type SatisfactionSignals struct {
    DwellTime        time.Duration // –í—Ä–µ–º—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ç–æ–≤–∞—Ä–∞
    ScrollDepth      float64       // –ì–ª—É–±–∏–Ω–∞ —Å–∫—Ä–æ–ª–ª–∞
    InteractionCount int           // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–π—Å—Ç–≤–∏–π
    ReturnVisits     int           // –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã
    AddToCartRate    float64       // –ü—Ä–æ—Ü–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏–π –≤ –∫–æ—Ä–∑–∏–Ω—É
    PurchaseRate     float64       // –ü—Ä–æ—Ü–µ–Ω—Ç –ø–æ–∫—É–ø–æ–∫
}

func (a *Analytics) CalculateSatisfactionScore(signals SatisfactionSignals) float64 {
    score := 0.0
    
    // Weighted scoring
    score += min(signals.DwellTime.Seconds() / 60, 1.0) * 0.2  // –î–æ 1 –º–∏–Ω—É—Ç—ã
    score += signals.ScrollDepth * 0.15
    score += min(float64(signals.InteractionCount) / 5, 1.0) * 0.15
    score += min(float64(signals.ReturnVisits) / 3, 1.0) * 0.1
    score += signals.AddToCartRate * 0.2
    score += signals.PurchaseRate * 0.2
    
    return score
}
```

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
```go
// Multi-level caching
type RecommendationCache struct {
    l1Cache *ristretto.Cache // In-memory, hot data
    l2Cache *redis.Client    // Redis, warm data
    l3Cache *s3.Client      // S3, cold data
}

func (c *RecommendationCache) GetRecommendations(userID int, recType string) ([]Item, error) {
    key := fmt.Sprintf("rec:%d:%s", userID, recType)
    
    // L1: In-memory cache (< 100ms)
    if val, found := c.l1Cache.Get(key); found {
        return val.([]Item), nil
    }
    
    // L2: Redis cache (< 500ms)
    if val, err := c.l2Cache.Get(ctx, key).Result(); err == nil {
        items := c.deserializeItems(val)
        c.l1Cache.Set(key, items, 1) // Promote to L1
        return items, nil
    }
    
    // L3: S3 pre-computed (< 2s)
    if val, err := c.getFromS3(key); err == nil {
        items := c.deserializeItems(val)
        c.promoteToUpperCaches(key, items)
        return items, nil
    }
    
    // Cache miss - compute
    items, err := c.computeRecommendations(userID, recType)
    if err != nil {
        return nil, err
    }
    
    // Async population of all cache levels
    go c.populateCaches(key, items)
    
    return items, nil
}
```

### –ü—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
```go
// Batch pre-computation
func (p *PrecomputeService) PrecomputeRecommendations() {
    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    activeUsers := p.getActiveUsers(24 * time.Hour)
    
    // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≤–æ—Ä–∫–µ—Ä–∞–º
    userBatches := p.batchUsers(activeUsers, 1000)
    
    var wg sync.WaitGroup
    for _, batch := range userBatches {
        wg.Add(1)
        go func(users []int) {
            defer wg.Done()
            
            for _, userID := range users {
                // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
                recommendations := map[string][]Item{
                    "personalized": p.computePersonalized(userID),
                    "similar":      p.computeSimilar(userID),
                    "trending":     p.computeTrending(userID),
                    "seasonal":     p.computeSeasonal(userID),
                }
                
                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ S3 —Å TTL
                p.saveToS3(userID, recommendations, 24*time.Hour)
            }
        }(batch)
    }
    
    wg.Wait()
}
```

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
```go
// HNSW index –¥–ª—è approximate nearest neighbors
type VectorIndex struct {
    index *hnswlib.Index
    dim   int
}

func (v *VectorIndex) BuildIndex(items []ItemEmbedding) error {
    // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã HNSW
    v.index = hnswlib.New(
        v.dim,
        hnswlib.CosineDistance,
        hnswlib.Config{
            M:              16,  // Connectivity parameter
            EfConstruction: 200, // Accuracy/speed tradeoff
            Seed:           42,
        },
    )
    
    // Batch –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–æ–≤
    for _, item := range items {
        v.index.Add(item.Vector, item.ID)
    }
    
    // –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞
    v.index.Build()
    
    return nil
}

// –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö
func (v *VectorIndex) SearchSimilar(query []float32, k int) ([]int, []float32, error) {
    // ef parameter –¥–ª—è runtime accuracy
    v.index.SetEf(50)
    
    ids, distances := v.index.SearchKNN(query, k)
    
    return ids, distances, nil
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Offline evaluation
```python
# evaluate_model.py
def evaluate_recommendations(test_data, model):
    metrics = {
        'precision_at_k': [],
        'recall_at_k': [],
        'ndcg_at_k': [],
        'coverage': set(),
        'diversity': []
    }
    
    for user_id, actual_items in test_data.items():
        # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
        recommended = model.predict(user_id, k=10)
        
        # Precision@K
        relevant = len(set(recommended) & set(actual_items))
        metrics['precision_at_k'].append(relevant / len(recommended))
        
        # Recall@K
        metrics['recall_at_k'].append(relevant / len(actual_items))
        
        # NDCG@K
        ndcg = calculate_ndcg(recommended, actual_items)
        metrics['ndcg_at_k'].append(ndcg)
        
        # Coverage
        metrics['coverage'].update(recommended)
        
        # Diversity
        diversity = calculate_diversity(recommended)
        metrics['diversity'].append(diversity)
    
    return {
        'precision@10': np.mean(metrics['precision_at_k']),
        'recall@10': np.mean(metrics['recall_at_k']),
        'ndcg@10': np.mean(metrics['ndcg_at_k']),
        'catalog_coverage': len(metrics['coverage']) / total_items,
        'avg_diversity': np.mean(metrics['diversity'])
    }
```

### Online A/B testing
```go
func TestRecommendationQuality(t *testing.T) {
    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º–∏
    testUsers := createTestUsers(100)
    
    // –°–∏–º—É–ª—è—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è
    for _, user := range testUsers {
        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–æ—Ñ–∏–ª—è
        events := simulateUserBehavior(user)
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
        for _, event := range events {
            engine.ProcessEvent(event)
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
        recommendations := engine.GetRecommendations(user.ID, 10)
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞
        relevanceScore := calculateRelevance(recommendations, user.Preferences)
        assert.Greater(t, relevanceScore, 0.7, "Low relevance score")
        
        diversityScore := calculateDiversity(recommendations)
        assert.Greater(t, diversityScore, 0.5, "Low diversity")
    }
}
```

## üåç –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫—É–ª—å—Ç—É—Ä–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è
```go
type RegionalPreferences struct {
    Country        string
    PopularCategories []int
    PriceMultiplier   float64
    PreferredBrands   []string
    SeasonalTrends    map[string][]string // season -> trending categories
}

var serbianPreferences = RegionalPreferences{
    Country: "RS",
    PopularCategories: []int{
        1,  // –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞
        5,  // –û–¥–µ–∂–¥–∞
        12, // –î–æ–º –∏ —Å–∞–¥
        18, // –°–ø–æ—Ä—Ç
    },
    PriceMultiplier: 0.8, // –ù–∏–∂–µ —Å—Ä–µ–¥–Ω–∏—Ö —Ü–µ–Ω –ø–æ –ï–≤—Ä–æ–ø–µ
    PreferredBrands: []string{"Gorenje", "Atlantic Grupa", "Nectar"},
    SeasonalTrends: map[string][]string{
        "summer": {"outdoor", "sports", "travel"},
        "winter": {"heating", "winter_clothes", "skiing"},
        "slava": {"decorations", "food", "gifts"}, // –°–µ–º–µ–π–Ω—ã–π –ø—Ä–∞–∑–¥–Ω–∏–∫
    },
}
```

### –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω—ã–µ embeddings
```go
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ multilingual BERT –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö features
func (e *EmbeddingService) GetMultilingualEmbedding(text string) ([]float32, error) {
    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞
    lang := e.detectLanguage(text)
    
    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –º–æ–¥–µ–ª–∏
    var embedding []float32
    switch lang {
    case "sr": // –°–µ—Ä–±—Å–∫–∏–π
        embedding = e.serbianBERT.Encode(text)
    case "en": // –ê–Ω–≥–ª–∏–π—Å–∫–∏–π
        embedding = e.englishBERT.Encode(text)
    default:
        // Fallback –Ω–∞ multilingual model
        embedding = e.multiBERT.Encode(text)
    }
    
    return embedding, nil
}
```

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Cold start problem** - –Ω–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ –∏—Å—Ç–æ—Ä–∏–∏
2. **–í—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å** - O(n*m) –¥–ª—è collaborative
3. **–ó–∞–¥–µ—Ä–∂–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - –¥–æ 5 –º–∏–Ω—É—Ç –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π
4. **–†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏** - –¥–æ 1GB –¥–ª—è neural collaborative filtering

## üîÑ –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

1. **[–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è](search-filtering.md)** - –∏—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
2. **[–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π](user-communication.md)** - —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–≥–Ω–∞–ª—ã
3. **[–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂](sales-analytics.md)** - –¥–∞–Ω–Ω—ã–µ –æ –∫–æ–Ω–≤–µ—Ä—Å–∏—è—Ö
4. **[–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏](product-management-storefront.md)** - –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–æ–≤

## üìà –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **Reinforcement Learning** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ engagement
2. **Graph Neural Networks** - —É—á–µ—Ç —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –≥—Ä–∞—Ñ–∞
3. **Multimodal —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** - –∫–æ–º–±–∏–Ω–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
4. **Real-time personalization** - < 100ms latency
5. **Explainable AI** - –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π