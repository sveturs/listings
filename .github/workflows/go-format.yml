name: Go Format Check

on:
  pull_request:
    paths:
      - 'backend/**/*.go'
      - 'backend/go.mod'
      - 'backend/go.sum'

permissions:
  contents: read
  packages: read

jobs:
  format-check:
    name: Check Go Code Formatting
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Configure Git for private modules
        run: |
          git config --global url."https://${{ secrets.PRIVATE_MODULES_TOKEN }}@github.com/".insteadOf "https://github.com/"

      - name: Set GOPRIVATE
        run: echo "GOPRIVATE=github.com/sveturs/*" >> $GITHUB_ENV

      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'

      - name: Check Go formatting
        working-directory: ./backend
        run: make format-check

      - name: Run golangci-lint
        working-directory: ./backend
        run: make lint

      # - name: Comment on PR if formatting needed
      #   if: failure()
      #   uses: actions/github-script@v6
      #   with:
      #     script: |
      #       github.rest.issues.createComment({
      #         issue_number: context.issue.number,
      #         owner: context.repo.owner,
      #         repo: context.repo.repo,
      #         body: `‚ùå **Go Code Formatting Check Failed**

      #         Your Go code needs formatting. Please run the following commands in the \`backend\` directory:

      #         \`\`\`bash
      #         cd backend
      #         make format
      #         \`\`\`

      #         This will format your code with \`gofumpt\` and fix import statements with \`goimports\`.

      #         Then commit and push the changes.`
      #       })
