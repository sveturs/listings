'use client';

import { useState, useEffect, useRef } from 'react';
import { useTranslations } from 'next-intl';

interface EmojiPickerProps {
  onSelect: (emoji: string) => void;
  onClose: () => void;
}

const EMOJI_CATEGORIES = {
  all: [], // Will be populated with all emojis
  recent: [],
  smileys: [
    'ğŸ˜€',
    'ğŸ˜ƒ',
    'ğŸ˜„',
    'ğŸ˜',
    'ğŸ˜…',
    'ğŸ˜‚',
    'ğŸ¤£',
    'ğŸ˜Š',
    'ğŸ˜‡',
    'ğŸ™‚',
    'ğŸ˜‰',
    'ğŸ˜Œ',
    'ğŸ˜',
    'ğŸ¥°',
    'ğŸ˜˜',
    'ğŸ˜—',
    'ğŸ˜™',
    'ğŸ˜š',
    'ğŸ˜‹',
    'ğŸ˜›',
    'ğŸ˜œ',
    'ğŸ¤ª',
    'ğŸ˜',
    'ğŸ¤‘',
    'ğŸ¤—',
    'ğŸ¤­',
    'ğŸ¤«',
    'ğŸ¤”',
    'ğŸ¤',
    'ğŸ¤¨',
    'ğŸ˜',
    'ğŸ˜‘',
    'ğŸ˜¶',
    'ğŸ˜',
    'ğŸ˜’',
    'ğŸ™„',
    'ğŸ˜¬',
    'ğŸ¤¥',
    'ğŸ˜Œ',
    'ğŸ˜”',
    'ğŸ˜ª',
    'ğŸ¤¤',
    'ğŸ˜´',
    'ğŸ˜·',
    'ğŸ¤’',
    'ğŸ¤•',
    'ğŸ¤¢',
    'ğŸ¤®',
    'ğŸ¤§',
    'ğŸ¥µ',
    'ğŸ¥¶',
    'ğŸ¥´',
    'ğŸ˜µ',
    'ğŸ¤¯',
    'ğŸ¤ ',
    'ğŸ¥³',
    'ğŸ˜',
    'ğŸ¤“',
    'ğŸ§',
    'ğŸ˜•',
    'ğŸ˜Ÿ',
    'ğŸ™',
    'â˜¹ï¸',
    'ğŸ˜®',
    'ğŸ˜¯',
    'ğŸ˜²',
    'ğŸ˜³',
    'ğŸ¥º',
    'ğŸ˜¦',
    'ğŸ˜§',
    'ğŸ˜¨',
    'ğŸ˜°',
    'ğŸ˜¥',
    'ğŸ˜¢',
    'ğŸ˜­',
    'ğŸ˜±',
    'ğŸ˜–',
    'ğŸ˜£',
    'ğŸ˜',
    'ğŸ˜“',
    'ğŸ˜©',
    'ğŸ˜«',
    'ğŸ¥±',
    'ğŸ˜¤',
    'ğŸ˜¡',
    'ğŸ˜ ',
    'ğŸ¤¬',
    'ğŸ˜ˆ',
    'ğŸ‘¿',
    'ğŸ’€',
    'â˜ ï¸',
    'ğŸ’©',
    'ğŸ¤¡',
    'ğŸ‘¹',
    'ğŸ‘º',
    'ğŸ‘»',
    'ğŸ‘½',
    'ğŸ‘¾',
    'ğŸ¤–',
  ],
  gestures: [
    'ğŸ‘‹',
    'ğŸ¤š',
    'ğŸ–',
    'âœ‹',
    'ğŸ––',
    'ğŸ‘Œ',
    'âœŒï¸',
    'ğŸ¤',
    'ğŸ¤Ÿ',
    'ğŸ¤˜',
    'ğŸ¤™',
    'ğŸ‘ˆ',
    'ğŸ‘‰',
    'ğŸ‘†',
    'ğŸ–•',
    'ğŸ‘‡',
    'â˜ï¸',
    'ğŸ‘',
    'ğŸ‘',
    'ğŸ‘Š',
    'âœŠ',
    'ğŸ¤›',
    'ğŸ¤œ',
    'ğŸ‘',
    'ğŸ™Œ',
    'ğŸ‘',
    'ğŸ¤²',
    'ğŸ¤',
    'ğŸ™',
    'âœï¸',
    'ğŸ’…',
    'ğŸ¤³',
    'ğŸ’ª',
  ],
  hearts: [
    'â¤ï¸',
    'ğŸ§¡',
    'ğŸ’›',
    'ğŸ’š',
    'ğŸ’™',
    'ğŸ’œ',
    'ğŸ–¤',
    'ğŸ¤',
    'ğŸ¤',
    'ğŸ’”',
    'â£ï¸',
    'ğŸ’•',
    'ğŸ’',
    'ğŸ’“',
    'ğŸ’—',
    'ğŸ’–',
    'ğŸ’˜',
    'ğŸ’',
  ],
  animals: [
    'ğŸ¶',
    'ğŸ±',
    'ğŸ­',
    'ğŸ¹',
    'ğŸ°',
    'ğŸ¦Š',
    'ğŸ»',
    'ğŸ¼',
    'ğŸ¨',
    'ğŸ¯',
    'ğŸ¦',
    'ğŸ®',
    'ğŸ·',
    'ğŸ½',
    'ğŸ¸',
    'ğŸµ',
    'ğŸ™ˆ',
    'ğŸ™‰',
    'ğŸ™Š',
    'ğŸ’',
    'ğŸ”',
    'ğŸ§',
    'ğŸ¦',
    'ğŸ¤',
    'ğŸ£',
    'ğŸ¥',
    'ğŸ¦†',
    'ğŸ¦…',
    'ğŸ¦‰',
    'ğŸ¦‡',
    'ğŸº',
    'ğŸ—',
    'ğŸ´',
    'ğŸ¦„',
    'ğŸ',
    'ğŸ›',
    'ğŸ¦‹',
    'ğŸŒ',
    'ğŸ',
    'ğŸœ',
    'ğŸ¦Ÿ',
    'ğŸ¦—',
    'ğŸ•·',
    'ğŸ•¸',
    'ğŸ¦‚',
    'ğŸ¢',
    'ğŸ',
    'ğŸ¦',
    'ğŸ¦–',
    'ğŸ¦•',
    'ğŸ™',
    'ğŸ¦‘',
    'ğŸ¦',
    'ğŸ¦',
    'ğŸ¦€',
    'ğŸ¡',
    'ğŸ ',
    'ğŸŸ',
    'ğŸ¬',
    'ğŸ³',
    'ğŸ‹',
    'ğŸ¦ˆ',
    'ğŸŠ',
    'ğŸ…',
    'ğŸ†',
    'ğŸ¦“',
    'ğŸ¦',
    'ğŸ¦§',
    'ğŸ˜',
    'ğŸ¦›',
    'ğŸ¦',
    'ğŸª',
    'ğŸ«',
    'ğŸ¦’',
    'ğŸ¦˜',
    'ğŸƒ',
    'ğŸ‚',
    'ğŸ„',
    'ğŸ',
    'ğŸ–',
    'ğŸ',
    'ğŸ‘',
    'ğŸ¦™',
    'ğŸ',
    'ğŸ¦Œ',
    'ğŸ•',
    'ğŸ©',
    'ğŸ¦®',
    'ğŸ•â€ğŸ¦º',
    'ğŸˆ',
    'ğŸˆâ€â¬›',
    'ğŸ“',
    'ğŸ¦ƒ',
    'ğŸ¦š',
    'ğŸ¦œ',
    'ğŸ¦¢',
    'ğŸ¦©',
    'ğŸ•Š',
    'ğŸ‡',
    'ğŸ¦',
    'ğŸ¦¨',
    'ğŸ¦¡',
    'ğŸ¦¦',
    'ğŸ¦¥',
    'ğŸ',
    'ğŸ€',
    'ğŸ¿',
    'ğŸ¦”',
  ],
  food: [
    'ğŸ',
    'ğŸ',
    'ğŸ',
    'ğŸŠ',
    'ğŸ‹',
    'ğŸŒ',
    'ğŸ‰',
    'ğŸ‡',
    'ğŸ“',
    'ğŸˆ',
    'ğŸ’',
    'ğŸ‘',
    'ğŸ¥­',
    'ğŸ',
    'ğŸ¥¥',
    'ğŸ¥',
    'ğŸ…',
    'ğŸ†',
    'ğŸ¥‘',
    'ğŸ¥¦',
    'ğŸ¥¬',
    'ğŸ¥’',
    'ğŸŒ¶',
    'ğŸŒ½',
    'ğŸ¥•',
    'ğŸ§„',
    'ğŸ§…',
    'ğŸ¥”',
    'ğŸ ',
    'ğŸ¥',
    'ğŸ¥–',
    'ğŸ',
    'ğŸ¥¨',
    'ğŸ¥¯',
    'ğŸ§€',
    'ğŸ¥š',
    'ğŸ³',
    'ğŸ§ˆ',
    'ğŸ¥',
    'ğŸ§‡',
    'ğŸ¥“',
    'ğŸ¥©',
    'ğŸ—',
    'ğŸ–',
    'ğŸŒ­',
    'ğŸ”',
    'ğŸŸ',
    'ğŸ•',
    'ğŸ¥ª',
    'ğŸ¥™',
    'ğŸ§†',
    'ğŸŒ®',
    'ğŸŒ¯',
    'ğŸ¥—',
    'ğŸ¥˜',
    'ğŸ¥«',
    'ğŸ',
    'ğŸœ',
    'ğŸ²',
    'ğŸ›',
    'ğŸ£',
    'ğŸ±',
    'ğŸ¥Ÿ',
    'ğŸ¦ª',
    'ğŸ¤',
    'ğŸ™',
    'ğŸš',
    'ğŸ˜',
    'ğŸ¥',
    'ğŸ¥ ',
    'ğŸ¥®',
    'ğŸ¢',
    'ğŸ¡',
    'ğŸ§',
    'ğŸ¨',
    'ğŸ¦',
    'ğŸ¥§',
    'ğŸ§',
    'ğŸ°',
    'ğŸ‚',
    'ğŸ®',
    'ğŸ­',
    'ğŸ¬',
    'ğŸ«',
    'ğŸ¿',
    'ğŸ©',
    'ğŸª',
    'ğŸŒ°',
    'ğŸ¥œ',
    'ğŸ¯',
    'ğŸ¥›',
    'ğŸ¼',
    'â˜•',
    'ğŸµ',
    'ğŸ§ƒ',
    'ğŸ¥¤',
    'ğŸ¶',
    'ğŸº',
    'ğŸ»',
    'ğŸ¥‚',
    'ğŸ·',
    'ğŸ¥ƒ',
    'ğŸ¸',
    'ğŸ¹',
    'ğŸ§‰',
    'ğŸ¾',
    'ğŸ§Š',
  ],
  objects: [
    'âŒš',
    'ğŸ“±',
    'ğŸ“²',
    'ğŸ’»',
    'âŒ¨ï¸',
    'ğŸ–¥',
    'ğŸ–¨',
    'ğŸ–±',
    'ğŸ–²',
    'ğŸ•¹',
    'ğŸ—œ',
    'ğŸ’½',
    'ğŸ’¾',
    'ğŸ’¿',
    'ğŸ“€',
    'ğŸ“¼',
    'ğŸ“·',
    'ğŸ“¸',
    'ğŸ“¹',
    'ğŸ¥',
    'ğŸ“½',
    'ğŸ',
    'ğŸ“',
    'â˜ï¸',
    'ğŸ“Ÿ',
    'ğŸ“ ',
    'ğŸ“º',
    'ğŸ“»',
    'ğŸ™',
    'ğŸš',
    'ğŸ›',
    'ğŸ§­',
    'â±',
    'â²',
    'â°',
    'ğŸ•°',
    'âŒ›',
    'â³',
    'ğŸ“¡',
    'ğŸ”‹',
    'ğŸ”Œ',
    'ğŸ’¡',
    'ğŸ”¦',
    'ğŸ•¯',
    'ğŸ§¯',
    'ğŸ›¢',
    'ğŸ’¸',
    'ğŸ’µ',
    'ğŸ’´',
    'ğŸ’¶',
    'ğŸ’·',
    'ğŸ’°',
    'ğŸ’³',
    'ğŸ’',
    'âš–ï¸',
    'ğŸ§°',
    'ğŸ”§',
    'ğŸ”¨',
    'âš’',
    'ğŸ› ',
    'â›',
    'ğŸ”©',
    'âš™ï¸',
    'ğŸ§±',
    'â›“',
    'ğŸ§²',
    'ğŸ”«',
    'ğŸ’£',
    'ğŸ§¨',
    'ğŸª“',
    'ğŸ”ª',
    'ğŸ—¡',
    'âš”ï¸',
    'ğŸ›¡',
    'ğŸš¬',
    'âš°ï¸',
    'âš±ï¸',
    'ğŸº',
    'ğŸ”®',
    'ğŸ“¿',
    'ğŸ§¿',
    'ğŸ’ˆ',
    'âš—ï¸',
    'ğŸ”­',
    'ğŸ”¬',
    'ğŸ•³',
    'ğŸ©¹',
    'ğŸ©º',
    'ğŸ’Š',
    'ğŸ’‰',
    'ğŸ©¸',
    'ğŸ§¬',
    'ğŸ¦ ',
    'ğŸ§«',
    'ğŸ§ª',
    'ğŸŒ¡',
    'ğŸ§¹',
    'ğŸ§º',
    'ğŸ§»',
    'ğŸš½',
    'ğŸš°',
    'ğŸš¿',
    'ğŸ›',
    'ğŸ›€',
    'ğŸ§¼',
    'ğŸª’',
    'ğŸ§½',
    'ğŸ§´',
    'ğŸ›',
    'ğŸ”‘',
    'ğŸ—',
    'ğŸšª',
    'ğŸª‘',
    'ğŸ›‹',
    'ğŸ›',
    'ğŸ›Œ',
    'ğŸ§¸',
    'ğŸ–¼',
    'ğŸ›',
    'ğŸ›’',
    'ğŸ',
    'ğŸˆ',
    'ğŸ',
    'ğŸ€',
    'ğŸŠ',
    'ğŸ‰',
    'ğŸ',
    'ğŸ®',
    'ğŸ',
    'ğŸ§§',
    'âœ‰ï¸',
    'ğŸ“©',
    'ğŸ“¨',
    'ğŸ“§',
    'ğŸ’Œ',
    'ğŸ“¥',
    'ğŸ“¤',
    'ğŸ“¦',
    'ğŸ·',
    'ğŸ“ª',
    'ğŸ“«',
    'ğŸ“¬',
    'ğŸ“­',
    'ğŸ“®',
    'ğŸ“¯',
    'ğŸ“œ',
    'ğŸ“ƒ',
    'ğŸ“„',
    'ğŸ“‘',
    'ğŸ§¾',
    'ğŸ“Š',
    'ğŸ“ˆ',
    'ğŸ“‰',
    'ğŸ—’',
    'ğŸ—“',
    'ğŸ“†',
    'ğŸ“…',
    'ğŸ—‘',
    'ğŸ“‡',
    'ğŸ—ƒ',
    'ğŸ—³',
    'ğŸ—„',
    'ğŸ“‹',
    'ğŸ“',
    'ğŸ“‚',
    'ğŸ—‚',
    'ğŸ—',
    'ğŸ“°',
    'ğŸ““',
    'ğŸ“”',
    'ğŸ“’',
    'ğŸ“•',
    'ğŸ“—',
    'ğŸ“˜',
    'ğŸ“™',
    'ğŸ“š',
    'ğŸ“–',
    'ğŸ”–',
    'ğŸ§·',
    'ğŸ”—',
    'ğŸ“',
    'ğŸ–‡',
    'ğŸ“',
    'ğŸ“',
    'ğŸ§®',
    'ğŸ“Œ',
    'ğŸ“',
    'âœ‚ï¸',
    'ğŸ–Š',
    'ğŸ–‹',
    'âœ’ï¸',
    'ğŸ–Œ',
    'ğŸ–',
    'ğŸ“',
    'âœï¸',
    'ğŸ”',
    'ğŸ”',
    'ğŸ”',
    'ğŸ”',
    'ğŸ”’',
    'ğŸ”“',
  ],
};

export default function EmojiPicker({ onSelect, onClose }: EmojiPickerProps) {
  const t = useTranslations('chat');
  const [selectedCategory, setSelectedCategory] =
    useState<keyof typeof EMOJI_CATEGORIES>('all');
  const [recentEmojis, setRecentEmojis] = useState<string[]>([]);
  const pickerRef = useRef<HTMLDivElement>(null);

  // Ğ¡Ğ¾Ğ·Ğ´Ğ°ĞµĞ¼ Ğ¼Ğ°ÑÑĞ¸Ğ² Ğ²ÑĞµÑ… ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ´Ğ»Ñ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ 'all'
  const allEmojis = [
    ...EMOJI_CATEGORIES.smileys,
    ...EMOJI_CATEGORIES.gestures,
    ...EMOJI_CATEGORIES.hearts,
    ...EMOJI_CATEGORIES.animals,
    ...EMOJI_CATEGORIES.food,
    ...EMOJI_CATEGORIES.objects,
  ];

  // Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğµ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸ Ğ¸Ğ· localStorage
  useEffect(() => {
    const saved = localStorage.getItem('recentEmojis');
    if (saved) {
      setRecentEmojis(JSON.parse(saved));
    }
  }, []);

  // Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ Ğ¿Ñ€Ğ¸ ĞºĞ»Ğ¸ĞºĞµ Ğ²Ğ½Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (
        pickerRef.current &&
        !pickerRef.current.contains(event.target as Node)
      ) {
        onClose();
      }
    };

    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, [onClose]);

  const handleEmojiClick = (emoji: string) => {
    onSelect(emoji);

    // ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ½ĞµĞ´Ğ°Ğ²Ğ½Ğ¸Ğµ ÑĞ¼Ğ¾Ğ´Ğ·Ğ¸
    const updated = [emoji, ...recentEmojis.filter((e) => e !== emoji)].slice(
      0,
      20
    );
    setRecentEmojis(updated);
    localStorage.setItem('recentEmojis', JSON.stringify(updated));
  };

  const getCategoryEmojis = () => {
    if (selectedCategory === 'all') {
      return allEmojis;
    }
    if (selectedCategory === 'recent') {
      return recentEmojis;
    }

    return EMOJI_CATEGORIES[selectedCategory];
  };

  const categoryIcons: Record<keyof typeof EMOJI_CATEGORIES, string> = {
    all: 'ğŸŒŸ',
    recent: 'ğŸ•',
    smileys: 'ğŸ˜€',
    gestures: 'ğŸ‘‹',
    hearts: 'â¤ï¸',
    animals: 'ğŸ¶',
    food: 'ğŸ',
    objects: 'ğŸ’¡',
  };

  return (
    <div
      ref={pickerRef}
      className="bg-white/85 backdrop-blur-md shadow-2xl border border-gray-200/50 rounded-2xl w-80 sm:w-96 overflow-hidden"
    >
      <div className="p-3">
        {/* ĞšĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸ */}
        <div className="mb-3 bg-gray-50/80 backdrop-blur-sm rounded-xl p-1">
          <div
            className="flex items-center overflow-x-auto scrollbar-none gap-1"
            style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}
          >
            {Object.keys(EMOJI_CATEGORIES).map((category) => (
              <button
                key={category}
                className={`flex-shrink-0 px-3 py-2 rounded-lg transition-all duration-200 ${
                  selectedCategory === category
                    ? 'bg-blue-500 text-white shadow-md'
                    : 'hover:bg-gray-100 text-gray-600'
                }`}
                onClick={() =>
                  setSelectedCategory(category as keyof typeof EMOJI_CATEGORIES)
                }
                title={t(`emojiCategory.${category}`)}
              >
                <span className="text-lg">
                  {categoryIcons[category as keyof typeof EMOJI_CATEGORIES]}
                </span>
              </button>
            ))}
          </div>
        </div>

        {/* Ğ­Ğ¼Ğ¾Ğ´Ğ·Ğ¸ */}
        <div className="grid grid-cols-6 gap-1 max-h-56 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100">
          {getCategoryEmojis().map((emoji, index) => (
            <button
              key={`${emoji}-${index}`}
              onClick={() => handleEmojiClick(emoji)}
              className="aspect-square flex items-center justify-center text-2xl hover:bg-blue-50 hover:scale-110 transition-all duration-150 rounded-lg p-1"
            >
              {emoji}
            </button>
          ))}
        </div>

        {/* ĞŸÑƒÑÑ‚Ğ¾Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ */}
        {getCategoryEmojis().length === 0 && (
          <div className="text-center py-8 text-gray-500">
            <div className="text-4xl mb-2">ğŸ˜…</div>
            <p className="text-sm">
              {selectedCategory === 'recent'
                ? t('noRecentEmojis')
                : t('noEmojisFound')}
            </p>
          </div>
        )}
      </div>
    </div>
  );
}
