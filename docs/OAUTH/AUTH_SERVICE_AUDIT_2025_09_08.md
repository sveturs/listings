# üîç –ê—É–¥–∏—Ç —Å–∏—Å—Ç–µ–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Auth Service
**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:** 08.09.2025  
**–ê–≤—Ç–æ—Ä:** Security Audit Team  
**–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã:** v1.0.0 (–º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å)

## üìä –û–±—â–µ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ

### ‚úÖ –°–ò–°–¢–ï–ú–ê –†–ê–ë–û–¢–ê–ï–¢ –ö–û–†–†–ï–ö–¢–ù–û
OAuth –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ Google –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —É—Å–ø–µ—à–Ω–æ –≤—Ö–æ–¥—è—Ç, —Ç–æ–∫–µ–Ω—ã –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è, API –∑–∞–ø—Ä–æ—Å—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã.

**–û—Ü–µ–Ω–∫–∞ –∑—Ä–µ–ª–æ—Å—Ç–∏:** üü¢ **85/100** - Production Ready —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞–º–∏

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –∞—É–¥–∏—Ç

### ‚úÖ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|-----------|--------|--------|
| Auth Service | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ü–æ—Ä—Ç 28080, healthy, uptime 36 –º–∏–Ω—É—Ç |
| PostgreSQL | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ü–æ—Ä—Ç 25432, healthy, 6 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î |
| Redis | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ü–æ—Ä—Ç 26379, healthy, –≥–æ—Ç–æ–≤ –¥–ª—è —Å–µ—Å—Å–∏–π |
| Docker | ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω | –í—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ docker-compose —Ä–∞–±–æ—Ç–∞—é—Ç |

### ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Å–µ—Ä–≤–∏—Å–æ–º
- **USE_AUTH_SERVICE=true** –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω ‚úÖ
- **Proxy middleware** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç –≤—Å–µ `/api/v1/auth/*` –∑–∞–ø—Ä–æ—Å—ã ‚úÖ
- **Backend –≤–∞–ª–∏–¥–∞—Ü–∏—è** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç RS256 —Ç–æ–∫–µ–Ω—ã –æ—Ç auth service ‚úÖ
- **–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á** —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ ‚úÖ

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### ‚úÖ –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è –∏ —Ç–æ–∫–µ–Ω—ã
| –ê—Å–ø–µ–∫—Ç | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|--------|--------|--------|
| JWT –∞–ª–≥–æ—Ä–∏—Ç–º | ‚úÖ RS256 | –ê—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å RSA 2048-bit |
| –ö–ª—é—á–∏ RSA | ‚úÖ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∏ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á–∏ –≤ `/keys/` |
| Token rotation | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | Refresh tokens —Å family tracking |
| Token expiration | ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ | Access: 15 –º–∏–Ω, Refresh: 30 –¥–Ω–µ–π |

### ‚úÖ –ó–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã
| –ú–µ—Ö–∞–Ω–∏–∑–º | –°—Ç–∞—Ç—É—Å | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è |
|----------|--------|--------------|
| Rate limiting | ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω | Login: 5/15–º–∏–Ω, Register: 3/—á–∞—Å |
| CORS | ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π | Credentials=true, Origin –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è |
| CSRF | ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ | State tokens –¥–ª—è OAuth, –Ω–æ –Ω–µ—Ç –æ–±—â–µ–≥–æ CSRF |
| Brute force | ‚úÖ –ó–∞—â–∏—Ç–∞ | Account lock –ø–æ—Å–ª–µ 5 –ø–æ–ø—ã—Ç–æ–∫ |

### ‚úÖ OAuth –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- **State parameter** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç CSRF ‚úÖ
- **PKCE** –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è confidential client) ‚ö†Ô∏è
- **Redirect URI** –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è ‚úÖ
- **Scope** –æ–≥—Ä–∞–Ω–∏—á–µ–Ω –º–∏–Ω–∏–º–∞–ª—å–Ω–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º ‚úÖ

## üîÑ OAuth Flow –∞—É–¥–∏—Ç

### –¢–µ–∫—É—â–∏–π flow (–†–ê–ë–û–¢–ê–ï–¢):
1. **–ò–Ω–∏—Ü–∏–∞—Ü–∏—è**: Frontend ‚Üí Backend ‚Üí Auth Service ‚Üí Google ‚úÖ
2. **Callback**: Google ‚Üí Frontend ‚Üí Auth Service (exchange) ‚úÖ  
3. **Token exchange**: Auth Service –æ–±–º–µ–Ω–∏–≤–∞–µ—Ç code –Ω–∞ tokens ‚úÖ
4. **Session**: Frontend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–æ–∫–µ–Ω –≤ TokenManager ‚úÖ
5. **API calls**: Backend –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç RS256 —Ç–æ–∫–µ–Ω—ã ‚úÖ

### –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏:
- ‚úÖ –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ Google
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—Ö–æ–¥ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- ‚úÖ Refresh token –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ access token
- ‚úÖ Logout (—á–∞—Å—Ç–∏—á–Ω–æ - —Ç–æ–∫–µ–Ω –Ω–µ revoke'–∞–µ—Ç—Å—è)
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Å–µ—Å—Å–∏–∏ —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üêõ –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (0)
*–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ*

### üü° –°—Ä–µ–¥–Ω–∏–µ (3)
1. **Logout –Ω–µ –æ—Ç–∑—ã–≤–∞–µ—Ç —Ç–æ–∫–µ–Ω—ã**
   - –¢–æ–∫–µ–Ω—ã –æ—Å—Ç–∞—é—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º–∏ –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å token blacklist –≤ Redis

2. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç audit logging**
   - –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –î–æ–±–∞–≤–∏—Ç—å structured logging –¥–ª—è auth —Å–æ–±—ã—Ç–∏–π

3. **Frontend callback URL –≤ production**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è localhost:3001 –≤ production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å environment-specific URLs

### üü¢ –ù–∏–∑–∫–∏–µ (4)
4. **PKCE –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è OAuth**
5. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç device fingerprinting**
6. **–ù–µ—Ç 2FA –ø–æ–¥–¥–µ—Ä–∂–∫–∏**
7. **Session management –±–∞–∑–æ–≤—ã–π**

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ó–∞–º–µ—Ä—ã:
- **Token validation**: ~2-3ms ‚úÖ
- **OAuth callback**: ~250ms ‚úÖ
- **Refresh token**: ~10ms ‚úÖ
- **Health check**: <1ms ‚úÖ

### –ù–∞–≥—Ä—É–∑–æ—á–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å:
- **–û–∂–∏–¥–∞–µ–º–∞—è**: 10,000 RPS –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- **–¢–µ–∫—É—â–∞—è**: ~1,000 RPS (—Ç—Ä–µ–±—É–µ—Ç load testing)

## ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–ª–∞–Ω–∞–º

### –°–æ–≥–ª–∞—Å–Ω–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏:
| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ü–ª–∞–Ω | –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ | –°—Ç–∞—Ç—É—Å |
|------------|------|-------------|--------|
| JWT RS256 | ‚úÖ | ‚úÖ | –ü–æ–ª–Ω–æ—Å—Ç—å—é |
| OAuth Google | ‚úÖ | ‚úÖ | –ü–æ–ª–Ω–æ—Å—Ç—å—é |
| Refresh tokens | ‚úÖ | ‚úÖ | –ü–æ–ª–Ω–æ—Å—Ç—å—é |
| Rate limiting | ‚úÖ | ‚úÖ | –ü–æ–ª–Ω–æ—Å—Ç—å—é |
| Device fingerprinting | ‚úÖ | ‚ùå | –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| MFA | ‚úÖ | ‚ùå | –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| Session management | ‚úÖ | ‚ö†Ô∏è | –ë–∞–∑–æ–≤—ã–π |
| Audit logging | ‚úÖ | ‚ùå | –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |

**–ü—Ä–æ—Ü–µ–Ω—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** 75% –æ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –°—Ä–æ—á–Ω—ã–µ (–¥–æ production):
1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å production URLs** –¥–ª—è OAuth callbacks
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å token revocation** –ø—Ä–∏ logout
3. **–î–æ–±–∞–≤–∏—Ç—å structured logging** –¥–ª—è security events
4. **–ü—Ä–æ–≤–µ—Å—Ç–∏ load testing** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ 10K RPS

### –í–∞–∂–Ω—ã–µ (–ø–µ—Ä–≤—ã–π –º–µ—Å—è—Ü production):
5. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å audit trail** –¥–ª—è compliance
6. **–î–æ–±–∞–≤–∏—Ç—å monitoring** (Prometheus + Grafana)
7. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å alerts** –¥–ª—è security events
8. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å session management** —Å Redis

### –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (roadmap):
9. **–î–æ–±–∞–≤–∏—Ç—å 2FA** –ø–æ–¥–¥–µ—Ä–∂–∫—É
10. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å PKCE** –¥–ª—è OAuth
11. **Device fingerprinting** –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
12. **WebAuthn** –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–ª—è passwordless

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è production

- [ ] –û–±–Ω–æ–≤–∏—Ç—å OAuth redirect URLs –≤ Google Console
- [ ] –°–º–µ–Ω–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç–æ–≤—ã–µ credentials
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å SSL/TLS –¥–ª—è –≤—Å–µ—Ö endpoints
- [ ] –í–∫–ª—é—á–∏—Ç—å production logging level
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å backup –¥–ª—è –ë–î auth service
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å disaster recovery –ø–ª–∞–Ω
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ penetration testing
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å monitoring –∏ alerting
- [ ] –°–æ–∑–¥–∞—Ç—å runbook –¥–ª—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤
- [ ] –û–±—É—á–∏—Ç—å support –∫–æ–º–∞–Ω–¥—É

## üèÜ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≥–æ—Ç–æ–≤–∞ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é** —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞–º–∏. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ —Ö–æ—Ä–æ—à–µ–º —É—Ä–æ–≤–Ω–µ, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RS256 –¥–ª—è JWT
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è OAuth 2.0
- ‚úÖ –•–æ—Ä–æ—à–∞—è –∏–∑–æ–ª—è—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ Rate limiting –∏ –±–∞–∑–æ–≤–∞—è –∑–∞—â–∏—Ç–∞

### –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:
- ‚ö†Ô∏è Session management
- ‚ö†Ô∏è Audit logging
- ‚ö†Ô∏è Token revocation
- ‚ö†Ô∏è Production configuration

**–§–∏–Ω–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞:** üü¢ **APPROVED –¥–ª—è production** —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º —Å—Ä–æ—á–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.

---
*–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω: 08.09.2025 01:45*  
*–°–ª–µ–¥—É—é—â–∏–π –∞—É–¥–∏—Ç: —á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞ –ø–æ—Å–ª–µ production –∑–∞–ø—É—Å–∫–∞*