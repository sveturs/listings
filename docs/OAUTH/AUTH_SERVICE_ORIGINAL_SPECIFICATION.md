# üîê Auth Service - –ü–æ–ª–Ω–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0.0  
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 06.09.2025  
**–°—Ç–∞—Ç—É—Å:** –£—Ç–≤–µ—Ä–∂–¥–µ–Ω –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏  
**–ê–≤—Ç–æ—Ä—ã:** Architecture Team  
**–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û!  
**–ê–∫—Ç—É–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `/data/auth_svetu/docs/ACTUAL_API_ENDPOINTS.md`

---

## üìë –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–†–µ–∑—é–º–µ –ø—Ä–æ–µ–∫—Ç–∞](#-—Ä–µ–∑—é–º–µ-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
3. [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è](#-—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è)
4. [API —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è](#-api-—Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è)
5. [–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞](#-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
6. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#-–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
7. [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
8. [–ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏](#-–ø–ª–∞–Ω-–º–∏–≥—Ä–∞—Ü–∏–∏)
9. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
10. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏](#-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–º–µ—Ç—Ä–∏–∫–∏)
11. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
12. [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API](#-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è-api)
13. [–†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è](#-—Ä–∏—Å–∫–∏-–∏-–º–∏—Ç–∏–≥–∞—Ü–∏—è)
14. [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

---

## üéØ –†–µ–∑—é–º–µ –ø—Ä–æ–µ–∫—Ç–∞

### –¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–≥–æ, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–≥–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã Sve Tu.

### –ö–ª—é—á–µ–≤—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 10,000+ RPS –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–æ–∫–µ–Ω–æ–≤
- **–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å:** 99.99% uptime
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ OWASP Top 10
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å:** –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- **–ò–∑–æ–ª—è—Ü–∏—è:** –ü–æ–ª–Ω–∞—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- JWT-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (RS256)
- OAuth 2.0 –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (Google, –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è Facebook, Apple)
- Email/Password —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—Ö–æ–¥
- Refresh token rotation
- Multi-factor authentication (–≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é)
- Rate limiting –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞
- Device fingerprinting
- Session management

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TB
    subgraph "External Clients"
        Web[Web Frontend]
        Mobile[Mobile Apps]
        API[API Clients]
    end
    
    subgraph "API Gateway Layer"
        APIGW[API Gateway / Load Balancer]
    end
    
    subgraph "Auth Service"
        REST[REST API :8080]
        GRPC[gRPC Server :50051]
        Core[Auth Core Logic]
        OAuth[OAuth Handlers]
        Token[Token Service]
        User[User Service]
    end
    
    subgraph "Data Layer"
        PG[(PostgreSQL)]
        Redis[(Redis Cache)]
        Vault[HashiCorp Vault]
    end
    
    subgraph "Main Service"
        Backend[Backend Service]
        MainDB[(Main Database)]
    end
    
    Web --> APIGW
    Mobile --> APIGW
    API --> APIGW
    
    APIGW --> REST
    Backend --> GRPC
    
    REST --> Core
    GRPC --> Core
    
    Core --> OAuth
    Core --> Token
    Core --> User
    
    Token --> PG
    Token --> Redis
    User --> PG
    User --> Redis
    OAuth --> Vault
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
auth-service/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ server/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.go              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ migrate/
‚îÇ       ‚îî‚îÄ‚îÄ main.go              # –£—Ç–∏–ª–∏—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–π –ë–î
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ config/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validation.go
‚îÇ   ‚îú‚îÄ‚îÄ domain/                 # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ token.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ errors.go
‚îÇ   ‚îú‚îÄ‚îÄ service/                # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ register.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ logout.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ token/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ refresh.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validation.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ profile.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ oauth/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ google.go
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ facebook.go
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ provider.go
‚îÇ   ‚îú‚îÄ‚îÄ repository/             # –°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ postgres/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ token.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ redis/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ cache.go
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ session.go
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ ratelimit.go
‚îÇ   ‚îú‚îÄ‚îÄ transport/              # API —Å–ª–æ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ grpc/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ interceptors.go
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ http/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server.go
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validators/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ events/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ publisher.go
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ types.go
‚îÇ   ‚îî‚îÄ‚îÄ pkg/                    # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ       ‚îú‚îÄ‚îÄ crypto/
‚îÇ       ‚îú‚îÄ‚îÄ logger/
‚îÇ       ‚îú‚îÄ‚îÄ metrics/
‚îÇ       ‚îî‚îÄ‚îÄ tracer/
‚îú‚îÄ‚îÄ pkg/                         # –ü—É–±–ª–∏—á–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ client/                  # Client SDK
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ grpc/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ http/
‚îÇ   ‚îî‚îÄ‚îÄ proto/                   # Proto –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
‚îÇ       ‚îú‚îÄ‚îÄ auth.proto
‚îÇ       ‚îî‚îÄ‚îÄ generated/
‚îú‚îÄ‚îÄ deployments/                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ docker/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ docker-compose.yml
‚îÇ   ‚îú‚îÄ‚îÄ kubernetes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ deployment.yaml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ service.yaml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ configmap.yaml
‚îÇ   ‚îî‚îÄ‚îÄ terraform/
‚îÇ       ‚îî‚îÄ‚îÄ main.tf
‚îú‚îÄ‚îÄ scripts/                     # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ migrate.sh
‚îÇ   ‚îú‚îÄ‚îÄ generate-keys.sh
‚îÇ   ‚îî‚îÄ‚îÄ test-load.sh
‚îî‚îÄ‚îÄ tests/                       # –¢–µ—Å—Ç—ã
    ‚îú‚îÄ‚îÄ unit/
    ‚îú‚îÄ‚îÄ integration/
    ‚îú‚îÄ‚îÄ e2e/
    ‚îî‚îÄ‚îÄ load/
```

---

## üíª –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|-----------|-----------|--------|-------------|
| –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è | Go | 1.22+ | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ—Ç–∞, concurrency |
| Web Framework | Fiber | v2.52+ | –í—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, Express-like API |
| gRPC Framework | grpc-go | v1.60+ | –°—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ |
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | PostgreSQL | 15+ | –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å, ACID, JSON support |
| –ö–µ—à | Redis | 7+ | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, TTL, pub/sub |
| Message Queue | NATS | 2.10+ | –õ–µ–≥–∫–æ–≤–µ—Å–Ω–æ—Å—Ç—å, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å |
| Secrets Management | HashiCorp Vault | 1.15+ | –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–ª—é—á–µ–π |
| –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è | Docker | 24+ | –°—Ç–∞–Ω–¥–∞—Ä—Ç –∏–Ω–¥—É—Å—Ç—Ä–∏–∏ |
| –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è | Kubernetes | 1.28+ | –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
| API Gateway | Kong | 3.5+ | Rate limiting, authentication |
| –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | Prometheus + Grafana | Latest | –ú–µ—Ç—Ä–∏–∫–∏ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è |
| –¢—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ | Jaeger | 1.50+ | Distributed tracing |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | ELK Stack | 8+ | Centralized logging |

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (Development)
- CPU: 2 cores
- RAM: 4 GB
- Storage: 20 GB SSD
- Network: 100 Mbps

#### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è (Production)
- CPU: 8 cores
- RAM: 16 GB
- Storage: 100 GB SSD (RAID 10)
- Network: 1 Gbps
- Load Balancer: 2+ instances
- Database: Master-Slave replication
- Redis: Sentinel setup

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª—å |
|---------|-----------|---------|------|
| Token Validation Latency | < 50ms | 200ms | 30ms |
| Login Latency | < 200ms | 500ms | 150ms |
| Throughput (RPS) | 10,000 | 2,000 | 15,000 |
| Concurrent Users | 100,000 | 10,000 | 500,000 |
| Database Connections | 100 | 50 | 200 |
| Cache Hit Rate | > 90% | 60% | 95% |
| Error Rate | < 0.1% | 1% | 0.05% |

---

## üì° API –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

### REST API Endpoints

#### Authentication Endpoints

```yaml
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
POST /api/v1/auth/register
Request:
  Content-Type: application/json
  Body:
    {
      "email": "user@example.com",
      "password": "SecurePass123!",
      "name": "John Doe",
      "terms_accepted": true
    }
Response:
  200 OK:
    {
      "access_token": "eyJhbGc...",
      "refresh_token": "eyJhbGc...",
      "token_type": "Bearer",
      "expires_in": 900,
      "user": {
        "id": 12345,
        "email": "user@example.com",
        "name": "John Doe",
        "email_verified": false,
        "created_at": "2025-09-06T10:00:00Z"
      }
    }
  400 Bad Request:
    {
      "error": "validation_error",
      "message": "Invalid email format",
      "details": {...}
    }
  409 Conflict:
    {
      "error": "user_exists",
      "message": "User with this email already exists"
    }

# –í—Ö–æ–¥
POST /api/v1/auth/login
Request:
  Content-Type: application/json
  Body:
    {
      "email": "user@example.com",
      "password": "SecurePass123!",
      "device_id": "uuid-device-id",
      "device_name": "Chrome on MacOS"
    }
Response:
  200 OK: (same as register)
  401 Unauthorized:
    {
      "error": "invalid_credentials",
      "message": "Invalid email or password"
    }
  429 Too Many Requests:
    {
      "error": "rate_limit",
      "message": "Too many login attempts",
      "retry_after": 900
    }

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
POST /api/v1/auth/refresh
Request:
  Cookie: refresh_token=eyJhbGc...
Response:
  200 OK:
    {
      "access_token": "eyJhbGc...",
      "refresh_token": "eyJhbGc...",
      "token_type": "Bearer",
      "expires_in": 900
    }
  401 Unauthorized:
    {
      "error": "invalid_token",
      "message": "Refresh token is invalid or expired"
    }

# –í—ã—Ö–æ–¥
POST /api/v1/auth/logout
Request:
  Authorization: Bearer eyJhbGc...
  Cookie: refresh_token=eyJhbGc...
Response:
  200 OK:
    {
      "message": "Successfully logged out"
    }

# –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
GET /api/v1/auth/validate
Request:
  Authorization: Bearer eyJhbGc...
Response:
  200 OK:
    {
      "valid": true,
      "user_id": 12345,
      "email": "user@example.com",
      "roles": ["user"],
      "expires_at": "2025-09-06T11:00:00Z"
    }
  401 Unauthorized:
    {
      "valid": false,
      "error": "token_expired"
    }
```

#### OAuth Endpoints

```yaml
# –ò–Ω–∏—Ü–∏–∞—Ü–∏—è OAuth
GET /api/v1/auth/oauth/{provider}
Parameters:
  provider: google|facebook|apple
  redirect_uri: https://app.svetu.rs/auth/callback
  state: random-state-string
Response:
  302 Redirect to OAuth provider

# OAuth Callback
GET /api/v1/auth/oauth/{provider}/callback
Parameters:
  code: authorization-code
  state: random-state-string
Response:
  302 Redirect to frontend with tokens in URL params
```

#### User Management

```yaml
# –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
GET /api/v1/auth/user/profile
Request:
  Authorization: Bearer eyJhbGc...
Response:
  200 OK:
    {
      "id": 12345,
      "email": "user@example.com",
      "name": "John Doe",
      "picture_url": "https://...",
      "email_verified": true,
      "phone_verified": false,
      "two_factor_enabled": false,
      "created_at": "2025-09-06T10:00:00Z",
      "updated_at": "2025-09-06T10:00:00Z"
    }

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
PATCH /api/v1/auth/user/profile
Request:
  Authorization: Bearer eyJhbGc...
  Content-Type: application/json
  Body:
    {
      "name": "Jane Doe",
      "phone": "+1234567890"
    }
Response:
  200 OK: (updated profile)

# –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è
POST /api/v1/auth/user/change-password
Request:
  Authorization: Bearer eyJhbGc...
  Content-Type: application/json
  Body:
    {
      "current_password": "OldPass123!",
      "new_password": "NewPass456!",
      "confirm_password": "NewPass456!"
    }
Response:
  200 OK:
    {
      "message": "Password changed successfully"
    }

# –£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
DELETE /api/v1/auth/user/account
Request:
  Authorization: Bearer eyJhbGc...
  Content-Type: application/json
  Body:
    {
      "password": "CurrentPass123!",
      "confirmation": "DELETE MY ACCOUNT"
    }
Response:
  200 OK:
    {
      "message": "Account scheduled for deletion",
      "deletion_date": "2025-10-06T10:00:00Z"
    }
```

### gRPC API

```protobuf
syntax = "proto3";

package auth.v1;

service AuthService {
  // Authentication
  rpc Login(LoginRequest) returns (AuthResponse);
  rpc Register(RegisterRequest) returns (AuthResponse);
  rpc Logout(LogoutRequest) returns (LogoutResponse);
  rpc RefreshToken(RefreshTokenRequest) returns (AuthResponse);
  
  // Token Validation
  rpc ValidateToken(ValidateTokenRequest) returns (ValidateTokenResponse);
  rpc RevokeToken(RevokeTokenRequest) returns (RevokeTokenResponse);
  
  // User Management
  rpc GetUser(GetUserRequest) returns (User);
  rpc UpdateUser(UpdateUserRequest) returns (User);
  rpc DeleteUser(DeleteUserRequest) returns (DeleteUserResponse);
  
  // Session Management
  rpc GetUserSessions(GetUserSessionsRequest) returns (GetUserSessionsResponse);
  rpc RevokeSession(RevokeSessionRequest) returns (RevokeSessionResponse);
  
  // Internal
  rpc CreateServiceAccount(CreateServiceAccountRequest) returns (ServiceAccount);
  rpc RotateServiceAccountKey(RotateKeyRequest) returns (ServiceAccount);
}

message LoginRequest {
  string email = 1;
  string password = 2;
  string device_id = 3;
  string device_name = 4;
  string ip_address = 5;
  string user_agent = 6;
}

message AuthResponse {
  string access_token = 1;
  string refresh_token = 2;
  string token_type = 3;
  int32 expires_in = 4;
  User user = 5;
}

message User {
  int32 id = 1;
  string email = 2;
  string name = 3;
  string picture_url = 4;
  bool email_verified = 5;
  repeated string roles = 6;
  map<string, string> metadata = 7;
  google.protobuf.Timestamp created_at = 8;
  google.protobuf.Timestamp updated_at = 9;
}

message ValidateTokenRequest {
  string token = 1;
  bool check_revoked = 2;
}

message ValidateTokenResponse {
  bool valid = 1;
  int32 user_id = 2;
  string email = 3;
  repeated string roles = 4;
  map<string, string> claims = 5;
  google.protobuf.Timestamp expires_at = 6;
}
```

---

## üè¢ –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

### Docker Compose Configuration

```yaml
version: '3.8'

networks:
  auth-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16

volumes:
  auth_postgres_data:
  auth_redis_data:
  auth_vault_data:

services:
  # PostgreSQL
  auth-postgres:
    image: postgres:15-alpine
    container_name: auth_postgres
    hostname: auth-postgres
    networks:
      auth-network:
        ipv4_address: 172.20.0.10
    environment:
      POSTGRES_DB: ${AUTH_DB_NAME:-auth_db}
      POSTGRES_USER: ${AUTH_DB_USER:-auth_user}
      POSTGRES_PASSWORD: ${AUTH_DB_PASSWORD}
      POSTGRES_INITDB_ARGS: "--encoding=UTF8 --locale=en_US.UTF-8"
    volumes:
      - auth_postgres_data:/var/lib/postgresql/data
      - ./scripts/postgres-init.sql:/docker-entrypoint-initdb.d/init.sql:ro
    ports:
      - "5433:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${AUTH_DB_USER:-auth_user} -d ${AUTH_DB_NAME:-auth_db}"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  # Redis
  auth-redis:
    image: redis:7-alpine
    container_name: auth_redis
    hostname: auth-redis
    networks:
      auth-network:
        ipv4_address: 172.20.0.11
    command: >
      redis-server
      --requirepass ${AUTH_REDIS_PASSWORD}
      --maxmemory 512mb
      --maxmemory-policy allkeys-lru
      --appendonly yes
      --appendfsync everysec
    volumes:
      - auth_redis_data:/data
    ports:
      - "6380:6379"
    healthcheck:
      test: ["CMD", "redis-cli", "--auth", "${AUTH_REDIS_PASSWORD}", "ping"]
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  # HashiCorp Vault (for secrets)
  auth-vault:
    image: vault:1.15
    container_name: auth_vault
    hostname: auth-vault
    networks:
      auth-network:
        ipv4_address: 172.20.0.12
    environment:
      VAULT_DEV_ROOT_TOKEN_ID: ${VAULT_ROOT_TOKEN}
      VAULT_DEV_LISTEN_ADDRESS: 0.0.0.0:8200
    volumes:
      - auth_vault_data:/vault/data
    ports:
      - "8200:8200"
    cap_add:
      - IPC_LOCK
    restart: unless-stopped

  # NATS (for events)
  auth-nats:
    image: nats:2.10-alpine
    container_name: auth_nats
    hostname: auth-nats
    networks:
      auth-network:
        ipv4_address: 172.20.0.13
    command: >
      -js
      -sd /data
      --user ${NATS_USER}
      --pass ${NATS_PASSWORD}
    volumes:
      - ./data/nats:/data
    ports:
      - "4222:4222"  # Client connections
      - "8222:8222"  # HTTP monitoring
    restart: unless-stopped

  # Auth Service
  auth-service:
    build:
      context: .
      dockerfile: deployments/docker/Dockerfile
      args:
        - GO_VERSION=1.22
    container_name: auth_service
    hostname: auth-service
    networks:
      auth-network:
        ipv4_address: 172.20.0.20
    environment:
      # Database
      DB_HOST: auth-postgres
      DB_PORT: 5432
      DB_NAME: ${AUTH_DB_NAME:-auth_db}
      DB_USER: ${AUTH_DB_USER:-auth_user}
      DB_PASSWORD: ${AUTH_DB_PASSWORD}
      DB_SSL_MODE: disable
      DB_MAX_CONNECTIONS: 100
      DB_MAX_IDLE_CONNECTIONS: 10
      DB_CONNECTION_MAX_LIFETIME: 3600
      
      # Redis
      REDIS_HOST: auth-redis
      REDIS_PORT: 6379
      REDIS_PASSWORD: ${AUTH_REDIS_PASSWORD}
      REDIS_DB: 0
      REDIS_MAX_RETRIES: 3
      REDIS_POOL_SIZE: 100
      
      # Vault
      VAULT_ADDR: http://auth-vault:8200
      VAULT_TOKEN: ${VAULT_ROOT_TOKEN}
      
      # NATS
      NATS_URL: nats://${NATS_USER}:${NATS_PASSWORD}@auth-nats:4222
      
      # Service Configuration
      SERVICE_NAME: auth-service
      SERVICE_VERSION: ${VERSION:-1.0.0}
      
      # Server Ports
      HTTP_PORT: 8080
      GRPC_PORT: 50051
      METRICS_PORT: 9090
      HEALTH_PORT: 8081
      
      # JWT Configuration
      JWT_ALGORITHM: RS256
      JWT_ACCESS_TOKEN_DURATION: 15m
      JWT_REFRESH_TOKEN_DURATION: 30d
      JWT_ISSUER: https://auth.svetu.rs
      JWT_AUDIENCE: https://svetu.rs
      
      # OAuth Providers
      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}
      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}
      GOOGLE_REDIRECT_URL: ${GOOGLE_REDIRECT_URL}
      
      # Security
      BCRYPT_COST: 12
      RATE_LIMIT_ENABLED: true
      RATE_LIMIT_LOGIN: 5/15m
      RATE_LIMIT_REGISTER: 3/1h
      RATE_LIMIT_TOKEN_REFRESH: 30/1m
      
      # Monitoring
      TRACING_ENABLED: true
      TRACING_ENDPOINT: http://jaeger:14268/api/traces
      METRICS_ENABLED: true
      
      # Logging
      LOG_LEVEL: ${LOG_LEVEL:-info}
      LOG_FORMAT: json
      
      # Environment
      ENV: ${ENV:-development}
    ports:
      - "8080:8080"    # HTTP/REST
      - "50051:50051"  # gRPC
      - "9090:9090"    # Metrics
      - "8081:8081"    # Health
    depends_on:
      auth-postgres:
        condition: service_healthy
      auth-redis:
        condition: service_healthy
      auth-vault:
        condition: service_started
      auth-nats:
        condition: service_started
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8081/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G

  # Jaeger (Tracing)
  jaeger:
    image: jaegertracing/all-in-one:1.50
    container_name: auth_jaeger
    networks:
      auth-network:
        ipv4_address: 172.20.0.30
    environment:
      COLLECTOR_OTLP_ENABLED: true
    ports:
      - "16686:16686"  # Jaeger UI
      - "14268:14268"  # Collector
    restart: unless-stopped
```

### Kubernetes Deployment

```yaml
# namespace.yaml
apiVersion: v1
kind: Namespace
metadata:
  name: auth-service

---
# configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: auth-service-config
  namespace: auth-service
data:
  SERVICE_NAME: auth-service
  HTTP_PORT: "8080"
  GRPC_PORT: "50051"
  LOG_LEVEL: info
  JWT_ALGORITHM: RS256
  JWT_ISSUER: https://auth.svetu.rs

---
# secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: auth-service-secrets
  namespace: auth-service
type: Opaque
stringData:
  DB_PASSWORD: "change-me"
  REDIS_PASSWORD: "change-me"
  JWT_PRIVATE_KEY: |
    -----BEGIN RSA PRIVATE KEY-----
    ...
    -----END RSA PRIVATE KEY-----
  GOOGLE_CLIENT_SECRET: "change-me"

---
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: auth-service
  namespace: auth-service
  labels:
    app: auth-service
    version: v1
spec:
  replicas: 3
  selector:
    matchLabels:
      app: auth-service
  template:
    metadata:
      labels:
        app: auth-service
        version: v1
      annotations:
        prometheus.io/scrape: "true"
        prometheus.io/port: "9090"
        prometheus.io/path: "/metrics"
    spec:
      serviceAccountName: auth-service
      containers:
      - name: auth-service
        image: svetu/auth-service:1.0.0
        imagePullPolicy: Always
        ports:
        - name: http
          containerPort: 8080
          protocol: TCP
        - name: grpc
          containerPort: 50051
          protocol: TCP
        - name: metrics
          containerPort: 9090
          protocol: TCP
        env:
        - name: DB_HOST
          value: auth-postgres-service
        - name: REDIS_HOST
          value: auth-redis-service
        envFrom:
        - configMapRef:
            name: auth-service-config
        - secretRef:
            name: auth-service-secrets
        resources:
          requests:
            memory: "256Mi"
            cpu: "250m"
          limits:
            memory: "512Mi"
            cpu: "500m"
        livenessProbe:
          httpGet:
            path: /health/live
            port: 8081
          initialDelaySeconds: 30
          periodSeconds: 10
          timeoutSeconds: 5
          failureThreshold: 3
        readinessProbe:
          httpGet:
            path: /health/ready
            port: 8081
          initialDelaySeconds: 10
          periodSeconds: 5
          timeoutSeconds: 3
          failureThreshold: 3
        volumeMounts:
        - name: jwt-keys
          mountPath: /etc/auth/keys
          readOnly: true
      volumes:
      - name: jwt-keys
        secret:
          secretName: jwt-keys

---
# service.yaml
apiVersion: v1
kind: Service
metadata:
  name: auth-service
  namespace: auth-service
  labels:
    app: auth-service
spec:
  type: ClusterIP
  selector:
    app: auth-service
  ports:
  - name: http
    port: 8080
    targetPort: 8080
  - name: grpc
    port: 50051
    targetPort: 50051
  - name: metrics
    port: 9090
    targetPort: 9090

---
# hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: auth-service-hpa
  namespace: auth-service
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: auth-service
  minReplicas: 3
  maxReplicas: 20
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
  - type: Resource
    resource:
      name: memory
      target:
        type: Utilization
        averageUtilization: 80
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 60
      policies:
      - type: Percent
        value: 100
        periodSeconds: 60
    scaleDown:
      stabilizationWindowSeconds: 300
      policies:
      - type: Percent
        value: 50
        periodSeconds: 60
```

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- Create database
CREATE DATABASE auth_db
    WITH 
    OWNER = auth_user
    ENCODING = 'UTF8'
    LC_COLLATE = 'en_US.UTF-8'
    LC_CTYPE = 'en_US.UTF-8'
    TABLESPACE = pg_default
    CONNECTION LIMIT = -1;

-- Connect to auth_db
\c auth_db;

-- Enable extensions
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
CREATE EXTENSION IF NOT EXISTS "pgcrypto";
CREATE EXTENSION IF NOT EXISTS "pg_trgm";

-- Create schema
CREATE SCHEMA IF NOT EXISTS auth;

-- Set search path
SET search_path TO auth, public;

-- Users table
CREATE TABLE auth.users (
    id SERIAL PRIMARY KEY,
    uuid UUID DEFAULT uuid_generate_v4() UNIQUE NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    email_normalized VARCHAR(255) GENERATED ALWAYS AS (lower(email)) STORED,
    name VARCHAR(100) NOT NULL,
    password_hash VARCHAR(255),
    
    -- OAuth providers
    google_id VARCHAR(255) UNIQUE,
    facebook_id VARCHAR(255) UNIQUE,
    apple_id VARCHAR(255) UNIQUE,
    
    -- Profile
    picture_url TEXT,
    phone VARCHAR(20),
    phone_verified BOOLEAN DEFAULT FALSE,
    
    -- Security
    email_verified BOOLEAN DEFAULT FALSE,
    two_factor_enabled BOOLEAN DEFAULT FALSE,
    two_factor_secret VARCHAR(255),
    backup_codes TEXT[],
    
    -- Status
    provider VARCHAR(20) NOT NULL CHECK (provider IN ('local', 'google', 'facebook', 'apple')),
    is_active BOOLEAN DEFAULT TRUE,
    is_deleted BOOLEAN DEFAULT FALSE,
    deleted_at TIMESTAMP,
    
    -- Metadata
    last_login_at TIMESTAMP,
    last_login_ip INET,
    last_login_user_agent TEXT,
    failed_login_attempts INT DEFAULT 0,
    locked_until TIMESTAMP,
    
    -- Timestamps
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- Indexes
    INDEX idx_email_normalized (email_normalized),
    INDEX idx_provider (provider),
    INDEX idx_created_at (created_at DESC),
    INDEX idx_last_login (last_login_at DESC)
);

-- Refresh tokens table
CREATE TABLE auth.refresh_tokens (
    id SERIAL PRIMARY KEY,
    jti UUID DEFAULT uuid_generate_v4() UNIQUE NOT NULL,
    user_id INTEGER NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
    token_hash VARCHAR(255) UNIQUE NOT NULL,
    
    -- Token family for rotation detection
    family_id UUID NOT NULL,
    parent_token_id INTEGER REFERENCES auth.refresh_tokens(id),
    
    -- Metadata
    device_id VARCHAR(255),
    device_name VARCHAR(100),
    ip_address INET,
    user_agent TEXT,
    
    -- Expiration and revocation
    expires_at TIMESTAMP NOT NULL,
    is_revoked BOOLEAN DEFAULT FALSE,
    revoked_at TIMESTAMP,
    revoked_reason VARCHAR(50),
    
    -- Usage tracking
    used_at TIMESTAMP,
    use_count INTEGER DEFAULT 0,
    
    -- Timestamps
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- Indexes
    INDEX idx_user_id (user_id) WHERE NOT is_revoked,
    INDEX idx_token_hash (token_hash) WHERE NOT is_revoked,
    INDEX idx_family_id (family_id),
    INDEX idx_expires_at (expires_at) WHERE NOT is_revoked,
    INDEX idx_device_id (device_id, user_id)
);

-- Revoked access tokens (blacklist)
CREATE TABLE auth.revoked_access_tokens (
    jti VARCHAR(255) PRIMARY KEY,
    user_id INTEGER REFERENCES auth.users(id) ON DELETE CASCADE,
    expires_at TIMESTAMP NOT NULL,
    revoked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    revoked_reason VARCHAR(50),
    
    -- Indexes
    INDEX idx_expires_at_revoked (expires_at),
    INDEX idx_user_id_revoked (user_id)
);

-- User sessions (active sessions tracking)
CREATE TABLE auth.user_sessions (
    id SERIAL PRIMARY KEY,
    session_id UUID DEFAULT uuid_generate_v4() UNIQUE NOT NULL,
    user_id INTEGER NOT NULL REFERENCES auth.users(id) ON DELETE CASCADE,
    refresh_token_id INTEGER REFERENCES auth.refresh_tokens(id) ON DELETE CASCADE,
    
    -- Session info
    device_id VARCHAR(255),
    device_name VARCHAR(100),
    device_type VARCHAR(50),
    browser VARCHAR(50),
    os VARCHAR(50),
    ip_address INET,
    location_country VARCHAR(2),
    location_city VARCHAR(100),
    
    -- Activity
    last_activity_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    activity_count INTEGER DEFAULT 1,
    
    -- Status
    is_active BOOLEAN DEFAULT TRUE,
    terminated_at TIMESTAMP,
    termination_reason VARCHAR(50),
    
    -- Timestamps
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    expires_at TIMESTAMP NOT NULL,
    
    -- Indexes
    INDEX idx_user_sessions (user_id, is_active),
    INDEX idx_session_id (session_id) WHERE is_active,
    INDEX idx_last_activity (last_activity_at DESC)
);

-- Audit log
CREATE TABLE auth.audit_log (
    id BIGSERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES auth.users(id) ON DELETE SET NULL,
    action VARCHAR(50) NOT NULL,
    resource VARCHAR(50),
    resource_id VARCHAR(255),
    
    -- Request info
    ip_address INET,
    user_agent TEXT,
    request_id UUID,
    
    -- Details
    old_values JSONB,
    new_values JSONB,
    metadata JSONB,
    
    -- Result
    success BOOLEAN DEFAULT TRUE,
    error_message TEXT,
    
    -- Timestamp
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- Indexes
    INDEX idx_audit_user (user_id, created_at DESC),
    INDEX idx_audit_action (action, created_at DESC),
    INDEX idx_audit_resource (resource, resource_id),
    INDEX idx_audit_created (created_at DESC)
) PARTITION BY RANGE (created_at);

-- Create partitions for audit log (monthly)
CREATE TABLE auth.audit_log_2025_09 PARTITION OF auth.audit_log
    FOR VALUES FROM ('2025-09-01') TO ('2025-10-01');
CREATE TABLE auth.audit_log_2025_10 PARTITION OF auth.audit_log
    FOR VALUES FROM ('2025-10-01') TO ('2025-11-01');

-- Login attempts tracking
CREATE TABLE auth.login_attempts (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) NOT NULL,
    ip_address INET NOT NULL,
    user_agent TEXT,
    success BOOLEAN NOT NULL,
    failure_reason VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    -- Indexes
    INDEX idx_login_email (email, created_at DESC),
    INDEX idx_login_ip (ip_address, created_at DESC),
    INDEX idx_login_created (created_at DESC)
);

-- Service accounts (for inter-service communication)
CREATE TABLE auth.service_accounts (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) UNIQUE NOT NULL,
    description TEXT,
    api_key_hash VARCHAR(255) UNIQUE NOT NULL,
    roles TEXT[] DEFAULT '{}',
    
    -- Rate limiting
    rate_limit_requests INTEGER DEFAULT 10000,
    rate_limit_window INTEGER DEFAULT 3600,
    
    -- Status
    is_active BOOLEAN DEFAULT TRUE,
    last_used_at TIMESTAMP,
    
    -- Expiration
    expires_at TIMESTAMP,
    
    -- Timestamps
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    rotated_at TIMESTAMP,
    
    -- Indexes
    INDEX idx_service_api_key (api_key_hash) WHERE is_active
);

-- Functions and triggers

-- Update updated_at timestamp
CREATE OR REPLACE FUNCTION auth.update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER update_users_updated_at BEFORE UPDATE ON auth.users
    FOR EACH ROW EXECUTE FUNCTION auth.update_updated_at_column();

CREATE TRIGGER update_service_accounts_updated_at BEFORE UPDATE ON auth.service_accounts
    FOR EACH ROW EXECUTE FUNCTION auth.update_updated_at_column();

-- Clean expired tokens
CREATE OR REPLACE FUNCTION auth.clean_expired_tokens()
RETURNS void AS $$
BEGIN
    -- Delete expired refresh tokens
    DELETE FROM auth.refresh_tokens 
    WHERE expires_at < CURRENT_TIMESTAMP 
    AND created_at < CURRENT_TIMESTAMP - INTERVAL '7 days';
    
    -- Delete expired revoked access tokens
    DELETE FROM auth.revoked_access_tokens 
    WHERE expires_at < CURRENT_TIMESTAMP;
    
    -- Delete old login attempts
    DELETE FROM auth.login_attempts 
    WHERE created_at < CURRENT_TIMESTAMP - INTERVAL '30 days';
    
    -- Deactivate expired sessions
    UPDATE auth.user_sessions 
    SET is_active = FALSE, 
        terminated_at = CURRENT_TIMESTAMP,
        termination_reason = 'expired'
    WHERE expires_at < CURRENT_TIMESTAMP 
    AND is_active = TRUE;
END;
$$ LANGUAGE plpgsql;

-- Detect token reuse
CREATE OR REPLACE FUNCTION auth.detect_token_reuse()
RETURNS TRIGGER AS $$
BEGIN
    -- If this token was already used, revoke entire family
    IF NEW.use_count > 1 THEN
        UPDATE auth.refresh_tokens 
        SET is_revoked = TRUE,
            revoked_at = CURRENT_TIMESTAMP,
            revoked_reason = 'reuse_detected'
        WHERE family_id = NEW.family_id;
        
        -- Log security event
        INSERT INTO auth.audit_log (user_id, action, resource, resource_id, metadata)
        VALUES (
            NEW.user_id,
            'token_reuse_detected',
            'refresh_token',
            NEW.jti::text,
            jsonb_build_object(
                'family_id', NEW.family_id,
                'ip_address', NEW.ip_address,
                'user_agent', NEW.user_agent
            )
        );
    END IF;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER detect_refresh_token_reuse 
    AFTER UPDATE OF use_count ON auth.refresh_tokens
    FOR EACH ROW 
    WHEN (NEW.use_count > 1)
    EXECUTE FUNCTION auth.detect_token_reuse();

-- Permissions
GRANT ALL PRIVILEGES ON SCHEMA auth TO auth_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA auth TO auth_user;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA auth TO auth_user;
```

### Redis —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```redis
# User cache
KEY: user:{id}
TYPE: STRING (JSON)
TTL: 300 seconds (5 minutes)
VALUE: {
  "id": 12345,
  "email": "user@example.com",
  "name": "John Doe",
  "roles": ["user"],
  "email_verified": true
}

# Active sessions set
KEY: sessions:{user_id}
TYPE: SET
TTL: None (managed manually)
MEMBERS: ["session_id_1", "session_id_2", ...]

# Session data
KEY: session:{session_id}
TYPE: HASH
TTL: 86400 seconds (24 hours)
FIELDS:
  user_id: "12345"
  device_id: "uuid"
  ip_address: "192.168.1.1"
  last_activity: "1693900000"

# Rate limiting
KEY: rate:login:{email}
TYPE: STRING (counter)
TTL: 900 seconds (15 minutes)
VALUE: "3"

KEY: rate:register:{ip}
TYPE: STRING (counter)
TTL: 3600 seconds (1 hour)
VALUE: "2"

KEY: rate:refresh:{user_id}
TYPE: STRING (counter)
TTL: 60 seconds
VALUE: "10"

# Token blacklist (for immediate revocation)
KEY: blacklist:{jti}
TYPE: STRING
TTL: Until token expiration
VALUE: "1"

# Email verification codes
KEY: verify:email:{code}
TYPE: STRING
TTL: 3600 seconds (1 hour)
VALUE: "user@example.com"

# Password reset tokens
KEY: reset:{token}
TYPE: HASH
TTL: 900 seconds (15 minutes)
FIELDS:
  user_id: "12345"
  email: "user@example.com"
  ip_address: "192.168.1.1"

# Two-factor authentication
KEY: 2fa:{user_id}:{code}
TYPE: STRING
TTL: 300 seconds (5 minutes)
VALUE: "1"

# Failed login tracking
KEY: failed:{email}
TYPE: LIST
TTL: 900 seconds (15 minutes)
VALUES: ["timestamp1", "timestamp2", ...]

# Device fingerprints
KEY: device:{user_id}:{device_id}
TYPE: HASH
TTL: 2592000 seconds (30 days)
FIELDS:
  name: "Chrome on MacOS"
  last_seen: "1693900000"
  trusted: "true"
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ú–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã

#### 1. –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è
```go
// –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
bcrypt.GenerateFromPassword(password, 12)

// JWT –ø–æ–¥–ø–∏—Å—å (RS256)
privateKey, _ := rsa.GenerateKey(rand.Reader, 2048)
token := jwt.NewWithClaims(jwt.SigningMethodRS256, claims)
signedToken, _ := token.SignedString(privateKey)

// –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ sensitive –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
cipher, _ := aes.NewCipher(key)
gcm, _ := cipher.NewGCM(cipher)
encrypted := gcm.Seal(nil, nonce, plaintext, nil)
```

#### 2. Rate Limiting
```yaml
Login: 5 attempts per 15 minutes per email
Register: 3 attempts per hour per IP
Token Refresh: 30 requests per minute per user
API General: 1000 requests per minute per IP
Password Reset: 3 attempts per hour per email
Email Verification: 5 attempts per day per email
```

#### 3. Token Security
- Access Token: 15 –º–∏–Ω—É—Ç, RS256, non-revocable
- Refresh Token: 30 –¥–Ω–µ–π, rotation on use, revocable
- Token Family: Detection of token reuse
- JTI (JWT ID): Unique identifier for blacklisting

#### 4. Session Security
- Device Fingerprinting
- IP Address validation
- User Agent tracking
- Geographical anomaly detection
- Concurrent session limits

#### 5. Input Validation
```go
// Email validation
emailRegex := regexp.MustCompile(`^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$`)

// Password requirements
minLength := 8
requireUppercase := true
requireLowercase := true
requireNumber := true
requireSpecial := true

// SQL Injection prevention
query := "SELECT * FROM users WHERE email = $1"
db.QueryRow(query, email) // –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

// XSS Prevention
html.EscapeString(userInput)
```

#### 6. Headers Security
```go
// Security headers
app.Use(helmet.New(helmet.Config{
    XSSProtection:         "1; mode=block",
    ContentTypeNosniff:    "nosniff",
    XFrameOptions:         "DENY",
    HSTSMaxAge:           31536000,
    HSTSIncludeSubdomains: true,
    HSTSPreload:          true,
    ContentSecurityPolicy: "default-src 'self'",
    ReferrerPolicy:       "strict-origin-when-cross-origin",
}))
```

### Compliance

#### GDPR
- Right to be forgotten (soft delete + anonymization)
- Data portability (export user data)
- Consent management
- Privacy by design
- Data minimization

#### OWASP Top 10
- A01: Broken Access Control ‚úì
- A02: Cryptographic Failures ‚úì
- A03: Injection ‚úì
- A04: Insecure Design ‚úì
- A05: Security Misconfiguration ‚úì
- A06: Vulnerable Components ‚úì
- A07: Identification and Authentication Failures ‚úì
- A08: Software and Data Integrity Failures ‚úì
- A09: Security Logging and Monitoring Failures ‚úì
- A10: Server-Side Request Forgery ‚úì

---

## üìã –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### –§–∞–∑–∞ 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ (–ù–µ–¥–µ–ª—è 0)

#### –ó–∞–¥–∞—á–∏
- [ ] –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- [ ] –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD pipeline
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- [ ] –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã

#### Deliverables
- Git repository
- CI/CD pipeline (GitHub Actions)
- Development environment
- Project board (Jira/GitHub Projects)

### –§–∞–∑–∞ 1: –û—á–∏—Å—Ç–∫–∞ Legacy (–ù–µ–¥–µ–ª—è 1)

#### –î–µ–Ω—å 1-2: –ê—É–¥–∏—Ç
```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è session_token
grep -r "session_token" backend/ --include="*.go"
grep -r "session_token" frontend/ --include="*.ts" --include="*.tsx"

# –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å endpoints
curl http://localhost:3000/swagger/index.html > current_api.html

# Backup –¥–∞–Ω–Ω—ã—Ö
pg_dump -h localhost -U postgres svetubd > backup_before_migration.sql
```

#### –î–µ–Ω—å 3-4: –£–¥–∞–ª–µ–Ω–∏–µ session –∫–æ–¥–∞
```go
// –£–¥–∞–ª–∏—Ç—å –∏–∑ backend:
// - sync.Map sessions
// - session_token –ø—Ä–æ–≤–µ—Ä–∫–∏
// - legacy middleware

// –£–¥–∞–ª–∏—Ç—å –∏–∑ frontend:
// - session_token –∏–∑ cookies
// - fallback –ª–æ–≥–∏–∫—É
```

#### –î–µ–Ω—å 5: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# Unit tests
go test ./...

# Integration tests
npm run test:e2e

# Load testing
k6 run scripts/load-test.js
```

### –§–∞–∑–∞ 2: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ Auth Service (–ù–µ–¥–µ–ª—è 2)

#### –î–µ–Ω—å 1: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
mkdir -p auth-service/{cmd,internal,pkg,deployments,scripts,tests}

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Go –º–æ–¥—É–ª—è
cd auth-service
go mod init github.com/svetu/auth-service

# –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
go get github.com/gofiber/fiber/v2
go get google.golang.org/grpc
go get github.com/golang-jwt/jwt/v5
go get gorm.io/gorm
go get github.com/redis/go-redis/v9
```

#### –î–µ–Ω—å 2-3: Core —Å–µ—Ä–≤–∏—Å—ã
```go
// Implement:
// - AuthService (login, register, logout)
// - TokenService (generate, validate, refresh)
// - UserService (CRUD operations)
// - OAuthService (Google, Facebook)
```

#### –î–µ–Ω—å 4: API Layer
```go
// REST endpoints
// gRPC services
// GraphQL schema (optional)
```

#### –î–µ–Ω—å 5: Database –∏ Cache
```sql
-- Run migrations
migrate -path migrations -database "postgres://..." up

-- Seed test data
psql auth_db < seed.sql
```

### –§–∞–∑–∞ 3: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–ù–µ–¥–µ–ª—è 3)

#### –î–µ–Ω—å 1-2: Client Libraries
```go
// Go client
package authclient

type Client interface {
    ValidateToken(ctx context.Context, token string) (*User, error)
    RefreshToken(ctx context.Context, refreshToken string) (*Tokens, error)
}

// TypeScript client
export class AuthClient {
    async validateToken(token: string): Promise<User>
    async refreshToken(refreshToken: string): Promise<Tokens>
}
```

#### –î–µ–Ω—å 3-4: Backend Integration
```go
// Replace internal auth with client
authClient := authclient.New(authServiceURL)

// Update middleware
func AuthMiddleware(client authclient.Client) fiber.Handler {
    return func(c *fiber.Ctx) error {
        token := extractToken(c)
        user, err := client.ValidateToken(c.Context(), token)
        if err != nil {
            return c.Status(401).JSON(errorResponse)
        }
        c.Locals("user", user)
        return c.Next()
    }
}
```

#### –î–µ–Ω—å 5: Frontend Integration
```typescript
// Update auth service
class AuthService {
    private readonly API_URL = process.env.NEXT_PUBLIC_AUTH_SERVICE_URL
    
    async login(email: string, password: string): Promise<AuthResponse> {
        const response = await fetch(`${this.API_URL}/api/v1/auth/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password })
        })
        return response.json()
    }
}
```

### –§–∞–∑–∞ 4: –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–ù–µ–¥–µ–ª—è 4)

#### –î–µ–Ω—å 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤
```go
// migrate-users.go
func MigrateUsers() error {
    sourceDB := connectToSource()
    targetDB := connectToTarget()
    
    users := sourceDB.Query("SELECT * FROM users")
    for _, user := range users {
        targetDB.Create(&AuthUser{
            ID: user.ID,
            Email: user.Email,
            // ... map fields
        })
    }
    return nil
}
```

#### –î–µ–Ω—å 2: –¢–µ—Å—Ç–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
```bash
# Backup
pg_dump auth_db > auth_db_backup.sql

# Run migration on test data
go run cmd/migrate/main.go --dry-run

# Verify
psql auth_db -c "SELECT COUNT(*) FROM auth.users"
```

#### –î–µ–Ω—å 3: Production –º–∏–≥—Ä–∞—Ü–∏—è
```bash
# Stop writes to old auth
kubectl scale deployment backend --replicas=0

# Run migration
go run cmd/migrate/main.go --production

# Verify data
./scripts/verify-migration.sh

# Switch traffic
kubectl apply -f deployments/kubernetes/
```

#### –î–µ–Ω—å 4-5: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–∫–∞—Ç
```bash
# Monitor metrics
curl http://auth-service:9090/metrics

# Check logs
kubectl logs -f deployment/auth-service

# Rollback if needed
kubectl rollout undo deployment/auth-service
```

### –§–∞–∑–∞ 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–ù–µ–¥–µ–ª—è 5)

#### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] Query optimization
- [ ] Connection pooling
- [ ] Caching strategy
- [ ] Load balancing

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- [ ] Security audit
- [ ] Penetration testing
- [ ] OWASP compliance
- [ ] SSL/TLS configuration

#### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- [ ] Prometheus metrics
- [ ] Grafana dashboards
- [ ] Alerts configuration
- [ ] Log aggregation

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### Unit Tests (Coverage > 80%)
```go
// auth_service_test.go
func TestLogin_ValidCredentials(t *testing.T) {
    service := NewAuthService(mockDB, mockRedis)
    user, token, err := service.Login("test@example.com", "password")
    
    assert.NoError(t, err)
    assert.NotNil(t, user)
    assert.NotEmpty(t, token)
}

func TestLogin_InvalidCredentials(t *testing.T) {
    service := NewAuthService(mockDB, mockRedis)
    _, _, err := service.Login("test@example.com", "wrong")
    
    assert.Error(t, err)
    assert.Equal(t, ErrInvalidCredentials, err)
}
```

#### Integration Tests
```go
// integration_test.go
func TestAuthFlow(t *testing.T) {
    // Setup test environment
    db := setupTestDB()
    redis := setupTestRedis()
    app := setupApp(db, redis)
    
    // Register
    resp := httptest.NewRequest("POST", "/auth/register", registerBody)
    assert.Equal(t, 200, resp.StatusCode)
    
    // Login
    resp = httptest.NewRequest("POST", "/auth/login", loginBody)
    assert.Equal(t, 200, resp.StatusCode)
    
    // Validate token
    token := extractToken(resp)
    resp = httptest.NewRequest("GET", "/auth/validate", nil)
    resp.Header.Set("Authorization", "Bearer "+token)
    assert.Equal(t, 200, resp.StatusCode)
}
```

#### End-to-End Tests
```javascript
// e2e/auth.spec.js
describe('Authentication Flow', () => {
    it('should register new user', async () => {
        await page.goto('http://localhost:3000/register')
        await page.fill('#email', 'test@example.com')
        await page.fill('#password', 'SecurePass123!')
        await page.click('#submit')
        
        await expect(page).toHaveURL('/dashboard')
    })
    
    it('should login existing user', async () => {
        await page.goto('http://localhost:3000/login')
        await page.fill('#email', 'test@example.com')
        await page.fill('#password', 'SecurePass123!')
        await page.click('#submit')
        
        await expect(page).toHaveURL('/dashboard')
    })
})
```

#### Load Testing
```javascript
// k6/load-test.js
import http from 'k6/http'
import { check, sleep } from 'k6'

export let options = {
    stages: [
        { duration: '2m', target: 100 },  // Ramp up
        { duration: '5m', target: 1000 }, // Stay at 1000
        { duration: '2m', target: 0 },    // Ramp down
    ],
    thresholds: {
        http_req_duration: ['p(95)<200'], // 95% requests under 200ms
        http_req_failed: ['rate<0.1'],    // Error rate under 10%
    },
}

export default function() {
    // Login test
    let loginRes = http.post('http://auth-service:8080/api/v1/auth/login', {
        email: 'test@example.com',
        password: 'password'
    })
    
    check(loginRes, {
        'login successful': (r) => r.status === 200,
        'token received': (r) => r.json('access_token') !== '',
    })
    
    // Token validation test
    let token = loginRes.json('access_token')
    let validateRes = http.get('http://auth-service:8080/api/v1/auth/validate', {
        headers: { 'Authorization': `Bearer ${token}` }
    })
    
    check(validateRes, {
        'token valid': (r) => r.status === 200,
    })
    
    sleep(1)
}
```

#### Security Testing
```bash
# OWASP ZAP scan
docker run -t owasp/zap2docker-stable zap-baseline.py \
    -t http://auth-service:8080 \
    -r security-report.html

# SQLMap for SQL injection
sqlmap -u "http://auth-service:8080/api/v1/auth/login" \
    --data='{"email":"*","password":"*"}' \
    --level=5 --risk=3

# Nikto web scanner
nikto -h http://auth-service:8080

# JWT security
python jwt_tool.py -t http://auth-service:8080 \
    -rc "Authorization: Bearer $TOKEN" \
    -M at
```

### Test Data

```sql
-- Test users
INSERT INTO auth.users (email, name, password_hash, provider, email_verified) VALUES
('admin@test.com', 'Admin User', '$2a$12$...', 'local', true),
('user@test.com', 'Test User', '$2a$12$...', 'local', true),
('google@test.com', 'Google User', NULL, 'google', true);

-- Test tokens
INSERT INTO auth.refresh_tokens (user_id, token_hash, family_id, expires_at) VALUES
(1, 'hash1', 'family1', NOW() + INTERVAL '30 days'),
(2, 'hash2', 'family2', NOW() + INTERVAL '30 days');

-- Test service accounts
INSERT INTO auth.service_accounts (name, api_key_hash, roles) VALUES
('backend-service', '$2a$12$...', '{"service"}'),
('monitoring-service', '$2a$12$...', '{"readonly"}');
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### Prometheus Metrics

```go
// Custom metrics
var (
    loginAttempts = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: "auth_login_attempts_total",
            Help: "Total number of login attempts",
        },
        []string{"status", "provider"},
    )
    
    tokenValidations = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name: "auth_token_validation_duration_seconds",
            Help: "Token validation duration",
            Buckets: []float64{0.001, 0.005, 0.01, 0.025, 0.05, 0.1},
        },
        []string{"token_type"},
    )
    
    activeUsers = prometheus.NewGauge(
        prometheus.GaugeOpts{
            Name: "auth_active_users",
            Help: "Number of active users",
        },
    )
    
    refreshTokenRotations = prometheus.NewCounter(
        prometheus.CounterOpts{
            Name: "auth_refresh_token_rotations_total",
            Help: "Total number of refresh token rotations",
        },
    )
)
```

### Grafana Dashboards

```json
{
  "dashboard": {
    "title": "Auth Service Monitoring",
    "panels": [
      {
        "title": "Login Rate",
        "targets": [
          {
            "expr": "rate(auth_login_attempts_total[5m])"
          }
        ]
      },
      {
        "title": "Token Validation Latency",
        "targets": [
          {
            "expr": "histogram_quantile(0.95, auth_token_validation_duration_seconds)"
          }
        ]
      },
      {
        "title": "Active Users",
        "targets": [
          {
            "expr": "auth_active_users"
          }
        ]
      },
      {
        "title": "Error Rate",
        "targets": [
          {
            "expr": "rate(auth_errors_total[5m])"
          }
        ]
      }
    ]
  }
}
```

### Alerts

```yaml
# prometheus-alerts.yaml
groups:
  - name: auth-service
    rules:
    - alert: HighErrorRate
      expr: rate(auth_errors_total[5m]) > 0.05
      for: 5m
      labels:
        severity: warning
      annotations:
        summary: High error rate in auth service
        description: "Error rate is {{ $value }} errors per second"
    
    - alert: HighLoginFailureRate
      expr: rate(auth_login_attempts_total{status="failed"}[5m]) > 10
      for: 5m
      labels:
        severity: critical
      annotations:
        summary: High login failure rate
        description: "Login failure rate is {{ $value }} per second"
    
    - alert: DatabaseConnectionPoolExhausted
      expr: auth_db_connections_in_use / auth_db_connections_max > 0.9
      for: 5m
      labels:
        severity: critical
      annotations:
        summary: Database connection pool almost exhausted
        description: "{{ $value }}% of connections are in use"
```

### Logging

```go
// Structured logging with context
logger.Info().
    Str("user_id", userID).
    Str("action", "login").
    Str("ip", ipAddress).
    Dur("duration", duration).
    Msg("User logged in successfully")

// Audit logging
auditLogger.Log(AuditEntry{
    UserID:     userID,
    Action:     "password_changed",
    Resource:   "user_account",
    ResourceID: userID,
    IPAddress:  ipAddress,
    UserAgent:  userAgent,
    Success:    true,
    Metadata: map[string]interface{}{
        "old_password_hash": oldHash,
        "new_password_hash": newHash,
    },
})
```

---

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Development Environment

```bash
# Clone repository
git clone https://github.com/svetu/auth-service.git
cd auth-service

# Setup environment
cp .env.example .env
vim .env  # Configure settings

# Generate JWT keys
./scripts/generate-keys.sh

# Start services
docker-compose up -d

# Run migrations
make migrate-up

# Seed test data
make seed

# Run tests
make test

# Start development server
make dev
```

### Staging Environment

```bash
# Build Docker image
docker build -t svetu/auth-service:staging .

# Push to registry
docker push svetu/auth-service:staging

# Deploy to Kubernetes
kubectl apply -f deployments/kubernetes/staging/

# Run smoke tests
./scripts/smoke-test.sh staging
```

### Production Deployment

```bash
# Pre-deployment checks
./scripts/pre-deploy-check.sh

# Create production image
docker build -t svetu/auth-service:v1.0.0 .
docker tag svetu/auth-service:v1.0.0 svetu/auth-service:latest

# Push to registry
docker push svetu/auth-service:v1.0.0
docker push svetu/auth-service:latest

# Blue-Green deployment
kubectl apply -f deployments/kubernetes/production/blue/
./scripts/verify-deployment.sh blue

# Switch traffic
kubectl patch service auth-service -p '{"spec":{"selector":{"version":"blue"}}}'

# Monitor
./scripts/monitor-deployment.sh

# Rollback if needed
kubectl patch service auth-service -p '{"spec":{"selector":{"version":"green"}}}'
```

### CI/CD Pipeline

```yaml
# .github/workflows/ci-cd.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Setup Go
      uses: actions/setup-go@v4
      with:
        go-version: '1.22'
    
    - name: Run tests
      run: |
        go test -v -race -coverprofile=coverage.out ./...
        go tool cover -html=coverage.out -o coverage.html
    
    - name: Upload coverage
      uses: codecov/codecov-action@v3
      with:
        file: ./coverage.out
  
  security:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    
    - name: Run Gosec
      uses: securego/gosec@master
      with:
        args: ./...
    
    - name: Run Trivy
      uses: aquasecurity/trivy-action@master
      with:
        scan-type: 'fs'
        scan-ref: '.'
  
  build:
    needs: [test, security]
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
    - uses: actions/checkout@v3
    
    - name: Build Docker image
      run: docker build -t svetu/auth-service:${{ github.sha }} .
    
    - name: Push to registry
      run: |
        echo ${{ secrets.DOCKER_PASSWORD }} | docker login -u ${{ secrets.DOCKER_USERNAME }} --password-stdin
        docker push svetu/auth-service:${{ github.sha }}
  
  deploy:
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    steps:
    - name: Deploy to Kubernetes
      run: |
        kubectl set image deployment/auth-service auth-service=svetu/auth-service:${{ github.sha }}
        kubectl rollout status deployment/auth-service
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

### OpenAPI Specification

```yaml
openapi: 3.0.0
info:
  title: Auth Service API
  version: 1.0.0
  description: Authentication and Authorization Service
  contact:
    name: API Support
    email: api@svetu.rs
  license:
    name: MIT

servers:
  - url: https://auth.svetu.rs
    description: Production
  - url: https://auth-staging.svetu.rs
    description: Staging
  - url: http://localhost:8080
    description: Development

security:
  - BearerAuth: []

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  
  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
          format: email
        name:
          type: string
        picture_url:
          type: string
          format: uri
        email_verified:
          type: boolean
        created_at:
          type: string
          format: date-time
    
    AuthResponse:
      type: object
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        token_type:
          type: string
          enum: [Bearer]
        expires_in:
          type: integer
        user:
          $ref: '#/components/schemas/User'
    
    Error:
      type: object
      properties:
        error:
          type: string
        message:
          type: string
        details:
          type: object

paths:
  /api/v1/auth/register:
    post:
      summary: Register new user
      operationId: register
      tags: [Authentication]
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password, name]
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                  minLength: 8
                name:
                  type: string
      responses:
        '200':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: User already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
```

### Client SDKs

#### Go SDK
```go
package authclient

import (
    "context"
    "fmt"
    
    "google.golang.org/grpc"
    pb "github.com/svetu/auth-service/pkg/proto"
)

type Client struct {
    conn   *grpc.ClientConn
    client pb.AuthServiceClient
}

func NewClient(address string) (*Client, error) {
    conn, err := grpc.Dial(address, grpc.WithInsecure())
    if err != nil {
        return nil, err
    }
    
    return &Client{
        conn:   conn,
        client: pb.NewAuthServiceClient(conn),
    }, nil
}

func (c *Client) ValidateToken(ctx context.Context, token string) (*pb.ValidateTokenResponse, error) {
    return c.client.ValidateToken(ctx, &pb.ValidateTokenRequest{
        Token: token,
    })
}

func (c *Client) Close() error {
    return c.conn.Close()
}
```

#### TypeScript SDK
```typescript
// auth-client-sdk/src/index.ts
export class AuthClient {
  private readonly baseURL: string
  
  constructor(baseURL: string = 'https://auth.svetu.rs') {
    this.baseURL = baseURL
  }
  
  async login(email: string, password: string): Promise<AuthResponse> {
    const response = await fetch(`${this.baseURL}/api/v1/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password }),
      credentials: 'include',
    })
    
    if (!response.ok) {
      throw new AuthError(await response.json())
    }
    
    return response.json()
  }
  
  async validateToken(token: string): Promise<ValidationResponse> {
    const response = await fetch(`${this.baseURL}/api/v1/auth/validate`, {
      headers: { 'Authorization': `Bearer ${token}` }
    })
    
    return response.json()
  }
  
  async refreshToken(): Promise<AuthResponse> {
    const response = await fetch(`${this.baseURL}/api/v1/auth/refresh`, {
      method: 'POST',
      credentials: 'include',
    })
    
    if (!response.ok) {
      throw new AuthError(await response.json())
    }
    
    return response.json()
  }
}
```

---

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| –£—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ | –ù–∏–∑–∫–∞—è | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ | –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ, –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã, –∞—É–¥–∏—Ç |
| –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞ | –°—Ä–µ–¥–Ω—è—è | –í—ã—Å–æ–∫–æ–µ | Blue-green deployment, rollback –ø–ª–∞–Ω |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∏–∂–µ –æ–∂–∏–¥–∞–µ–º–æ–π | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | Load testing, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ |
| –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | Backward compatibility layer |
| –û—à–∏–±–∫–∏ –≤ —Ç–æ–∫–µ–Ω —Ä–æ—Ç–∞—Ü–∏–∏ | –ù–∏–∑–∫–∞—è | –°—Ä–µ–¥–Ω–µ–µ | Extensive testing, monitoring |

### –ë–∏–∑–Ω–µ—Å —Ä–∏—Å–∫–∏

| –†–∏—Å–∫ | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è |
|------|-------------|---------|-----------|
| –ü–æ—Ç–µ—Ä—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º –≤—Ö–æ–¥–∞ | –ù–∏–∑–∫–∞—è | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ | Graceful degradation, fallback |
| –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤, –∞–≤—Ç–æ—Å–∫–µ–π–ª–∏–Ω–≥ |
| –ó–∞–¥–µ—Ä–∂–∫–∞ —Ä–µ–ª–∏–∑–∞ | –°—Ä–µ–¥–Ω—è—è | –°—Ä–µ–¥–Ω–µ–µ | Agile –ø–æ–¥—Ö–æ–¥, MVP first |
| Compliance –Ω–∞—Ä—É—à–µ–Ω–∏—è | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–æ–µ | Security audit, legal review |

### –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
kubectl scale deployment auth-service --replicas=0

# 2. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ —Å—Ç–∞—Ä—ã–π —Å–µ—Ä–≤–∏—Å
kubectl patch service backend -p '{"spec":{"selector":{"version":"legacy"}}}'

# 3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
pg_restore -h localhost -d svetubd backup_before_migration.sql

# 4. –û—á–∏—Å—Ç–∫–∞ Redis
redis-cli FLUSHALL

# 5. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å—Ç–∞—Ä–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
kubectl rollout restart deployment backend-legacy

# 6. –ü—Ä–æ–≤–µ—Ä–∫–∞
./scripts/health-check.sh legacy
```

---

## üìé –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ A: –ì–ª–æ—Å—Å–∞—Ä–∏–π

| –¢–µ—Ä–º–∏–Ω | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| JWT | JSON Web Token - —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ |
| Refresh Token | –î–æ–ª–≥–æ–∂–∏–≤—É—â–∏–π —Ç–æ–∫–µ–Ω –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è access token |
| Token Rotation | –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–º–µ–Ω—ã refresh token –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ |
| Token Family | –ì—Ä—É–ø–ø–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è |
| Device Fingerprinting | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –ø–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º |
| Rate Limiting | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥ –≤—Ä–µ–º–µ–Ω–∏ |
| OWASP | Open Web Application Security Project |
| MFA | Multi-Factor Authentication |
| SSO | Single Sign-On |
| RBAC | Role-Based Access Control |

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ B: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```env
# Database
DB_HOST=localhost
DB_PORT=5433
DB_NAME=auth_db
DB_USER=auth_user
DB_PASSWORD=secure_password
DB_SSL_MODE=require
DB_MAX_CONNECTIONS=100

# Redis
REDIS_HOST=localhost
REDIS_PORT=6380
REDIS_PASSWORD=redis_password
REDIS_DB=0

# Server
HTTP_PORT=8080
GRPC_PORT=50051
METRICS_PORT=9090

# JWT
JWT_ALGORITHM=RS256
JWT_ACCESS_TOKEN_DURATION=15m
JWT_REFRESH_TOKEN_DURATION=30d
JWT_PRIVATE_KEY_PATH=/etc/auth/keys/private.pem
JWT_PUBLIC_KEY_PATH=/etc/auth/keys/public.pem

# OAuth
GOOGLE_CLIENT_ID=your-client-id
GOOGLE_CLIENT_SECRET=your-client-secret

# Security
BCRYPT_COST=12
RATE_LIMIT_LOGIN=5/15m
RATE_LIMIT_REGISTER=3/1h

# Monitoring
TRACING_ENABLED=true
METRICS_ENABLED=true

# Environment
ENV=production
LOG_LEVEL=info
```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ C: –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
# Health check
curl http://auth-service:8081/health

# Metrics
curl http://auth-service:9090/metrics

# Version info
curl http://auth-service:8080/api/v1/version

# Database migrations
make migrate-up    # Apply migrations
make migrate-down  # Rollback migrations
make migrate-status # Check status

# Redis operations
redis-cli -h localhost -p 6380 --auth password INFO
redis-cli -h localhost -p 6380 --auth password FLUSHDB

# Logs
docker logs auth_service -f --tail 100
kubectl logs deployment/auth-service -f

# Backup
pg_dump -h localhost -p 5433 -U auth_user auth_db > backup.sql
redis-cli -h localhost -p 6380 --auth password BGSAVE

# Performance testing
k6 run scripts/load-test.js
ab -n 10000 -c 100 http://auth-service:8080/api/v1/auth/validate
```

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Auth Service –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã Sve Tu, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é. –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –ø–æ–∑–≤–æ–ª–∏—Ç:

1. **–ü–æ–≤—ã—Å–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** —á–µ—Ä–µ–∑ –∏–∑–æ–ª—è—Ü–∏—é –∏ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã
2. **–£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** –Ω–∞ 200% –±–ª–∞–≥–æ–¥–∞—Ä—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—é
3. **–û–±–µ—Å–ø–µ—á–∏—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ä–æ—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –±–∞–∑—ã
4. **–£–ø—Ä–æ—Å—Ç–∏—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É** —á–µ—Ä–µ–∑ —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
5. **–°–Ω–∏–∑–∏—Ç—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥** —É–¥–∞–ª–µ–Ω–∏–µ–º legacy –∫–æ–¥–∞

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∑–∞–π–º–µ—Ç 5 –Ω–µ–¥–µ–ª—å —Å –∫–æ–º–∞–Ω–¥–æ–π –∏–∑ 3-4 —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤. ROI –æ–∂–∏–¥–∞–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ 6 –º–µ—Å—è—Ü–µ–≤ –∑–∞ —Å—á–µ—Ç —Å–Ω–∏–∂–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏ –ø–æ–≤—ã—à–µ–Ω–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã.

---

**–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** Architecture Team  
**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 06.09.2025  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤ –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

---

*–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è –∂–∏–≤—ã–º –∏ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –ø–æ –º–µ—Ä–µ —Ä–∞–∑–≤–∏—Ç–∏—è –ø—Ä–æ–µ–∫—Ç–∞.*