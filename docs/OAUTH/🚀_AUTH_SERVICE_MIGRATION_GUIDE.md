# üöÄ –†–£–ö–û–í–û–î–°–¢–í–û –ü–û –ü–ï–†–ï–•–û–î–£ –ù–ê AUTH SERVICE –ú–ò–ö–†–û–°–ï–†–í–ò–°

## üìå –ì–õ–ê–í–ù–´–ô –î–û–ö–£–ú–ï–ù–¢ –ú–ò–ì–†–ê–¶–ò–ò

**–°—Ç–∞—Ç—É—Å:** ‚úÖ Auth Service –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏  
**–î–∞—Ç–∞:** 06.09.2025  
**–í–µ—Ä—Å–∏—è Auth Service:** 1.0.0

---

## üéØ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### Auth Service —É–∂–µ –∑–∞–ø—É—â–µ–Ω! 

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:
curl http://localhost:28080/health

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤–µ—Ä—Å–∏—é:
curl http://localhost:28080/api/v1/version
```

---

## üìö –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### üî• –û–°–ù–û–í–ù–´–ï –î–û–ö–£–ú–ï–ù–¢–´ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–∏):

1. **üìã –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏**: [`/data/hostel-booking-system/docs/AUTH_SERVICE_MIGRATION_PLAN.md`](./AUTH_SERVICE_MIGRATION_PLAN.md)
   - –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –ø–µ—Ä–µ—Ö–æ–¥–∞
   - 7 —Ñ–∞–∑ –º–∏–≥—Ä–∞—Ü–∏–∏
   - –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞

2. **‚úÖ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å**: [`/data/hostel-booking-system/docs/AUTH_SERVICE_CURRENT_STATUS.md`](./AUTH_SERVICE_CURRENT_STATUS.md)
   - –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–µ–π—á–∞—Å
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤
   - –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

3. **üîå API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã**: [`/data/auth_svetu/docs/ACTUAL_API_ENDPOINTS.md`](/data/auth_svetu/docs/ACTUAL_API_ENDPOINTS.md)
   - –í—Å–µ —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
   - –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
   - Rate limiting

4. **üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: [`/data/auth_svetu/docs/DOCUMENTATION_FIXES.md`](/data/auth_svetu/docs/DOCUMENTATION_FIXES.md)
   - –ß—Ç–æ –±—ã–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
   - –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## ‚ö° –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### 1Ô∏è‚É£ Backend - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∫—Å–∏ –≤ –º–æ–Ω–æ–ª–∏—Ç

```go
// backend/internal/service/authclient/client.go
package authclient

import (
    "net/http"
    "google.golang.org/grpc"
)

type Client struct {
    httpClient *http.Client
    grpcConn   *grpc.ClientConn
    baseURL    string // http://localhost:28080
}

// –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã:
// OLD: /api/v1/auth/login 
// NEW: http://localhost:28080/api/v1/auth/login
```

### 2Ô∏è‚É£ Frontend - –æ–±–Ω–æ–≤–∏—Ç—å endpoints

```typescript
// frontend/src/config/api.ts
const AUTH_SERVICE_URL = process.env.NEXT_PUBLIC_AUTH_SERVICE_URL || '/api/v1/auth';

// –ó–∞–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ø—É—Ç–∏ –Ω–∞ –Ω–æ–≤—ã–µ:
// OLD: /auth/google
// NEW: /api/v1/auth/oauth/google
```

### 3Ô∏è‚É£ Nginx - –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ

```nginx
location /api/v1/auth/ {
    proxy_pass http://localhost:28080/api/v1/auth/;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}
```

---

## üóÇÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

### Auth Service (–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å)
```
üì¶ /data/auth_svetu/
‚îú‚îÄ‚îÄ üìÅ cmd/          # –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ üìÅ internal/     # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ üìÅ keys/         # JWT –∫–ª—é—á–∏ (RS256)
‚îú‚îÄ‚îÄ üìÅ docs/         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ üìÑ .env          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ üê≥ docker-compose.yml
```

### –ú–æ–Ω–æ–ª–∏—Ç (–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞)
```
üì¶ /data/hostel-booking-system/
‚îú‚îÄ‚îÄ üìÅ backend/      # Go backend (–ø–æ—Ä—Ç 3000)
‚îú‚îÄ‚îÄ üìÅ frontend/     # Next.js (–ø–æ—Ä—Ç 3001)
‚îî‚îÄ‚îÄ üìÅ docs/         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| **–ú–æ–Ω–æ–ª–∏—Ç Backend** | 3000 | –¢–µ–∫—É—â–∏–π backend |
| **Frontend** | 3001 | Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ |
| **Auth Service HTTP** | 28080 | REST API –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ |
| **Auth Service gRPC** | 50051 | gRPC –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ |
| **Auth PostgreSQL** | 25432 | –ë–î –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ |
| **Auth Redis** | 26379 | –ö–µ—à —Å–µ—Å—Å–∏–π |

---

## üìù –ß–µ–∫-–ª–∏—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

### ‚úÖ –£–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ:
- [x] Auth Service –∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ Docker Compose
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã JWT –∫–ª—é—á–∏ (RS256)
- [x] –ù–∞—Å—Ç—Ä–æ–µ–Ω Google OAuth
- [x] –°–æ–∑–¥–∞–Ω –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞

### ‚è≥ –ù—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:
- [ ] –°–æ–∑–¥–∞—Ç—å Auth Client –≤ –º–æ–Ω–æ–ª–∏—Ç–µ
- [ ] –û–±–Ω–æ–≤–∏—Ç—å middleware –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –û–±–Ω–æ–≤–∏—Ç—å frontend endpoints
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å nginx
- [ ] –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π –ë–î
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ flows
- [ ] –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å production —Ç—Ä–∞—Ñ–∏–∫

---

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### ‚ö†Ô∏è –û—Ç–ª–∏—á–∏—è –æ—Ç —Å—Ç–∞—Ä–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
1. **Go –≤–µ—Ä—Å–∏—è**: –¢—Ä–µ–±—É–µ—Ç—Å—è 1.23, –Ω–µ 1.22
2. **–ü–æ—Ä—Ç—ã**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ (28080 –≤–º–µ—Å—Ç–æ 8080)
3. **Health endpoint**: `/health`, –∞ –Ω–µ `/api/v1/health`
4. **JWT –∫–ª—é—á–∏**: –í –ø–∞–ø–∫–µ `./keys/`, –∞ –Ω–µ `/etc/auth/keys/`

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- JWT —Ç–æ–∫–µ–Ω—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç RS256 (–∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ)
- Rate limiting –∞–∫—Ç–∏–≤–µ–Ω –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö origins
- –ü–∞—Ä–æ–ª–∏ –≤ .env —Ñ–∞–π–ª–µ (–Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å!)

---

## üõ†Ô∏è –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

```bash
# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
docker ps | grep auth

# –õ–æ–≥–∏
docker logs auth_service -f
docker logs auth_postgres
docker logs auth_redis

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
cd /data/auth_svetu && docker-compose restart

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞
cd /data/auth_svetu
docker-compose down -v
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:28080/health | jq .
```

---

## üîÑ –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫:

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Auth Service
cd /data/auth_svetu && docker-compose down

# 2. –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx
cp /etc/nginx/sites-available/svetu.backup /etc/nginx/sites-available/svetu
nginx -s reload

# 3. –û—Ç–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ backend
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ .env: USE_AUTH_SERVICE=false
```

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å–º–æ—Ç—Ä–∏—Ç–µ:
1. –õ–æ–≥–∏: `docker logs auth_service -f`
2. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π: `/data/auth_svetu/docs/DOCUMENTATION_FIXES.md`
3. –ê–∫—Ç—É–∞–ª—å–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã: `/data/auth_svetu/docs/ACTUAL_API_ENDPOINTS.md`

---

## ‚ú® –†–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:
- üöÄ –ù–µ–∑–∞–≤–∏—Å–∏–º—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- üîê –£–ª—É—á—à–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (RS256 JWT)
- üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (10k+ RPS)
- üîÑ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- üõ°Ô∏è Rate limiting –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞

---

**–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —è–≤–ª—è–µ—Ç—Å—è –≥–ª–∞–≤–Ω—ã–º —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ–º –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ–≥–æ!**