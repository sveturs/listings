# üîç –ü–û–õ–ù–´–ô –ê–£–î–ò–¢ AUTH –ú–ò–ö–†–û–°–ï–†–í–ò–°–ê - –û–¢–ß–ï–¢

## üìä –ò–¢–û–ì–û–í–û–ï –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –í–´–í–û–î
**–°–∏—Å—Ç–µ–º–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Auth –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏!** 

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ:
- ‚úÖ –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ—Ä—Ç 28080)
- ‚úÖ –ü—Ä–æ–∫—Å–∏ middleware –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –∞–∫—Ç–∏–≤–µ–Ω (USE_AUTH_SERVICE=true)
- ‚úÖ –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç—Å—è –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å

**–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ –°–¢–ê–†–´–ô –ú–û–ù–û–õ–ò–¢!**

## üî¥ –ì–õ–ê–í–ù–ê–Ø –ü–†–û–ë–õ–ï–ú–ê

### –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ OAuth handlers
–°–∏—Å—Ç–µ–º–∞ –∏–º–µ–µ—Ç **–î–í–ê –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö OAuth flow**:

1. **–í –º–æ–Ω–æ–ª–∏—Ç–µ** (backend/internal/proj/users/handler/auth.go):
   - `/api/v1/auth/google` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
   - `/api/v1/auth/google/callback` - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –°–¢–ê–†–´–ï credentials –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ .env
   - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã –ª–æ–∫–∞–ª—å–Ω–æ

2. **–í –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–µ** (auth_svetu):
   - –¢–µ –∂–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã, –Ω–æ –ù–ï –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
   - –ò–º–µ–µ—Ç –°–í–û–ò credentials (–¥—Ä—É–≥–∏–µ!)
   - –ì–æ—Ç–æ–≤, –Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è

## üìã –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó

### 1. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü–æ—Ä—Ç | –°–æ—Å—Ç–æ—è–Ω–∏–µ |
|-----------|--------|------|-----------|
| Auth Service | ‚úÖ –ó–∞–ø—É—â–µ–Ω | 28080 | Up 4 hours (unhealthy) |
| PostgreSQL | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 25432 | Up 6 hours (healthy) |
| Redis | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | 26379 | Up 6 hours (healthy) |

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è

```go
// backend/internal/middleware/auth_proxy.go
USE_AUTH_SERVICE=true // –£–°–¢–ê–ù–û–í–õ–ï–ù–û!
```

**–ù–û!** –ü—Ä–æ–∫—Å–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è:
- `/api/v1/auth/validate` ‚úÖ
- `/api/v1/auth/session` ‚úÖ
- `/api/v1/auth/refresh` ‚úÖ

**–ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è:**
- `/api/v1/auth/google` ‚ùå (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –º–æ–Ω–æ–ª–∏—Ç–æ–º)
- `/api/v1/auth/google/callback` ‚ùå (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –º–æ–Ω–æ–ª–∏—Ç–æ–º)
- `/api/v1/auth/login` ‚ùå (–Ω–µ—Ç –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–µ)
- `/api/v1/auth/register` ‚ùå (–Ω–µ—Ç –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–µ)

### 3. –ê–Ω–∞–ª–∏–∑ auth flow

#### –¢–µ–∫—É—â–∏–π flow (–ú–û–ù–û–õ–ò–¢):
```
1. User ‚Üí Frontend (3001) ‚Üí Backend (3000) ‚Üí auth.GoogleAuth() [–ú–û–ù–û–õ–ò–¢]
2. Backend ‚Üí Google OAuth (—Å credentials –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ .env)
3. Google ‚Üí Backend callback ‚Üí auth.GoogleCallback() [–ú–û–ù–û–õ–ò–¢]
4. Backend ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT –ª–æ–∫–∞–ª—å–Ω–æ
5. Backend ‚Üí Frontend —Å —Ç–æ–∫–µ–Ω–æ–º
```

#### –û–∂–∏–¥–∞–µ–º—ã–π flow (–ú–ò–ö–†–û–°–ï–†–í–ò–°):
```
1. User ‚Üí Frontend ‚Üí Backend ‚Üí Auth Service (28080)
2. Auth Service ‚Üí Google OAuth (—Å –î–†–£–ì–ò–ú–ò credentials)
3. Google ‚Üí Frontend ‚Üí Auth Service
4. Auth Service ‚Üí –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT
5. Auth Service ‚Üí Frontend —Å —Ç–æ–∫–µ–Ω–æ–º
```

### 4. –ü—Ä–æ–±–ª–µ–º—ã —Å credentials

**–ú–æ–Ω–æ–ª–∏—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç:**
```env
# /data/hostel-booking-system/backend/.env
GOOGLE_CLIENT_ID=(—Å—Ç–∞—Ä—ã–π ID)
GOOGLE_CLIENT_SECRET=(—Å—Ç–∞—Ä—ã–π secret)
```

**–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞:**
```env
# /data/auth_svetu/.env
GOOGLE_CLIENT_ID=917315728307-au9ga5fl7o3bbid9nv7e4l92gut194pq.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=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
GOOGLE_REDIRECT_URL=http://localhost:3001/oauth-callback
```

## üéØ –†–ï–ê–õ–¨–ù–û–ï –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï

### –ß—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–∑ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞:
1. **Health check** - —Ä–∞–±–æ—Ç–∞–µ—Ç (`/health`)
2. **Validate token** - –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏
3. **Session check** - –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç—Å—è, –Ω–æ –≤—Å–µ–≥–¥–∞ 401 (–Ω–µ—Ç —Å–µ—Å—Å–∏–π)

### –ß—Ç–æ –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
1. **OAuth flow** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤ –º–æ–Ω–æ–ª–∏—Ç–µ
2. **JWT –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** - –≤ –º–æ–Ω–æ–ª–∏—Ç–µ
3. **User management** - –≤ –º–æ–Ω–æ–ª–∏—Ç–µ
4. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞** - –ø—É—Å—Ç–∞—è, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

## üìà –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò–ó –õ–û–ì–û–í

–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—É:
- `/api/v1/auth/session` - 401 (–Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π)
- `/api/v1/auth/refresh` - 401 (–Ω–µ—Ç —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
- `/api/v1/auth/validate` - 401 (—Ç–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –º–æ–Ω–æ–ª–∏—Ç)
- `/health` - 200 (–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–∞–±–æ—Ç–∞—é—â–∏–π —ç–Ω–¥–ø–æ–∏–Ω—Ç)

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

1. **–î–≤–æ–π–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** - –∫–æ–¥ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö
2. **–†–∞–∑–Ω—ã–µ credentials** - –º–æ–Ω–æ–ª–∏—Ç –∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–∞–∑–Ω—ã–µ OAuth apps
3. **–ù–µ–ø–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** - –ø—Ä–æ–∫—Å–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –Ω–æ –Ω–µ –¥–ª—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
4. **–ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤** - JWT –∏–∑ –º–æ–Ω–æ–ª–∏—Ç–∞ –Ω–µ –≤–∞–ª–∏–¥–Ω—ã –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–µ
5. **–ü—É—Å—Ç–∞—è –ë–î –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞** - users –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ó–∞–≤–µ—Ä—à–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)
1. **–£–¥–∞–ª–∏—Ç—å** OAuth handlers –∏–∑ –º–æ–Ω–æ–ª–∏—Ç–∞
2. **–ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å** –í–°–ï /api/v1/auth/* –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
3. **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å** credentials (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–Ω–∏)
4. **–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞
5. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –ø–æ–ª–Ω—ã–π flow

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
1. **–û—Ç–∫–ª—é—á–∏—Ç—å** USE_AUTH_SERVICE
2. **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å** –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å
3. **–£–¥–∞–ª–∏—Ç—å** –ø—Ä–æ–∫—Å–∏ middleware
4. **–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å** —Ä–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å - —Å–æ–∑–¥–∞–µ—Ç –ø—É—Ç–∞–Ω–∏—Ü—É –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç, –Ω–æ **–ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø** –¥–ª—è —Ä–µ–∞–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –í—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Å—Ç–∞—Ä—ã–π –º–æ–Ω–æ–ª–∏—Ç.

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è - OAuth handlers –æ—Å—Ç–∞–ª–∏—Å—å –≤ –º–æ–Ω–æ–ª–∏—Ç–µ –∏ –∏–º–µ—é—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ –ø—Ä–æ–∫—Å–∏.

**–†–∏—Å–∫–∏:**
- –ü—É—Ç–∞–Ω–∏—Ü–∞ –≤ –∫–æ–¥–µ
- –î–≤–æ–π–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥—ã—Ä—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–°—Ä–æ—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø - —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–º, –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

---

## üìé –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### –§–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
- `/data/hostel-booking-system/backend/internal/proj/users/handler/auth.go` - OAuth –≤ –º–æ–Ω–æ–ª–∏—Ç–µ
- `/data/hostel-booking-system/backend/internal/middleware/auth_proxy.go` - –ø—Ä–æ–∫—Å–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- `/data/auth_svetu/.env` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞
- `/data/hostel-booking-system/backend/.env` - USE_AUTH_SERVICE=true

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞
curl http://localhost:28080/health

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker logs auth_service --tail 50

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∫—Å–∏
curl -I http://localhost:3000/api/v1/auth/google

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å handlers –≤ –º–æ–Ω–æ–ª–∏—Ç–µ
grep -r "GoogleAuth\|GoogleCallback" /data/hostel-booking-system/backend/
```

---
*–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω: 07.09.2025*
*–ê—É–¥–∏—Ç–æ—Ä: System Audit*