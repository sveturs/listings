# üë• –ê–£–î–ò–¢ –°–ò–°–¢–ï–ú–´ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô
## –î–∞—Ç–∞: 2025-09-16

---

## üìä –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ:
- **–í—Å–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**: 11
- **–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö email**: 11
- **–ê–∫—Ç–∏–≤–Ω—ã—Ö**: 11 (100%)
- **–ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π**: 8 (73%)

### –ú–µ—Ç–æ–¥—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
- **Google OAuth**: 7 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (64%)
- **Email/Password**: 4 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (36%)

---

## üóÇÔ∏è –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ù–´–•

### –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ `users`
```sql
–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:
- id (PK)
- email (unique)
- name
- google_id (–¥–ª—è OAuth)
- password (–¥–ª—è email auth)
- provider (google/email)
- role_id (FK to roles)
- account_status (active/inactive/suspended)
- preferred_language (ru/sr/en)
- last_seen
- settings (JSONB)
```

### –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã (11 —à—Ç—É–∫):
1. `user_balances` - –±–∞–ª–∞–Ω—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. `user_behavior_events` - —Å–æ–±—ã—Ç–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è
3. `user_contacts` - –∫–æ–Ω—Ç–∞–∫—Ç—ã
4. `user_privacy_settings` - –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏
5. `user_roles` - —Å–≤—è–∑—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–æ–ª–µ–π
6. `user_storefronts` - –≤–∏—Ç—Ä–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
7. `user_subscriptions` - –ø–æ–¥–ø–∏—Å–∫–∏
8. `user_telegram_connections` - Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
9. `admin_users` - –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
10. `users` - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
11. `pg_user_mapping` - —Å–∏—Å—Ç–µ–º–Ω–∞—è PostgreSQL

---

## üëÆ –°–ò–°–¢–ï–ú–ê –†–û–õ–ï–ô

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–æ–ª–µ–π:
- **user**: 4 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–±—ã—á–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
- **admin**: 3 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã)
- **warehouse_manager**: 1 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- **–ù–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ä–æ–ª–µ–π**: 27 (90% —Ä–æ–ª–µ–π –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è!)

### –í—Å–µ–≥–æ —Ä–æ–ª–µ–π –≤ —Å–∏—Å—Ç–µ–º–µ: 30
–í–∫–ª—é—á–∞—è: super_admin, moderator, support (L1-L3), vendor, courier –∏ –¥—Ä.

---

## üîç –í–´–Ø–í–õ–ï–ù–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 1. ‚ö†Ô∏è –ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å —Ä–æ–ª–µ–π
- **–ü—Ä–æ–±–ª–µ–º–∞**: 27 –∏–∑ 30 —Ä–æ–ª–µ–π –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- **–†–∏—Å–∫**: –£—Å–ª–æ–∂–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã, –ø—É—Ç–∞–Ω–∏—Ü–∞ –≤ –ø—Ä–∞–≤–∞—Ö
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ä–æ–ª–µ–π

### 2. ‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Ç –ø–æ–ª—è `email_verified`
- **–†–∏—Å–∫**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å —á—É–∂–∏–º email
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –î–æ–±–∞–≤–∏—Ç—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é email

### 3. ‚ö†Ô∏è –°–º–µ—à–∞–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- **–ü—Ä–æ–±–ª–µ–º–∞**: –î–≤–∞ —Ç–∏–ø–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –±–µ–∑ —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–†–∏—Å–∫**: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤, —Å–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –†–∞–∑—Ä–µ—à–∏—Ç—å —Å–≤—è–∑—ã–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤

### 4. ‚ö†Ô∏è –ù–µ—Ç –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç 2FA
- **–†–∏—Å–∫**: –£—è–∑–≤–∏–º–æ—Å—Ç—å –¥–ª—è –≤–∑–ª–æ–º–∞ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í–Ω–µ–¥—Ä–∏—Ç—å 2FA —á–µ—Ä–µ–∑ TOTP

### 5. ‚ö†Ô∏è –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫
- **–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –æ–¥–Ω–æ–º JSONB –ø–æ–ª–µ
- **–†–∏—Å–∫**: –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞ –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –í—ã–Ω–µ—Å—Ç–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

---

## ‚úÖ –ü–û–ó–ò–¢–ò–í–ù–´–ï –ú–û–ú–ï–ù–¢–´

1. **–•–æ—Ä–æ—à–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è**
   - –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ email, phone, role_id, status
   - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ lower(email)

2. **Check constraints**
   - –í–∞–ª–∏–¥–∞—Ü–∏—è account_status
   - –í–∞–ª–∏–¥–∞—Ü–∏—è preferred_language

3. **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤**
   - –ü–æ–ª–µ timezone –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

4. **–ì–∏–±–∫–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**
   - JSONB –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫

5. **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ru/sr/en —è–∑—ã–∫–æ–≤

---

## üìà –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. **–î–æ–±–∞–≤–∏—Ç—å email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é**
   ```sql
   ALTER TABLE users ADD COLUMN email_verified BOOLEAN DEFAULT FALSE;
   ALTER TABLE users ADD COLUMN email_verification_token VARCHAR(255);
   ALTER TABLE users ADD COLUMN email_verified_at TIMESTAMP;
   ```

2. **–í–Ω–µ–¥—Ä–∏—Ç—å 2FA**
   ```sql
   ALTER TABLE users ADD COLUMN two_factor_enabled BOOLEAN DEFAULT FALSE;
   ALTER TABLE users ADD COLUMN two_factor_secret VARCHAR(255);
   ```

3. **–û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–æ–ª–∏**
   - –ü—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ª–∏—à–Ω–∏–µ

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. **–°–≤—è–∑—ã–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤**
   - –ü–æ–∑–≤–æ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–≤—è–∑–∞—Ç—å Google –∏ email –∞–∫–∫–∞—É–Ω—Ç—ã

2. **–ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π**
   - –î–æ–±–∞–≤–∏—Ç—å –∞—É–¥–∏—Ç –≤–∞–∂–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

3. **–£–ª—É—á—à–∏—Ç—å privacy settings**
   - –†–∞—Å—à–∏—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É user_privacy_settings

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:
1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–æ–ª–µ–π**
   - Redis –∫—ç—à –¥–ª—è —á–∞—Å—Ç—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø—Ä–∞–≤

2. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ–≤–µ–¥–µ–Ω–∏—è**
   - –†–∞—Å—à–∏—Ä–∏—Ç—å user_behavior_events

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- ‚úÖ –ü–∞—Ä–æ–ª–∏ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω—ã (–ø—Ä–µ–¥–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ bcrypt)
- ‚úÖ OAuth 2.0 —á–µ—Ä–µ–∑ Google
- ‚ö†Ô∏è –ù–µ—Ç rate limiting –Ω–∞ login
- ‚ö†Ô∏è –ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
- ‚ö†Ô∏è –ù–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. –í–Ω–µ–¥—Ä–∏—Ç—å rate limiting (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5 –ø–æ–ø—ã—Ç–æ–∫ –≤ –º–∏–Ω—É—Ç—É)
2. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞ –ø–æ—Å–ª–µ 10 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫
3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
4. –†–µ–≥—É–ª—è—Ä–Ω—ã–π –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üìä –ú–ï–¢–†–ò–ö–ò –ò –ú–û–ù–ò–¢–û–†–ò–ù–ì

### –ß—Ç–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å:
1. **–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**
   - DAU/MAU (Daily/Monthly Active Users)
   - Retention rate
   - Churn rate

2. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - –ù–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
   - –°–º–µ–Ω–∞ –ø–∞—Ä–æ–ª–µ–π
   - –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –í—Ä–µ–º—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ—Å—Å–∏–π
   - –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î

---

## üéØ –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### –§–∞–∑–∞ 1 (1-2 –Ω–µ–¥–µ–ª–∏):
- [ ] –î–æ–±–∞–≤–∏—Ç—å email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é
- [ ] –í–Ω–µ–¥—Ä–∏—Ç—å rate limiting
- [ ] –û—á–∏—Å—Ç–∏—Ç—å –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–æ–ª–∏

### –§–∞–∑–∞ 2 (3-4 –Ω–µ–¥–µ–ª–∏):
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å 2FA
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥–æ–≤
- [ ] –£–ª—É—á—à–∏—Ç—å privacy settings

### –§–∞–∑–∞ 3 (1-2 –º–µ—Å—è—Ü–∞):
- [ ] –°–≤—è–∑—ã–≤–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- [ ] –ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

---

## üìà KPI –°–ò–°–¢–ï–ú–´

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ | –¶–µ–ª–µ–≤–æ–µ | –°—Ç–∞—Ç—É—Å |
|---------|---------|---------|---------|
| –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | 73% | 80% | ‚ö†Ô∏è |
| –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö email | 0% | 100% | ‚ùå |
| –° –≤–∫–ª—é—á–µ–Ω–Ω—ã–º 2FA | 0% | 30% | ‚ùå |
| –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö —Ä–æ–ª–µ–π | 10% | 50% | ‚ùå |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (1-10) | 5 | 8 | ‚ö†Ô∏è |

---

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞**: 2025-09-16
**–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª**: System Audit