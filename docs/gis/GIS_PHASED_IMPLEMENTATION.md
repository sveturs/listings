# üó∫Ô∏è GIS –º–æ–¥—É–ª—å - –ü–æ—ç—Ç–∞–ø–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–í–µ—Ä—Å–∏—è**: 1.0  
**–î–∞—Ç–∞**: 2025-01-10  
**–ü—Ä–∏–Ω—Ü–∏–ø**: –ö–∞–∂–¥–∞—è —Ñ–∞–∑–∞ - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç

## üìä –û–±–∑–æ—Ä —Ñ–∞–∑

| –§–∞–∑–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ | –°—Ä–æ–∫ | –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å |
|------|----------|------|-------------------|
| **1** | –ë–∞–∑–æ–≤–∞—è –∫–∞—Ä—Ç–∞ | 4 –Ω–µ–¥–µ–ª–∏ | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –∏ –≤–∏—Ç—Ä–∏–Ω –Ω–∞ –∫–∞—Ä—Ç–µ |
| **2** | –ì–µ–æ–ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã | 4 –Ω–µ–¥–µ–ª–∏ | –ü–æ–∏—Å–∫ –ø–æ —Ä–∞–¥–∏—É—Å—É, —Ä–∞–π–æ–Ω–∞–º, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è |
| **3** | –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ | 4 –Ω–µ–¥–µ–ª–∏ | AI-–ø–æ–∏—Å–∫, —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ |

---

## üéØ –§–ê–ó–ê 1: –ë–∞–∑–æ–≤–∞—è –∫–∞—Ä—Ç–∞ (4 –Ω–µ–¥–µ–ª–∏)

### –¶–µ–ª—å
–î–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–∏–¥–µ—Ç—å —Ç–æ–≤–∞—Ä—ã –∏ –≤–∏—Ç—Ä–∏–Ω—ã –Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ä—Ç–µ.

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

#### –î–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π:
- ‚úÖ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ –≤–∏—Ç—Ä–∏–Ω–∞–º–∏
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ –º–∞—Ä–∫–µ—Ä—ã (–æ–±—ä—è–≤–ª–µ–Ω–∏—è, –≤–∏—Ç—Ä–∏–Ω—ã, —Ç–æ–≤–∞—Ä—ã –≤–∏—Ç—Ä–∏–Ω)
- ‚úÖ –ö–ª–∏–∫ –Ω–∞ –º–∞—Ä–∫–µ—Ä ‚Üí –ø—Ä–µ–≤—å—é ‚Üí –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Ç–æ–≤–∞—Ä—É/–≤–∏—Ç—Ä–∏–Ω–µ
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–ª–æ–µ–≤ –∫–∞—Ä—Ç—ã
- ‚úÖ –¢–µ–∫—É—â–∞—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### –î–ª—è –ø—Ä–æ–¥–∞–≤—Ü–æ–≤:
- ‚úÖ –£–∫–∞–∑–∞–Ω–∏–µ —Ç–æ—á–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
- ‚úÖ –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ (—Ç–æ—á–Ω—ã–π/—Ä–∞–π–æ–Ω/–æ–±–ª–∞—Å—Ç—å)
- ‚úÖ –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–∏—Ç—Ä–∏–Ω—ã

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:
```sql
-- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–∞–±–ª–∏—Ü
CREATE EXTENSION IF NOT EXISTS postgis;

-- –ì–µ–æ–¥–∞–Ω–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
CREATE TABLE listings_geo (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    listing_id UUID NOT NULL REFERENCES marketplace_listings(id),
    location GEOGRAPHY(POINT, 4326) NOT NULL,
    location_privacy VARCHAR(20) DEFAULT 'exact',
    blurred_location GEOGRAPHY(POINT, 4326),
    city VARCHAR(100),
    district VARCHAR(100),
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏—Ç—Ä–∏–Ω –Ω–∞ –∫–∞—Ä—Ç–µ
CREATE TABLE storefront_map_settings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    storefront_id UUID NOT NULL REFERENCES storefronts(id),
    display_location VARCHAR(20) DEFAULT 'exact',
    show_on_map BOOLEAN DEFAULT true,
    products_show_on_map BOOLEAN DEFAULT false,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –§—É–Ω–∫—Ü–∏—è —Ä–∞–∑–º—ã—Ç–∏—è
CREATE OR REPLACE FUNCTION blur_coordinates(
    p_location GEOGRAPHY,
    p_privacy VARCHAR
) RETURNS GEOGRAPHY AS $$
-- implementation
$$ LANGUAGE plpgsql;
```

#### API Endpoints:
```yaml
# –ü–æ–ª—É—á–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∫–∞—Ä—Ç—ã
GET /api/v1/gis/map/items:
  parameters:
    - bounds: string (sw_lat,sw_lng,ne_lat,ne_lng)
    - types: array[listing,storefront]
  response:
    items: array of MapItem

# –û–±–Ω–æ–≤–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –æ–±—ä—è–≤–ª–µ–Ω–∏—è
PUT /api/v1/listings/{id}/location:
  body:
    lat: number
    lng: number
    privacy: exact|district|area
```

#### Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
```typescript
// –ë–∞–∑–æ–≤–∞—è –∫–∞—Ä—Ç–∞
<BasicMap 
  center={[44.8178, 20.4568]} // –ë–µ–ª–≥—Ä–∞–¥
  zoom={12}
  items={mapItems}
  onMarkerClick={handleMarkerClick}
/>

// –ü—Ä–µ–≤—å—é —Ç–æ–≤–∞—Ä–∞/–≤–∏—Ç—Ä–∏–Ω—ã
<MapItemPreview 
  item={selectedItem}
  onNavigate={handleNavigate}
/>
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç –§–∞–∑—ã 1
- –†–∞–±–æ—Ç–∞—é—â–∞—è –∫–∞—Ä—Ç–∞ —Å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ –∏—Å–∫–∞—Ç—å —Ç–æ–≤–∞—Ä—ã
- –ü—Ä–æ–¥–∞–≤—Ü—ã –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—Ç –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –ª–æ–∫–∞—Ü–∏–∏
- **–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞**: 20% –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞—Ä—Ç—É

---

## üîç –§–ê–ó–ê 2: –ì–µ–æ–ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã (4 –Ω–µ–¥–µ–ª–∏)

### –¶–µ–ª—å
–î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º –∫—Ä–∏—Ç–µ—Ä–∏—è–º.

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ –§–∞–∑–µ 1)

#### –î–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π:
- ‚úÖ –ü–æ–∏—Å–∫ –≤ —Ä–∞–¥–∏—É—Å–µ –æ—Ç —Ç–æ—á–∫–∏ ("–≤ 5 –∫–º –æ—Ç –º–µ–Ω—è")
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ —Ä–∞–π–æ–Ω–∞–º –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–º –µ–¥–∏–Ω–∏—Ü–∞–º
- ‚úÖ –§–∏–ª—å—Ç—Ä—ã: –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, —Ü–µ–Ω–∞, –¥–æ—Å—Ç–∞–≤–∫–∞, —Ä–µ–π—Ç–∏–Ω–≥
- ‚úÖ –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ –ø—Ä–∏ –æ—Ç–¥–∞–ª–µ–Ω–∏–∏
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

#### –î–ª—è –ø—Ä–æ–¥–∞–≤—Ü–æ–≤:
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–æ–Ω –¥–æ—Å—Ç–∞–≤–∫–∏ –¥–ª—è –≤–∏—Ç—Ä–∏–Ω
- ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º —Ç–æ–≤–∞—Ä–æ–≤ –≤–∏—Ç—Ä–∏–Ω—ã –Ω–∞ –∫–∞—Ä—Ç–µ
- ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ —á–µ—Ä–µ–∑ –∫–∞—Ä—Ç—É

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è):
```sql
-- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã
CREATE TABLE administrative_boundaries (
    id UUID PRIMARY KEY,
    name VARCHAR(100),
    type VARCHAR(50), -- municipality, district
    boundary GEOGRAPHY(MULTIPOLYGON, 4326),
    center_point GEOGRAPHY(POINT, 4326)
);

-- –ó–æ–Ω—ã –¥–æ—Å—Ç–∞–≤–∫–∏
CREATE TABLE delivery_zones (
    id UUID PRIMARY KEY,
    storefront_id UUID REFERENCES storefronts(id),
    zone_polygon GEOGRAPHY(POLYGON, 4326),
    delivery_fee DECIMAL(10,2),
    min_order_amount DECIMAL(10,2)
);

-- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
CREATE INDEX idx_listings_geo_location ON listings_geo USING GIST(location);
CREATE INDEX idx_delivery_zones_polygon ON delivery_zones USING GIST(zone_polygon);

-- –§—É–Ω–∫—Ü–∏—è –ø–æ–∏—Å–∫–∞ –≤ —Ä–∞–¥–∏—É—Å–µ
CREATE FUNCTION search_radius(center GEOGRAPHY, radius_m INT)
RETURNS TABLE(...) AS $$
-- optimized spatial query
$$ LANGUAGE plpgsql;
```

#### API Endpoints (–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è):
```yaml
# –ü–æ–∏—Å–∫ –≤ —Ä–∞–¥–∏—É—Å–µ
POST /api/v1/gis/search/radius:
  body:
    lat: number
    lng: number
    radius: number (meters)
    filters:
      categories: array
      priceMin: number
      priceMax: number

# –ü–æ–∏—Å–∫ –ø–æ —Ä–∞–π–æ–Ω—É
GET /api/v1/gis/search/district:
  parameters:
    - district_id: string
    - filters: object

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–æ–Ω–∞–º–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
POST /api/v1/storefronts/{id}/delivery-zones:
  body:
    zones: array of DeliveryZone
```

#### Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è):
```typescript
// –ü–∞–Ω–µ–ª—å –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
<GeoSearchPanel>
  <RadiusSearch onSearch={handleRadiusSearch} />
  <DistrictSelector districts={districts} />
  <FilterPanel filters={filters} onChange={setFilters} />
</GeoSearchPanel>

// –†–µ–¥–∞–∫—Ç–æ—Ä –∑–æ–Ω –¥–æ—Å—Ç–∞–≤–∫–∏
<DeliveryZoneEditor 
  storefront={storefront}
  onSave={handleSaveZones}
/>
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenSearch:
```json
{
  "mappings": {
    "properties": {
      "location": {
        "type": "geo_point"
      },
      "district": {
        "type": "keyword"
      },
      "delivery_zones": {
        "type": "geo_shape"
      }
    }
  }
}
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç –§–∞–∑—ã 2
- –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –≥–µ–æ–ø–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Ä–∞–π–æ–Ω–∞–º
- –ü—Ä–æ–¥–∞–≤—Ü—ã –º–æ–≥—É—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å –¥–æ—Å—Ç–∞–≤–∫—É
- **–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞**: 35% –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞—Ä—Ç—É, +20% –∫–æ–Ω–≤–µ—Ä—Å–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

---

## ü§ñ –§–ê–ó–ê 3: –£–º–Ω—ã–π –ø–æ–∏—Å–∫ –∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ (4 –Ω–µ–¥–µ–ª–∏)

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—É—é —Å–∏—Å—Ç–µ–º—É –ø–æ–∏—Å–∫–∞ –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å –≥–ª—É–±–æ–∫—É—é –∞–Ω–∞–ª–∏—Ç–∏–∫—É.

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ –§–∞–∑–∞–º 1-2)

#### –î–ª—è –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π:
- ‚úÖ –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫–æ–≤–æ–π –ø–æ–∏—Å–∫ ("–¥–µ—Ç—Å–∫–∞—è –∫–æ–ª—è—Å–∫–∞ –¥–æ 10000 —Ä—è–¥–æ–º —Å –ø–∞—Ä–∫–æ–º")
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ –º–∞—Ä—à—Ä—É—Ç—É ("–ø–æ –¥–æ—Ä–æ–≥–µ –¥–æ–º–æ–π")
- ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö —Ç–æ–≤–∞—Ä–∞—Ö –≤ –ª—é–±–∏–º—ã—Ö —Ä–∞–π–æ–Ω–∞—Ö
- ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –ø–æ–∏—Å–∫–æ–≤ –∏ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ –∑–æ–Ω—ã

#### –î–ª—è –ø—Ä–æ–¥–∞–≤—Ü–æ–≤:
- ‚úÖ –¢–µ–ø–ª–æ–≤—ã–µ –∫–∞—Ä—Ç—ã –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª–µ–π
- ‚úÖ –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –ø–æ —Ä–∞–π–æ–Ω–∞–º
- ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–º—É —Ä–∞–∑–º–µ—â–µ–Ω–∏—é
- ‚úÖ –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–æ—Å–∞ –ø–æ –ª–æ–∫–∞—Ü–∏—è–º
- ‚úÖ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–æ–Ω –¥–æ—Å—Ç–∞–≤–∫–∏

#### –î–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã:
- ‚úÖ –û–±—â–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
- ‚úÖ –í—ã—è–≤–ª–µ–Ω–∏–µ –Ω–µ–¥–æ–æ–±—Å–ª—É–∂–µ–Ω–Ω—ã—Ö —Ä–∞–π–æ–Ω–æ–≤
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ª–æ–≥–∏—Å—Ç–∏–∫–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è):
```sql
-- –¢—Ä–µ–∫–∏–Ω–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
CREATE TABLE geo_analytics_events (
    id UUID PRIMARY KEY,
    event_type VARCHAR(50), -- search, view, click
    user_id UUID,
    location GEOGRAPHY(POINT, 4326),
    search_query TEXT,
    filters JSONB,
    results_count INT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);

-- –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
CREATE TABLE user_routes (
    id UUID PRIMARY KEY,
    user_id UUID,
    route_name VARCHAR(100),
    route_line GEOGRAPHY(LINESTRING, 4326),
    search_radius INT DEFAULT 1000
);

-- –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏
CREATE MATERIALIZED VIEW district_activity_heatmap AS
SELECT 
    district,
    date_trunc('hour', created_at) as hour,
    COUNT(*) as activity_count,
    COUNT(DISTINCT user_id) as unique_users
FROM geo_analytics_events
GROUP BY district, hour;
```

#### AI/ML –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
```python
# NLP –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
class GeoSearchNLP:
    def parse_query(self, query: str):
        # "–¥–µ—Ç—Å–∫–∞—è –∫–æ–ª—è—Å–∫–∞ –¥–æ 10000 —Ä—è–¥–æ–º —Å –ø–∞—Ä–∫–æ–º"
        return {
            "product": "–¥–µ—Ç—Å–∫–∞—è –∫–æ–ª—è—Å–∫–∞",
            "price_max": 10000,
            "near_landmark": "–ø–∞—Ä–∫",
            "inferred_radius": 2000
        }

# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
class GeoRecommender:
    def get_recommendations(self, user_id, location):
        # –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ + –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –≤ —Ä–∞–π–æ–Ω–µ
        return recommended_items
```

#### API Endpoints (–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è):
```yaml
# –£–º–Ω—ã–π –ø–æ–∏—Å–∫
POST /api/v1/gis/search/smart:
  body:
    query: string (natural language)
    context:
      userLocation: Point
      preferredDistricts: array

# –ü–æ–∏—Å–∫ –ø–æ –º–∞—Ä—à—Ä—É—Ç—É  
POST /api/v1/gis/search/route:
  body:
    route: array of Points
    radius: number
    filters: object

# –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¥–ª—è –ø—Ä–æ–¥–∞–≤—Ü–æ–≤
GET /api/v1/gis/analytics/heatmap:
  parameters:
    - storefront_id: string
    - period: day|week|month
    - metric: views|clicks|purchases

# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
POST /api/v1/gis/analytics/placement-suggestions:
  body:
    category: string
    target_audience: object
```

#### Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è):
```typescript
// –£–º–Ω—ã–π –ø–æ–∏—Å–∫
<SmartSearchBar 
  onSearch={handleSmartSearch}
  suggestions={aiSuggestions}
/>

// –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–π –¥–∞—à–±–æ—Ä–¥
<GeoAnalyticsDashboard>
  <HeatmapLayer data={heatmapData} />
  <CompetitorAnalysis />
  <DemandForecast />
  <PlacementRecommendations />
</GeoAnalyticsDashboard>

// –ü–æ–∏—Å–∫ –ø–æ –º–∞—Ä—à—Ä—É—Ç—É
<RouteSearch 
  onDrawRoute={handleDrawRoute}
  onSearch={handleRouteSearch}
/>
```

### ML Pipeline:
```yaml
# –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π
- –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–π–æ–Ω–æ–≤ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø—Ä–æ—Å–∞ (time series)
- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ª–æ–∫–∞—Ü–∏–π
- NER –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –≥–µ–æ-—Å—É—â–Ω–æ—Å—Ç–µ–π –∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç –§–∞–∑—ã 3
- –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ–Ω–∏–º–∞–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫
- –ü—Ä–æ–¥–∞–≤—Ü—ã –ø–æ–ª—É—á–∞—é—Ç actionable insights
- –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- **–ú–µ—Ç—Ä–∏–∫–∞ —É—Å–ø–µ—Ö–∞**: 50% –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞—Ä—Ç—É, +40% –∫–æ–Ω–≤–µ—Ä—Å–∏—è, +25% retention

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ —Ñ–∞–∑–∞–º

| –ú–µ—Ç—Ä–∏–∫–∞ | –§–∞–∑–∞ 1 | –§–∞–∑–∞ 2 | –§–∞–∑–∞ 3 |
|---------|--------|--------|--------|
| –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã | 20% | 35% | 50% |
| –ö–æ–Ω–≤–µ—Ä—Å–∏—è –∏–∑ –∫–∞—Ä—Ç—ã | –±–∞–∑–æ–≤–∞—è | +20% | +40% |
| –í—Ä–µ–º—è –Ω–∞ –∫–∞—Ä—Ç–µ | 2 –º–∏–Ω | 4 –º–∏–Ω | 6 –º–∏–Ω |
| –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ | 30% | 50% | 70% |
| –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç—å | 3.5/5 | 4.0/5 | 4.5/5 |

---

## üöÄ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–æ—ç—Ç–∞–ø–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

1. **–ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫** - –ø–µ—Ä–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ 4 –Ω–µ–¥–µ–ª–∏
2. **–ü–æ—Å—Ç–æ—è–Ω–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å** - –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
3. **–°–Ω–∏–∂–µ–Ω–∏–µ —Ä–∏—Å–∫–æ–≤** - –∫–∞–∂–¥–∞—è —Ñ–∞–∑–∞ —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞
4. **–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∫–æ–º–∞–Ω–¥–∞
5. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π** - –≤–ª–æ–∂–µ–Ω–∏—è –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ –º–µ—Ç—Ä–∏–∫

---

## ‚è±Ô∏è Timeline

```
–ú–µ—Å—è—Ü 1: [====] –§–∞–∑–∞ 1 - –ë–∞–∑–æ–≤–∞—è –∫–∞—Ä—Ç–∞
–ú–µ—Å—è—Ü 2: [====] –§–∞–∑–∞ 2 - –ì–µ–æ–ø–æ–∏—Å–∫ 
–ú–µ—Å—è—Ü 3: [====] –§–∞–∑–∞ 3 - –£–º–Ω—ã–π –ø–æ–∏—Å–∫
```

–ö–∞–∂–¥–∞—è —Ñ–∞–∑–∞ –≤–∫–ª—é—á–∞–µ—Ç:
- –ù–µ–¥–µ–ª—è 1-2: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- –ù–µ–¥–µ–ª—è 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è  
- –ù–µ–¥–µ–ª—è 4: –ó–∞–ø—É—Å–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥