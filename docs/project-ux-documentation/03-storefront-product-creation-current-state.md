# Создание товаров в витринах - Текущая реализация

## Обзор

Процесс создания товара в витрине (storefront) представляет собой 6-шаговый визард для владельцев магазинов. Система разработана для управления инвентарем и продажи товаров через собственную витрину на платформе.

## Структура процесса

### Шаг 1: Выбор категории (CategoryStep)

**Компонент**: `/components/products/steps/CategoryStep.tsx`

**Функциональность**:
- Загрузка категорий через API
- Навигация по иерархии категорий с breadcrumbs
- Поиск по названию категории
- Визуальные иконки для категорий

**Особенности**:
- Использует тот же API категорий, что и маркетплейс
- Поддерживает многоуровневую иерархию
- Fallback на тестовые категории при ошибке API

### Шаг 2: Базовая информация (BasicInfoStep)

**Компонент**: `/components/products/steps/BasicInfoStep.tsx`

**Поля**:
- Название товара (обязательно, мин. 3 символа)
- Описание (обязательно, мин. 10 символов)
- Цена (обязательно, > 0)
- Валюта (по умолчанию RSD)
- Количество на складе
- SKU (артикул)
- Штрих-код
- Статус активности (вкл/выкл)

**Особенности**:
- Автосохранение с debounce 500мс
- Валидация в реальном времени
- Очистка ошибок при изменении полей

### Шаг 3: Местоположение (LocationStep)

**Компонент**: `/components/products/steps/LocationStep.tsx`

**Функциональность**:
- Выбор местоположения товара
- Настройки доставки и самовывоза
- Интеграция с картами

### Шаг 4: Атрибуты (AttributesStep)

**Компонент**: `/components/products/steps/AttributesStep.tsx`

**Функциональность**:
- Динамические поля на основе категории
- Различные типы атрибутов (текст, число, выбор)
- Валидация специфичная для категории

### Шаг 5: Фотографии (PhotosStep)

**Компонент**: `/components/products/steps/PhotosStep.tsx`

**Функциональность**:
- Загрузка до 10 фотографий
- Drag & Drop для изменения порядка
- Предпросмотр изображений
- Валидация типа и размера файлов (макс 10MB)

**Особенности**:
- Использует FileReader для локального превью
- Поддерживает перестановку изображений
- Первое изображение становится главным

### Шаг 6: Предпросмотр (PreviewStep)

**Компонент**: `/components/products/steps/PreviewStep.tsx`

**Функциональность**:
- Полный предпросмотр товара
- Возможность вернуться и отредактировать
- Публикация товара через API

## Визуальный дизайн

### ProductWizard компонент

**Особенности дизайна**:
- Адаптивный дизайн (мобильный/десктоп)
- Визуальные иконки для каждого шага
- Прогресс-бар с процентами
- Цветовая индикация статуса шагов

**Мобильная версия**:
- Компактный заголовок с текущим шагом
- Круглая иконка с эмодзи
- Мини прогресс-бар

**Десктопная версия**:
- Полная навигация по шагам
- Кликабельные завершенные шаги
- Визуальная индикация доступности

## Технические детали

### Управление состоянием

**Контекст**: `/contexts/CreateProductContext.tsx`

```typescript
interface ProductData {
  name: string;
  description: string;
  price: number;
  currency: string;
  stock_quantity: number;
  sku?: string;
  barcode?: string;
  is_active: boolean;
  attributes?: Record<string, any>;
}

interface CreateProductState {
  currentStep: number;
  completedSteps: Set<number>;
  category: MarketplaceCategory | null;
  productData: ProductData;
  images: File[];
  location?: LocationData;
  errors: Record<string, string>;
}
```

### API интеграция

- Использует `apiClient` для всех запросов
- Загрузка категорий: `/api/v1/marketplace/category-tree`
- Создание товара: POST запрос с multipart/form-data

## Проблемы текущей реализации

### UX проблемы

1. **Избыточность для простых товаров**
   - 6 шагов для добавления простого товара - слишком много
   - Нет быстрого режима для повторяющихся товаров

2. **Отсутствие шаблонов**
   - Нельзя сохранить шаблон для похожих товаров
   - Нет копирования существующих товаров

3. **Слабая интеграция с инвентарем**
   - Нет связи со складским учетом
   - Нет автоматического обновления остатков

4. **Ограниченная функциональность фото**
   - Нет обрезки/редактирования
   - Нет оптимизации размера
   - Нет галереи существующих фото

### Технические проблемы

1. **Производительность**
   - Загрузка всего дерева категорий сразу
   - Нет ленивой загрузки для больших списков

2. **Валидация**
   - Только базовая валидация
   - Нет проверки уникальности SKU

3. **Интеграция**
   - Нет интеграции с системами учета
   - Нет импорта из Excel/CSV

### Сравнение с созданием объявлений

| Аспект | Объявления (8 шагов) | Товары витрины (6 шагов) |
|--------|---------------------|-------------------------|
| Сложность | Очень высокая | Высокая |
| Время | 15+ минут | 10+ минут |
| Мобильность | Плохая | Средняя |
| Повторное использование | Нет | Нет |
| Шаблоны | Нет | Нет |

## Специфика для витрин

### Отличия от обычных объявлений

1. **Инвентарный учет**
   - SKU и штрих-коды
   - Количество на складе
   - Управление остатками

2. **Брендинг**
   - Товары привязаны к витрине
   - Единый стиль оформления
   - Корпоративная информация

3. **Массовые операции**
   - Необходимость добавлять много товаров
   - Обновление цен и остатков
   - Сезонные изменения

## Вывод

Процесс создания товаров в витринах функционален, но не оптимизирован для реальных потребностей владельцев магазинов. Основная проблема - отсутствие инструментов для эффективной работы с большим количеством товаров. Необходима оптимизация для скорости и удобства массовых операций.