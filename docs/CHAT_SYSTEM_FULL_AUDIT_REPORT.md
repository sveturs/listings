# üìä –ü–û–õ–ù–´–ô –ê–£–î–ò–¢ –°–ò–°–¢–ï–ú–´ –ß–ê–¢–û–í - –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢

**–î–∞—Ç–∞:** 18.08.2025  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è **–¢—Ä–µ–±—É–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**

## üìã –†–µ–∑—é–º–µ

–°–∏—Å—Ç–µ–º–∞ —á–∞—Ç–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ** —Å —Ö–æ—Ä–æ—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ –±–æ–≥–∞—Ç—ã–º –Ω–∞–±–æ—Ä–æ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π, –Ω–æ **—Å–æ–¥–µ—Ä–∂–∏—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã**, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø–µ—Ä–µ–¥ production deployment.

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: **6.5/10**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û—Ü–µ–Ω–∫–∞ | –°—Ç–∞—Ç—É—Å |
|-----------|--------|--------|
| –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö | 7/10 | ‚úÖ –ì–æ—Ç–æ–≤–æ —Å –∑–∞–º–µ—á–∞–Ω–∏—è–º–∏ |
| Backend API | 8/10 | ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ production |
| Frontend | 6/10 | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π |
| WebSocket | 7/10 | ‚ö†Ô∏è –ù—É–∂–Ω—ã —É–ª—É—á—à–µ–Ω–∏—è |
| –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å | 7/10 | ‚ö†Ô∏è –ï—Å—Ç—å —É—è–∑–≤–∏–º–æ—Å—Ç–∏ |
| –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | 6/10 | ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ |

---

## üóÑÔ∏è 1. –ë–ê–ó–ê –î–ê–ù–ù–´–•

### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü —Å foreign keys
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —á–∞—Ç–æ–≤ (–æ–±—ä—è–≤–ª–µ–Ω–∏—è, —Ç–æ–≤–∞—Ä—ã, –ø—Ä—è–º—ã–µ)
- –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è timestamps

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã
1. **–ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö** - –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ listing_id/storefront_product_id –≤ messages –∏ chats
2. **26 –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ 2 —Ç–∞–±–ª–∏—Ü—ã** - –∏–∑–±—ã—Ç–æ—á–Ω–æ, –∑–∞–º–µ–¥–ª—è–µ—Ç INSERT/UPDATE
3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** - –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ —Ä–æ—Å—Ç–µ –¥–∞–Ω–Ω—ã—Ö

### üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
```sql
-- –£–¥–∞–ª–∏—Ç—å –∏–∑–±—ã—Ç–æ—á–Ω—ã–µ –ø–æ–ª—è –∏–∑ messages
ALTER TABLE marketplace_messages 
DROP COLUMN listing_id,
DROP COLUMN storefront_product_id;

-- –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ –¥–∞—Ç–µ
CREATE TABLE marketplace_messages_2025_08 PARTITION OF marketplace_messages
FOR VALUES FROM ('2025-08-01') TO ('2025-09-01');
```

---

## üîß 2. BACKEND API

### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
- **–ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ —Å–ª–æ–∏
- **–ü–æ–ª–Ω—ã–π REST API** —Å–æ –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ endpoints
- **WebSocket –ø–æ–¥–¥–µ—Ä–∂–∫–∞** –¥–ª—è real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- **–°–∏—Å—Ç–µ–º–∞ –≤–ª–æ–∂–µ–Ω–∏–π** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
- **JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** –Ω–∞ –≤—Å–µ—Ö endpoints
- **Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è WebSocket
```go
// –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
type WebSocketManager struct {
    connections sync.Map // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
}

// –ù–£–ñ–ù–û: Redis Pub/Sub –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞
type WebSocketBroker interface {
    Publish(channel string, message []byte) error
    Subscribe(channel string) <-chan []byte
}
```

#### 2. Memory leaks –≤ –≥–æ—Ä—É—Ç–∏–Ω–∞—Ö
```go
// –ü—Ä–æ–±–ª–µ–º–∞: –æ—à–∏–±–∫–∏ —Ç–µ—Ä—è—é—Ç—Å—è
go func() {
    err := sendNotification()
    if err != nil {
        logger.Error(err) // –¢–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É–µ–º
    }
}()

// –†–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å errgroup
g, ctx := errgroup.WithContext(context.Background())
g.Go(func() error {
    return sendNotification()
})
```

#### 3. –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ URL –¥–ª—è —Ñ–∞–π–ª–æ–≤
```go
// –ü—Ä–æ–±–ª–µ–º–∞: –ª—é–±–æ–π —Å URL –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
return &Attachment{
    PublicURL: "https://minio.svetu.rs/chat-files/doc.pdf"
}

// –†–µ—à–µ–Ω–∏–µ: –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ URL
url, _ := minioClient.PresignedGetObject(ctx, bucket, object, 1*time.Hour, nil)
```

### üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
1. –í–Ω–µ–¥—Ä–∏—Ç—å Redis –¥–ª—è WebSocket –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
2. –î–æ–±–∞–≤–∏—Ç—å signed URLs –¥–ª—è —Ñ–∞–π–ª–æ–≤
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å errgroup –¥–ª—è –≥–æ—Ä—É—Ç–∏–Ω
4. –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ Prometheus

---

## üíª 3. FRONTEND

### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã
- **Modern —Å—Ç–µ–∫** (React 19, Redux Toolkit, TypeScript)
- **–ë–æ–≥–∞—Ç—ã–π UI** —Å animated emoji –∏ drag&drop
- **Responsive –¥–∏–∑–∞–π–Ω** —Å DaisyUI
- **–ò–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** (ru/en/sr)

### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

#### 1. Memory Leaks
```typescript
// –ü–†–û–ë–õ–ï–ú–ê: URL –Ω–µ –æ—á–∏—â–∞—é—Ç—Å—è
const preview = URL.createObjectURL(file);
// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –Ω–µ—Ç cleanup!

// –†–ï–®–ï–ù–ò–ï:
useEffect(() => {
    return () => {
        previews.forEach(url => URL.revokeObjectURL(url));
    };
}, [previews]);
```

#### 2. Race Conditions –≤ WebSocket
```typescript
// –ü–†–û–ë–õ–ï–ú–ê: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
useEffect(() => {
    const ws = new WebSocket(wsUrl); // –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
}, []);

// –†–ï–®–ï–ù–ò–ï: 
const wsRef = useRef<WebSocket | null>(null);
useEffect(() => {
    if (wsRef.current?.readyState === WebSocket.OPEN) return;
    wsRef.current = new WebSocket(wsUrl);
}, []);
```

#### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Error Boundaries
```typescript
// –õ—é–±–∞—è –æ—à–∏–±–∫–∞ –≤ —á–∞—Ç–µ –ª–æ–º–∞–µ—Ç –≤—Å—ë –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
// –ù–£–ñ–ù–û:
class ChatErrorBoundary extends React.Component {
    componentDidCatch(error, errorInfo) {
        logErrorToService(error, errorInfo);
    }
}
```

#### 4. –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä—ã
```typescript
// –ü–†–û–ë–õ–ï–ú–ê: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ –º–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
export const MessageItem = ({ message }) => { ... }

// –†–ï–®–ï–ù–ò–ï:
export const MessageItem = React.memo(({ message }) => { ... })
```

### üîß –°—Ä–æ—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å memory leaks** - –∫—Ä–∏—Ç–∏—á–Ω–æ!
2. **–î–æ–±–∞–≤–∏—Ç—å Error Boundaries** 
3. **–£—Å—Ç—Ä–∞–Ω–∏—Ç—å race conditions**
4. **–î–æ–±–∞–≤–∏—Ç—å –º–µ–º–æ–∏–∑–∞—Ü–∏—é**

---

## üåê 4. WEBSOCKET –ò REAL-TIME

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- –î–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –æ–±–º–µ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- Online/offline —Å—Ç–∞—Ç—É—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- Typing indicators
- Heartbeat/ping-pong –º–µ—Ö–∞–Ω–∏–∑–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã
1. **–ù–µ—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏** - –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ –≤—Å–µ –æ—Ç–∫–ª—é—á–∞—é—Ç—Å—è
2. **–¢–æ–ª—å–∫–æ –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä** - –Ω–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
3. **–ù–µ—Ç rate limiting** –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ WS
4. **–ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –±–µ–∑ retry

### üîß –†–µ—à–µ–Ω–∏–µ: Redis Pub/Sub
```go
// Backend
type RedisWebSocketBroker struct {
    client *redis.Client
    subscriptions map[string]chan Message
}

func (b *RedisWebSocketBroker) BroadcastToChat(chatID int, msg Message) {
    b.client.Publish(ctx, fmt.Sprintf("chat:%d", chatID), msg)
}
```

```typescript
// Frontend —Å reconnection
class WebSocketManager {
    private reconnectAttempts = 0;
    private maxReconnectAttempts = 5;
    
    connect() {
        this.ws = new WebSocket(url);
        this.ws.onclose = () => this.handleReconnect();
    }
    
    handleReconnect() {
        if (this.reconnectAttempts < this.maxReconnectAttempts) {
            setTimeout(() => this.connect(), Math.pow(2, this.reconnectAttempts) * 1000);
            this.reconnectAttempts++;
        }
    }
}
```

---

## üîê 5. –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ –≤—Å–µ—Ö endpoints
- CSRF –∑–∞—â–∏—Ç–∞
- XSS –∑–∞—â–∏—Ç–∞ —á–µ—Ä–µ–∑ DOMPurify
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –ø–æ —Ç–∏–ø—É –∏ —Ä–∞–∑–º–µ—Ä—É
- SQL injection –∑–∞—â–∏—Ç–∞

### üî¥ –£—è–∑–≤–∏–º–æ—Å—Ç–∏

#### 1. –°–ª–∞–±–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è Origin –¥–ª—è WebSocket
```go
// –ü–†–û–ë–õ–ï–ú–ê: –≤ dev —Ä–µ–∂–∏–º–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±–æ–π origin
if config.Environment == "production" {
    // –ø—Ä–æ–≤–µ—Ä–∫–∞ origin
}

// –†–ï–®–ï–ù–ò–ï: –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å
allowedOrigins := config.GetAllowedOrigins()
if !isOriginAllowed(origin, allowedOrigins) {
    return errors.New("origin not allowed")
}
```

#### 2. –ü—É–±–ª–∏—á–Ω—ã–µ URL —Ñ–∞–π–ª–æ–≤ –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```go
// –ü–†–û–ë–õ–ï–ú–ê: –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ MinIO
PublicURL: "https://minio.svetu.rs/chat-files/secret.pdf"

// –†–ï–®–ï–ù–ò–ï: proxy —á–µ—Ä–µ–∑ backend —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤
GET /api/v1/chat/files/{fileID}
// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ user - —É—á–∞—Å—Ç–Ω–∏–∫ —á–∞—Ç–∞
```

#### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting –¥–ª—è WebSocket —Å–æ–æ–±—â–µ–Ω–∏–π
```go
// –ù–£–ñ–ù–û –¥–æ–±–∞–≤–∏—Ç—å:
type RateLimiter struct {
    limits map[int]*rate.Limiter // userID -> limiter
}

func (r *RateLimiter) Allow(userID int) bool {
    limiter := r.limits[userID]
    if limiter == nil {
        limiter = rate.NewLimiter(10, 30) // 10 msg/sec, burst 30
        r.limits[userID] = limiter
    }
    return limiter.Allow()
}
```

---

## ‚ö° 6. –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### –¢–µ–∫—É—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- **–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞—Ç–æ–≤:** ~200ms
- **–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:** ~100ms  
- **WebSocket latency:** ~50ms
- **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ 10MB:** ~3s

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã
1. **N+1 –∑–∞–ø—Ä–æ—Å—ã** –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –≤–ª–æ–∂–µ–Ω–∏–π
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è** –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤
3. **–ù–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è** –Ω–∞ frontend
4. **26 –∏–Ω–¥–µ–∫—Å–æ–≤** –∑–∞–º–µ–¥–ª—è—é—Ç –∑–∞–ø–∏—Å—å

### üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

#### 1. –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
```sql
-- –í–º–µ—Å—Ç–æ N –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π
WITH attachments AS (
    SELECT message_id, 
           json_agg(json_build_object(
               'id', id,
               'file_type', file_type,
               'file_path', file_path
           )) as files
    FROM chat_attachments
    WHERE message_id = ANY($1)
    GROUP BY message_id
)
SELECT m.*, a.files
FROM marketplace_messages m
LEFT JOIN attachments a ON m.id = a.message_id
```

#### 2. Redis –∫—ç—à –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤
```go
type ChatCache struct {
    redis *redis.Client
    ttl   time.Duration
}

func (c *ChatCache) GetMessages(chatID int, page int) (*MessagesPage, error) {
    key := fmt.Sprintf("chat:%d:page:%d", chatID, page)
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫—ç—à
    // –ï—Å–ª–∏ –Ω–µ—Ç - –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –ë–î –∏ –∑–∞–∫—ç—à–∏—Ä–æ–≤–∞—Ç—å
}
```

#### 3. Intersection Observer –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
```typescript
// –í–º–µ—Å—Ç–æ MutationObserver
const observer = new IntersectionObserver(
    (entries) => {
        if (entries[0].isIntersecting) {
            loadMoreMessages();
        }
    },
    { threshold: 0.1 }
);
```

---

## üîÑ 7. –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø

### ‚úÖ –£—Å–ø–µ—à–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- **MinIO S3** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤
- **PostgreSQL** –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
- **Nginx** –∫–∞–∫ reverse proxy
- **–°–∏—Å—Ç–µ–º—ã –æ–±—ä—è–≤–ª–µ–Ω–∏–π –∏ –≤–∏—Ç—Ä–∏–Ω**

### ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã
1. **–ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏**
2. **–ù–µ—Ç email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö**
3. **–ù–µ—Ç webhooks –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º**
4. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç API –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π**

---

## üìà 8. –ú–ê–°–®–¢–ê–ë–ò–†–£–ï–ú–û–°–¢–¨

### –¢–µ–∫—É—â–∏–µ –ª–∏–º–∏—Ç—ã
- **Max WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:** ~10,000 –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- **Max —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫:** ~1,000
- **Max —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:** 100MB
- **PostgreSQL connections:** 100

### –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏
1. WebSocket —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
2. –ù–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –ë–î
3. –§–∞–π–ª—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ–¥–Ω–æ–º bucket MinIO
4. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç CDN –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏

### –ü–ª–∞–Ω –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
```yaml
# docker-compose –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞
services:
  chat-api-1:
    image: chat-api
    environment:
      REDIS_URL: redis://redis:6379
  
  chat-api-2:
    image: chat-api
    environment:
      REDIS_URL: redis://redis:6379
      
  redis:
    image: redis:7-alpine
    
  nginx:
    image: nginx
    # Load balancing –º–µ–∂–¥—É chat-api-1 –∏ chat-api-2
```

---

## üéØ –ü–†–ò–û–†–ò–¢–ï–¢–ù–´–ï –ó–ê–î–ê–ß–ò

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–±–ª–æ–∫–∏—Ä—É—é—â–∏–µ production)
1. **Frontend: –ò—Å–ø—Ä–∞–≤–∏—Ç—å memory leaks** (2 —á–∞—Å–∞)
2. **Frontend: –î–æ–±–∞–≤–∏—Ç—å Error Boundaries** (1 —á–∞—Å)
3. **Backend: –ó–∞—â–∏—Ç–∏—Ç—å —Ñ–∞–π–ª—ã signed URLs** (3 —á–∞—Å–∞)
4. **WebSocket: –ò—Å–ø—Ä–∞–≤–∏—Ç—å race conditions** (2 —á–∞—Å–∞)

### üü° –í–∞–∂–Ω—ã–µ (–≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏)
1. **–í–Ω–µ–¥—Ä–∏—Ç—å Redis –¥–ª—è WebSocket** (1 –¥–µ–Ω—å)
2. **–î–æ–±–∞–≤–∏—Ç—å rate limiting** (4 —á–∞—Å–∞)
3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î** (4 —á–∞—Å–∞)
4. **–î–æ–±–∞–≤–∏—Ç—å –º–µ–º–æ–∏–∑–∞—Ü–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤** (2 —á–∞—Å–∞)

### üü¢ –ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ (–≤ —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞)
1. **–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î**
2. **CDN –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏**
3. **Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
4. **–ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**

---

## üí∞ –û–¶–ï–ù–ö–ê –¢–†–£–î–û–ó–ê–¢–†–ê–¢

| –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ß–∞—Å—ã | –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ |
|--------|-----------|------|--------------|
| –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è | üî¥ | 8 | 1 |
| –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è | üü° | 24 | 1 |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ | üü¢ | 40 | 2 |
| **–ò–¢–û–ì–û** | | **72 —á–∞—Å–∞** | **1-2** |

---

## ‚úÖ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–°–∏—Å—Ç–µ–º–∞ —á–∞—Ç–æ–≤ **–≥–æ—Ç–æ–≤–∞ –∫ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–º—É production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é** –ø–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º (8 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã).

–î–ª—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ production deployment —Å –≤—ã—Å–æ–∫–∏–º–∏ –Ω–∞–≥—Ä—É–∑–∫–∞–º–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è:
- –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- –í–Ω–µ–¥—Ä–∏—Ç—å Redis –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CDN –∏ –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ production –ø–æ—Å–ª–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ –≤–∞–∂–Ω—ã–º–∏ —É–ª—É—á—à–µ–Ω–∏—è–º–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–µ–π.

---

*–û—Ç—á–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–∏—Å—Ç–µ–º—ã —á–∞—Ç–æ–≤.*