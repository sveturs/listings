# Техническое задание на разработку админ-панели для управления категориями и атрибутами маркетплейса

## 1. Общее описание

Необходимо разработать полноценную административную панель для управления структурой категорий и атрибутов маркетплейса. Система должна позволять гибко настраивать иерархию категорий, создавать и управлять атрибутами товаров, группировать атрибуты и настраивать их отображение в различных частях интерфейса.

## 2. Текущее состояние системы

### 2.1 Существующая структура БД

#### Таблицы категорий:
- `marketplace_categories` - основная таблица категорий с поддержкой иерархии
- Поддерживается древовидная структура через `parent_id`
- Есть поля для иконок и slug для SEO

#### Таблицы атрибутов:
- `category_attributes` - атрибуты с типами: text, number, select, boolean
- `category_attribute_mapping` - связь атрибутов с категориями
- `attribute_groups` - группы атрибутов для организации
- `attribute_group_items` - атрибуты в группах
- `category_attribute_groups` - привязка групп к категориям
- `listing_attribute_values` - значения атрибутов в объявлениях

#### Система переводов:
- `translations` - универсальная таблица для переводов всех сущностей
- `attribute_option_translations` - переводы опций для select-атрибутов
- Поддержка языков: ru, sr, en

#### Кастомизация:
- `custom_ui_components` - возможность создания кастомных компонентов отображения

### 2.2 Существующий Backend API

Уже реализованы базовые эндпоинты для:
- CRUD операций с категориями
- CRUD операций с атрибутами
- Управление связями категорий и атрибутов
- Базовые операции с группами атрибутов
- Экспорт/импорт настроек атрибутов между категориями

## 3. Требования к функционалу админ-панели

### 3.1 Управление категориями

#### 3.1.1 Древовидная структура категорий
- Визуальное отображение иерархии категорий в виде дерева
- Drag & Drop для изменения порядка и вложенности
- Возможность сворачивания/разворачивания веток
- Индикация количества товаров в категории
- Быстрый поиск по категориям

#### 3.1.2 Создание и редактирование категорий
- Форма с полями:
  - Название (с мультиязычностью)
  - URL slug (автогенерация из названия с возможностью ручного редактирования)
  - Родительская категория (выбор из дерева)
  - Иконка (выбор из библиотеки или загрузка SVG)
  - SEO-поля: meta title, description, keywords
  - Изображение категории для отображения на главной
  - Флаг активности
  - Настройки отображения на разных устройствах

#### 3.1.3 Массовые операции
- Массовое перемещение категорий
- Массовое включение/отключение
- Копирование структуры категорий с атрибутами

### 3.2 Управление атрибутами

#### 3.2.1 Библиотека атрибутов
- Таблица всех атрибутов с фильтрацией и поиском
- Группировка по типам атрибутов
- Предпросмотр атрибута

#### 3.2.2 Типы атрибутов (расширить существующие)
- **text** - текстовое поле
  - Настройки: min/max длина, регулярное выражение для валидации
  - Подтипы: однострочный, многострочный, rich text
- **number** - числовое поле
  - Настройки: min/max значение, шаг, единица измерения
  - Форматирование: валюта, проценты, обычное число
- **select** - выбор из списка
  - Одиночный/множественный выбор
  - Управление опциями с переводами
  - Иконки для опций
  - Цвета для опций (например, для выбора цвета товара)
- **boolean** - да/нет
  - Настройка текста для true/false значений
- **date** - выбор даты
  - Форматы отображения
  - Ограничения на выбор дат
- **range** - диапазон значений
  - Для цен, размеров и т.д.
- **location** - выбор местоположения
  - Интеграция с картой
  - Настройка точности (точный адрес, район, город)
- **file** - загрузка файлов
  - Типы разрешенных файлов
  - Максимальный размер
- **gallery** - галерея изображений
  - Минимум/максимум изображений
  - Требования к размерам

#### 3.2.3 Создание и редактирование атрибутов
- Системное имя (латиница, для API)
- Отображаемое имя (мультиязычность)
- Тип атрибута
- Описание/подсказка для пользователя
- Правила валидации
- Значение по умолчанию
- Флаги:
  - Обязательный для заполнения
  - Используется в поиске
  - Используется в фильтрах
  - Показывать в карточке товара
  - Показывать в списке товаров

### 3.3 Группы атрибутов

#### 3.3.1 Управление группами
- Создание тематических групп (например: "Технические характеристики", "Размеры", "Комплектация")
- Название и описание группы (мультиязычность)
- Иконка группы
- Порядок сортировки

#### 3.3.2 Состав группы
- Добавление атрибутов в группу с настройками:
  - Порядок в группе
  - Переопределение названия атрибута для группы
  - Условия видимости (например, показывать только если выбран определенный тип товара)
  - Кастомная иконка для атрибута в группе

### 3.4 Привязка атрибутов к категориям

#### 3.4.1 Интерфейс настройки категории
- Вкладки: Основные настройки | Атрибуты | SEO | Отображение
- На вкладке "Атрибуты":
  - Список доступных атрибутов/групп (с поиском)
  - Список привязанных атрибутов/групп
  - Drag & Drop между списками
  - Настройка порядка отображения

#### 3.4.2 Настройки атрибута в категории
При привязке атрибута к категории можно настроить:
- Обязательность заполнения
- Переопределение названия для категории
- Видимость на разных этапах:
  - При создании объявления
  - В карточке товара
  - В списке товаров (мобильная/десктоп версия)
  - В фильтрах
  - В сравнении товаров
- Кастомный компонент отображения

#### 3.4.3 Наследование атрибутов
- Опция наследования атрибутов от родительской категории
- Возможность отключить/переопределить унаследованные атрибуты
- Визуальная индикация унаследованных атрибутов

### 3.5 Настройки отображения

#### 3.5.1 Места отображения атрибутов
Для каждого атрибута/группы можно настроить видимость:

**Карточка товара в списке:**
- Минимальная (мобильная) - только ключевые атрибуты
- Расширенная (десктоп) - больше атрибутов
- При наведении - дополнительные атрибуты

**Страница товара:**
- Основной блок характеристик
- Краткие характеристики вверху
- Технические характеристики (отдельная вкладка)
- Боковая панель

**Фильтры:**
- Основные фильтры (всегда видны)
- Расширенные фильтры (по клику)
- Тип фильтра: чекбоксы, слайдер, выбор диапазона

**Поиск:**
- Участие в полнотекстовом поиске
- Вес атрибута в поиске

#### 3.5.2 Кастомные компоненты
- Библиотека готовых компонентов отображения
- Редактор для создания кастомных компонентов
- Предпросмотр компонента с тестовыми данными
- Версионирование компонентов

### 3.6 Шаблоны и пресеты

#### 3.6.1 Шаблоны категорий
- Сохранение настроек категории как шаблона
- Применение шаблона к новым категориям
- Библиотека стандартных шаблонов (Электроника, Одежда, Недвижимость и т.д.)

#### 3.6.2 Пресеты атрибутов
- Готовые наборы атрибутов для типовых категорий
- Импорт пресетов из маркетплейса сообщества

### 3.7 Импорт и синхронизация

#### 3.7.1 Импорт из внешних источников
- Поддержка CSV/XML для магазинов
- Маппинг полей из файла на атрибуты
- Создание новых атрибутов при импорте
- Валидация данных перед импортом

#### 3.7.2 API для интеграций
- REST API для управления категориями и атрибутами
- Webhooks для синхронизации изменений
- Документация API в Swagger

### 3.8 Аналитика и мониторинг

#### 3.8.1 Статистика использования
- Какие атрибуты заполняются чаще всего
- Какие атрибуты используются в фильтрах
- Категории с наибольшим количеством товаров

#### 3.8.2 Качество данных
- Процент заполнения атрибутов по категориям
- Товары с незаполненными обязательными атрибутами
- Атрибуты, которые никогда не заполняются

### 3.9 Права доступа

#### 3.9.1 Роли
- Супер-админ - полный доступ
- Менеджер категорий - управление структурой
- Контент-менеджер - только переводы и описания
- Аналитик - только просмотр и отчеты

#### 3.9.2 Журнал изменений
- Логирование всех изменений структуры
- Возможность отката изменений
- Уведомления об изменениях

## 4. Технические требования

### 4.1 Frontend админ-панели
- Next.js + TypeScript
- UI библиотека: DaisyUI + Tailwind CSS
- Состояние: Zustand или Context API
- Формы: React Hook Form + Zod для валидации
- Drag & Drop: react-beautiful-dnd или dnd-kit
- Дерево категорий: react-arborist или собственная реализация
- Графики: Recharts
- Интернационализация: next-intl

### 4.2 Оптимизация
- Виртуализация для больших списков
- Ленивая загрузка для дерева категорий
- Кеширование на стороне клиента
- Оптимистичные обновления UI

### 4.3 Безопасность
- RBAC (Role-Based Access Control)
- Валидация всех входных данных
- Защита от XSS при кастомных компонентах
- Rate limiting для API

## 5. Интерфейс пользователя

### 5.1 Основные принципы
- Минималистичный и чистый дизайн
- Быстрый доступ к часто используемым функциям
- Контекстные подсказки и документация
- Responsive дизайн для работы с планшетов

### 5.2 Структура админ-панели
```
┌─────────────────────────────────────────────────────────┐
│ Sve Tu Admin          [Поиск]      [Уведомления] [User] │
├─────────────────────────────────────────────────────────┤
│ ┌─────────────┐ ┌─────────────────────────────────────┐ │
│ │ Навигация   │ │                                     │ │
│ │             │ │        Основная рабочая область    │ │
│ │ - Dashboard │ │                                     │ │
│ │ - Категории │ │                                     │ │
│ │ - Атрибуты  │ │                                     │ │
│ │ - Шаблоны   │ │                                     │ │
│ │ - Импорт    │ │                                     │ │
│ │ - Аналитика │ │                                     │ │
│ │ - Настройки │ │                                     │ │
│ └─────────────┘ └─────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 5.3 Ключевые экраны

#### 5.3.1 Dashboard
- Ключевые метрики
- Последние изменения
- Быстрые действия

#### 5.3.2 Управление категориями
- Дерево категорий слева
- Детали/редактирование справа
- Панель инструментов сверху

#### 5.3.3 Библиотека атрибутов
- Таблица с фильтрами
- Быстрый просмотр
- Массовые операции

#### 5.3.4 Конструктор форм
- Визуальный редактор
- Предпросмотр в реальном времени
- Библиотека элементов

## 6. Этапы реализации

### Этап 1: Базовый функционал (2-3 недели)
1. UI админ-панели: layout, навигация, авторизация
2. CRUD для категорий с деревом
3. CRUD для атрибутов
4. Базовая привязка атрибутов к категориям

### Этап 2: Группы и настройки отображения (2 недели)
1. Управление группами атрибутов
2. Настройки отображения атрибутов
3. Наследование атрибутов в категориях
4. Drag & Drop для управления порядком

### Этап 3: Расширенные типы и валидация (2 недели)
1. Новые типы атрибутов
2. Расширенная валидация
3. Кастомные компоненты отображения
4. Условная видимость атрибутов

### Этап 4: Шаблоны и импорт (1-2 недели)
1. Система шаблонов
2. Импорт/экспорт настроек
3. Массовые операции
4. API для внешних интеграций

### Этап 5: Аналитика и оптимизация (1 неделя)
1. Дашборд с аналитикой
2. Оптимизация производительности
3. Расширенные права доступа
4. Финальное тестирование

## 7. Критерии успеха

1. **Производительность**: загрузка дерева из 1000+ категорий < 2 сек
2. **Удобство**: создание новой категории с атрибутами < 2 минут
3. **Гибкость**: возможность настроить любую предметную область
4. **Масштабируемость**: поддержка 10000+ атрибутов
5. **Надежность**: zero downtime при изменениях структуры

## 8. Риски и их митигация

1. **Сложность миграции существующих данных**
   - Решение: поэтапная миграция с сохранением обратной совместимости

2. **Производительность при большом количестве категорий**
   - Решение: виртуализация, ленивая загрузка, кеширование

3. **Конфликты при одновременном редактировании**
   - Решение: оптимистичная блокировка, real-time синхронизация

4. **Сложность UI для неопытных пользователей**
   - Решение: режим "Простой/Расширенный", видео-туториалы

## 9. Дополнительные возможности (future scope)

1. **AI-помощник**
   - Автоматическое предложение атрибутов на основе названия категории
   - Умное заполнение атрибутов из описания товара

2. **Marketplace атрибутов**
   - Сообщество может делиться шаблонами атрибутов
   - Рейтинг и отзывы на шаблоны

3. **A/B тестирование**
   - Тестирование разных наборов атрибутов
   - Оптимизация конверсии

4. **Интеграция с внешними каталогами**
   - Автоматический импорт структуры из Google Product Taxonomy
   - Синхронизация с отраслевыми стандартами