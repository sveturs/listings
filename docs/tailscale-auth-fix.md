# Исправление авторизации через Tailscale

## Проблема
При доступе к приложению через Tailscale IP адрес (100.88.44.15) refresh token не передавался в cookies из-за кросс-доменных ограничений.

## Примененные исправления

### 1. Backend - настройки cookies
**Файл**: `/backend/internal/config/config.go`

- Изменена функция `GetCookieDomain()` - теперь возвращает пустую строку в development режиме, что позволяет cookies работать на любом хосте
- Обновлена функция `GetCookieSameSite()` - правильно обрабатывает SameSite атрибут для HTTP/HTTPS

### 2. Frontend - использование прокси
**Файл**: `/frontend/svetu/src/config/index.ts`

- Изменена функция `getApiUrl()` - в development режиме на клиенте возвращает пустую строку, чтобы использовались относительные пути и запросы шли через прокси Next.js

### 3. Next.js - настройка прокси
**Файл**: `/frontend/svetu/next.config.ts`

- Добавлена поддержка проксирования auth путей с учетом локали (/:locale/auth/:path*)
- Сохранена поддержка путей без локали (/auth/:path*)

### 4. Переменные окружения
**Файлы**: 
- `/backend/.env` - FRONTEND_URL=http://100.88.44.15:3001
- `/frontend/svetu/.env` - все URL обновлены на IP адрес Tailscale

## Как это работает

1. Frontend делает запросы к API через относительные пути (например, `/api/v1/auth/refresh`)
2. Next.js проксирует эти запросы на backend (http://100.88.44.15:3000)
3. Cookies устанавливаются для текущего домена frontend
4. При последующих запросах cookies автоматически передаются через прокси

## Дополнительные настройки для production

Для production окружения рекомендуется:

1. Использовать один домен для frontend и backend (например, api.svetu.rs и svetu.rs)
2. Настроить правильные CORS заголовки
3. Использовать HTTPS и установить `Secure: true` для cookies
4. Настроить правильные значения SameSite для cookies

## Тестирование

1. Откройте http://100.88.44.15:3001
2. Войдите через Google OAuth
3. Обновите страницу - сессия должна сохраниться
4. Проверьте в DevTools что refresh_token cookie установлен