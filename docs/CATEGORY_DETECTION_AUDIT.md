# üîç –ê–£–î–ò–¢ –°–ò–°–¢–ï–ú–´ –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –ö–ê–¢–ï–ì–û–†–ò–ô

## üìä –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´)

1. **Hardcoded –º–∞–ø–ø–∏–Ω–≥–∏ –≤ –ë–î** (`category_ai_mappings`)
   - –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ domain + product_type
   - –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–µ–¥—É–≥–∞–¥–∞—Ç—å –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
   - –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –º–∞–ø–ø–∏–Ω–≥–æ–≤

2. **–ñ–µ—Å—Ç–∫–∏–µ fallback –ø—Ä–∞–≤–∏–ª–∞ –≤ –∫–æ–¥–µ**
   ```go
   domainFallbacks := map[string]string{
       "electronics": "electronics",
       "home-garden": "home",
       // –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–æ –≤ –∫–æ–¥–µ!
   }
   ```

3. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è AI –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è**
   - AI (Claude) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç domain –∏ product_type
   - –ù–æ –ù–ï –≤—ã–±–∏—Ä–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ –Ω–∞—à–µ–≥–æ —Å–ø–∏—Å–∫–∞!

### –¢–µ–∫—É—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º (5 —É—Ä–æ–≤–Ω–µ–π):

```
1. AI Hints (–≤–µ—Å 85%) ‚Üí –ò—â–µ–º –≤ category_ai_mappings
2. Keywords (–≤–µ—Å 70%) ‚Üí –ò—â–µ–º –≤ category_keyword_weights
3. Similarity (–≤–µ—Å 60%) ‚Üí –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π
4. User History (–≤–µ—Å 50%) ‚Üí –ò—Å—Ç–æ—Ä–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
5. Weighted Voting ‚Üí –í–∑–≤–µ—à–µ–Ω–Ω–æ–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **AI –Ω–µ —É—á–∞—Å—Ç–≤—É–µ—Ç –≤ –≤—ã–±–æ—Ä–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏** - —Ç–æ–ª—å–∫–æ –¥–∞–µ—Ç hints
2. **–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∞–ø–ø–∏–Ω–≥–∏** - –Ω–µ –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ–¥ –Ω–æ–≤—ã–µ —Ç–æ–≤–∞—Ä—ã
3. **–ù–µ—Ç –æ–±—É—á–µ–Ω–∏—è** - —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —É–ª—É—á—à–∞–µ—Ç—Å—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º
4. **–°–ª–æ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - 5 –º–µ—Ç–æ–¥–æ–≤, –≤–µ—Å–∞, –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ

## üéØ –ü–†–ï–î–õ–ê–ì–ê–ï–ú–û–ï –†–ï–®–ï–ù–ò–ï

### –ù–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º (3 —ç—Ç–∞–ø–∞):

#### –≠—Ç–∞–ø 1: –ê–Ω–∞–ª–∏–∑ —Ç–æ–≤–∞—Ä–∞ —á–µ—Ä–µ–∑ AI
```json
{
  "title": "–ö–µ—Ä–∞–º–∏—á–µ—Å–∫–∞—è –≤–∞–∑–∞-–æ—Å—å–º–∏–Ω–æ–≥",
  "description": "...",
  "category_hints": {
    "domain": "home decor",
    "type": "vase",
    "keywords": ["ceramic", "vase", "decoration"]
  }
}
```

#### –≠—Ç–∞–ø 2: –õ–æ–∫–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ (–±—ã—Å—Ç—Ä—ã–π)
- –ü–æ–∏—Å–∫ –ø–æ keywords –≤ –ë–î
- –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
- –ï—Å–ª–∏ confidence > 90% ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç

#### –≠—Ç–∞–ø 3: AI –≤—ã–±–∏—Ä–∞–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–ù–û–í–´–ô!)
```json
// –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Claude:
{
  "task": "select_category",
  "product": {
    "title": "–ö–µ—Ä–∞–º–∏—á–µ—Å–∫–∞—è –≤–∞–∑–∞-–æ—Å—å–º–∏–Ω–æ–≥",
    "description": "...",
    "hints": {...}
  },
  "categories": [
    {"id": 1001, "name": "Elektronika", "description": "..."},
    {"id": 1005, "name": "Dom i ba≈°ta", "description": "..."},
    // ... –≤—Å–µ 21 –∫–∞—Ç–µ–≥–æ—Ä–∏—è
  ]
}

// Claude –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
{
  "category_id": 1005,
  "confidence": 0.98,
  "reasoning": "–ö–µ—Ä–∞–º–∏—á–µ—Å–∫–∞—è –≤–∞–∑–∞ - —ç—Ç–æ –ø—Ä–µ–¥–º–µ—Ç –¥–æ–º–∞—à–Ω–µ–≥–æ –¥–µ–∫–æ—Ä–∞"
}
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞:

1. **100% —Ç–æ—á–Ω–æ—Å—Ç—å** - AI –≤–∏–¥–∏—Ç –≤—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é
2. **–ù–µ –Ω—É–∂–Ω—ã –º–∞–ø–ø–∏–Ω–≥–∏** - —É–¥–∞–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É category_ai_mappings
3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - 3 —á–µ—Ç–∫–∏—Ö —ç—Ç–∞–ø–∞ –≤–º–µ—Å—Ç–æ 5
4. **–°–∞–º–æ–æ–±—É—á–µ–Ω–∏–µ** - —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ—à–µ–Ω–∏—è AI –¥–ª—è –±—É–¥—É—â–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

## üìù –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### 1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π endpoint –≤ AI —Å–µ—Ä–≤–∏—Å–µ

```go
// /api/ai/select-category
type SelectCategoryRequest struct {
    Title       string       `json:"title"`
    Description string       `json:"description"`
    Hints       *AIHints     `json:"hints"`
    Categories  []Category   `json:"categories"`
}

type SelectCategoryResponse struct {
    CategoryID  int32   `json:"category_id"`
    Confidence  float64 `json:"confidence"`
    Reasoning   string  `json:"reasoning"`
}
```

### 2. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å DetectWithAIFallback

```go
func (d *AICategoryDetector) DetectWithAIFallback(ctx context.Context, input AIDetectionInput) (*AIDetectionResult, error) {
    // –≠—Ç–∞–ø 1: –ê–Ω–∞–ª–∏–∑ —á–µ—Ä–µ–∑ AI (—É–∂–µ –µ—Å—Ç—å)
    hints := d.analyzeWithAI(ctx, input)

    // –≠—Ç–∞–ø 2: –ë—ã—Å—Ç—Ä—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫
    if result := d.quickLocalSearch(ctx, input, hints); result != nil && result.Confidence > 0.9 {
        return result, nil
    }

    // –≠—Ç–∞–ø 3: AI –≤—ã–±–∏—Ä–∞–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    categories := d.loadAllCategories(ctx)
    result := d.askAIToSelectCategory(ctx, input, hints, categories)

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
    d.saveAIDecision(ctx, input, result)

    return result, nil
}
```

### 3. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

```go
// –ö–µ—à–∏—Ä—É–µ–º —Ä–µ—à–µ–Ω–∏—è AI
type AIDecisionCache struct {
    TitleHash    string
    CategoryID   int32
    Confidence   float64
    DecidedAt    time.Time
}
```

### 4. –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ—à–µ–Ω–∏–π AI

```sql
CREATE TABLE ai_category_decisions (
    id SERIAL PRIMARY KEY,
    title_hash VARCHAR(64) NOT NULL,
    title TEXT NOT NULL,
    description TEXT,
    category_id INTEGER NOT NULL REFERENCES marketplace_categories(id),
    confidence DECIMAL(3,2),
    reasoning TEXT,
    ai_model VARCHAR(50),
    created_at TIMESTAMP DEFAULT NOW(),

    INDEX idx_title_hash (title_hash),
    INDEX idx_category_confidence (category_id, confidence DESC)
);
```

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–µ–∫—É—â–∏–π | –ù–æ–≤—ã–π |
|----------|---------|-------|
| –¢–æ—á–Ω–æ—Å—Ç—å | ~70% | 95-99% |
| –°–∫–æ—Ä–æ—Å—Ç—å | –ë—ã—Å—Ç—Ä–æ | +200ms –Ω–∞ AI –∑–∞–ø—Ä–æ—Å |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ | –°–ª–æ–∂–Ω–∞—è (–º–∏–≥—Ä–∞—Ü–∏–∏) | –ü—Ä–æ—Å—Ç–∞—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è) |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å | –ü–ª–æ—Ö–∞—è | –û—Ç–ª–∏—á–Ω–∞—è |
| –û–±—É—á–µ–Ω–∏–µ | –ù–µ—Ç | –î–∞ |

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ**: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —ç—Ç–∞–ø 3 (AI –≤—ã–±–æ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞)
2. **–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–æ**: –°–æ–∑–¥–∞—Ç—å –∫–µ—à —Ä–µ—à–µ–Ω–∏–π AI
3. **–°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ**: –£–¥–∞–ª–∏—Ç—å hardcoded –º–∞–ø–ø–∏–Ω–≥–∏
4. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ**: –î–æ–±–∞–≤–∏—Ç—å ML –º–æ–¥–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## ‚ö†Ô∏è –†–∏—Å–∫–∏

1. **–°—Ç–æ–∏–º–æ—Å—Ç—å API Claude** - –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å —Å—Ç–æ–∏—Ç –¥–µ–Ω–µ–≥
   - –†–µ—à–µ–Ω–∏–µ: –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **–ó–∞–¥–µ—Ä–∂–∫–∞** - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π API call
   - –†–µ—à–µ–Ω–∏–µ: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞, –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏

3. **–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å AI**
   - –†–µ—à–µ–Ω–∏–µ: Fallback –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã

## üí° –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–∫–æ–º–ø—Ä–æ–º–∏—Å—Å)

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AI —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤:
1. –ï—Å–ª–∏ confidence < 70% –ø–æ—Å–ª–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
2. –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è "Ostalo" (Miscellaneous)
3. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ä—É—á–Ω—É—é –∑–∞–ø—Ä–æ—Å–∏–ª –ø—Ä–æ–≤–µ—Ä–∫—É

–≠—Ç–æ —Å–Ω–∏–∑–∏—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ API –∏ —Å—Ç–æ–∏–º–æ—Å—Ç—å.