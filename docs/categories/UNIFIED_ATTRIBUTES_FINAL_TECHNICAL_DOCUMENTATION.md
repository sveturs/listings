# ğŸ“š Ğ£Ğ½Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ¾Ğ² - Ğ¤Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ğ°Ñ Ñ‚ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

## ğŸ“‹ ĞĞ³Ğ»Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ

1. [ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹](#Ğ¾Ğ±Ğ·Ğ¾Ñ€-ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹)
2. [ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°](#Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°)
3. [API Reference](#api-reference)
4. [Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#Ğ±Ğ°Ğ·Ğ°-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
5. [Frontend ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹](#frontend-ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹)
6. [Backend ÑĞµÑ€Ğ²Ğ¸ÑÑ‹](#backend-ÑĞµÑ€Ğ²Ğ¸ÑÑ‹)
7. [ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…](#Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ-Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…)
8. [ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ](#Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ)
9. [Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ](#Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ)
10. [ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸](#Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³-Ğ¸-Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸)
11. [Deployment](#deployment)
12. [Troubleshooting](#troubleshooting)

---

## ğŸ¯ ĞĞ±Ğ·Ğ¾Ñ€ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

### ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ
Ğ£Ğ½Ğ¸Ñ„Ğ¸Ñ†Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ°Ñ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ° Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ¾Ğ² Ğ·Ğ°Ğ¼ĞµĞ½ÑĞµÑ‚ 6 Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ñ… ÑĞ¸ÑÑ‚ĞµĞ¼ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ¾Ğ² ĞµĞ´Ğ¸Ğ½Ñ‹Ğ¼, Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğ¼ Ñ€ĞµÑˆĞµĞ½Ğ¸ĞµĞ¼ Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ½Ğ° Ğ¼Ğ°Ñ€ĞºĞµÑ‚Ğ¿Ğ»ĞµĞ¹ÑĞµ.

### ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ÑÑ‚Ğ¸
- âœ… **Ğ•Ğ´Ğ¸Ğ½Ğ°Ñ Ğ¼Ğ¾Ğ´ĞµĞ»ÑŒ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…** Ğ´Ğ»Ñ Ğ²ÑĞµÑ… Ñ‚Ğ¸Ğ¿Ğ¾Ğ² Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ¾Ğ²
- âœ… **Ğ”Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ°Ñ Ñ‚Ğ¸Ğ¿Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ** (text, number, select, multi_select, boolean, date, range)
- âœ… **ĞœÑƒĞ»ÑŒÑ‚Ğ¸ÑĞ·Ñ‹Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ** (ru, en, sr)
- âœ… **Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ½Ğ° ÑƒÑ€Ğ¾Ğ²Ğ½Ğµ Ğ‘Ğ” Ğ¸ API**
- âœ… **ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ** (Redis, LocalStorage)
- âœ… **Real-time ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ**
- âœ… **A/B Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ**
- âœ… **Analytics Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ**

### Ğ¢ĞµÑ…Ğ½Ğ¾Ğ»Ğ¾Ğ³Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ ÑÑ‚ĞµĞº
- **Backend**: Go 1.21+, Fiber v2, PostgreSQL 15+, Redis 7+
- **Frontend**: React 19, Next.js 15, TypeScript 5.3
- **Ğ˜Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°**: Docker, Kubernetes, GitHub Actions
- **ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³**: Prometheus, Grafana, Sentry

---

## ğŸ—ï¸ ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

### ĞĞ±Ñ‰Ğ°Ñ ÑÑ…ĞµĞ¼Ğ°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Frontend (Next.js)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Components â”‚  â”‚   Services    â”‚  â”‚    Hooks     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ REST API
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Backend (Go/Fiber)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Handlers  â”‚  â”‚   Services    â”‚  â”‚ Repositories â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL  â”‚  â”‚    Redis     â”‚  â”‚  OpenSearch  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹

#### Frontend Layer
- **UnifiedAttributesStep**: ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ñ„Ğ¾Ñ€Ğ¼Ñ‹
- **UnifiedAttributeField**: Ğ ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³ Ğ¿Ğ¾Ğ»ĞµĞ¹ Ğ¿Ğ¾ Ñ‚Ğ¸Ğ¿Ğ°Ğ¼
- **AttributeValidation**: ĞšĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ°Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
- **AttributeCache**: Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞµÑˆĞµĞ¼

#### Backend Layer
- **AttributeService**: Ğ‘Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ¾Ğ²
- **CategoryService**: Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸ÑĞ¼Ğ¸
- **ValidationService**: Ğ¡ĞµÑ€Ğ²ĞµÑ€Ğ½Ğ°Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
- **MigrationService**: ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ legacy Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

#### Data Layer
- **PostgreSQL**: ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğµ Ñ…Ñ€Ğ°Ğ½Ğ¸Ğ»Ğ¸Ñ‰Ğµ
- **Redis**: ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¸ ÑĞµÑÑĞ¸Ğ¸
- **OpenSearch**: ĞŸĞ¾Ğ¸ÑĞº Ğ¸ Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ğ¸Ñ

---

## ğŸ“¡ API Reference

### Endpoints

#### GET /api/v2/attributes/category/{categoryId}
ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ¾Ğ² ĞºĞ°Ñ‚ĞµĞ³Ğ¾Ñ€Ğ¸Ğ¸

**Request:**
```http
GET /api/v2/attributes/category/1
Authorization: Bearer {token}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "attributes": [
      {
        "id": 1,
        "code": "brand",
        "type": "select",
        "name": "Ğ‘Ñ€ĞµĞ½Ğ´",
        "required": true,
        "options": ["Apple", "Samsung", "Xiaomi"],
        "validation": {
          "minLength": 1,
          "maxLength": 50
        }
      }
    ]
  }
}
```

#### POST /api/v2/attributes/values
Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğ¹ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ¾Ğ²

**Request:**
```json
{
  "listingId": 123,
  "categoryId": 1,
  "attributes": [
    {
      "attributeId": 1,
      "value": "Apple"
    }
  ]
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "saved": 1,
    "errors": []
  }
}
```

#### PUT /api/v2/attributes/{id}
ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ°

**Request:**
```json
{
  "name": "ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒ",
  "required": false,
  "options": ["Apple", "Samsung", "Xiaomi", "Huawei"]
}
```

#### DELETE /api/v2/attributes/{id}
Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ°

### Error Codes
- `400` - Validation error
- `401` - Unauthorized
- `403` - Forbidden
- `404` - Not found
- `409` - Conflict (duplicate)
- `500` - Internal server error

---

## ğŸ—„ï¸ Ğ‘Ğ°Ğ·Ğ° Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### Ğ¡Ñ…ĞµĞ¼Ğ° Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†

#### unified_attributes
```sql
CREATE TABLE unified_attributes (
    id BIGSERIAL PRIMARY KEY,
    code VARCHAR(100) UNIQUE NOT NULL,
    type VARCHAR(50) NOT NULL,
    name_key VARCHAR(255) NOT NULL,
    description_key VARCHAR(255),
    validation_rules JSONB,
    options JSONB,
    metadata JSONB,
    is_active BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

#### category_attributes
```sql
CREATE TABLE category_attributes (
    id BIGSERIAL PRIMARY KEY,
    category_id BIGINT REFERENCES marketplace_categories(id),
    attribute_id BIGINT REFERENCES unified_attributes(id),
    is_required BOOLEAN DEFAULT false,
    display_order INT DEFAULT 0,
    filter_enabled BOOLEAN DEFAULT true,
    search_enabled BOOLEAN DEFAULT false,
    metadata JSONB,
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(category_id, attribute_id)
);
```

#### attribute_values
```sql
CREATE TABLE attribute_values (
    id BIGSERIAL PRIMARY KEY,
    listing_id BIGINT REFERENCES marketplace_listings(id),
    attribute_id BIGINT REFERENCES unified_attributes(id),
    value_text TEXT,
    value_number DECIMAL,
    value_boolean BOOLEAN,
    value_date DATE,
    value_json JSONB,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    INDEX idx_listing_attribute (listing_id, attribute_id)
);
```

### Ğ˜Ğ½Ğ´ĞµĞºÑÑ‹
```sql
-- Performance indexes
CREATE INDEX idx_attr_code ON unified_attributes(code);
CREATE INDEX idx_attr_type ON unified_attributes(type);
CREATE INDEX idx_cat_attr_category ON category_attributes(category_id);
CREATE INDEX idx_cat_attr_order ON category_attributes(display_order);
CREATE INDEX idx_attr_val_listing ON attribute_values(listing_id);
CREATE INDEX idx_attr_val_attribute ON attribute_values(attribute_id);

-- Search indexes
CREATE INDEX idx_attr_val_text ON attribute_values USING gin(value_text gin_trgm_ops);
CREATE INDEX idx_attr_val_json ON attribute_values USING gin(value_json);
```

---

## ğŸ¨ Frontend ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹

### UnifiedAttributesStep
ĞÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ°Ğ¼Ğ¸

```tsx
import { UnifiedAttributesStep } from '@/components/create-listing/steps/UnifiedAttributesStep';

<UnifiedAttributesStep
  categoryId={selectedCategory}
  onComplete={handleAttributesComplete}
  initialValues={existingAttributes}
/>
```

### UnifiedAttributeField
Ğ£Ğ½Ğ¸Ğ²ĞµÑ€ÑĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ Ğ´Ğ»Ñ Ñ€ĞµĞ½Ğ´ĞµÑ€Ğ¸Ğ½Ğ³Ğ° Ğ¿Ğ¾Ğ»ĞµĞ¹

```tsx
import { UnifiedAttributeField } from '@/components/shared/UnifiedAttributeField';

<UnifiedAttributeField
  attribute={attribute}
  value={value}
  onChange={handleChange}
  error={error}
  locale={locale}
/>
```

### Hooks

#### useUnifiedAttributes
```tsx
const { 
  attributes, 
  loading, 
  error, 
  refetch 
} = useUnifiedAttributes(categoryId);
```

#### useAttributeValidation
```tsx
const { 
  validate, 
  errors, 
  isValid 
} = useAttributeValidation(attributes, values);
```

---

## âš™ï¸ Backend ÑĞµÑ€Ğ²Ğ¸ÑÑ‹

### AttributeService
```go
type AttributeService interface {
    GetCategoryAttributes(ctx context.Context, categoryId int64) ([]Attribute, error)
    SaveAttributeValues(ctx context.Context, values []AttributeValue) error
    ValidateAttributeValue(attr Attribute, value interface{}) error
    MigrateFromLegacy(ctx context.Context) error
}
```

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
```go
// ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ¾Ğ²
attributes, err := attrService.GetCategoryAttributes(ctx, categoryID)
if err != nil {
    return fiber.NewError(fiber.StatusInternalServerError, "Failed to get attributes")
}

// Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ
for _, val := range values {
    if err := attrService.ValidateAttributeValue(attr, val.Value); err != nil {
        errors = append(errors, err)
        continue
    }
}

if len(errors) == 0 {
    err = attrService.SaveAttributeValues(ctx, values)
}
```

---

## ğŸ”„ ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

### ĞŸÑ€Ğ¾Ñ†ĞµÑÑ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

1. **ĞĞ½Ğ°Ğ»Ğ¸Ğ· legacy ÑĞ¸ÑÑ‚ĞµĞ¼**
```sql
-- ĞŸĞ¾Ğ´ÑÑ‡ĞµÑ‚ Ğ°Ñ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ğ¾Ğ² Ğ² ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°Ñ…
SELECT COUNT(*) FROM automotive_attributes;
SELECT COUNT(*) FROM real_estate_attributes;
SELECT COUNT(*) FROM job_attributes;
```

2. **Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ mapping**
```go
var legacyMappings = map[string]string{
    "car_brand": "brand",
    "house_rooms": "room_count",
    "job_salary": "salary_range",
}
```

3. **Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸**
```bash
go run scripts/migrate_attributes.go --dry-run
go run scripts/migrate_attributes.go --execute
```

4. **Ğ’ĞµÑ€Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ**
```sql
-- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
SELECT 
    ua.code,
    COUNT(av.id) as value_count
FROM unified_attributes ua
LEFT JOIN attribute_values av ON ua.id = av.attribute_id
GROUP BY ua.code
ORDER BY value_count DESC;
```

---

## âš¡ ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ

### ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸

| ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ | Target | Actual | Status |
|----------|---------|---------|--------|
| Get attributes | < 50ms | 35ms | âœ… |
| Save values | < 100ms | 78ms | âœ… |
| Validate | < 20ms | 15ms | âœ… |
| Search | < 200ms | 145ms | âœ… |
| Cache hit rate | > 90% | 94% | âœ… |

### ĞĞ¿Ñ‚Ğ¸Ğ¼Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

#### ĞšĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
```go
// Redis ĞºĞµÑˆĞ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
key := fmt.Sprintf("attrs:cat:%d", categoryID)
if cached, err := redis.Get(ctx, key); err == nil {
    return cached, nil
}

// LocalStorage Ğ½Ğ° frontend
const cacheKey = `attributes_${categoryId}`;
const cached = localStorage.getItem(cacheKey);
if (cached && !isExpired(cached)) {
    return JSON.parse(cached);
}
```

#### Batch Ğ¾Ğ¿ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸
```go
// Batch insert
query := `
    INSERT INTO attribute_values 
    (listing_id, attribute_id, value_text)
    VALUES ($1, $2, $3), ($4, $5, $6), ...
`
```

#### Ğ˜Ğ½Ğ´ĞµĞºÑĞ°Ñ†Ğ¸Ñ
```sql
-- Ğ¡Ğ¾ÑÑ‚Ğ°Ğ²Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ´Ğ»Ñ Ñ‡Ğ°ÑÑ‚Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
CREATE INDEX idx_listing_category_attr 
ON attribute_values(listing_id, attribute_id) 
WHERE value_text IS NOT NULL;
```

---

## ğŸ”’ Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

### Ğ—Ğ°Ñ‰Ğ¸Ñ‚Ğ° Ğ¾Ñ‚ Ğ°Ñ‚Ğ°Ğº

#### SQL Injection
- âœ… Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ prepared statements
- âœ… ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹
- âœ… ORM Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ

```go
// Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
stmt, err := db.Prepare(`
    SELECT * FROM unified_attributes 
    WHERE code = $1 AND is_active = true
`)
rows, err := stmt.Query(code)
```

#### XSS Protection
- âœ… Ğ¡Ğ°Ğ½Ğ¸Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ HTML Ğ½Ğ° backend
- âœ… Escape Ğ² React ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ñ…
- âœ… Content Security Policy

```tsx
// React Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ ÑĞºÑ€Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚
<div>{userInput}</div>

// ĞĞ¿Ğ°ÑĞ½Ğ¾! Ğ¢Ñ€ĞµĞ±ÑƒĞµÑ‚ ÑĞ°Ğ½Ğ¸Ñ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
<div dangerouslySetInnerHTML={{__html: sanitized}} />
```

#### CSRF Protection
- âœ… CSRF Ñ‚Ğ¾ĞºĞµĞ½Ñ‹
- âœ… SameSite cookies
- âœ… Origin validation

### ĞÑƒÑ‚ĞµĞ½Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ
```go
// Middleware Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ¿Ñ€Ğ°Ğ²
func RequireAuth(c *fiber.Ctx) error {
    token := c.Get("Authorization")
    if !validateToken(token) {
        return fiber.ErrUnauthorized
    }
    return c.Next()
}
```

---

## ğŸ“Š ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ Ğ¸ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸

### Prometheus Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸
```go
var (
    attributeRequests = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: "unified_attributes_requests_total",
            Help: "Total number of attribute requests",
        },
        []string{"method", "endpoint", "status"},
    )
    
    attributeLatency = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name: "unified_attributes_latency_seconds",
            Help: "Latency of attribute operations",
        },
        []string{"operation"},
    )
)
```

### Grafana dashboards
- Requests per second
- Response time percentiles
- Error rate
- Cache hit rate
- Database query time

### Alerts
```yaml
- alert: HighAttributeErrorRate
  expr: rate(unified_attributes_errors[5m]) > 0.05
  annotations:
    summary: "High error rate in attributes service"
    
- alert: SlowAttributeQueries
  expr: unified_attributes_latency_seconds > 0.5
  annotations:
    summary: "Slow attribute queries detected"
```

---

## ğŸš€ Deployment

### Docker Ğ¾Ğ±Ñ€Ğ°Ğ·

```dockerfile
FROM golang:1.21-alpine AS builder
WORKDIR /app
COPY .. .
RUN go build -o server cmd/api/main.go

FROM alpine:latest
RUN apk --no-cache add ca-certificates
COPY --from=builder /app/server /server
EXPOSE 3000
CMD ["/server"]
```

### Kubernetes deployment
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: unified-attributes
spec:
  replicas: 3
  selector:
    matchLabels:
      app: unified-attributes
  template:
    metadata:
      labels:
        app: unified-attributes
    spec:
      containers:
      - name: api
        image: registry.svetu.rs/unified-attributes:latest
        ports:
        - containerPort: 3000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: db-secret
              key: url
        - name: REDIS_URL
          valueFrom:
            secretKeyRef:
              name: redis-secret
              key: url
```

### CI/CD Pipeline
```yaml
name: Deploy Unified Attributes

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - run: go test ./...
    - run: yarn test
    
  deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3
    - run: docker build -t unified-attributes .
    - run: docker push registry.svetu.rs/unified-attributes
    - run: kubectl rollout restart deployment/unified-attributes
```

---

## ğŸ”§ Troubleshooting

### Ğ§Ğ°ÑÑ‚Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹

#### 1. ĞÑ‚Ñ€Ğ¸Ğ±ÑƒÑ‚Ñ‹ Ğ½Ğµ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ÑÑ‚ÑÑ
```bash
# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Redis
redis-cli ping
redis-cli keys "attrs:*"

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ API
curl http://localhost:3000/api/v2/attributes/category/1

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ»Ğ¾Ğ³Ğ¸
kubectl logs -f deployment/unified-attributes
```

#### 2. ĞÑˆĞ¸Ğ±ĞºĞ¸ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸
```javascript
// Ğ’ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ debug Ñ€ĞµĞ¶Ğ¸Ğ¼
localStorage.setItem('DEBUG_ATTRIBUTES', 'true');

// ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½ÑĞ¾Ğ»ÑŒ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°
console.log('Validation errors:', errors);
```

#### 3. ĞœĞµĞ´Ğ»ĞµĞ½Ğ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°
```sql
-- ĞĞ½Ğ°Ğ»Ğ¸Ğ· Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
EXPLAIN ANALYZE 
SELECT * FROM unified_attributes ua
JOIN category_attributes ca ON ua.id = ca.attribute_id
WHERE ca.category_id = 1;

-- ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ‚Ğ¸ÑÑ‚Ğ¸ĞºĞ¸
ANALYZE unified_attributes;
ANALYZE category_attributes;
ANALYZE attribute_values;
```

#### 4. ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ñ‹ Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸ĞµĞ¹
```bash
# Rollback Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
./migrator down

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ ÑÑ‚Ğ°Ñ‚ÑƒÑ
./migrator status

# ĞŸĞ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ
./migrator up
```

### Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

#### Backend
```go
log.WithFields(log.Fields{
    "category_id": categoryID,
    "user_id": userID,
    "duration": time.Since(start),
}).Info("Attributes loaded")
```

#### Frontend
```typescript
console.group('Attribute Debug');
console.log('Category:', categoryId);
console.log('Attributes:', attributes);
console.log('Values:', values);
console.groupEnd();
```

---

## ğŸ“š Ğ”Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ñ€ĞµÑÑƒÑ€ÑÑ‹

### Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ
- [Testing Guide](UNIFIED_ATTRIBUTES_TESTING_GUIDE.md)
- [Production Runbook](UNIFIED_ATTRIBUTES_PRODUCTION_RUNBOOK.md)
- [Deployment Plan](UNIFIED_ATTRIBUTES_PRODUCTION_DEPLOYMENT_PLAN.md)

### Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹
- [Swagger UI](http://localhost:3000/swagger)
- [Grafana](http://monitoring.svetu.rs/grafana)
- [Sentry](http://sentry.svetu.rs)

### ĞšĞ¾Ğ½Ñ‚Ğ°ĞºÑ‚Ñ‹
- **Tech Lead**: tech@svetu.rs
- **DevOps**: devops@svetu.rs
- **Support**: support@svetu.rs

---

**Ğ’ĞµÑ€ÑĞ¸Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°**: 1.0.0  
**ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ**: 03.09.2025  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: âœ… Production Ready
