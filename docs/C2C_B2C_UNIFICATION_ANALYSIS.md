# üîç –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è C2C –∏ B2C —Å—É—â–Ω–æ—Å—Ç–µ–π

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-10-09
**–ê–Ω–∞–ª–∏—Ç–∏–∫:** Claude Code
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à—ë–Ω

---

## üìã Executive Summary

–ü–æ—Å–ª–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞ **–ù–ï –†–ï–ö–û–ú–ï–ù–î–£–Æ** –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —Ç–∞–±–ª–∏—Ü—ã `c2c_listings` –∏ `b2c_products` –≤ –æ–¥–Ω—É —Å—É—â–Ω–æ—Å—Ç—å.

**–û–¥–Ω–∞–∫–æ –†–ï–ö–û–ú–ï–ù–î–£–Æ** –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—É—é, –∫—ç—à –∏ S3 –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É —á–µ—Ä–µ–∑ –ø–∞—Ç—Ç–µ—Ä–Ω "Unified Product Interface".

---

## üéØ –ö–ª—é—á–µ–≤—ã–µ –Ω–∞—Ö–æ–¥–∫–∏

### 1. **–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ - —ç—Ç–æ –ù–ï –¥—É–±–ª–∏–∫–∞—Ü–∏—è, –∞ –°–ò–ú–ë–ò–û–ó**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  C2C_LISTINGS (58 –∑–∞–ø–∏—Å–µ–π)           ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  ‚îú‚îÄ –ß–∏—Å—Ç—ã–π C2C (3 –∑–∞–ø–∏—Å–∏)            ‚îÇ
‚îÇ  ‚îÇ   user_id: YES                    ‚îÇ
‚îÇ  ‚îÇ   storefront_id: NULL             ‚îÇ
‚îÇ  ‚îÇ   external_id: NULL               ‚îÇ
‚îÇ  ‚îÇ                                   ‚îÇ
‚îÇ  ‚îî‚îÄ –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π C2C (55 –∑–∞–ø–∏—Å–µ–π)‚îÇ
‚îÇ      user_id: YES                    ‚îÇ
‚îÇ      storefront_id: 43 ‚Üê —Å–≤—è–∑—å —Å B2C ‚îÇ
‚îÇ      external_id: SKU –∏–∑ –ø—Ä–∞–π—Å–∞      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                 ‚Üï
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  B2C_PRODUCTS (5 –∑–∞–ø–∏—Å–µ–π)            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  storefront_id: 43                   ‚îÇ
‚îÇ  sku, barcode, stock_quantity        ‚îÇ
‚îÇ  has_variants, attributes            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### 2. **95% C2C –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å–≤—è–∑–∞–Ω—ã —Å –º–∞–≥–∞–∑–∏–Ω–∞–º–∏ —á–µ—Ä–µ–∑ import system**

–≠—Ç–æ –Ω–µ –æ—à–∏–±–∫–∞ –¥–∏–∑–∞–π–Ω–∞ - —ç—Ç–æ **–§–ò–ß–ê**!

**–õ–æ–≥–∏–∫–∞:** –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ –ø—Ä–∞–π—Å–æ–≤ (XML/CSV) —Å–æ–∑–¥–∞—ë—Ç:
- ‚úÖ B2C product (—Ç–æ–≤–∞—Ä –≤ –≤–∏—Ç—Ä–∏–Ω–µ –º–∞–≥–∞–∑–∏–Ω–∞)
- ‚úÖ C2C listing (—Ç–æ–≤–∞—Ä –≤ –æ–±—â–µ–º –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ)

–ö–æ–¥: `backend/internal/proj/b2c/service/import_service.go:1846-1919` (IndexMarketplaceListings)

---

## üìä –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä –ë–î

### –¢–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –ø–æ–ª–µ–π

| –ü–æ–ª–µ | C2C | B2C | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|-----|-----|-------------|
| **–û–±—â–∏–µ (12 –ø–æ–ª–µ–π)** ||||
| id | ‚úÖ | ‚úÖ | global_product_id_seq |
| category_id | ‚úÖ | ‚úÖ | |
| title / name | ‚úÖ | ‚úÖ | –†–∞–∑–Ω—ã–µ –∏–º–µ–Ω–∞ |
| description | ‚úÖ | ‚úÖ | |
| price | ‚úÖ | ‚úÖ | |
| status / is_active | ‚úÖ | ‚úÖ | –†–∞–∑–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞ |
| latitude, longitude | ‚úÖ | ‚úÖ | |
| show_on_map | ‚úÖ | ‚úÖ | |
| created_at, updated_at | ‚úÖ | ‚úÖ | |
| **–£–ù–ò–ö–ê–õ–¨–ù–´–ï C2C (11 –ø–æ–ª–µ–π)** ||||
| user_id | ‚úÖ | ‚ùå | –í–ª–∞–¥–µ–ª–µ—Ü (—Ñ–∏–∑–ª–∏—Ü–æ) |
| condition | ‚úÖ | ‚ùå | new/used |
| location | ‚úÖ | ‚ùå | –¢–µ–∫—Å—Ç–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ |
| address_city, address_country | ‚úÖ | ‚ùå | |
| original_language | ‚úÖ | ‚ùå | sr/en/ru |
| storefront_id | ‚úÖ | ‚ùå | **–ö–õ–Æ–ß–ï–í–û–ï!** –°–≤—è–∑—å —Å B2C |
| external_id | ‚úÖ | ‚ùå | SKU –∏–∑ –ø—Ä–∞–π—Å–∞ |
| metadata | ‚úÖ | ‚ùå | –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –ø–æ–ª—è |
| needs_reindex | ‚úÖ | ‚ùå | OpenSearch —Ñ–ª–∞–≥ |
| address_multilingual | ‚úÖ | ‚ùå | i18n –∞–¥—Ä–µ—Å–∞ |
| views_count | ‚úÖ | ‚ùå | |
| **–£–ù–ò–ö–ê–õ–¨–ù–´–ï B2C (12 –ø–æ–ª–µ–π)** ||||
| storefront_id | ‚ùå | ‚úÖ | NOT NULL! |
| sku | ‚ùå | ‚úÖ | –ê—Ä—Ç–∏–∫—É–ª |
| barcode | ‚ùå | ‚úÖ | –®—Ç—Ä–∏—Ö–∫–æ–¥ |
| stock_quantity | ‚ùå | ‚úÖ | –°–∫–ª–∞–¥—Å–∫–æ–π —É—á—ë—Ç |
| stock_status | ‚ùå | ‚úÖ | in_stock/out_of_stock |
| currency | ‚ùå | ‚úÖ | RSD/USD/EUR |
| attributes | ‚ùå | ‚úÖ | Structured attrs |
| sold_count | ‚ùå | ‚úÖ | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| has_individual_location | ‚ùå | ‚úÖ | –°–≤–æ–π –∞–¥—Ä–µ—Å |
| individual_address/lat/lon | ‚ùå | ‚úÖ | |
| location_privacy | ‚ùå | ‚úÖ | exact/approximate |
| has_variants | ‚ùå | ‚úÖ | –°–∏—Å—Ç–µ–º–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ |

### –í—ã–≤–æ–¥:

- **–ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ: ~30%** (12 –æ–±—â–∏—Ö –ø–æ–ª–µ–π –∏–∑ ~40 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö)
- **C2C —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ: 11 –ø–æ–ª–µ–π** (48% –æ—Ç C2C total)
- **B2C —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ: 12 –ø–æ–ª–µ–π** (50% –æ—Ç B2C total)

---

## üî¨ –ê–Ω–∞–ª–∏–∑ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### C2C Use Cases

1. **–ß–∏—Å—Ç—ã–π C2C** (peer-to-peer –ø—Ä–æ–¥–∞–∂–∏)
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
   - –ù–µ—Ç —Å–∫–ª–∞–¥—Å–∫–æ–≥–æ —É—á—ë—Ç–∞
   - –ù–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–æ–≤–∞—Ä–∞
   - –ü—Ä–æ—Å—Ç–∞—è –º–æ–¥–µ–ª—å (–∑–∞–≥–æ–ª–æ–≤–æ–∫, —Ü–µ–Ω–∞, —Ñ–æ—Ç–æ)

2. **–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π C2C** (–≤–∏—Ç—Ä–∏–Ω–∞ ‚Üí –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å)
   - –ú–∞–≥–∞–∑–∏–Ω –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∞–π—Å (XML/CSV)
   - –°–æ–∑–¥–∞—ë—Ç—Å—è B2C product + C2C listing
   - C2C listing.storefront_id ‚Üí B2C store
   - –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ü–µ–Ω –∏ –Ω–∞–ª–∏—á–∏—è

### B2C Use Cases

1. **–ò–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω**
   - –ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
   - –°–∫–ª–∞–¥—Å–∫–æ–π —É—á—ë—Ç (stock_quantity)
   - SKU/Barcode —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
   - –ê—Ç—Ä–∏–±—É—Ç—ã (—Ü–≤–µ—Ç, —Ä–∞–∑–º–µ—Ä)
   - –ü–µ—Ä—Å–æ–Ω–∞–ª (store_staff)
   - –ß–∞—Å—ã —Ä–∞–±–æ—Ç—ã (store_hours)

2. **POS —Å–∏—Å—Ç–µ–º–∞**
   - –ü—Ä–æ–¥–∞–∂–∏ —á–µ—Ä–µ–∑ –≤–∏—Ç—Ä–∏–Ω—É
   - –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è (inventory_movements)
   - –í–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–∞ (variants)
   - –î–æ—Å—Ç–∞–≤–∫–∞ (delivery_options)

---

## üí• –ü—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü

### 1. **–ú–∞—Å—Å–æ–≤—ã–µ NULL –ø–æ–ª—è (~50%)**

–û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞:
```sql
CREATE TABLE unified_products (
    -- 12 –æ–±—â–∏—Ö –ø–æ–ª–µ–π
    id, title, price, category_id, ...

    -- 11 C2C –ø–æ–ª–µ–π (NULL –¥–ª—è B2C)
    user_id, condition, external_id, storefront_id, ...

    -- 12 B2C –ø–æ–ª–µ–π (NULL –¥–ª—è C2C)
    sku, barcode, stock_quantity, has_variants, ...
);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** 50% –ø–æ–ª–µ–π –±—É–¥—É—Ç NULL –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞ –∑–∞–ø–∏—Å–∏!

### 2. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏**

```go
// –ü—Ä–∏–º–µ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –≤ –∫–æ–¥–µ
func (s *ProductService) UpdateProduct(ctx context.Context, id int, req UpdateRequest) error {
    // –ö–∞–∫–æ–π —Ç–∏–ø –ø—Ä–æ–¥—É–∫—Ç–∞?
    if product.Type == "c2c" {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º user_id –≤–ª–∞–¥–µ–ª—å—Ü–∞
        if product.UserID != currentUserID {
            return ErrUnauthorized
        }
        // –ù–ï –æ–±–Ω–æ–≤–ª—è–µ–º stock_quantity (–µ–≥–æ –Ω–µ—Ç)
        // –ù–ï –æ–±–Ω–æ–≤–ª—è–µ–º variants (–∏—Ö –Ω–µ—Ç)

    } else if product.Type == "b2c" {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º storefront ownership
        if !HasStoreAccess(currentUserID, product.StorefrontID) {
            return ErrUnauthorized
        }
        // –î–û–õ–ñ–ù–´ –æ–±–Ω–æ–≤–∏—Ç—å stock_quantity
        // –î–û–õ–ñ–ù–´ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å variants
    }

    // 100+ —Å—Ç—Ä–æ–∫ if-else –ª–æ–≥–∏–∫–∏...
}
```

### 3. **–°–ª–æ–∂–Ω–æ—Å—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏–∏**

```go
// –û–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö constraints
CHECK (
    (type = 'c2c' AND user_id IS NOT NULL AND storefront_id IS NULL) OR
    (type = 'b2c' AND storefront_id IS NOT NULL AND stock_quantity IS NOT NULL)
)
```

### 4. **–ü–æ—Ç–µ—Ä—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏–Ω–¥–µ–∫—Å–æ–≤**

–¢–µ–∫—É—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ –∫–∞–∂–¥—ã–π use case:

**C2C:**
- `c2c_listings_user_id_status_created_at_idx` (–º–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è)
- `c2c_listings_status_created_at_idx` (–Ω–æ–≤—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è)
- `c2c_listings_storefront_id_idx` (–∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)

**B2C:**
- `b2c_products_storefront_id_sku_idx` (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π SKU)
- `b2c_products_stock_status_idx` (–≤ –Ω–∞–ª–∏—á–∏–∏)
- `b2c_products_has_variants_idx` (—Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏)

–ü–æ—Å–ª–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è: –ø—Ä–∏–¥—ë—Ç—Å—è –¥–æ–±–∞–≤–ª—è—Ç—å `type` –≤–æ –≤—Å–µ –∏–Ω–¥–µ–∫—Å—ã ‚Üí —Ä–æ—Å—Ç —Ä–∞–∑–º–µ—Ä–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ 30-50%!

---

## ‚úÖ –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–û–ï –†–ï–®–ï–ù–ò–ï: Unified Product Interface

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         UNIFIED SEARCH & INFRASTRUCTURE             ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  OpenSearch Index: "products" (–µ–¥–∏–Ω—ã–π –∏–Ω–¥–µ–∫—Å)       ‚îÇ
‚îÇ  MinIO/S3: "products/" (–µ–¥–∏–Ω—ã–π bucket)              ‚îÇ
‚îÇ  Redis Cache: "product:{id}" (–µ–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         DOMAIN LAYER (–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  type Sellable interface {                          ‚îÇ
‚îÇ      GetID() int                                    ‚îÇ
‚îÇ      GetTitle() string                              ‚îÇ
‚îÇ      GetPrice() decimal.Decimal                     ‚îÇ
‚îÇ      GetImages() []Image                            ‚îÇ
‚îÇ      GetCategory() int                              ‚îÇ
‚îÇ      GetType() ProductType  // "c2c" | "b2c"        ‚îÇ
‚îÇ  }                                                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚Üô          ‚Üò
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   C2C_LISTINGS         ‚îÇ  ‚îÇ   B2C_PRODUCTS         ‚îÇ
‚îÇ   (23 –ø–æ–ª—è)            ‚îÇ  ‚îÇ   (24 –ø–æ–ª—è)            ‚îÇ
‚îÇ   ‚îú‚îÄ user_id           ‚îÇ  ‚îÇ   ‚îú‚îÄ storefront_id     ‚îÇ
‚îÇ   ‚îú‚îÄ condition         ‚îÇ  ‚îÇ   ‚îú‚îÄ sku, barcode      ‚îÇ
‚îÇ   ‚îú‚îÄ external_id       ‚îÇ  ‚îÇ   ‚îú‚îÄ stock_quantity    ‚îÇ
‚îÇ   ‚îî‚îÄ storefront_id     ‚îÇ  ‚îÇ   ‚îî‚îÄ has_variants      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

#### 1. –û–±—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```go
// backend/internal/domain/product_common.go
package domain

type ProductType string

const (
    ProductTypeC2C ProductType = "c2c"
    ProductTypeB2C ProductType = "b2c"
)

// Sellable - —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤
type Sellable interface {
    // –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    GetID() int
    GetType() ProductType
    GetTitle() string
    GetDescription() string
    GetPrice() decimal.Decimal
    GetCurrency() string

    // –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è
    GetCategoryID() int

    // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    GetImages() []ProductImage
    GetMainImage() *ProductImage

    // –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
    GetLocation() (lat, lon float64, hasLocation bool)
    GetAddress() string

    // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
    GetCreatedAt() time.Time
    GetUpdatedAt() time.Time
    IsActive() bool

    // –ü–æ–∏—Å–∫–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è OpenSearch
    ToSearchDocument() map[string]interface{}
}

// C2CListing implements Sellable
func (l *C2CListing) GetID() int { return l.ID }
func (l *C2CListing) GetType() ProductType { return ProductTypeC2C }
func (l *C2CListing) GetTitle() string { return l.Title }
// ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã

// B2CProduct implements Sellable
func (p *B2CProduct) GetID() int { return p.ID }
func (p *B2CProduct) GetType() ProductType { return ProductTypeB2C }
func (p *B2CProduct) GetTitle() string { return p.Name }
// ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã
```

#### 2. Unified Search Service

```go
// backend/internal/proj/search/unified_search_service.go
package search

type UnifiedSearchService struct {
    c2cRepo       C2CRepository
    b2cRepo       B2CRepository
    osClient      *opensearch.Client
    indexName     string // "products"
}

// Search –∏—â–µ—Ç –ø–æ –µ–¥–∏–Ω–æ–º—É –∏–Ω–¥–µ–∫—Å—É OpenSearch
func (s *UnifiedSearchService) Search(ctx context.Context, query SearchQuery) ([]domain.Sellable, error) {
    // 1. –ü–æ–∏—Å–∫ –≤ OpenSearch –ø–æ –µ–¥–∏–Ω–æ–º—É –∏–Ω–¥–µ–∫—Å—É
    results, err := s.osClient.Search(ctx, s.indexName, query.ToOpenSearchQuery())
    if err != nil {
        return nil, err
    }

    // 2. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ —Ç–∏–ø—É
    c2cIDs := []int{}
    b2cIDs := []int{}

    for _, hit := range results.Hits {
        switch hit.Source["type"] {
        case "c2c":
            c2cIDs = append(c2cIDs, hit.Source["id"].(int))
        case "b2c":
            b2cIDs = append(b2cIDs, hit.Source["id"].(int))
        }
    }

    // 3. Batch –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü
    var products []domain.Sellable

    if len(c2cIDs) > 0 {
        c2cListings, err := s.c2cRepo.GetByIDs(ctx, c2cIDs)
        if err == nil {
            for _, listing := range c2cListings {
                products = append(products, listing)
            }
        }
    }

    if len(b2cIDs) > 0 {
        b2cProducts, err := s.b2cRepo.GetByIDs(ctx, b2cIDs)
        if err == nil {
            for _, product := range b2cProducts {
                products = append(products, product)
            }
        }
    }

    return products, nil
}

// IndexProduct –∏–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä –ª—é–±–æ–≥–æ —Ç–∏–ø–∞
func (s *UnifiedSearchService) IndexProduct(ctx context.Context, product domain.Sellable) error {
    doc := product.ToSearchDocument()

    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∏–ø –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
    doc["type"] = product.GetType()
    doc["id"] = product.GetID()

    return s.osClient.Index(ctx, s.indexName, doc)
}
```

#### 3. Unified OpenSearch Index Mapping

```json
{
  "mappings": {
    "properties": {
      "type": { "type": "keyword" },
      "id": { "type": "integer" },
      "source_table": { "type": "keyword" },

      "title": { "type": "text", "analyzer": "russian" },
      "description": { "type": "text" },
      "price": { "type": "float" },
      "currency": { "type": "keyword" },
      "category_id": { "type": "integer" },

      "location": { "type": "geo_point" },
      "address": { "type": "text" },

      "is_active": { "type": "boolean" },
      "created_at": { "type": "date" },

      "metadata": {
        "type": "object",
        "properties": {
          "condition": { "type": "keyword" },
          "sku": { "type": "keyword" },
          "stock_quantity": { "type": "integer" },
          "has_variants": { "type": "boolean" }
        }
      }
    }
  }
}
```

#### 4. Unified Image Storage

```go
// backend/internal/services/image_service.go

const (
    // –ï–¥–∏–Ω—ã–π bucket –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤
    ProductImagesBucket = "products"
)

func (s *ImageService) UploadProductImage(ctx context.Context, product domain.Sellable, image *Image) error {
    // –ü—É—Ç—å: products/{type}/{id}/image-{hash}.jpg
    path := fmt.Sprintf("%s/%s/%d/image-%s.jpg",
        ProductImagesBucket,
        product.GetType(),  // "c2c" –∏–ª–∏ "b2c"
        product.GetID(),
        generateHash(image.Data),
    )

    return s.s3Client.Upload(ctx, path, image.Data)
}
```

---

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Unified Interface –ø–æ–¥—Ö–æ–¥–∞

### ‚úÖ –ï–¥–∏–Ω–∞—è –ø–æ–∏—Å–∫–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- 1 –∏–Ω–¥–µ–∫—Å OpenSearch –≤–º–µ—Å—Ç–æ 2
- –ú–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏ –∏ CPU –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- –ü—Ä–æ—Å—Ç—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ schema

### ‚úÖ –ï–¥–∏–Ω—ã–π S3 bucket
- –ú–µ–Ω—å—à–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –ü—Ä–æ—Å—Ç–∞—è –æ—á–∏—Å—Ç–∫–∞
- –ï–¥–∏–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏ TTL

### ‚úÖ –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- –û–±—â–∏–µ –º–µ—Ç–æ–¥—ã (GetImages, GetPrice)
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ API responses
- –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ë–î
- C2C –∏ B2C —Ç–∞–±–ª–∏—Ü—ã –æ—Å—Ç–∞—é—Ç—Å—è —Ä–∞–∑–¥–µ–ª—å–Ω—ã–º–∏
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- –ß–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å
- –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∏–ø—ã (C2B, rentals, services)
- –ù–µ –ª–æ–º–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥
- –ü–æ—ç—Ç–∞–ø–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

---

## üöÄ –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏ (4 —Ñ–∞–∑—ã)

### –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ (1-2 –¥–Ω—è)

```bash
# 1. –°–æ–∑–¥–∞—Ç—å domain –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
touch backend/internal/domain/product_common.go

# 2. –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Sellable –¥–ª—è C2C
# backend/internal/domain/models/c2c_listing.go
func (l *C2CListing) GetTitle() string { return l.Title }

# 3. –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Sellable –¥–ª—è B2C
# backend/internal/domain/models/b2c_product.go
func (p *B2CProduct) GetTitle() string { return p.Name }

# 4. Unit —Ç–µ—Å—Ç—ã
go test ./internal/domain/...
```

### –§–∞–∑–∞ 2: Unified OpenSearch (2-3 –¥–Ω—è)

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å "products"
curl -X PUT "localhost:9200/products" -H 'Content-Type: application/json' -d @unified_mapping.json

# 2. –ü–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
python3 reindex_to_unified.py

# 3. –û–±–Ω–æ–≤–∏—Ç—å Search Service
# backend/internal/proj/search/unified_search_service.go
```

### –§–∞–∑–∞ 3: Unified Storage (1-2 –¥–Ω—è)

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π bucket "products"
mc mb local/products

# 2. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
mc mirror local/c2c-images local/products/c2c/
mc mirror local/b2c-images local/products/b2c/

# 3. –û–±–Ω–æ–≤–∏—Ç—å ImageService
```

### –§–∞–∑–∞ 4: API —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è (2-3 –¥–Ω—è)

```go
// –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API response
type ProductResponse struct {
    ID          int         `json:"id"`
    Type        string      `json:"type"` // "c2c" | "b2c"
    Title       string      `json:"title"`
    Price       float64     `json:"price"`
    Images      []Image     `json:"images"`
    // ... –æ–±—â–∏–µ –ø–æ–ª—è

    // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ type-specific –ø–æ–ª—è
    C2CData     *C2CData    `json:"c2c_data,omitempty"`
    B2CData     *B2CData    `json:"b2c_data,omitempty"`
}
```

**–û–±—â–µ–µ –≤—Ä–µ–º—è:** 6-10 –¥–Ω–µ–π —Ä–∞–±–æ—Ç—ã

---

## üí∞ –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤

### OpenSearch

**–î–æ:**
- 2 –∏–Ω–¥–µ–∫—Å–∞ (c2c_listings, b2c_products)
- 2 –Ω–∞–±–æ—Ä–∞ shards
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ mapping definitions

**–ü–æ—Å–ª–µ:**
- 1 –∏–Ω–¥–µ–∫—Å (products)
- 1 –Ω–∞–±–æ—Ä shards
- –≠–∫–æ–Ω–æ–º–∏—è ~30-40% –ø–∞–º—è—Ç–∏

### S3/MinIO

**–î–æ:**
- 2 buckets —Å —Ä–∞–∑–Ω—ã–º–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è–º–∏
- –°–ª–æ–∂–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è

**–ü–æ—Å–ª–µ:**
- 1 bucket —Å –ø—Ä–æ—Å—Ç–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- –£–ø—Ä–æ—â–µ–Ω–∏–µ backup/restore

### –ö–æ–¥

**–î–æ:**
- 2 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–æ–¥—É–ª—è (95 + 36 —Ñ–∞–π–ª–æ–≤ = 131 —Ñ–∞–π–ª)
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ search/cache –ª–æ–≥–∏–∫–∏

**–ü–æ—Å–ª–µ:**
- –û–±—â–∏–π search service (~-20% –∫–æ–¥–∞)
- –û–±—â–∏–π image service (~-15% –∫–æ–¥–∞)
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ domain logic (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

---

## ‚ùå –ß—Ç–æ –ù–ï —Å—Ç–æ–∏—Ç –¥–µ–ª–∞—Ç—å

### 1. –ù–ï –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —Ç–∞–±–ª–∏—Ü—ã –ë–î

**–ü—Ä–∏—á–∏–Ω—ã:**
- 50% NULL –ø–æ–ª–µ–π
- –ü–æ—Ç–µ—Ä—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –°–ª–æ–∂–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### 2. –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å "—Å—É–ø–µ—Ä-–º–æ–¥–µ–ª—å"

```go
// ‚ùå –ü–õ–û–•–û
type Product struct {
    // C2C –ø–æ–ª—è
    UserID     *int    // NULL –¥–ª—è B2C
    Condition  *string // NULL –¥–ª—è B2C

    // B2C –ø–æ–ª—è
    SKU            *string // NULL –¥–ª—è C2C
    StockQuantity  *int    // NULL –¥–ª—è C2C
    HasVariants    *bool   // NULL –¥–ª—è C2C
}
```

### 3. –ù–ï –ª–æ–º–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π API

–°–æ—Ö—Ä–∞–Ω—è–µ–º backward compatibility:
- `/api/v1/c2c/listings` - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- `/api/v1/b2c/products` - —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- `/api/v2/products` - –Ω–æ–≤—ã–π unified endpoint (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### Performance

- ‚úÖ –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–∏—Å–∫–∞: -20% (–º–µ–Ω—å—à–µ –∏–Ω–¥–µ–∫—Å–æ–≤)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ RAM: -30-40%
- ‚úÖ S3 –æ–ø–µ—Ä–∞—Ü–∏–∏: —É–ø—Ä–æ—â–µ–Ω–∏–µ

### Developer Experience

- ‚úÖ –ú–µ–Ω—å—à–µ –∫–æ–¥–∞: ~15-20%
- ‚úÖ –ï–¥–∏–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è search/cache
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### Maintainability

- ‚úÖ –û–¥–∏–Ω –∏–Ω–¥–µ–∫—Å ‚Üí –æ–¥–∏–Ω mapping
- ‚úÖ –û–¥–∏–Ω bucket ‚Üí –æ–¥–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –†–∞–∑–¥–µ–ª—ë–Ω–Ω–∞—è domain logic

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

### ‚úÖ –î–ï–õ–ê–¢–¨:

1. **Unified Search Index** (OpenSearch: "products")
2. **Unified Storage** (S3: "products/")
3. **Domain Interfaces** (Sellable interface)
4. **Shared Infrastructure** (cache, images)

### ‚ùå –ù–ï –î–ï–õ–ê–¢–¨:

1. **–ù–ï –æ–±—ä–µ–¥–∏–Ω—è—Ç—å —Ç–∞–±–ª–∏—Ü—ã –ë–î** (c2c_listings + b2c_products)
2. **–ù–ï —Å–º–µ—à–∏–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É** (—Ä–∞–∑–Ω—ã–µ use cases)
3. **–ù–ï –ª–æ–º–∞—Ç—å API** (—Å–æ—Ö—Ä–∞–Ω—è—Ç—å backward compatibility)

### üèÜ –†–µ–∑—É–ª—å—Ç–∞—Ç:

–í—ã –ø–æ–ª—É—á–∏—Ç–µ:
- ‚úÖ –ï–¥–∏–Ω—É—é –ø–æ–∏—Å–∫–æ–≤—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (—Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!)
- ‚úÖ –ï–¥–∏–Ω—ã–π S3 bucket (—Ü–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞!)
- ‚úÖ –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- ‚úÖ –ü—Ä–æ—Å—Ç–æ—Ç—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- ‚úÖ –í—ã—Å–æ–∫—É—é –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

### –î–∏–∞–≥—Ä–∞–º–º—ã

```
–¢–ï–ö–£–©–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ C2C     ‚îÇ  ‚îÇ B2C     ‚îÇ
‚îÇ Search  ‚îÇ  ‚îÇ Search  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ            ‚îÇ
     ‚ñº            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ c2c_    ‚îÇ  ‚îÇ b2c_    ‚îÇ
‚îÇlistings ‚îÇ  ‚îÇproducts ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–ü–†–ï–î–õ–ê–ì–ê–ï–ú–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê:
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ Unified Search‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
     ‚ñº             ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ c2c_    ‚îÇ  ‚îÇ b2c_    ‚îÇ
‚îÇlistings ‚îÇ  ‚îÇproducts ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

–°–º. —Å–µ–∫—Ü–∏–∏ –≤—ã—à–µ —Å –∫–æ–¥–æ–º –¥–ª—è:
- Sellable interface
- UnifiedSearchService
- Unified OpenSearch mapping
- Unified Image Storage

---

**–ê–≤—Ç–æ—Ä –æ—Ç—á—ë—Ç–∞:** Claude Code
**–î–∞—Ç–∞:** 2025-10-09
**–í–µ—Ä—Å–∏—è:** 1.0
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–ª–∞–Ω–∞ –∏ –Ω–∞—á–∞–ª–æ –§–∞–∑—ã 1
