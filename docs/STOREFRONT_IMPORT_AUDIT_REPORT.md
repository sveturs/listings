# –ê—É–¥–∏—Ç —Å–∏—Å—Ç–µ–º—ã –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –≤–∏—Ç—Ä–∏–Ω—ã

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏—Ç–∞:** 2025-10-06
**–ê–≤—Ç–æ—Ä:** Claude Code
**–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã:** 0.2.1

---

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ](#–∫—Ä–∞—Ç–∫–æ–µ-—Ä–µ–∑—é–º–µ)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –∏–º–ø–æ—Ä—Ç–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã-–∏–º–ø–æ—Ä—Ç–∞)
3. [–ê–Ω–∞–ª–∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#–∞–Ω–∞–ª–∏–∑-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
4. [Backend - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑](#backend---–¥–µ—Ç–∞–ª—å–Ω—ã–π-–∞–Ω–∞–ª–∏–∑)
5. [Frontend - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑](#frontend---–¥–µ—Ç–∞–ª—å–Ω—ã–π-–∞–Ω–∞–ª–∏–∑)
6. [API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã](#api-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
7. [–í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#–≤—ã—è–≤–ª–µ–Ω–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)
8. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-—É–ª—É—á—à–µ–Ω–∏—é)
9. [–ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π](#–ø–ª–∞–Ω-–≤–Ω–µ–¥—Ä–µ–Ω–∏—è-—É–ª—É—á—à–µ–Ω–∏–π)

---

## üéØ –ö—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ —Ñ–∞–π–ª–æ–≤ (XML, CSV, ZIP)
- –ò–º–ø–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ URL
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∏–º–ø–æ—Ä—Ç–∞ —á–µ—Ä–µ–∑ job-—Å–∏—Å—Ç–µ–º—É
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (create_only, update_only, upsert)
- Frontend UI –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–º–ø–æ—Ä—Ç–æ–º
- –ü–∞—Ä—Å–µ—Ä—ã –¥–ª—è Digital Vision XML —Ñ–æ—Ä–º–∞—Ç–∞

**‚ùå –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ / –ü—Ä–æ–±–ª–µ–º—ã:**
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è import jobs (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è mock –¥–∞–Ω–Ω—ã–µ)
- –ù–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ –ë–î –¥–ª—è import jobs
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–≤—è–∑—å marketplace_listings —Å storefronts —á–µ—Ä–µ–∑ –∏–º–ø–æ—Ä—Ç
- –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
- –ù–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–Ω–∞ –º–æ–º–µ–Ω—Ç –∞—É–¥–∏—Ç–∞)

```
–í–∏—Ç—Ä–∏–Ω—ã (storefronts):                    –ù–µ—Å–∫–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö
–¢–æ–≤–∞—Ä—ã –≤–∏—Ç—Ä–∏–Ω (storefront_products):      1 —Ç–æ–≤–∞—Ä –æ—Ç 1 –≤–∏—Ç—Ä–∏–Ω—ã
–°–≤—è–∑—å marketplace ‚Üí storefronts:          0 –∑–∞–ø–∏—Å–µ–π (storefront_id IS NULL)
Import jobs –≤ –ë–î:                         –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–∞–±–ª–∏—Ü–∞
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã –∏–º–ø–æ—Ä—Ç–∞

### –û–±—â–∞—è —Å—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Frontend (Next.js)                  ‚îÇ
‚îÇ  - ImportWizard                      ‚îÇ
‚îÇ  - ImportJobsList                    ‚îÇ
‚îÇ  - ImportApi Service                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ HTTP/HTTPS (—á–µ—Ä–µ–∑ BFF proxy)
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Backend API (Go + Fiber)            ‚îÇ
‚îÇ  - ImportHandler                     ‚îÇ
‚îÇ  - ImportService                     ‚îÇ
‚îÇ  - XML/CSV Parsers                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ
           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PostgreSQL Database                 ‚îÇ
‚îÇ  - storefront_products (—Ç–æ–≤–∞—Ä—ã)      ‚îÇ
‚îÇ  - storefronts (–≤–∏—Ç—Ä–∏–Ω—ã)             ‚îÇ
‚îÇ  - marketplace_listings (–º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å)‚îÇ
‚îÇ  [!] –ù–ï–¢ —Ç–∞–±–ª–∏—Ü—ã import_jobs         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üóÑÔ∏è –ê–Ω–∞–ª–∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: `storefronts`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –•—Ä–∞–Ω–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∏—Ç—Ä–∏–Ω–∞—Ö –ø—Ä–æ–¥–∞–≤—Ü–æ–≤

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
- `id` (PK) - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–∏—Ç—Ä–∏–Ω—ã
- `user_id` (FK) - –≤–ª–∞–¥–µ–ª–µ—Ü –≤–∏—Ç—Ä–∏–Ω—ã
- `slug` (UNIQUE) - —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º—ã–π URL
- `products_count` - —Å—á–µ—Ç—á–∏–∫ —Ç–æ–≤–∞—Ä–æ–≤
- `is_active` - —Å—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- `update_storefront_products_geo` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∞–¥—Ä–µ—Å–∞ –≤–∏—Ç—Ä–∏–Ω—ã
- `update_storefront_usage` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –¢–∞–±–ª–∏—Ü–∞: `storefront_products`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –¢–æ–≤–∞—Ä—ã, –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—â–∏–µ –≤–∏—Ç—Ä–∏–Ω–∞–º

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
- `id` (PK) - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–æ–≤–∞—Ä–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç `global_product_id_seq`)
- `storefront_id` (FK ‚Üí storefronts) - –≤–∏—Ç—Ä–∏–Ω–∞-–≤–ª–∞–¥–µ–ª–µ—Ü
- `name`, `description`, `price`, `currency`
- `category_id` - –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Ç–æ–≤–∞—Ä–∞
- `sku`, `barcode` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Ç–æ–≤–∞—Ä–∞
- `stock_quantity`, `stock_status` - —Å–∫–ª–∞–¥—Å–∫–æ–π —É—á–µ—Ç
- `attributes` (JSONB) - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã
- `has_variants` - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–æ–≤–∞—Ä–∞

**–ò–Ω–¥–µ–∫—Å—ã:**
- –ü–æ `storefront_id`, `category_id`, `sku`, `barcode`
- Full-text search –ø–æ `name`
- GIN –∏–Ω–¥–µ–∫—Å –¥–ª—è `attributes`

**–°–≤—è–∑–∏:**
- `storefront_product_images` - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
- `storefront_product_variants` - –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–∞
- `shopping_cart_items`, `storefront_order_items` - –∫–æ—Ä–∑–∏–Ω–∞ –∏ –∑–∞–∫–∞–∑—ã

### –¢–∞–±–ª–∏—Ü–∞: `marketplace_listings`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –û–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ (–ø—É–±–ª–∏—á–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã)

**–ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:**
- `id` (PK) - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ª–∏—Å—Ç–∏–Ω–≥–∞
- `storefront_id` (FK ‚Üí user_storefronts, NULLABLE) - —Å–≤—è–∑—å —Å –≤–∏—Ç—Ä–∏–Ω–æ–π
- `external_id` - –≤–Ω–µ—à–Ω–∏–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (–¥–ª—è –∏–º–ø–æ—Ä—Ç–∞)
- `metadata` (JSONB) - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**‚ö†Ô∏è –ü–†–û–ë–õ–ï–ú–ê:**
```sql
SELECT COUNT(*) FROM marketplace_listings WHERE storefront_id IS NOT NULL;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 0 (–Ω–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –≤–∏—Ç—Ä–∏–Ω)
```

### ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞: `import_jobs`

**–û–∂–∏–¥–∞–µ–º–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–¥–∞):**
```sql
CREATE TABLE import_jobs (
    id SERIAL PRIMARY KEY,
    storefront_id INTEGER NOT NULL REFERENCES storefronts(id),
    user_id INTEGER NOT NULL,
    file_name VARCHAR(255),
    file_type VARCHAR(10) NOT NULL, -- xml, csv, zip
    file_url TEXT,
    status VARCHAR(20) NOT NULL, -- pending, processing, completed, failed
    total_records INTEGER DEFAULT 0,
    processed_records INTEGER DEFAULT 0,
    successful_records INTEGER DEFAULT 0,
    failed_records INTEGER DEFAULT 0,
    error_message TEXT,
    started_at TIMESTAMP,
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_import_jobs_storefront ON import_jobs(storefront_id);
CREATE INDEX idx_import_jobs_status ON import_jobs(status);
CREATE INDEX idx_import_jobs_created ON import_jobs(created_at DESC);
```

---

## üîß Backend - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
backend/internal/proj/storefronts/
‚îú‚îÄ‚îÄ handler/
‚îÇ   ‚îú‚îÄ‚îÄ import_handler.go         # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–º–ø–æ—Ä—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ storefront_handler.go     # –û—Å–Ω–æ–≤–Ω—ã–µ handlers –≤–∏—Ç—Ä–∏–Ω
‚îÇ   ‚îî‚îÄ‚îÄ product_handler.go        # Handlers —Ç–æ–≤–∞—Ä–æ–≤
‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îú‚îÄ‚îÄ import_service.go         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ storefront_service.go
‚îÇ   ‚îî‚îÄ‚îÄ product_service.go
‚îú‚îÄ‚îÄ parsers/
‚îÇ   ‚îú‚îÄ‚îÄ xml_parser.go             # –ü–∞—Ä—Å–µ—Ä XML (Digital Vision)
‚îÇ   ‚îî‚îÄ‚îÄ csv_parser.go             # –ü–∞—Ä—Å–µ—Ä CSV
‚îî‚îÄ‚îÄ module.go                     # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–æ–≤
```

### ImportHandler (backend/internal/proj/storefronts/handler/import_handler.go)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
1. `ImportFromURL` - –∏–º–ø–æ—Ä—Ç –ø–æ URL (—Å—Ç—Ä–æ–∫–∏ 42-102)
2. `ImportFromFile` - –∏–º–ø–æ—Ä—Ç –∏–∑ —Ñ–∞–π–ª–∞ (—Å—Ç—Ä–æ–∫–∏ 122-209)
3. `ValidateImportFile` - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞ (—Å—Ç—Ä–æ–∫–∏ 227-294)
4. `GetCSVTemplate` - –ø–æ–ª—É—á–µ–Ω–∏–µ CSV —à–∞–±–ª–æ–Ω–∞ (—Å—Ç—Ä–æ–∫–∏ 303-326)
5. `GetImportFormats` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–æ—Ä–º–∞—Ç–∞—Ö (—Å—Ç—Ä–æ–∫–∏ 335-377)
6. `GetJobs` - —Å–ø–∏—Å–æ–∫ import jobs (—Å—Ç—Ä–æ–∫–∏ 396-439)
7. `GetJobDetails` - –¥–µ—Ç–∞–ª–∏ job (—Å—Ç—Ä–æ–∫–∏ 456-474)
8. `GetJobStatus` - —Å—Ç–∞—Ç—É—Å job (—Å—Ç—Ä–æ–∫–∏ 491-509)
9. `CancelJob` - –æ—Ç–º–µ–Ω–∞ job (—Å—Ç—Ä–æ–∫–∏ 526-547)
10. `RetryJob` - –ø–æ–≤—Ç–æ—Ä job (—Å—Ç—Ä–æ–∫–∏ 564-582)

**‚úÖ –ü–ª—é—Å—ã:**
- –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞–∫ ID, —Ç–∞–∫ –∏ slug –≤–∏—Ç—Ä–∏–Ω—ã
- Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**‚ùå –ü—Ä–æ–±–ª–µ–º—ã:**
- –í—Å–µ –º–µ—Ç–æ–¥—ã job management –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç mock –¥–∞–Ω–Ω—ã–µ (—Å—Ç—Ä–æ–∫–∏ 449-554)
- –ù–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–π –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ü–∏–∏ import jobs
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç error handling –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞

### ImportService (backend/internal/proj/storefronts/service/import_service.go)

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**

1. **ImportFromURL** (—Å—Ç—Ä–æ–∫–∏ 42-114)
   - –°–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª —Å URL
   - –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ —Ç–∏–ø—É (XML/CSV/ZIP)
   - –°–æ–∑–¥–∞–µ—Ç ImportJob (–≤ –ø–∞–º—è—Ç–∏)
   - ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
   - ‚ùå –ù–µ—Ç timeout –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

2. **ImportFromFile** (—Å—Ç—Ä–æ–∫–∏ 117-178)
   - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞
   - –ü–∞—Ä—Å–∏—Ç –ø–æ —Ç–∏–ø—É
   - –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã
   - ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –Ω–µ–±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
   - ‚ùå –ú–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö (–Ω–µ—Ç –ª–∏–º–∏—Ç–∞)

3. **processXMLData** (—Å—Ç—Ä–æ–∫–∏ 215-228)
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Digital Vision XML parser
   - ‚úÖ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä—Å–µ—Ä –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞
   - ‚ùå –ù–µ—Ç fallback –Ω–∞ generic XML

4. **importProducts** (—Å—Ç—Ä–æ–∫–∏ 294-308)
   - –ò—Ç–µ—Ä–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç
   - ‚úÖ –°–æ–±–∏—Ä–∞–µ—Ç –æ—à–∏–±–∫–∏, –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—è –ø—Ä–æ—Ü–µ—Å—Å
   - ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç batch processing

5. **importSingleProduct** (—Å—Ç—Ä–æ–∫–∏ 311-344)
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ SKU (–∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞, —Å—Ç—Ä–æ–∫–∞ 317)
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–µ–∂–∏–º–æ–≤: create_only, update_only, upsert
   - ‚ùå **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê:** –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤!

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø:**

```go
// –°—Ç—Ä–æ–∫–∞ 317-319 –≤ import_service.go
if importProduct.SKU != "" {
    // existingProduct, err = s.productService.GetProductBySKU(ctx, storefrontID, importProduct.SKU)
    // For now, treat all as new products
    _ = err
}
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ **–í–°–ï —Ç–æ–≤–∞—Ä—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –∫–∞–∫ –Ω–æ–≤—ã–µ**, –∏–≥–Ω–æ—Ä–∏—Ä—É—è `update_mode`!

### Parsers

**XML Parser** (–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è –¥–µ—Ç–∞–ª—å–Ω–æ):
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Digital Vision —Ñ–æ—Ä–º–∞—Ç–∞
- –ú–∞–ø–ø–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**CSV Parser** (–Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è –¥–µ—Ç–∞–ª—å–Ω–æ):
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π CSV —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ UTF-8
- Template generation

---

## üíª Frontend - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
frontend/svetu/src/
‚îú‚îÄ‚îÄ components/import/
‚îÇ   ‚îú‚îÄ‚îÄ ImportWizard.tsx          # –û—Å–Ω–æ–≤–Ω–æ–π –º–∞—Å—Ç–µ—Ä –∏–º–ø–æ—Ä—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ ImportManager.tsx         # –ú–µ–Ω–µ–¥–∂–µ—Ä –∏–º–ø–æ—Ä—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ ImportJobsList.tsx        # –°–ø–∏—Å–æ–∫ jobs
‚îÇ   ‚îú‚îÄ‚îÄ ImportJobDetails.tsx      # –î–µ—Ç–∞–ª–∏ job
‚îÇ   ‚îî‚îÄ‚îÄ ImportErrorsModal.tsx     # –ú–æ–¥–∞–ª–∫–∞ –æ—à–∏–±–æ–∫
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îî‚îÄ‚îÄ importApi.ts              # API –∫–ª–∏–µ–Ω—Ç –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
‚îú‚îÄ‚îÄ store/slices/
‚îÇ   ‚îî‚îÄ‚îÄ importSlice.ts            # Redux state management
‚îî‚îÄ‚îÄ types/
    ‚îî‚îÄ‚îÄ import.ts                 # TypeScript —Ç–∏–ø—ã
```

### ImportApi Service (frontend/svetu/src/services/importApi.ts)

**–ú–µ—Ç–æ–¥—ã:**

1. **importFromUrlBySlug** (—Å—Ç—Ä–æ–∫–∏ 15-32)
   - –ò–º–ø–æ—Ä—Ç –ø–æ URL —á–µ—Ä–µ–∑ slug
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç BFF proxy `/api/v1/storefronts/slug/{slug}/import/url`

2. **importFromFileBySlug** (—Å—Ç—Ä–æ–∫–∏ 37-97)
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ slug
   - ‚úÖ Tracking –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —á–µ—Ä–µ–∑ XMLHttpRequest
   - ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç BFF proxy `/api/v2/.../import/file`
   - ‚úÖ withCredentials –¥–ª—è cookies

3. **importFromFile** (—Å—Ç—Ä–æ–∫–∏ 118-175)
   - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥ —á–µ—Ä–µ–∑ storefront ID
   - –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

4. **validateFile** (—Å—Ç—Ä–æ–∫–∏ 180-200)
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞ –±–µ–∑ –∏–º–ø–æ—Ä—Ç–∞
   - ‚úÖ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

5. **getJobs, getJobDetails, getJobStatus** (—Å—Ç—Ä–æ–∫–∏ 213-241)
   - –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ jobs
   - ‚ùå –í–æ–∑–≤—Ä–∞—â–∞—é—Ç mock –¥–∞–Ω–Ω—ã–µ —Å backend

6. **downloadCsvTemplate** (—Å—Ç—Ä–æ–∫–∏ 246-255)
   - –°–∫–∞—á–∏–≤–∞–Ω–∏–µ CSV —à–∞–±–ª–æ–Ω–∞
   - ‚úÖ –ß–µ—Ä–µ–∑ BFF proxy

**‚úÖ –ü–ª—é—Å—ã:**
- –ü–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ API
- –û—Ç–ª–∏—á–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- Progress tracking –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
- Helper —Ñ—É–Ω–∫—Ü–∏–∏ (validateFileType, formatFileSize)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ BFF proxy –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**‚ùå –ü—Ä–æ–±–ª–µ–º—ã:**
- –ú–µ—Ç–æ–¥—ã `getCategoryMappings`, `createCategoryMapping` (—Å—Ç—Ä–æ–∫–∏ 347-382) –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤ backend
- `previewFile` (—Å—Ç—Ä–æ–∫–∏ 318-342) endpoint –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `getSummary` (—Å—Ç—Ä–æ–∫–∏ 297-313) endpoint –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `exportResults` (—Å—Ç—Ä–æ–∫–∏ 283-292) endpoint –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### ImportWizard Component (frontend/svetu/src/components/import/ImportWizard.tsx)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- Multi-step wizard –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ drag & drop —Ñ–∞–π–ª–æ–≤
- –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ (—Ç–∏–ø, —Ä–∞–∑–º–µ—Ä)
- –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
- Progress bar –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

**‚úÖ –ü–ª—é—Å—ã:**
- –û—Ç–ª–∏—á–Ω—ã–π UX
- –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- Error handling
- Redux integration

**‚ùå –ü—Ä–æ–±–ª–µ–º—ã:**
- –ù–µ—Ç –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç mapping –∫–∞—Ç–µ–≥–æ—Ä–∏–π (—Ö–æ—Ç—è –∫–æ–¥ –µ—Å—Ç—å)

### Types (frontend/svetu/src/types/import.ts)

**–û–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:**
- `ImportJob` - –¥–∂–æ–±–∞ –∏–º–ø–æ—Ä—Ç–∞
- `ImportError` - –æ—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞
- `ImportJobStatus` - —Å—Ç–∞—Ç—É—Å –¥–∂–æ–±—ã
- `ImportRequest` - –∑–∞–ø—Ä–æ—Å –∏–º–ø–æ—Ä—Ç–∞
- `ImportFormats` - —Ñ–æ—Ä–º–∞—Ç—ã –∏–º–ø–æ—Ä—Ç–∞
- –ö–æ–Ω—Ñ–∏–≥: max 100MB, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ XML/CSV/ZIP

---

## üîå API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | Handler | –°—Ç–∞—Ç—É—Å |
|-------|------|---------|--------|
| POST | `/api/v1/storefronts/{id}/import/url` | ImportFromURL | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| POST | `/api/v1/storefronts/{id}/import/file` | ImportFromFile | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| POST | `/api/v1/storefronts/{id}/import/validate` | ValidateImportFile | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| GET | `/api/v1/storefronts/import/csv-template` | GetCSVTemplate | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| GET | `/api/v1/storefronts/import/formats` | GetImportFormats | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| GET | `/api/v1/storefronts/{id}/import/jobs` | GetJobs | ‚ö†Ô∏è Mock –¥–∞–Ω–Ω—ã–µ |
| GET | `/api/v1/import/jobs/{jobId}` | GetJobDetails | ‚ö†Ô∏è Mock –¥–∞–Ω–Ω—ã–µ |
| GET | `/api/v1/import/jobs/{jobId}/status` | GetJobStatus | ‚ö†Ô∏è Mock –¥–∞–Ω–Ω—ã–µ |
| POST | `/api/v1/import/jobs/{jobId}/cancel` | CancelJob | ‚ö†Ô∏è –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| POST | `/api/v1/import/jobs/{jobId}/retry` | RetryJob | ‚ö†Ô∏è Mock –¥–∞–Ω–Ω—ã–µ |

### –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã —á–µ—Ä–µ–∑ slug

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –°—Ç–∞—Ç—É—Å |
|-------|------|--------|
| POST | `/api/v1/storefronts/slug/{slug}/import/url` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| POST | `/api/v1/storefronts/slug/{slug}/import/file` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| POST | `/api/v1/storefronts/slug/{slug}/import/validate` | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| GET | `/api/v1/storefronts/slug/{slug}/import/jobs` | ‚ö†Ô∏è Mock –¥–∞–Ω–Ω—ã–µ |

### –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (–≤ –∫–æ–¥–µ frontend)

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-------|------|-----------|
| POST | `/api/v1/storefronts/import/preview` | –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞ |
| POST | `/api/v1/storefronts/{id}/import/category-mappings` | –ú–∞–ø–ø–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π |
| POST | `/api/v1/storefronts/{id}/import/category-mappings/create` | –°–æ–∑–¥–∞–Ω–∏–µ –º–∞–ø–ø–∏–Ω–≥–∞ |
| GET | `/api/v1/storefronts/{id}/import/summary` | –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ |
| GET | `/api/v1/import/jobs/{jobId}/export` | –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ |
| GET | `/api/v1/storefronts/import/sample/{format}` | –°–∫–∞—á–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ |

---

## ‚ö†Ô∏è –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ

#### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ import jobs

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ç–∞–±–ª–∏—Ü–∞ `import_jobs`. –í—Å–µ –º–µ—Ç–æ–¥—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç mock –¥–∞–Ω–Ω—ã–µ.

**–§–∞–π–ª—ã:**
- `backend/internal/proj/storefronts/service/import_service.go:449-554`

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–º–ø–æ—Ä—Ç–æ–≤
- –ù–µ—Ç real-time —Å—Ç–∞—Ç—É—Å–∞ –∏–º–ø–æ—Ä—Ç–∞
- –ù–µ–ª—å–∑—è retry failed jobs
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞—É–¥–∏—Ç –∏–º–ø–æ—Ä—Ç–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL

---

#### 2. –û—Ç–∫–ª—é—á–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í –º–µ—Ç–æ–¥–µ `importSingleProduct` –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ SKU.

**–ö–æ–¥:**
```go
// import_service.go:317-319
if importProduct.SKU != "" {
    // existingProduct, err = s.productService.GetProductBySKU(ctx, storefrontID, importProduct.SKU)
    // For now, treat all as new products
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ü—Ä–∏ –∫–∞–∂–¥–æ–º –∏–º–ø–æ—Ä—Ç–µ —Å–æ–∑–¥–∞—é—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤
- –†–µ–∂–∏–º—ã `update_only` –∏ `upsert` –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- –ù–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL

---

#### 3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–≤—è–∑–∏ marketplace_listings —Å storefronts

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í —Ç–∞–±–ª–∏—Ü–µ `marketplace_listings` –ø–æ–ª–µ `storefront_id` –≤—Å–µ–≥–¥–∞ NULL (0 –∑–∞–ø–∏—Å–µ–π —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º –ø–æ–ª–µ–º).

**SQL:**
```sql
SELECT COUNT(*) FROM marketplace_listings WHERE storefront_id IS NOT NULL;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 0
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –Ω–µ —Å–≤—è–∑–∞–Ω—ã —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–º
- –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- –¢–æ–≤–∞—Ä—ã –≤–∏—Ç—Ä–∏–Ω—ã –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –ø—É–±–ª–∏—á–Ω–æ–º –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL

---

### üü† –í–∞–∂–Ω—ã–µ

#### 4. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ò–º–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤ HTTP handler. –î–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ —ç—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ timeout.

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- HTTP request timeout –¥–ª—è —Ñ–∞–π–ª–æ–≤ > 1000 —Ç–æ–≤–∞—Ä–æ–≤
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞
- –ü–ª–æ—Ö–æ–π UX (–¥–æ–ª–≥–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á (–Ω–∞–ø—Ä–∏–º–µ—Ä, background workers —á–µ—Ä–µ–∑ channels –∏–ª–∏ external queue system).

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† HIGH

---

#### 5. –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í –∫–æ–¥–µ –µ—Å—Ç—å –∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (import_service.go:370-381), –Ω–æ –æ–Ω–∞ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞.

**–ö–æ–¥:**
```go
// Add images if provided
if len(importProduct.ImageURLs) > 0 {
    for i, imageURL := range importProduct.ImageURLs {
        imageReq := models.StorefrontProductImage{
            StorefrontProductID: product.ID,
            ImageURL:            imageURL,
            DisplayOrder:        i + 1,
            IsDefault:           i == 0,
        }
        // Add image (would need to implement this in product service)
        _ = imageReq
    }
}
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–æ–±–∞–≤–ª—è—Ç—å –≤—Ä—É—á–Ω—É—é

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† HIGH

---

#### 6. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤

**–û–ø–∏—Å–∞–Ω–∏–µ:**
Frontend –∏–º–µ–µ—Ç –∫–æ–¥ –¥–ª—è category mapping, –Ω–æ backend –Ω–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —ç—Ç–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã.

**–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã:**
- `getCategoryMappings`
- `createCategoryMapping`

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è:**
- –¢–æ–≤–∞—Ä—ã –ø–æ–ø–∞–¥–∞—é—Ç –≤ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- –ù–µ—Ç auto-mapping –∫–∞—Ç–µ–≥–æ—Ä–∏–π –∏–∑ –≤–Ω–µ—à–Ω–∏—Ö —Å–∏—Å—Ç–µ–º

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† HIGH

---

### üü° –°—Ä–µ–¥–Ω–∏–µ

#### 7. Mock –¥–∞–Ω–Ω—ã–µ –≤ production-ready –∫–æ–¥–µ

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ú–µ—Ç–æ–¥—ã `GetJobs`, `GetJobDetails`, `GetJobStatus`, `RetryJob` –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ mock –¥–∞–Ω–Ω—ã–µ.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° MEDIUM

---

#### 8. –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –≤ backend

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í –∫–æ–¥–µ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞. Frontend –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç 100MB, –Ω–æ —ç—Ç–æ –º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° MEDIUM

---

#### 9. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç batch processing

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–¢–æ–≤–∞—Ä—ã –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –æ–¥–Ω–æ–º—É. –î–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ —ç—Ç–æ –Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° MEDIUM

---

#### 10. –ù–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü—Ä–∏ –æ—à–∏–±–∫–µ –∏–º–ø–æ—Ä—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–±—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ù–µ—Ç –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–æ–∫–∞–º/–ø–æ–ª—è–º.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° MEDIUM

---

### üîµ –ù–∏–∑–∫–∏–µ

#### 11. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º

**–û–ø–∏—Å–∞–Ω–∏–µ:**
Frontend –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π endpoint `/api/v1/storefronts/import/preview`.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üîµ LOW

---

#### 12. –ù–µ—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–º–ø–æ—Ä—Ç–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:**
Frontend –∏–º–µ–µ—Ç –º–µ—Ç–æ–¥ `exportResults`, –Ω–æ endpoint –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω.

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üîµ LOW

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 –Ω–µ–¥–µ–ª–∏)

#### 1.1 –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É import_jobs

**SQL:**
```sql
-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
CREATE TABLE import_jobs (
    id SERIAL PRIMARY KEY,
    storefront_id INTEGER NOT NULL REFERENCES storefronts(id) ON DELETE CASCADE,
    user_id INTEGER NOT NULL,
    file_name VARCHAR(255),
    file_type VARCHAR(10) NOT NULL CHECK (file_type IN ('xml', 'csv', 'zip')),
    file_url TEXT,
    status VARCHAR(20) NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'processing', 'completed', 'failed', 'cancelled')),
    total_records INTEGER DEFAULT 0,
    processed_records INTEGER DEFAULT 0,
    successful_records INTEGER DEFAULT 0,
    failed_records INTEGER DEFAULT 0,
    error_message TEXT,
    started_at TIMESTAMP,
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);

-- –ò–Ω–¥–µ–∫—Å—ã
CREATE INDEX idx_import_jobs_storefront ON import_jobs(storefront_id);
CREATE INDEX idx_import_jobs_status ON import_jobs(status);
CREATE INDEX idx_import_jobs_created ON import_jobs(created_at DESC);
CREATE INDEX idx_import_jobs_user ON import_jobs(user_id);

-- –¢–∞–±–ª–∏—Ü–∞ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω—ã—Ö –æ—à–∏–±–æ–∫
CREATE TABLE import_errors (
    id SERIAL PRIMARY KEY,
    job_id INTEGER NOT NULL REFERENCES import_jobs(id) ON DELETE CASCADE,
    line_number INTEGER,
    field_name VARCHAR(100),
    error_message TEXT NOT NULL,
    raw_data TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL
);

CREATE INDEX idx_import_errors_job ON import_errors(job_id);

-- Trigger –¥–ª—è updated_at
CREATE OR REPLACE FUNCTION update_import_jobs_updated_at()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_import_jobs_updated_at
    BEFORE UPDATE ON import_jobs
    FOR EACH ROW
    EXECUTE FUNCTION update_import_jobs_updated_at();
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ:**
1. –°–æ–∑–¥–∞—Ç—å `backend/internal/storage/postgres/import_jobs.go` - repository –¥–ª—è import_jobs
2. –û–±–Ω–æ–≤–∏—Ç—å `ImportService` –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è jobs –≤ –ë–î
3. –ó–∞–º–µ–Ω–∏—Ç—å mock –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ DB

---

#### 1.2 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ SKU

**–§–∞–π–ª:** `backend/internal/proj/storefronts/service/product_service.go`

**–î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥:**
```go
// GetProductBySKU returns product by SKU for a specific storefront
func (s *ProductService) GetProductBySKU(ctx context.Context, storefrontID int, sku string) (*models.StorefrontProduct, error) {
    query := `
        SELECT * FROM storefront_products
        WHERE storefront_id = $1 AND sku = $2 AND is_active = true
        LIMIT 1
    `

    var product models.StorefrontProduct
    err := s.storage.QueryRow(ctx, query, storefrontID, sku).Scan(&product)
    if err != nil {
        if errors.Is(err, sql.ErrNoRows) {
            return nil, nil // Product not found
        }
        return nil, err
    }

    return &product, nil
}
```

**–†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É** –≤ `import_service.go:317`:
```go
if importProduct.SKU != "" {
    existingProduct, err = s.productService.GetProductBySKU(ctx, storefrontID, importProduct.SKU)
    if err != nil {
        return fmt.Errorf("failed to check existing product: %w", err)
    }
}
```

---

#### 1.3 –°–æ–∑–¥–∞—Ç—å —Å–≤—è–∑—å marketplace_listings ‚Üî storefronts

**–í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**

**–í–∞—Ä–∏–∞–Ω—Ç A: –ò–º–ø–æ—Ä—Ç —Å–æ–∑–¥–∞–µ—Ç –æ–±–∞ –æ–±—ä–µ–∫—Ç–∞**
```go
// –í import_service.go –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è storefront_product
func (s *ImportService) createMarketplaceListing(ctx context.Context, product *models.StorefrontProduct) error {
    listing := &models.MarketplaceListing{
        StorefrontID: &product.StorefrontID,
        Title: product.Name,
        Description: product.Description,
        Price: product.Price,
        ExternalID: product.SKU, // –°–≤—è–∑—å —á–µ—Ä–µ–∑ SKU
        Status: "active",
        // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
    }

    return s.marketplaceRepo.CreateListing(ctx, listing)
}
```

**–í–∞—Ä–∏–∞–Ω—Ç B: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä**
```sql
CREATE OR REPLACE FUNCTION sync_storefront_product_to_marketplace()
RETURNS TRIGGER AS $$
BEGIN
    -- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ –≤–∏—Ç—Ä–∏–Ω—ã —Å–æ–∑–¥–∞—ë–º listing –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ
    IF TG_OP = 'INSERT' AND NEW.is_active = true THEN
        INSERT INTO marketplace_listings (
            storefront_id,
            title,
            description,
            price,
            external_id,
            status,
            created_at,
            updated_at
        ) VALUES (
            NEW.storefront_id,
            NEW.name,
            NEW.description,
            NEW.price,
            NEW.sku,
            'active',
            CURRENT_TIMESTAMP,
            CURRENT_TIMESTAMP
        );
    END IF;

    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trigger_sync_storefront_to_marketplace
    AFTER INSERT OR UPDATE ON storefront_products
    FOR EACH ROW
    EXECUTE FUNCTION sync_storefront_product_to_marketplace();
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–∞—Ä–∏–∞–Ω—Ç B (—Ç—Ä–∏–≥–≥–µ—Ä) –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

---

### –§–∞–∑–∞ 2: –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (2-3 –Ω–µ–¥–µ–ª–∏)

#### 2.1 –í–Ω–µ–¥—Ä–∏—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–º–ø–æ—Ä—Ç–∞

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:**
- Go channels + goroutines
- Redis Pub/Sub –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- WebSocket –¥–ª—è real-time updates

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Handler   ‚îÇ‚îÄ‚îÄPOST‚îÄ‚îÄ‚ñ∂‚îÇ  Job Queue   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   Worker    ‚îÇ
‚îÇ             ‚îÇ‚óÄ‚îÄ‚îÄID‚îÄ‚îÄ‚îÄ‚îÇ              ‚îÇ         ‚îÇ   Pool      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                                         ‚îÇ
                                                         ‚ñº
                                                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                                                  ‚îÇ   Database  ‚îÇ
                                                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–æ–¥:**
```go
// backend/internal/proj/storefronts/worker/import_worker.go
type ImportWorker struct {
    jobQueue    chan *models.ImportJob
    resultQueue chan *models.ImportJobResult
    storage     ImportStorage
}

func (w *ImportWorker) Start(ctx context.Context, workers int) {
    for i := 0; i < workers; i++ {
        go w.processJobs(ctx)
    }
}

func (w *ImportWorker) processJobs(ctx context.Context) {
    for {
        select {
        case job := <-w.jobQueue:
            result := w.processJob(ctx, job)
            w.resultQueue <- result
        case <-ctx.Done():
            return
        }
    }
}
```

---

#### 2.2 –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```go
// –í import_service.go
func (s *ImportService) importProductImages(ctx context.Context, productID int, imageURLs []string) error {
    for i, imageURL := range imageURLs {
        // –°–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        imageData, err := s.downloadImage(ctx, imageURL)
        if err != nil {
            logger.Warn().Err(err).Str("url", imageURL).Msg("Failed to download image")
            continue
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ MinIO
        objectName := fmt.Sprintf("products/%d/%d_%s", productID, i, filepath.Base(imageURL))
        uploadedURL, err := s.fileStorage.UploadFile(ctx, objectName, imageData)
        if err != nil {
            return fmt.Errorf("failed to upload image: %w", err)
        }

        // –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –≤ –ë–î
        image := &models.StorefrontProductImage{
            StorefrontProductID: productID,
            ImageURL:            uploadedURL,
            DisplayOrder:        i + 1,
            IsDefault:           i == 0,
        }

        if err := s.imageRepo.Create(ctx, image); err != nil {
            return fmt.Errorf("failed to create image record: %w", err)
        }
    }

    return nil
}
```

---

#### 2.3 –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—é —Ç–æ–≤–∞—Ä–æ–≤

**API Endpoints:**
```go
// GET /api/v1/storefronts/{id}/import/category-mappings
func (h *ImportHandler) GetCategoryMappings(c *fiber.Ctx) error {
    // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π
    // –í–µ—Ä–Ω—É—Ç—å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ –º–∞–ø–ø–∏–Ω–≥—É
}

// POST /api/v1/storefronts/{id}/import/category-mappings
func (h *ImportHandler) CreateCategoryMapping(c *fiber.Ctx) error {
    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
}
```

**–¢–∞–±–ª–∏—Ü–∞:**
```sql
CREATE TABLE import_category_mappings (
    id SERIAL PRIMARY KEY,
    storefront_id INTEGER NOT NULL REFERENCES storefronts(id),
    source_category_path TEXT NOT NULL, -- "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞/–¢–µ–ª–µ—Ñ–æ–Ω—ã/iPhone"
    target_category_id INTEGER NOT NULL REFERENCES marketplace_categories(id),
    confidence NUMERIC(3,2), -- 0.00-1.00
    is_manual BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(storefront_id, source_category_path)
);
```

---

### –§–∞–∑–∞ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è UX (1-2 –Ω–µ–¥–µ–ª–∏)

#### 3.1 Batch processing –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞

**–ö–æ–¥:**
```go
func (s *ImportService) importProductsBatch(ctx context.Context, products []models.ImportProductRequest, batchSize int) error {
    for i := 0; i < len(products); i += batchSize {
        end := i + batchSize
        if end > len(products) {
            end = len(products)
        }

        batch := products[i:end]
        if err := s.importBatch(ctx, batch); err != nil {
            return err
        }
    }

    return nil
}
```

---

#### 3.2 –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞:**
```go
type ImportValidationError struct {
    LineNumber int    `json:"line_number"`
    FieldName  string `json:"field_name"`
    ErrorType  string `json:"error_type"` // required, invalid_format, duplicate, etc.
    Message    string `json:"message"`
    Value      string `json:"value,omitempty"`
}
```

---

#### 3.3 –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º

**Endpoint:**
```go
// POST /api/v1/storefronts/import/preview
func (h *ImportHandler) PreviewFile(c *fiber.Ctx) error {
    // Parse first 10 rows
    // Return sample data + detected fields
}
```

---

## üìÖ –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π

### –°–ø—Ä–∏–Ω—Ç 1 (–ù–µ–¥–µ–ª—è 1-2): –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è `import_jobs` –∏ `import_errors`
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å repository –¥–ª—è import_jobs
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç—å ImportService –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è jobs –≤ –ë–î
4. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `GetProductBySKU` –∏ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
5. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ storefront_products ‚Üí marketplace_listings
6. ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- –ò—Å—Ç–æ—Ä–∏—è –∏–º–ø–æ—Ä—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
- –ò–º–ø–æ—Ä—Ç –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤
- –¢–æ–≤–∞—Ä—ã –≤–∏—Ç—Ä–∏–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ

---

### –°–ø—Ä–∏–Ω—Ç 2 (–ù–µ–¥–µ–ª—è 3-4): –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å worker pool –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å Redis –¥–ª—è –æ—á–µ—Ä–µ–¥–∏ –∑–∞–¥–∞—á
3. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
4. ‚úÖ –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É category_mappings
5. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏
6. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å WebSocket notifications –¥–ª—è real-time updates

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- –ò–º–ø–æ—Ä—Ç –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ (10k+ —Ç–æ–≤–∞—Ä–æ–≤) –Ω–µ –ø–∞–¥–∞–µ—Ç
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∫–∞—á–∏–≤–∞—é—Ç—Å—è –∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ MinIO
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–∞–ø–ø—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é

---

### –°–ø—Ä–∏–Ω—Ç 3 (–ù–µ–¥–µ–ª—è 5): –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–ó–∞–¥–∞—á–∏:**
1. ‚úÖ –í–Ω–µ–¥—Ä–∏—Ç—å batch processing
2. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å preview file
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
4. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î
5. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

**–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- –ò–º–ø–æ—Ä—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 2x –±—ã—Å—Ç—Ä–µ–µ
- UX —É–ª—É—á—à–µ–Ω (preview, –¥–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏)
- –ï—Å—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

**–ü–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏–π –æ–∂–∏–¥–∞–µ—Ç—Å—è:**

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|-----|-------|-----------|
| –ò–º–ø–æ—Ä—Ç 1000 —Ç–æ–≤–∞—Ä–æ–≤ | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, ~30 —Å–µ–∫ | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ, ~10 —Å–µ–∫ | 3x –±—ã—Å—Ç—Ä–µ–µ |
| –î—É–±–ª–∏–∫–∞—Ç—ã –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∏–º–ø–æ—Ä—Ç–µ | 100% (–≤—Å–µ –¥—É–±–ª–∏) | 0% | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏—Å—Ç–æ—Ä–∏–∏ –∏–º–ø–æ—Ä—Ç–æ–≤ | –ù–µ—Ç | –î–∞ | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| –¢–æ–≤–∞—Ä—ã –Ω–∞ –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–µ | 0 –∏–∑ –∏–º–ø–æ—Ä—Ç–∞ | 100% | ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ |
| –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π | –ù–µ—Ç | –î–∞ | ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
| Max —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ | –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω | –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ backend | ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–µ–µ |

---

## üîó –°—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–¥

**Backend:**
- Import Handler: `backend/internal/proj/storefronts/handler/import_handler.go`
- Import Service: `backend/internal/proj/storefronts/service/import_service.go`
- Module Routes: `backend/internal/proj/storefronts/module.go:215-233`
- Parsers: `backend/internal/proj/storefronts/parsers/`

**Frontend:**
- Import API: `frontend/svetu/src/services/importApi.ts`
- Import Wizard: `frontend/svetu/src/components/import/ImportWizard.tsx`
- Types: `frontend/svetu/src/types/import.ts`
- Redux Slice: `frontend/svetu/src/store/slices/importSlice.ts`

**Database:**
- –¢–∞–±–ª–∏—Ü—ã: `storefronts`, `storefront_products`, `marketplace_listings`
- –ú–∏–≥—Ä–∞—Ü–∏–∏: `backend/migrations/*.up.sql`

---

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∏–º–ø–æ—Ä—Ç–∞ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –≤–∏—Ç—Ä–∏–Ω—ã –∏–º–µ–µ—Ç **—Ö–æ—Ä–æ—à—É—é –±–∞–∑–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–æ—Ä–∞–±–æ—Ç–æ–∫** –¥–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

### –ì–ª–∞–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
1. üî¥ –ù–µ—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ import jobs
2. üî¥ –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–≤—Å–µ —Ç–æ–≤–∞—Ä—ã = –Ω–æ–≤—ã–µ)
3. üî¥ –ù–µ—Ç —Å–≤—è–∑–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ —Å –º–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å–æ–º

### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ö–æ—Ä–æ—à–æ:
- ‚úÖ –ü–∞—Ä—Å–∏–Ω–≥ XML/CSV/ZIP
- ‚úÖ Frontend UI –∏ UX
- ‚úÖ API —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Ä–æ—É—Ç–∏–Ω–≥
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤

### –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:
**–ù–∞—á–∞—Ç—å —Å –°–ø—Ä–∏–Ω—Ç–∞ 1** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º. –ë–µ–∑ —ç—Ç–æ–≥–æ —Å–∏—Å—Ç–µ–º–∞ –∏–º–ø–æ—Ä—Ç–∞ –Ω–µ –≥–æ—Ç–æ–≤–∞ –∫ production.

---

**–î–æ–∫—É–º–µ–Ω—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω:** 2025-10-06
**–ê–≤—Ç–æ—Ä:** Claude Code
**–í–µ—Ä—Å–∏—è:** 1.0
