# Listings Service Configuration
# Copy this file to .env and configure for your environment

# ========================================
# Application Settings
# ========================================
VONDILISTINGS_ENV=development
VONDILISTINGS_LOG_LEVEL=debug
VONDILISTINGS_LOG_FORMAT=json

# ========================================
# Server Ports
# ========================================
# gRPC Internal API
VONDILISTINGS_GRPC_PORT=50052
VONDILISTINGS_GRPC_HOST=0.0.0.0

# HTTP REST API
VONDILISTINGS_HTTP_PORT=8086
VONDILISTINGS_HTTP_HOST=0.0.0.0

# Prometheus Metrics
VONDILISTINGS_METRICS_PORT=9093
VONDILISTINGS_METRICS_HOST=0.0.0.0

# ========================================
# Database Configuration (PostgreSQL)
# ========================================
# ВАЖНО: Микросервис использует ОТДЕЛЬНУЮ БД (НЕ монолит svetubd!)
# Docker container: listings_postgres (порт 35434)
VONDILISTINGS_DB_HOST=localhost
VONDILISTINGS_DB_PORT=35434
VONDILISTINGS_DB_USER=listings_user
VONDILISTINGS_DB_PASSWORD=listings_secret
VONDILISTINGS_DB_NAME=listings_dev_db
VONDILISTINGS_DB_SSLMODE=disable

# Connection Pool Settings
VONDILISTINGS_DB_MAX_OPEN_CONNS=25
VONDILISTINGS_DB_MAX_IDLE_CONNS=10
VONDILISTINGS_DB_CONN_MAX_LIFETIME=5m
VONDILISTINGS_DB_CONN_MAX_IDLE_TIME=10m

# ========================================
# Redis Configuration
# ========================================
VONDILISTINGS_REDIS_HOST=localhost
VONDILISTINGS_REDIS_PORT=36380
VONDILISTINGS_REDIS_PASSWORD=redis_password
VONDILISTINGS_REDIS_DB=0

# Redis Connection Pool
VONDILISTINGS_REDIS_POOL_SIZE=10
VONDILISTINGS_REDIS_MIN_IDLE_CONNS=5

# Cache TTL Settings
VONDILISTINGS_CACHE_LISTING_TTL=5m
VONDILISTINGS_CACHE_SEARCH_TTL=2m

# ========================================
# OpenSearch Configuration
# ========================================
VONDILISTINGS_OPENSEARCH_ADDRESSES=http://localhost:9200
VONDILISTINGS_OPENSEARCH_USERNAME=admin
VONDILISTINGS_OPENSEARCH_PASSWORD=admin
VONDILISTINGS_OPENSEARCH_INDEX=marketplace_listings

# ========================================
# MinIO Configuration (S3-compatible storage)
# ========================================
VONDILISTINGS_MINIO_ENDPOINT=localhost:9000
VONDILISTINGS_MINIO_ACCESS_KEY=minioadmin
VONDILISTINGS_MINIO_SECRET_KEY=minioadmin
VONDILISTINGS_MINIO_USE_SSL=false
VONDILISTINGS_MINIO_BUCKET=listings-images

# ========================================
# Auth Service Integration
# ========================================
# URL Auth Service (HTTP API)
# - Локально: http://localhost:28086
# - На сервере (Docker network): http://vondi-dev-auth:8080
VONDILISTINGS_AUTH_SERVICE_URL=http://localhost:28086

# gRPC URL Auth Service (для валидации токенов)
# - Локально: localhost:20053
# - На сервере (Docker network): vondi-dev-auth:50051
VONDILISTINGS_AUTH_GRPC_URL=localhost:20053

# Путь к публичному ключу для валидации JWT
# - Локально: ./keys/public.pem или /p/github.com/sveturs/auth/keys/public.pem
# - На сервере (Docker): /app/keys/public.pem
VONDILISTINGS_AUTH_PUBLIC_KEY_PATH=./keys/public.pem

# ВАЖНО: Auth ДОЛЖЕН быть включен для работы чата и WebSocket!
# Установи false ТОЛЬКО для локального тестирования без auth service
VONDILISTINGS_AUTH_ENABLED=true

# ========================================
# Delivery Microservice Integration
# ========================================
# Enable/disable delivery microservice integration
VONDILISTINGS_DELIVERY_ENABLED=false
# gRPC address of delivery microservice
VONDILISTINGS_DELIVERY_GRPC_ADDRESS=localhost:50052
# Timeout for delivery service calls
VONDILISTINGS_DELIVERY_TIMEOUT=10s
# Number of retry attempts for transient errors
VONDILISTINGS_DELIVERY_MAX_RETRIES=3
# Initial delay between retries (exponential backoff)
VONDILISTINGS_DELIVERY_RETRY_DELAY=100ms

# ========================================
# Worker Configuration
# ========================================
VONDILISTINGS_WORKER_ENABLED=true
VONDILISTINGS_WORKER_CONCURRENCY=5
VONDILISTINGS_WORKER_QUEUE_NAME=listings_indexing

# ========================================
# Rate Limiting
# ========================================
VONDILISTINGS_RATE_LIMIT_ENABLED=true
VONDILISTINGS_RATE_LIMIT_RPS=100
VONDILISTINGS_RATE_LIMIT_BURST=200

# ========================================
# Tracing & Monitoring
# ========================================
VONDILISTINGS_TRACING_ENABLED=false
VONDILISTINGS_JAEGER_ENDPOINT=http://localhost:14268/api/traces

# ========================================
# CORS Configuration
# ========================================
VONDILISTINGS_CORS_ALLOWED_ORIGINS=http://localhost:3001,http://localhost:3000
VONDILISTINGS_CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
VONDILISTINGS_CORS_ALLOWED_HEADERS=Content-Type,Authorization

# ========================================
# Feature Flags
# ========================================
VONDILISTINGS_FEATURE_ASYNC_INDEXING=true
VONDILISTINGS_FEATURE_IMAGE_OPTIMIZATION=true
VONDILISTINGS_FEATURE_CACHE_ENABLED=true

# ========================================
# Health Check Configuration
# ========================================
# Timeout for individual health checks (database, redis, etc)
VONDILISTINGS_HEALTH_CHECK_TIMEOUT=5s

# Interval between health check executions (internal scheduling)
VONDILISTINGS_HEALTH_CHECK_INTERVAL=30s

# Timeout for startup checks (longer to allow initialization)
VONDILISTINGS_HEALTH_STARTUP_TIMEOUT=60s

# Duration to cache health check results (reduces load on dependencies)
VONDILISTINGS_HEALTH_CACHE_DURATION=10s

# Enable deep diagnostics endpoint (/health/deep) for debugging
VONDILISTINGS_HEALTH_ENABLE_DEEP_CHECKS=true
