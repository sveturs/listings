# Отчет о бизнес-процессах платформы Sve Tu

## Общий обзор платформы

Sve Tu - это универсальная маркетплейс-платформа с поддержкой витрин (storefronts), интерактивной картой и системой геолокации. Платформа объединяет возможности классифайдов (объявлений от частных лиц) и витрин для бизнеса.

### Ключевые технологии:
- **Frontend:** Next.js 15.3, TypeScript, Tailwind CSS v4 + DaisyUI, Redux Toolkit, Mapbox
- **Backend:** Go, Fiber, PostgreSQL + PostGIS, OpenSearch, MinIO
- **Платежи:** Эскроу-система с защитой покупателя
- **Интернационализация:** 3 языка (ru/en/sr)

## 1. Флоу покупателя (Buyer Journey)

### 1.1. Поиск товара

**Точки входа:**
- Главная страница с каталогом товаров
- Интерактивная карта с геолокацией
- Поиск по категориям
- Полнотекстовый поиск (OpenSearch)

**Функционал поиска:**
- Фильтрация по категориям (иерархическая структура)
- Атрибуты категорий (размер, цвет, состояние и т.д.)
- Ценовой диапазон
- Геолокационный поиск (радиус от точки)
- Сортировка (цена, дата, расстояние)
- Переключение между видом списка и картой

**Типы товаров:**
- Товары из объявлений частных лиц (marketplace)
- Товары из витрин бизнеса (storefront products)

### 1.2. Просмотр товара

**Детальная страница товара включает:**
- Галерея изображений с лайтбоксом
- Цена (с отображением скидки если есть)
- Описание и характеристики
- Местоположение с учетом приватности:
  - `exact` - точный адрес
  - `approximate` - только улица
  - `city_only` - только город
  - `hidden` - адрес скрыт
- Информация о продавце
- Отзывы и рейтинг
- Похожие товары
- Кнопка "Написать продавцу"
- Кнопка "Купить" (если включены платежи)

### 1.3. Коммуникация с продавцом

**Система чата:**
- Real-time обмен сообщениями (WebSocket)
- Поддержка вложений (изображения, документы)
- Индикаторы набора текста
- Статус "онлайн/офлайн"
- История сообщений
- Уведомления о новых сообщениях
- Эмодзи и реакции

### 1.4. Процесс покупки

**Способы оплаты для B2C (витрины):**
1. **Оплата картой на сайте** - через платежный шлюз
2. **Наложенный платеж** - при получении в пункте выдачи или курьеру
3. **В магазине по QR-коду** - для самовывоза

**Способы оплаты для C2C (частные продавцы):**
1. **Наложенный платеж** - при получении в пункте выдачи или курьеру
2. **При личной встрече** - наличными продавцу
   - ⚠️ Оплата картой НЕ доступна для C2C

**Процесс оформления:**
1. Выбор способа доставки
2. Выбор способа оплаты (в зависимости от типа продавца)
3. Добавление сообщения продавцу (опционально)
4. Подтверждение заказа
5. Получение инструкций по оплате/получению

**Примечание об эскроу:**
- Эскроу-защита применяется только при онлайн-оплате (B2C)
- При наложенном платеже деньги поступают продавцу после доставки
- Период защиты 7 дней начинается с момента получения товара

### 1.5. После покупки

**Действия покупателя:**
- Подтверждение получения товара
- Открытие спора при проблемах
- Написание отзыва о продавце/товаре
- Просмотр истории заказов

## 2. Флоу продавца (Seller Journey)

### 2.1. Регистрация и создание профиля

**Типы продавцов:**
- Частные лица (обычные пользователи)
- Бизнес (владельцы витрин)

**Регистрация через:**
- Google OAuth 2.0
- Email/пароль (планируется)

### 2.2. Создание объявления (для частных лиц)

**Процесс создания:**
1. Выбор категории (иерархический выбор)
2. Заполнение атрибутов категории
3. Загрузка фотографий (до 10 штук)
4. Указание цены и описания
5. Выбор местоположения
6. Настройка приватности адреса
7. Публикация

### 2.3. Создание витрины (для бизнеса)

**Пошаговый мастер создания витрины:**
1. **Основная информация:**
   - Название магазина
   - Описание
   - Категория бизнеса
   - Контактные данные

2. **Местоположение:**
   - Выбор адреса на карте
   - Настройка приватности
   - Указание зоны обслуживания

3. **Часы работы:**
   - Расписание по дням недели
   - Праздничные дни
   - Перерывы

4. **Способы оплаты и доставки:**
   - Оплата картой на сайте
   - Наложенный платеж (COD)
   - Оплата в магазине по QR-коду
   - Интеграция с Почтой Сербии и DExpress

5. **Медиа:**
   - Загрузка логотипа
   - Баннер витрины
   - Фотографии магазина

### 2.4. Управление товарами витрины

**Добавление товара в витрину:**
1. Выбор категории
2. Заполнение атрибутов
3. Загрузка изображений
4. Цена и описание
5. **Выбор адреса товара:**
   - Использовать адрес витрины
   - Указать индивидуальный адрес
6. Управление запасами
7. Публикация

**Дополнительные возможности:**
- Массовый импорт товаров (CSV)
- Управление вариантами товара
- Установка скидок
- Временное скрытие товаров

### 2.5. Обработка заказов

**Уведомления продавца:**
- Push-уведомления о новых заказах
- Email-уведомления
- Уведомления в личном кабинете

**Действия с заказом:**
- Подтверждение наличия товара
- Отметка об отправке
- Добавление трек-номера
- Коммуникация с покупателем
- Подтверждение доставки

## 3. Система эскроу-счетов и платежей

### 3.1. Архитектура платежной системы

**Компоненты:**
- **payment_transactions** - все транзакции
- **escrow_payments** - эскроу-счета (только для онлайн-платежей)
- **user_balances** - балансы пользователей
- **marketplace_orders** - заказы

### 3.2. Способы оплаты по типам продавцов

**B2C (витрины):**
1. **Онлайн-оплата картой** - с эскроу-защитой
2. **Наложенный платеж (COD)** - без эскроу
3. **QR-код в магазине** - для самовывоза

**C2C (частные лица):**
1. **Наложенный платеж (COD)** - без эскроу
2. **Наличные при встрече** - без эскроу
3. ❌ Оплата картой недоступна

### 3.3. Жизненный цикл платежа с эскроу (только B2C онлайн)

1. **Создание заказа:**
   - Создается запись в marketplace_orders
   - Статус: `pending`

2. **Онлайн-оплата:**
   - Создается payment_transaction
   - Деньги списываются с карты покупателя
   - Создается escrow_payment
   - Статус эскроу: `held`

3. **Период защиты (7 дней):**
   - Начинается после получения товара
   - Покупатель может открыть спор
   - Продавец не может вывести деньги

4. **Завершение сделки:**
   - Автоматический релиз после 7 дней
   - Или ручное подтверждение покупателем
   - Статус эскроу: `released`
   - Деньги переводятся продавцу (минус комиссия 5%)

### 3.4. Процесс наложенного платежа (COD)

**Для B2C (витрины):**
1. **Оформление заказа** - без предоплаты
2. **Доставка товара** - курьерской службой
3. **Оплата при получении** - курьеру или в пункте выдачи
4. **Перевод продавцу** - после подтверждения доставки
5. **Комиссия 5%** - удерживается при переводе

**Для C2C (частные лица):**
1. **Оформление заказа** - без предоплаты
2. **Доставка товара** - выбранным способом
3. **Оплата при получении** - курьеру/в пункте выдачи
4. **Перевод продавцу** - полная сумма без комиссии
5. **Платформа зарабатывает** - на дополнительных услугах

### 3.5. Комиссии платформы

**Для B2C (витрины):**
- **Комиссия:** 5% от суммы сделки
- **Применяется ко всем продажам витрин**
- **Расчет:**
  - Цена товара: 1000 RSD
  - Комиссия платформы: 50 RSD
  - Продавец получает: 950 RSD

**Для C2C (частные лица):**
- **БЕЗ комиссии с продаж** ✅
- **Платные услуги:**
  - Продвижение объявления
  - Выделение в поиске
  - Дополнительные фото
  - VIP-статус объявления

## 4. Работа с картами и геолокацией

### 4.1. Интерактивная карта

**Функционал карты:**
- Отображение товаров и витрин
- Кластеризация при масштабировании
- Фильтрация по категориям
- Поиск в радиусе
- Изохроны (зоны пешей доступности)

### 4.2. Компоненты геолокации

**LocationPicker:**
- Выбор адреса через поиск
- Выбор точки на карте
- Обратное геокодирование
- Мультиязычная поддержка адресов

**SmartAddressInput:**
- Автодополнение адресов
- Интеграция с Mapbox Geocoding API
- Поддержка разных языков

### 4.3. Приватность местоположения

**Уровни приватности:**
1. **Точный адрес** - полный адрес с номером дома
2. **Приблизительный** - только улица
3. **Только город** - скрыта улица
4. **Скрытый** - адрес полностью скрыт

**Применение:**
- Для объявлений частных лиц
- Для витрин
- Для отдельных товаров витрин

## 5. Система отзывов и рейтингов

### 5.1. Типы отзывов

**Отзывы можно оставлять на:**
- Товары/объявления
- Продавцов/пользователей
- Витрины

### 5.2. Структура отзыва

**Компоненты отзыва:**
- Рейтинг (1-5 звезд)
- Текст отзыва
- Фотографии (до 5 штук)
- Теги (helpful/not helpful)

### 5.3. Модерация отзывов

**Статусы отзыва:**
- `draft` - черновик
- `published` - опубликован
- `disputed` - оспорен
- `confirmed` - подтвержден модератором

**Права на отзывы:**
- Только покупатели могут оставлять отзывы
- Продавец может ответить на отзыв
- Пользователи могут голосовать за полезность

### 5.4. Рейтинговая система

**Расчет рейтинга:**
- Средний рейтинг по всем отзывам
- Отдельный рейтинг для верифицированных отзывов
- Распределение по звездам
- Количество отзывов с фото

**Материализованные представления:**
- `user_rating_stats_mv` - статистика по пользователям
- `storefront_rating_stats_mv` - статистика по витринам
- `listing_rating_stats_mv` - статистика по товарам

## 6. Чат между покупателем и продавцом

### 6.1. Архитектура чата

**Технологии:**
- WebSocket для real-time сообщений
- Redux для управления состоянием
- Оптимистичные обновления UI

### 6.2. Функционал чата

**Возможности:**
- Текстовые сообщения
- Вложения (изображения, файлы)
- Индикаторы набора текста
- Статус прочтения
- Онлайн/офлайн статус
- История сообщений с пагинацией
- Поиск по чатам

### 6.3. Типы чатов

1. **Чат по объявлению:**
   - Инициируется с страницы товара
   - Привязан к конкретному товару
   - Отображает информацию о товаре

2. **Прямой чат:**
   - Между пользователями без привязки к товару
   - Для постоянных клиентов витрин

## 7. Логистика и доставка

### 7.1. Партнеры доставки

**Реализованные интеграции:**
- **Почта Сербии** - национальный почтовый оператор с широкой сетью отделений и поштоматов
- **DExpress.rs** - современная курьерская служба с быстрой доставкой

### 7.2. Опции доставки для C2C (частные продавцы)

**Доступные способы:**
1. **Курьерская доставка до двери**
   - Курьер забирает товар у продавца
   - Доставка до адреса покупателя
   - Отслеживание в реальном времени

2. **Поштоматы (пункты самовывоза)**
   - Продавец относит товар в поштомат
   - Покупатель забирает по коду
   - Доступно 24/7

3. **Отделение транспортной компании**
   - Продавец сдает в отделение
   - Покупатель забирает в своем отделении
   - Классический способ доставки

4. **Личная встреча**
   - Договариваются через чат
   - Без участия служб доставки
   - Для локальных сделок

### 7.3. Опции доставки для B2C (витрины/магазины)

**Дополнительные возможности для бизнеса:**
1. **Курьер забирает из магазина**
   - Регулярный забор товаров
   - Интеграция с расписанием магазина
   - Массовая отправка

2. **Магазин отвозит на склад**
   - Для крупных партий
   - Собственная логистика магазина
   - Оптовые тарифы

3. **Все опции C2C**
   - Доступны все способы для частных лиц
   - Гибкость выбора

### 7.4. Процесс оформления доставки

**Для покупателя:**
1. При оформлении заказа выбирает способ доставки
2. Видит стоимость каждого варианта
3. Указывает адрес доставки или пункт выдачи
4. Оплачивает товар + доставку
5. Получает трек-номер для отслеживания

**Для продавца:**
1. Получает уведомление о заказе с выбранным способом доставки
2. Получает транспортную накладную для печати
3. Упаковывает товар
4. Передает курьеру или отвозит в пункт приема
5. Отмечает отправку в системе

### 7.5. Интеграция с эскроу

**Особенности:**
- Эскроу-период начинается после получения товара покупателем
- Автоматическое продление при задержках доставки
- Интеграция трекинга с эскроу-системой
- Защита при потере или повреждении груза

### 7.6. Расчет стоимости доставки

**Факторы ценообразования:**
- Расстояние между городами
- Вес и габариты товара
- Выбранный способ доставки
- Срочность доставки
- Страховка груза

**Прозрачность для пользователей:**
- Калькулятор доставки на странице товара
- Сравнение тарифов разных служб
- Итоговая цена до оплаты

### 7.7. Способы оплаты при доставке

**Для B2C (витрины):**
- **Предоплата картой** - безопасно через платежный шлюз
- **Наложенный платеж (COD)** - оплата курьеру или в пункте выдачи
- **QR-код в магазине** - для самовывоза из магазина

**Для C2C (частные лица):**
- **Наложенный платеж (COD)** - оплата при получении
- **Наличные при встрече** - для локальных сделок
- ❌ **Оплата картой недоступна** для C2C транзакций

**Безопасность платежей:**
- Эскроу только для онлайн-платежей
- Подтверждение получения для COD
- Чеки и документы для всех транзакций

## 8. Витрины (Storefronts) и их функционал

### 8.1. Преимущества витрин

**Для продавцов:**
- Собственная страница магазина
- Управление каталогом товаров
- Аналитика и статистика
- Массовый импорт товаров
- Управление персоналом
- Интеграция с кассовыми системами

**Для покупателей:**
- Все товары продавца в одном месте
- Информация о режиме работы
- Способы оплаты и доставки
- Отзывы о магазине
- Подписка на обновления

### 8.2. Управление витриной

**Панель управления включает:**
- **Dashboard** - общая статистика
- **Товары** - управление каталогом
- **Заказы** - обработка заказов
- **Аналитика** - детальная статистика
- **Настройки** - информация о магазине
- **Персонал** - управление доступами

### 8.3. Аналитика витрины

**Метрики:**
- Просмотры страницы витрины
- Просмотры товаров
- Конверсия в заказы
- Средний чек
- Популярные товары
- География покупателей

### 8.4. SEO и маркетинг

**Оптимизация:**
- Дружественные URL (slug)
- Meta-теги для товаров
- Структурированные данные
- Sitemap
- Social sharing

## 9. Безопасность и доверие

### 9.1. Верификация пользователей

- OAuth через Google
- Подтвержденные отзывы
- История транзакций
- Рейтинг продавца

### 9.2. Защита сделок

- Эскроу-система
- Период защиты покупателя
- Система споров
- Модерация контента

### 9.3. Приватность данных

- Настройки приватности адресов
- Скрытие личных данных
- GDPR compliance
- Шифрование чувствительных данных

## 10. Монетизация платформы

### 10.1. Источники дохода

1. **Комиссия с продаж B2C** - 5% от продаж витрин
   - Применяется ко всем транзакциям витрин
   - Включает онлайн-платежи и COD
   - НЕ применяется к C2C продажам

2. **Платные услуги для C2C:**
   - Продвижение объявления
   - VIP-статус (выделение цветом)
   - Поднятие в топ поиска
   - Дополнительные фото (больше 10)
   - Статистика просмотров

3. **Платные услуги для витрин:**
   - Расширенная аналитика
   - Приоритет в поиске
   - Массовый импорт товаров
   - API доступ
   - Брендированная страница

4. **Реклама:**
   - Промо-места на главной
   - Баннеры в категориях
   - Спонсорские товары в поиске
   - Email-рассылки

### 10.2. Финансовая отчетность

**Для платформы:**
- Общий объем транзакций (GMV)
- Доход от комиссий
- Доход от платных услуг
- Конверсия и retention

## 11. Планы развития

### 11.1. Краткосрочные планы

- Мобильное приложение
- Push-уведомления
- ✅ Интеграция с доставками (реализовано: Почта Сербии, DExpress)
- Расширенная аналитика
- A/B тестирование

### 11.2. Долгосрочная стратегия

- AI-рекомендации товаров
- Видео-обзоры товаров
- Live-трансляции продаж
- Программа лояльности
- Международная экспансия

## Заключение

Платформа Sve Tu представляет собой комплексное решение для электронной коммерции, объединяющее:
- Классические объявления (C2C)
- Витрины для бизнеса (B2C)
- Защищенные платежи
- Геолокационные сервисы
- Социальные функции (чат, отзывы)

Архитектура платформы позволяет масштабировать бизнес как горизонтально (новые регионы), так и вертикально (новые функции и сервисы).