# Пошаговая инструкция по установке Harbor для Sve Tu Platform

Файлы успешно скопированы на сервер. Так как установка требует интерактивных действий и ввода пароля sudo, выполните следующие шаги:

## 1. Подключитесь к серверу

```bash
ssh dima@207.180.197.172
```

## 2. Перейдите в директорию с файлами

```bash
cd harbor_migration
```

## 3. Просмотрите файл конфигурации Harbor перед установкой

```bash
cat harbor_config.yml
```

В этом файле вы найдете пример конфигурации, которую нужно будет применить в процессе установки Harbor.

## 4. Запустите скрипт установки Docker и Harbor

```bash
./install_harbor.sh
```

В ходе выполнения скрипта:
- Введите пароль sudo при запросе
- Следуйте инструкциям на экране
- Когда скрипт предложит отредактировать harbor.yml, используйте настройки из harbor_config.yml
- Обязательно установите правильный hostname (IP-адрес сервера или доменное имя)
- Установите надежный пароль для администратора Harbor

## 5. После успешной установки Harbor

Запустите скрипт настройки CI/CD:

```bash
./setup_harbor_ci_cd.sh
```

Обратите внимание, что в этом скрипте также нужно будет ввести пароль sudo.

## 6. Проверьте доступность Harbor

После завершения установки:
- Откройте в браузере https://207.180.197.172 (или ваш домен)
- Войдите в систему с логином admin и паролем, указанным в harbor.yml

## 7. Перенесите образы Docker в Harbor

После успешного входа в Harbor:

```bash
./migrate_images.sh
```

Этот скрипт:
- Загрузит все необходимые базовые образы
- Пометит их соответствующими тегами для Harbor
- Отправит образы в реестр Harbor

## 8. Обновите docker-compose.yml

После миграции всех образов обновите файлы docker-compose.yml:
- В локальной среде разработки
- В продакшн-окружении

Замените пути к образам на новые, указывающие на Harbor:

```yaml
services:
  backend:
    image: 207.180.197.172/svetu/backend/api:latest
  frontend:
    image: 207.180.197.172/svetu/frontend/app:latest
  db:
    image: 207.180.197.172/svetu/db/postgres:15
```

## 9. Обновите скрипты деплоя

Обновите скрипт deploy.sh, чтобы он использовал новый registry:
- Добавьте аутентификацию в Harbor перед деплоем
- Обновите способ загрузки образов

## Дополнительная информация

Полная документация по установке и использованию Harbor доступна в файле:
```bash
cat harbor_instructions.md
```

Список всех образов, которые нужно перенести в Harbor:
```bash
cat docker_image_list.md
```