# Задание: Реализация реальных границ районов

## Цель
Заменить временные прямоугольные границы районов на реальные административные границы (полигоны) для всех городов Сербии в системе hostel-booking-system.

## Текущее состояние
- В базе данных есть 11 городов с 87 районами
- Все районы имеют временные прямоугольные границы размером 0.04° × 0.04°
- Границы созданы автоматически вокруг центральных точек районов
- Система работает, но границы не соответствуют реальным административным границам

## Требования

### 1. Источники данных
Найти и использовать один из следующих источников геоданных:
- **OpenStreetMap (OSM)** - бесплатный, наиболее доступный
- **Геодетска служба Србије** - официальные данные
- **GADM** (Global Administrative Areas) - глобальная база административных границ
- **Natural Earth** - упрощенные границы для картографии

### 2. Формат данных
- Получить данные в формате **GeoJSON**, **Shapefile** или **KML**
- Убедиться, что данные содержат:
  - Полигоны границ районов/муниципалитетов
  - Названия районов на сербском языке (кириллица)
  - Привязку к городам
  - Координаты в системе **WGS84 (EPSG:4326)**

### 3. Города для обработки
Обновить границы для следующих городов:

**Крупные города:**
- Београд (17 районов)
- Нови Сад (16 районов)

**Средние города:**
- Суботица (8 районов)
- Крагујевац (7 районов)
- Кикинда (5 районов)
- Ниш (5 районов)

**Малые города:**
- Лесковац (4 района)
- Панчево (4 района)
- Смедерево (4 района)
- Чачак (4 района)

### 4. Техническая реализация

#### 4.1 Обработка данных
```sql
-- Структура таблицы districts
-- boundary: geometry(Polygon,4326) - поле для хранения границ
-- center_point: geometry(Point,4326) - центральная точка
-- name: varchar(255) - название района
-- city_id: uuid - привязка к городу
```

#### 4.2 Алгоритм обновления
1. **Загрузка данных**: Скачать геоданные для Сербии
2. **Фильтрация**: Выбрать только нужные города и районы
3. **Сопоставление**: Сопоставить названия районов в данных с названиями в БД
4. **Валидация**: Проверить корректность полигонов
5. **Обновление**: Заменить временные границы на реальные

#### 4.3 SQL для обновления
```sql
UPDATE districts 
SET boundary = ST_GeomFromGeoJSON('{"type":"Polygon","coordinates":[...]}')
WHERE name = 'Название района' AND city_id = 'uuid-города';
```

### 5. Проблемы и решения

#### 5.1 Сопоставление названий
- **Проблема**: Названия в геоданных могут отличаться от названий в БД
- **Решение**: Создать таблицу соответствий или использовать fuzzy matching

#### 5.2 Качество данных
- **Проблема**: Некоторые районы могут отсутствовать в геоданных
- **Решение**: Оставить временные границы для отсутствующих районов

#### 5.3 Сложные полигоны
- **Проблема**: Некоторые границы могут быть очень детализированными
- **Решение**: Упростить полигоны с помощью ST_Simplify()

### 6. Инструменты разработки

#### 6.1 Для работы с геоданными
- **QGIS** - для визуализации и обработки
- **PostGIS** - для работы с геометрией в PostgreSQL
- **ogr2ogr** - для конвертации форматов
- **Python + GeoPandas** - для автоматизации обработки

#### 6.2 Для валидации
- **ST_IsValid()** - проверка корректности полигонов
- **ST_Area()** - проверка площади районов
- **ST_Contains()** - проверка вложенности районов в города

### 7. Этапы выполнения

#### Этап 1: Исследование (1-2 дня)
- Найти подходящие источники геоданных
- Изучить структуру данных
- Определить метод сопоставления названий

#### Этап 2: Подготовка данных (2-3 дня)
- Скачать и обработать геоданные
- Создать скрипты для конвертации
- Подготовить SQL-скрипты для обновления

#### Этап 3: Тестирование (1 день)
- Обновить границы для 1-2 городов
- Проверить корректность отображения на карте
- Протестировать поиск по районам

#### Этап 4: Массовое обновление (1 день)
- Обновить границы для всех городов
- Провести финальное тестирование
- Создать резервную копию БД

### 8. Критерии успеха
- ✅ Все районы имеют реальные административные границы
- ✅ Границы корректно отображаются на карте
- ✅ Поиск по районам работает с новыми границами
- ✅ Комбинированный поиск (район + радиус) работает корректно
- ✅ Производительность системы не ухудшилась

### 9. Дополнительные рекомендации

#### 9.1 Резервное копирование
```sql
-- Создать резервную копию текущих границ
CREATE TABLE districts_backup AS SELECT * FROM districts;
```

#### 9.2 Постепенное обновление
- Начать с одного города (например, Белград)
- Протестировать все функции
- Постепенно обновить остальные города

#### 9.3 Мониторинг
- Отслеживать производительность запросов после обновления
- Проверить корректность API ответов
- Убедиться в правильности отображения на frontend

### 10. Ожидаемый результат
После выполнения задания система будет иметь:
- Реальные административные границы всех районов
- Более точный поиск по районам
- Профессиональный вид карты с корректными границами
- Соответствие реальной географии Сербии

## Приоритет выполнения
**Высокий** - задача критична для качества пользовательского опыта и профессионального вида системы.

## Примерное время выполнения
**5-7 рабочих дней** (включая исследование, разработку и тестирование)
