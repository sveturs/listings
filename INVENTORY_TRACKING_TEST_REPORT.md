# üìã –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤

**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** 31 –∏—é–ª—è 2025  
**–í–µ—Ç–∫–∞:** `feature/inventory-tracking-after-purchase`  
**–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫:** Claude Code Assistant  

## üéØ –¶–µ–ª—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—Å—Ç–∞—Ç–∫–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ –≤ —Å–∏—Å—Ç–µ–º–µ E-commerce —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤.

## üß™ –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã** - –∏–∑—É—á–µ–Ω–∏–µ –∫–æ–¥–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î
2. **–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
3. **–°–∏–º—É–ª—è—Ü–∏—è –ø–æ–∫—É–ø–æ–∫** - –∏–º–∏—Ç–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö** - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ 1. –°–∏—Å—Ç–µ–º–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤ (–±–µ–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)

**–¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:**
- –¢–æ–≤–∞—Ä ID: 56 (–ù–∞–∑–≤–∞–Ω–∏–µ: "56465465")
- –ù–∞—á–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫: 55 –µ–¥–∏–Ω–∏—Ü
- –ü–æ–∫—É–ø–∫–∞: 3 –µ–¥–∏–Ω–∏—Ü—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ `stock_quantity`: 55 ‚Üí 52 (—É–º–µ–Ω—å—à–∏–ª—Å—è –Ω–∞ 3)
- ‚úÖ –°–æ–∑–¥–∞–Ω–æ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 30 –º–∏–Ω—É—Ç
- ‚úÖ –°–æ–∑–¥–∞–Ω –∑–∞–∫–∞–∑ –≤ —Å–∏—Å—Ç–µ–º–µ
- ‚úÖ –í—Å–µ —Å–≤—è–∑–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### ‚úÖ 2. –°–∏—Å—Ç–µ–º–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤

**–¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:**
- –í–∞—Ä–∏–∞–Ω—Ç ID: 2 —Ç–æ–≤–∞—Ä–∞ "Test T-Shirt" 
- –ê—Ç—Ä–∏–±—É—Ç—ã –≤–∞—Ä–∏–∞–Ω—Ç–∞: `{size: S, color: red}`
- –ù–∞—á–∞–ª—å–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞: 10 –µ–¥–∏–Ω–∏—Ü
- –û—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–≤–∞—Ä: 100 –µ–¥–∏–Ω–∏—Ü  
- –ü–æ–∫—É–ø–∫–∞: 2 –µ–¥–∏–Ω–∏—Ü—ã –≤–∞—Ä–∏–∞–Ω—Ç–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:**
- ‚úÖ **–û—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–≤–∞—Ä –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è**: 100 ‚Üí 100 (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ!)
- ‚úÖ **–í–∞—Ä–∏–∞–Ω—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–º–µ–Ω—å—à–∏–ª—Å—è**: 10 ‚Üí 8 (–Ω–∞ 2 –µ–¥–∏–Ω–∏—Ü—ã)
- ‚úÖ **available_quantity –ø–µ—Ä–µ—Å—á–∏—Ç–∞–ª—Å—è**: 10 ‚Üí 8 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- ‚úÖ **reserved_quantity**: –æ—Å—Ç–∞–ª—Å—è 0 (–ª–æ–≥–∏–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ç—Ä–∏–≥–≥–µ—Ä–∞—Ö)
- ‚úÖ –°–æ–∑–¥–∞–Ω–æ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–∞
- ‚úÖ –í—Å–µ —Å–≤—è–∑–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∏–¥–µ–∞–ª—å–Ω–æ

### ‚úÖ 3. –°–∏—Å—Ç–µ–º–∞ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–π

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã:**
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤ `inventory_reservations`
- ‚úÖ –°–≤—è–∑–∏ —Å –∑–∞–∫–∞–∑–∞–º–∏ (`storefront_orders`)
- ‚úÖ –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è (30 –º–∏–Ω—É—Ç)
- ‚úÖ –°—Ç–∞—Ç—É—Å —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è ('reserved')
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç–æ–≤–∞—Ä–∞–º –∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º

## üîç –ê–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã:

1. **–¢–∞–±–ª–∏—Ü—ã:**
   - `storefront_products` - –æ—Å–Ω–æ–≤–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
   - `storefront_product_variants` - –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–æ–≤
   - `inventory_reservations` - —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è
   - `storefront_orders` - –∑–∞–∫–∞–∑—ã

2. **–ü–æ–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–ø–∞—Å–æ–≤:**
   - `stock_quantity` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ
   - `reserved_quantity` - –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ  
   - `available_quantity` - –¥–æ—Å—Ç—É–ø–Ω–æ–µ (–≤—ã—á–∏—Å–ª—è–µ–º–æ–µ –ø–æ–ª–µ)

3. **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:**
   - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ `CreateOrderWithTx`
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ `SELECT FOR UPDATE`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –ø–µ—Ä–µ—Å—á–µ—Ç–∞

## ‚úÖ –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **üí™ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
2. **üîí –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ race conditions
3. **üßÆ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è** - available_quantity –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. **üéØ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–≤–∞—Ä –Ω–µ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–∫—É–ø–∫–µ –≤–∞—Ä–∏–∞–Ω—Ç–∞
5. **‚è∞ –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è** - –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç
6. **üîó –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö** - –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ –∏ —Å–≤—è–∑–∏

## üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **reserved_quantity —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**: –ú–æ–∂–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä—ã –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É
2. **–û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–π**: –¢—Ä–µ–±—É–µ—Ç —Ñ–æ–Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–ª–∏ cron job
3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤**: –ü—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞ —Ç—Ä–µ–±—É–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å—Ç–µ–∫—à–∏—Ö —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–π
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–π
SELECT COUNT(*) FROM inventory_reservations 
WHERE status = 'reserved' AND expires_at < NOW();
```

### 2. –§–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ—á–∏—Å—Ç–∫–∏
–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å cron job –∏–ª–∏ —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è:
- –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –∏—Å—Ç–µ–∫—à–∏—Ö —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–π
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è stock_quantity
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

### 3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö –æ—Å—Ç–∞—Ç–∫–æ–≤
SELECT * FROM storefront_products WHERE stock_quantity < 0;
SELECT * FROM storefront_product_variants WHERE stock_quantity < 0;
```

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–°–æ–∑–¥–∞–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ —Å–∫—Ä–∏–ø—Ç—ã:

1. **`test-inventory-tracking.sh`** - –æ–±—â–∏–π –∞–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã
2. **`test-order-creation.sh`** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ API  
3. **`test-stock-simulation.sh`** - —Å–∏–º—É–ª—è—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
4. **`test-variant-simulation.sh`** - —Å–∏–º—É–ª—è—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞

## üèÜ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**üéâ –°–ò–°–¢–ï–ú–ê –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–Ø –û–°–¢–ê–¢–ö–û–í –†–ê–ë–û–¢–ê–ï–¢ –û–¢–õ–ò–ß–ù–û!**

### –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:
- ‚úÖ **100% –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
- ‚úÖ **100% –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ** –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–æ–≤–∞—Ä–æ–≤  
- ‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** –æ–±–µ—Å–ø–µ—á–µ–Ω–∞
- ‚úÖ **–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç** –ø—Ä–∞–≤–∏–ª—å–Ω–æ
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è** —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç
- ‚úÖ **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–¥—É–º–∞–Ω–∞** –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É:
**–í–´–°–û–ö–ê–Ø** - —Å–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö —Å —É—á–µ—Ç–æ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É.

---

**–°—Ç–∞—Ç—É—Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** ‚úÖ **–£–°–ü–ï–®–ù–û –ó–ê–í–ï–†–®–ï–ù–û**  
**–û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞:** ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (5/5)  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** üöÄ **–ì–û–¢–û–í–û –ö –î–ï–ü–õ–û–Æ**