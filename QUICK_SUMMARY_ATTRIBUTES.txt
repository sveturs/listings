LISTINGS MICROSERVICE - ATTRIBUTES ARCHITECTURE - QUICK SUMMARY
================================================================

KEY FINDINGS:

1. ATTRIBUTES STORAGE - TWO SYSTEMS:
   
   Legacy (C2C):
   - Table: listing_attributes (key-value pairs)
   - Schema: id, listing_id, attribute_key, attribute_value
   - Status: Still exists but NOT used for B2C products
   
   Modern (B2C):
   - Location: attributes JSONB column in listings table
   - Supports: Nested objects, arrays, primitives
   - Indexed: GIN index for efficient queries
   - Status: ACTIVELY USED for products

2. ATTRIBUTE METADATA:
   
   NO METADATA TABLE EXISTS - No support for:
   - Attribute definitions per category
   - Type information (string, number, enum)
   - Validation rules
   - Required fields
   - Default values
   
   Current approach: Store-anything-goes with JSONB

3. CATEGORIES:
   
   Status: FULLY PRESENT
   - Table: categories (renamed from c2c_categories)
   - Features: Hierarchical, level tracking, custom UI support
   - Missing: Attribute definitions per category
   
4. GRPC ATTRIBUTES API:
   
   Products:
   - Accept: google.protobuf.Struct attributes
   - Validation: NONE
   - Schema: Flexible, no constraints
   
   Listings:
   - Use: repeated ListingAttribute (key-value)
   - Validation: NONE
   
   Categories:
   - Support: NO ATTRIBUTES
   
5. PRODUCT VARIANTS:
   
   Status: DEPRECATED but still referenced
   - Table: b2c_product_variants (DROPPED in Phase 11.5)
   - Code: Still tries to use it in product_variants_repository.go
   - Impact: Methods return errors
   - Attributes: variant_attributes JSONB (no storage)

6. DOMAIN MODELS:
   
   Product.Attributes: map[string]interface{} (from JSONB)
   ProductVariant.VariantAttributes: map[string]interface{} (JSONB)
   ProductVariant.Dimensions: map[string]interface{} (JSONB)
   Listing.Attributes: []*ListingAttribute (key-value table)
   
ARCHITECTURE ASSESSMENT:

STRENGTHS:
✓ Flexible - JSONB allows any structure
✓ Indexed - GIN indexes for performance
✓ Backward compatible - Old key-value table still there
✓ No schema changes needed - Can add new attributes anytime

WEAKNESSES:
✗ No validation - Accepts any data
✗ No metadata - Can't define allowed attributes
✗ No type enforcement - String/number/enum not validated
✗ No documentation - No schema definitions
✗ Inconsistent - C2C uses key-value, B2C uses JSONB
✗ Broken code - Variants code references dropped table

FILE LOCATIONS:

Database Schemas:
- Attributes (key-value): migrations/000001_initial_schema.up.sql
- Attributes (JSONB): migrations/000012_add_attributes_to_listings.up.sql
- B2C Products: migrations/000004_add_b2c_products.up.sql
- Categories: migrations/000011_restore_categories_table.up.sql

Domain Models:
- Product: internal/domain/product.go (line 10)
- ProductVariant: internal/domain/product.go (line 41)
- Listing: internal/domain/listing.go (line 10)

Repositories:
- Products: internal/repository/postgres/products_repository.go
- Variants: internal/repository/postgres/product_variants_repository.go (DEPRECATED)
- Categories: internal/repository/postgres/categories_repository.go

gRPC:
- Proto file: api/proto/listings/v1/listings.proto
- Product message: line 494-521
- Category message: line 458-474
- ListingAttribute message: line 420-427

ANSWERS TO KEY QUESTIONS:

Q: Is there a table for attribute metadata?
A: NO - not implemented

Q: How are attributes currently handled?
A: Two ways - C2C uses key-value table, B2C uses JSONB column

Q: What's the gRPC API for attributes?
A: Products accept protobuf.Struct (no schema validation)
   Listings use repeated ListingAttribute (key-value)
   Categories don't support attributes

Q: Are categories in the microservice?
A: YES - fully present with hierarchical support

For detailed analysis, see: ARCHITECTURE_ANALYSIS_ATTRIBUTES.md
